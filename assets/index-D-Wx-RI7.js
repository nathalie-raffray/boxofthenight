var e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m,g,_,v,y,x,w,b,E,M,S,T,A,C,R,P,k,O,I,L,D,N,U,F,z,B,V,H,W,j,G,X,q,Y,$,K,Z,Q,J,ee,te,ne,ie,re,ae,se,oe,le,ce,ue,he,de,pe,fe,me,ge,_e,ve,ye,xe,we,be,Ee,Me,Se,Te,Ae,Ce,Re,Pe,ke,Oe,Ie,Le,De,Ne,Ue,Fe,ze,Be,Ve,He,We,je,Ge,Xe,qe,Ye,$e,Ke,Ze,Qe,Je,et,tt,nt,it,rt,at,st,ot,lt,ct,ut,ht,dt,pt,ft,mt,gt,_t,vt,yt,xt,wt,bt,Et,Mt,St,Tt,At,Ct,Rt,Pt,kt,Ot,It,Lt,Dt,Nt,Ut,Ft,zt,Bt,Vt,Ht,Wt,jt,Gt,Xt,qt,Yt,$t,Kt,Zt,Qt,Jt,en,tn,nn,rn,an,sn,on,ln,cn,un,hn,dn,pn,fn,mn,gn,_n,vn,yn,xn,wn,bn,En,Mn,Sn,Tn,An,Cn,Rn,Pn,kn,On,In,Ln,Dn,Nn,Un,Fn,zn,Bn,Vn,Hn,Wn,jn,Gn,Xn,qn,Yn,$n,Kn,Zn,Qn,Jn,ei,ti,ni,ii,ri,ai,si,oi,li,ci,ui,hi,di,pi,fi,mi,gi,_i,vi,yi,xi,wi,bi,Ei,Mi,Si,Ti,Ai,Ci,Ri,Pi,ki,Oi,Ii,Li,Di,Ni,Ui,Fi,zi,Bi=Object.defineProperty,Vi=e=>{throw TypeError(e)},Hi=(e,t,n)=>((e,t,n)=>t in e?Bi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),Wi=(e,t,n)=>t.has(e)||Vi("Cannot "+n),ji=(e,t,n)=>(Wi(e,t,"read from private field"),n?n.call(e):t.get(e)),Gi=(e,t,n)=>t.has(e)?Vi("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Xi=(e,t,n,i)=>(Wi(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),qi=(e,t,n)=>(Wi(e,t,"access private method"),n),Yi=(e,t,n,i)=>({set _(i){Xi(e,t,i,n)},get _(){return ji(e,t,i)}});function $i(e,t){for(var n=0;n<t.length;n++){const i=t[n];if("string"!=typeof i&&!Array.isArray(i))for(const t in i)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(i,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>i[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Ki=[{name:"Diary Goggles",desc:["Diary goggles given by a pink guy I met with no eyes."],type:"garb"},{name:"sardine_pen",desc:["A one-of-a-kind pen in the shape of a sardine."],type:"cursor",img:"/img/cursors/sardine_pen_cursor.webp",imgDimensions:[83,78],imgPosition:[0,0]},{name:"box_of_the_night",desc:[""],type:"viewable",img:"/img/rooms/outside/box_of_the_night.jpg"},{name:"red_lightbulb",desc:["Red, the color of my true love's.."],type:"cursor",img:"/img/cursors/red_lightbulb_cursor.webp",imgDimensions:[36,63],imgPosition:[18,31]},{name:"key1",desc:[""],type:"cursor",img:"/img/cursors/key_cursor.webp",imgDimensions:[61,29],imgPosition:[18,31]},{name:"key2",desc:[""],type:"cursor",img:"/img/cursors/key_cursor.webp",imgDimensions:[61,29],imgPosition:[18,31]}],Zi=e=>Ki.find((t=>t.name===e)),Qi=e=>{var t;return"cursor"===(null==(t=Zi(e))?void 0:t.type)},Ji={living_room:{name:"living_room",subRooms:[{name:"living_room1",img:["/img/rooms/living_room/living_room1.png","/img/rooms/living_room/living_room2.jpg","/img/rooms/living_room/living_room3.jpg","/img/rooms/living_room/living_room4.jpg","/img/rooms/living_room/living_room5.jpg"],adjacentRooms:[{room:"living_room",subRoom:"living_room2",entry:{type:"arrow",position:{left:.94,top:.87},char:"→",tooltip:"Go thissa way"}},{room:"living_room",subRoom:"living_room3",entry:{type:"arrow",position:{left:.05,top:.3},char:"←",tooltip:"Go thatta way"}}],items:[{name:"sardine_pillow",img:"/img/rooms/living_room/sardine_pillow.webp",position:[.437,.247],dimensions:[.1,.03],desc:["A one-of-a-kind sardine pillow. These things can go up to 300$. Such a sexy addition to the living room."]},{name:"porcelain-faced_clown",img:"/img/rooms/living_room/vic_with_clowns.webp",position:[.648,.22],dimensions:[.05,.08],desc:["Porcelain-faced clown babies perched on the cat tree, donning small satin garbs. A clown in a room is an omen of laughter.","A good wink, when done right, goes DINGGGG!"]},{name:"sardine_pen",img:"/img/rooms/living_room/sardine_pen.webp",position:[.1098,.655],dimensions:[.02,.12],desc:["What do you call a sardine with a pen? A little fish with big ideas!","Why did the sardine start a blog? Because it wanted to make a splash with its fin-tastic writing!","Why did the sardine bring a pen to the party? Because it wanted to ink a deal on a fishy business!","Why did the sardine start a diary? Because it wanted to share its *school* of thought!","Why did the sardine carry a pen? To make sure its thoughts were always well-preserved!"]},{name:"sardine",img:"/img/rooms/living_room/sardine.webp",position:[.673,.335],dimensions:[.045,.02],desc:["Eating a sardine is said to make you slimey and street smart, like a new yorker."]},{name:"tic_tacs",img:"/img/rooms/living_room/tic_tacs.webp",position:[.895,.547],dimensions:[.03,.04],desc:["Someone left their tic tacs here."]},{name:"mystery",img:"/img/rooms/living_room/mystery.webp",position:[.242,.765],dimensions:[.067,.12],desc:["Ooooooo, interesting, mysterious...I should come back to this another time."],shouldntTally:!0,canClick:e=>3===e.roomToImgIndex.living_room&&3!==e.dayIndex},{name:"mystery",img:"/img/rooms/living_room3/black.webp",position:[.242,.765],dimensions:[.067,.12],desc:[""],shouldntTally:!0,canClick:e=>3===e.roomToImgIndex.living_room&&3===e.dayIndex&&"souls_imbued"===e.hornyVortexPhase}],actionItems:[{name:"lamp",position:[.155,.245],dimensions:[.09,.26],desc:[""],action:{isActive:e=>null===e.hornyVortexPhase,reduxAction:{type:"CLICK_LAMP"},compatibleCursorItemName:"red_lightbulb"}}]},{name:"living_room2",img:["/img/rooms/living_room2/livingroom2_1.png","/img/rooms/living_room2/livingroom2_2.jpg","/img/rooms/living_room2/livingroom2_3.jpg","/img/rooms/living_room2/livingroom2_4.jpg","/img/rooms/living_room2/livingroom2_5.jpg"],adjacentRooms:[{room:"living_room",subRoom:"living_room1",entry:{type:"arrow",position:{left:.07,top:.3},char:"←",tooltip:"Go thatta way"}},{room:"living_room",subRoom:"living_room3",entry:{type:"arrow",position:{left:.95,top:.1},char:"→",tooltip:"Go thissa way"}}],items:[{name:"tic_tacs",img:"/img/rooms/living_room/tic_tacs.webp",position:[.23,.63],dimensions:[.035,.04],desc:["Someone left their tic tacs here."]},{name:"Cocteau Twins - Treasure",img:"/img/rooms/living_room2/treasure.webp",position:[.365,.255],dimensions:[.01,.17],desc:["The sweet ghostly wails of Elizabeth Fraser... My favorite track on here is Beatrix, which is in 3/4 and is essentially a waltz. You could waltz to it.","\"It is divine inspiration. I don't think I'll be alive when people finally realize Elizabeth Fraser had a holy Voice.\"\n\n                -@srpntnova, Youtube comment",'Elizabeth Fraser told this story about how she was sitting on a bed and the band was practicing in the other room. \n                What residue of sound came through the walls was so gorgeous and haunting that she mouthed the lyrics while sitting on her bed.\n                She decided she wanted her voice to sound like that unintelligible distant beauty of music through a wall. Some of my favorite songs \n                of hers are those where the lyrics are so undecipherable because she sings not in the intent of pronouncing words but in the intent\n                of creating a sung sculpture that uses the English language as its base but becomes completely alien to it. "Blue Bell Knoll" is like that.\n                She sings as if she is blowing glass by breath heat, and creates a hollow glass form ringing with buzzing guitar and the last verse. \n                She plays her voice as an instrument, it\'s kind of crazy actually.',"All the dream pop that came after Cocteau Twins was poor imitation and most of it is facile and annoying."]},{name:"Cheb Hasni - J'ai mal au coeur",img:"/img/rooms/living_room2/cheb_hasni.jpg",position:[.29,.439],dimensions:[.01,.17],desc:["Cheb Hasni is an Algerian Rai singer. This album is so FUCKING GOOD!! It's raw and energetic as fuck, the mixing is fucked, its heart is beating.",'I love the occasional evocative French I can understand: "j\'ai mal au coeur", "je garde toujours espoir". He was assassinated when he was 26 by Islamic fundamentalists for being a loverboy. He\'s a legend in Algeria, Rest In Peace. He sings about sleepless nights caused by heartbreak and societal issues.']},{name:"Kate Bush - The Dreaming",img:"/img/rooms/living_room2/kate_bush_the_dreaming.webp",position:[.24,.25],dimensions:[.01,.17],desc:["Kate Bush. Follow down the path of her theatrics. Although the Dreaming is a SEAMLESSLY musically coherent album, each of its songs in its content is a stand-alone, a story in itself. This is important to keep in mind with Kate Bush: each song is a story. And more often than not 'Kate Bush' isn't a character in it. It could be from the perspective of a bank robber, a soldier, a fetus, a scorned lover, a mad psychologist's son, a character from a book, etc, etc. This is rare in rock music! Most rock musicians tend to write and think from their own experience only.","This was her first album which she produced entirely without any outside contribution, and it's probably her most experimental and my favorite - music wise.","Favorite Tracks (they are all good though): There Goes a Tenner, Pull Out the Pin, The Dreaming, Night of the Swallow (where her voice imitates the swooping ups and downs of a swallow in flight, a metaphor for a young pilot tasking a risk to fly against the wishes of his mother)"]},{name:"John Maus - Songs",img:"/img/rooms/living_room2/john_maus.png",position:[.403,.255],dimensions:[.01,.17],desc:["A collection of songs by John Maus which embody the deep tortorous lovesick state when you are alone and thinking of that special one. That special intensity that arises...","\"You stupid bitch.. you mutilate my soul.. I'll cut all my fingers just to touch you... I want to put my fingers deep inside you... I wonder if you're thinking of me now\"","Listening to this album has caused a quite rational emotionally stunted person as myself to fall into hysteric love states. So thank you, John Maus...I guess I had it in me all along...","Even though the man himself speaks like a BA-in-philosophy dialectical trash chute, his lyrics are simple and repetitive. His brother (R.I.P.) described them as 'mantras'. They really touch me, as well as his monastic deep voice. I want to perform like him one day - sweating and jumping and crying in a pitstained button up, not giving a fuck, being pure and raw."]}],actionItems:[{name:"tv_switch",position:[.54,.2],dimensions:[.018,.009],img:"/img/rooms/living_room2/tv_switch.webp",imgDimensions:[.018,.009],imgPosition:[.54,.2],desc:[""],action:{reduxAction:{type:"CLICK_TV"}}}]},{name:"living_room3",img:["/img/rooms/living_room3/white.webp","/img/rooms/living_room3/purple.webp","/img/rooms/living_room3/white.webp","/img/rooms/living_room3/red.webp","/img/rooms/living_room3/black.webp"],adjacentRooms:[{room:"living_room",subRoom:"living_room1",entry:{type:"arrow",position:{left:.95,top:.2},char:"→",tooltip:"Go thatta way"}},{room:"living_room",subRoom:"living_room2",entry:{type:"arrow",position:{left:.05,top:.3},char:"←",tooltip:"Go thissa way"}},{room:"nats_room",subRoom:"nats_room1",entry:{type:"door",position:{left:.27,top:.2},dimensions:{height:284.5,width:139.5},roomColor:"#9f2323"}},{room:"vics_room",subRoom:"vics_room1",entry:{type:"door",position:{left:.6,top:.2},dimensions:{height:284.5,width:139.5},roomColor:"yellow"}}],items:[]}]},nats_room:{name:"nats_room",subRooms:[{name:"nats_room1",img:["/img/rooms/nats_room/natroom1.png","/img/rooms/nats_room/natsroom2.jpg","/img/rooms/nats_room/natsroom3.jpg","/img/rooms/nats_room/natsroom4.jpg","/img/rooms/nats_room/natsroom5.jpg"],adjacentRooms:[{room:"living_room",subRoom:"living_room3",entry:{type:"arrow",position:{left:.5,top:.94},char:"↓",tooltip:"Go thissa way"}}],items:[{name:"clown",img:"/img/rooms/nats_room/clown.webp",position:[.757,.42],dimensions:[.03,.05],desc:["Don't mind me. I am a sexless observer.","I enjoy to exist in the periphery of things."]},{name:"tomita",img:"/img/rooms/nats_room/tomita.webp",position:[.3394,.194],dimensions:[.11,.22],desc:["Tomita the synth maestro takes on Gustav Holst's \"The Planets\", a classical piece first composed in 1917. \n            A lot of classical music is about an unraveling unabridged emotional journey. \n            Vivaldi's Four Seasons was the first classical piece that with great intention placed its musical setting\n            holistically in nature, instructing violinists to imitate a looming storm, fleeting streaks of lightning across the sky, or the sound of shepherd's dog barking.\n            \"The Planets\" takes place in space. It imagines the music of the spheres, and the character of each planet (believe it or not Holst was an avid astrologist).\n            What does it sound like out there, and where is the music coming from?\n            Tomita realized it with electronics, which Holst may have used were they available in his day. It's gorgeous."]},{name:"mask",img:"/img/rooms/nats_room/mask.webp",position:[.055,.11],dimensions:[.065,.19],desc:["The mask with the Mona Lisa smile. \n            I found it slyly lying amongst candles at the old candle shop down the street.","The owner of the shop I got it from is this stubby tan man. Local Greek business owner that's been here for years.","He made this mask with his bare hands. Shout out Astor Candles."]},{name:"hot rod to hell",img:"/img/rooms/nats_room/hotrodtohell.webp",position:[.93,.809],dimensions:[.11,.21],desc:["These are the stories of the dark twisted heart of gay New York back when it was dangerous\n            and the thrill was at the risk of hanging like a sow from the ceiling of some gay killer. Who knew\n            that's what music could be. A man talking over a beat. Maybe it will gross you out. There's a lot of talk\n            of cock exploding and geysers of cum. I fucking love Man Parrish too...(Music by Man Parrish, spoken word by Roy Garrett)."]},{name:"sacred heart",img:"/img/rooms/nats_room/sacredheart.webp",position:[.403,.645],dimensions:[.09,.222],desc:["This is the symbol of the sacred heart. \n            I bought it on the hillside Basilica overlooking the city of Lyon. \n            From the streets below you can make out the sculpture at its helm. \n            It depicts the archangel Michael smiting the devil, who lies belligerent and squirming under the weight of the angel's foot,\n            under the threat of impalation.","I bought one for Vic too as a token of immortal friendship.",'"friendship"']},{name:"nats_virgin_penis",img:"/img/rooms/nats_room/nvp.webp",imgPosition:[.13,.73],imgDimensions:[.08,.18],position:[.13,.73],dimensions:[.08,.18],desc:["My virgin penis."],shouldntTally:!0,canClick:e=>3===e.dayIndex},{name:"einsturzende neubeuten",img:"/img/rooms/nats_room/einstenzurndeneubuten.webp",position:[.832,.03],dimensions:[.03,.05],desc:["this noise music is about the darkness specifically my schnitzel"]},{name:"Coucou Mon Minou",img:"/img/rooms/nats_room/coucoumonminou.webp",position:[.831,.14],dimensions:[.04,.09],desc:["She brings me comfort."]}],actionItems:[{name:"lamp",position:[.6856,.29],dimensions:[.03,.26],desc:["A nice candle"],action:{isActive:e=>null===e.hornyVortexPhase,reduxAction:{type:"CLICK_LAMP"},compatibleCursorItemName:"red_lightbulb"}},{name:"pillow",desc:["Sleep on me"],actionOptions:[{name:"sleep",reduxAction:{type:"SLEEP"}}],optionDisplayOffset:[.02,-.015],position:[.8298,.38],dimensions:[.05,.07]},{name:"open window",desc:[""],actionOptions:[{name:"escape",reduxAction:{type:"ENTER_ROOM",payload:{room:"outside",subRoom:"outside1"}}}],optionDisplayOffset:[-.02,-.12],position:[.205,.689],dimensions:[.1,.15]},{name:"diary",desc:["Oh fuck someone could just read this...."],img:"/img/rooms/nats_room/nats_diary.webp",imgDimensions:[.07,.12],imgPosition:[.833,.51],optionDisplayOffset:[-.05,-.05],actionOptions:[{name:"open",isActive:e=>e.equipped.includes("Diary Goggles"),reduxAction:{type:"READ_DIARY",payload:!0}}],position:[.833,.51],dimensions:[.07,.12]}]}]},vics_room:{name:"vics_room",subRooms:[{name:"vics_room1",img:["/img/rooms/vics_room/vicsroom.png","/img/rooms/vics_room/vicsroom_heartsbokeh.jpg","/img/rooms/vics_room/vicroom_coloredsketch.jpg","/img/rooms/vics_room/vicsroom_redroom.jpg","/img/rooms/vics_room/vicroom_redroom.jpg","/img/rooms/vics_room/vicsroom_party.jpg"],adjacentRooms:[{room:"living_room",subRoom:"living_room3",entry:{type:"arrow",position:{left:.2,top:.94},char:"↓",tooltip:"Go thissa way"}}],items:[{name:"boink",img:"/img/rooms/vics_room/binkyonbed.webp",position:[.69,.7],dimensions:[.1,.14],desc:["Binky a.k.a. Boink is an angel sent by god, birthed at a crackhead farm in Salasberry-de-Valleyfield.","It is a cardinal sin to call Binky names like fat and whore and Binklestein Grumplestein. \n                A one way ticket to hell."]},{name:"sacred heart",img:"/img/rooms/nats_room/sacredheart.webp",position:[.715,.225],dimensions:[.12,.27],desc:["This heart's made of adamantium gold. It can take a real pounding.","Light of my life, fire of my loins. My sin, my soul. You know the rest...","All there is in life is experience and its decay. \n                In this moment right now, you are experiencing the decay of experience. \n                No matter how strong the initial intake of experience was, it will waste away\n                in the mind's corridors.\n                There may be no such thing as an eternal fire, but\n                I posit a metamorphosing fire, which takes upon different forms."]},{name:"fuzzy wuzzy abomination",img:"/img/rooms/vics_room/unibrow.png",position:[.378,.45],dimensions:[.065,.03],desc:["What can this be? Let me touch it. It feels like I'm two inches away from an Algerian asshole.","Oh I know what this is. It's Vic's unibrow.","Vic's unibrow. Wow what a treat. It must have fallen off during her beauty sleep.","Normally I'd pocket this but I already have a copy of Arabian nights in my room.","If only I knew how to knit I could make a wooly winter scarf with this thing.","I wish she just let it grow out... it's fucking sexy."]},{name:"vivienne westwood necklace",img:"/img/rooms/vics_room/vivienne_westwood.webp",position:[.0885,.63151],dimensions:[.1,.1],desc:["Wow...Fashion!"]}],actionItems:[{name:"lamp",position:[.3697,.27],dimensions:[.05,.13],desc:["A nice lamp"],action:{isActive:e=>null===e.hornyVortexPhase,reduxAction:{type:"CLICK_LAMP"},compatibleCursorItemName:"red_lightbulb"}},{name:"Victoria's journals",desc:[""],img:"/img/rooms/vics_room/vics_diary.webp",imgDimensions:[.07,.16],imgPosition:[.335,.587],actionOptions:[{name:"read",isActive:e=>e.equipped.includes("Diary Goggles"),reduxAction:{type:"READ_DIARY",payload:!0}}],position:[.335,.587],dimensions:[.07,.16]}]}]},outside:{name:"outside",subRooms:[{name:"outside1",img:["/img/rooms/outside/outside1.jpg","/img/rooms/outside/outside_night.jpg","/img/rooms/outside/outside_comic_brick.jpg","/img/rooms/outside/outside_comic_brick2.jpg","/img/rooms/outside/outside_comic_3dwall.jpg","/img/rooms/outside/outside_sketch.jpg","/img/rooms/outside/outside_sunset.jpg","/img/rooms/outside/outside_red.jpg","/img/rooms/outside/outside_party.jpg"],adjacentRooms:[{room:"nats_room",subRoom:"nats_room1",entry:{type:"arrow",position:{left:.08,top:.75},char:"↑",tooltip:"Crawl back in your room",color:"#b9b9b9"}},{room:"sunset",subRoom:"sunset1",entry:{type:"arrow",position:{left:.04,top:.94},char:"←",tooltip:"..."}}],items:[{name:"a sign",img:"/img/rooms/outside/sign1.webp",position:[.25,.77],dimensions:[.07,.1],imgPosition:[.25,.77],imgDimensions:[.07,.1],desc:[""],canClick:e=>0===e.dayIndex},{name:"another sign",img:"/img/rooms/outside/sign2.webp",position:[.45,.54],dimensions:[.07,.1],imgPosition:[.45,.54],imgDimensions:[.07,.1],desc:[""],canClick:e=>0===e.dayIndex},{name:"another another sign",img:"/img/rooms/outside/sign3.webp",position:[.84,.6],dimensions:[.07,.1],imgPosition:[.84,.6],imgDimensions:[.07,.1],desc:[""],canClick:e=>0===e.dayIndex}],actionItems:[{name:"lamp",position:[.06,.075],dimensions:[.12,.13],desc:[""],action:{reduxAction:{type:"CLICK_LAMP"},isActive:e=>(0===e.equipped.length||e.equipped.includes("red_lightbulb"))&&null===e.hornyVortexPhase}},{name:"Venus",desc:[""],optionDisplayOffset:[.04,0],actionOptions:[{name:"talk",isActive:e=>1===e.roomToImgIndex.outside,reduxAction:{type:"START_CONVO",payload:"meet_venus"}}],position:[.2546,.0646],dimensions:[.03,.03]},{name:"White Dwarf",desc:[""],optionDisplayOffset:[.04,0],actionOptions:[{name:"talk",isActive:e=>1===e.roomToImgIndex.outside,reduxAction:{type:"START_CONVO",payload:"meet_white_dwarf"}}],position:[.459,.1215],dimensions:[.03,.03]},{name:"North Star",desc:[""],optionDisplayOffset:[.04,0],actionOptions:[{name:"talk",isActive:e=>1===e.roomToImgIndex.outside,reduxAction:{type:"START_CONVO",payload:"meet_north_star"}}],position:[.808,.066],dimensions:[.03,.03]},{name:"Moon",desc:[""],optionDisplayOffset:[-.07,0],actionOptions:[{name:"talk",isActive:e=>1===e.roomToImgIndex.outside,reduxAction:{type:"START_CONVO",payload:"meet_moon"}}],position:[.93,.1411],dimensions:[.09,.21]}]},{name:"oracle",img:[],adjacentRooms:[],items:[]}]},sunset:{name:"sunset",subRooms:[{name:"sunset1",img:["/img/rooms/outside/look_down_the_street.gif","/img/rooms/outside/oracle_entrance.gif","/img/rooms/outside/look_down_the_street.gif"],adjacentRooms:[{room:"outside",subRoom:"outside1",entry:{type:"arrow",position:{left:.5,top:.9},char:"↓",tooltip:"alas, one must go back to fight yesterday's battles.."}},{room:"sunset",subRoom:"oracle",entry:{type:"door",position:{left:.465,top:.47},dimensions:{height:0,width:0},roomColor:"black"}}],items:[]}]}};function er(e){return Ji[e]}function tr(e,t){return er(e).subRooms.find((({name:e})=>e===t))}!function(){const e=document.createDocumentFragment();(function(){const e=[];for(const t in Ji){const n=Ji[t];for(const t of n.subRooms)e.push(...t.img)}for(const t of Ki)void 0!==t.img&&e.push(t.img);return e})().forEach((t=>{const n=document.createElement("link");n.rel="preload",n.href=t,n.as="image",e.appendChild(n)})),document.head.appendChild(e)}();var nr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ir(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var rr={exports:{}},ar={},sr={exports:{}},or={},lr=Symbol.for("react.element"),cr=Symbol.for("react.portal"),ur=Symbol.for("react.fragment"),hr=Symbol.for("react.strict_mode"),dr=Symbol.for("react.profiler"),pr=Symbol.for("react.provider"),fr=Symbol.for("react.context"),mr=Symbol.for("react.forward_ref"),gr=Symbol.for("react.suspense"),_r=Symbol.for("react.memo"),vr=Symbol.for("react.lazy"),yr=Symbol.iterator;var xr={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wr=Object.assign,br={};function Er(e,t,n){this.props=e,this.context=t,this.refs=br,this.updater=n||xr}function Mr(){}function Sr(e,t,n){this.props=e,this.context=t,this.refs=br,this.updater=n||xr}Er.prototype.isReactComponent={},Er.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Er.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},Mr.prototype=Er.prototype;var Tr=Sr.prototype=new Mr;Tr.constructor=Sr,wr(Tr,Er.prototype),Tr.isPureReactComponent=!0;var Ar=Array.isArray,Cr=Object.prototype.hasOwnProperty,Rr={current:null},Pr={key:!0,ref:!0,__self:!0,__source:!0};function kr(e,t,n){var i,r={},a=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)Cr.call(t,i)&&!Pr.hasOwnProperty(i)&&(r[i]=t[i]);var o=arguments.length-2;if(1===o)r.children=n;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];r.children=l}if(e&&e.defaultProps)for(i in o=e.defaultProps)void 0===r[i]&&(r[i]=o[i]);return{$$typeof:lr,type:e,key:a,ref:s,props:r,_owner:Rr.current}}function Or(e){return"object"==typeof e&&null!==e&&e.$$typeof===lr}var Ir=/\/+/g;function Lr(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function Dr(e,t,n,i,r){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var s=!1;if(null===e)s=!0;else switch(a){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case lr:case cr:s=!0}}if(s)return r=r(s=e),e=""===i?"."+Lr(s,0):i,Ar(r)?(n="",null!=e&&(n=e.replace(Ir,"$&/")+"/"),Dr(r,t,n,"",(function(e){return e}))):null!=r&&(Or(r)&&(r=function(e,t){return{$$typeof:lr,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(r,n+(!r.key||s&&s.key===r.key?"":(""+r.key).replace(Ir,"$&/")+"/")+e)),t.push(r)),1;if(s=0,i=""===i?".":i+":",Ar(e))for(var o=0;o<e.length;o++){var l=i+Lr(a=e[o],o);s+=Dr(a,t,n,l,r)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=yr&&e[yr]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),o=0;!(a=e.next()).done;)s+=Dr(a=a.value,t,n,l=i+Lr(a,o++),r);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function Nr(e,t,n){if(null==e)return e;var i=[],r=0;return Dr(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function Ur(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var Fr={current:null},zr={transition:null},Br={ReactCurrentDispatcher:Fr,ReactCurrentBatchConfig:zr,ReactCurrentOwner:Rr};function Vr(){throw Error("act(...) is not supported in production builds of React.")}or.Children={map:Nr,forEach:function(e,t,n){Nr(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return Nr(e,(function(){t++})),t},toArray:function(e){return Nr(e,(function(e){return e}))||[]},only:function(e){if(!Or(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},or.Component=Er,or.Fragment=ur,or.Profiler=dr,or.PureComponent=Sr,or.StrictMode=hr,or.Suspense=gr,or.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Br,or.act=Vr,or.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=wr({},e.props),r=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=Rr.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)Cr.call(t,l)&&!Pr.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==o?o[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];i.children=o}return{$$typeof:lr,type:e.type,key:r,ref:a,props:i,_owner:s}},or.createContext=function(e){return(e={$$typeof:fr,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:pr,_context:e},e.Consumer=e},or.createElement=kr,or.createFactory=function(e){var t=kr.bind(null,e);return t.type=e,t},or.createRef=function(){return{current:null}},or.forwardRef=function(e){return{$$typeof:mr,render:e}},or.isValidElement=Or,or.lazy=function(e){return{$$typeof:vr,_payload:{_status:-1,_result:e},_init:Ur}},or.memo=function(e,t){return{$$typeof:_r,type:e,compare:void 0===t?null:t}},or.startTransition=function(e){var t=zr.transition;zr.transition={};try{e()}finally{zr.transition=t}},or.unstable_act=Vr,or.useCallback=function(e,t){return Fr.current.useCallback(e,t)},or.useContext=function(e){return Fr.current.useContext(e)},or.useDebugValue=function(){},or.useDeferredValue=function(e){return Fr.current.useDeferredValue(e)},or.useEffect=function(e,t){return Fr.current.useEffect(e,t)},or.useId=function(){return Fr.current.useId()},or.useImperativeHandle=function(e,t,n){return Fr.current.useImperativeHandle(e,t,n)},or.useInsertionEffect=function(e,t){return Fr.current.useInsertionEffect(e,t)},or.useLayoutEffect=function(e,t){return Fr.current.useLayoutEffect(e,t)},or.useMemo=function(e,t){return Fr.current.useMemo(e,t)},or.useReducer=function(e,t,n){return Fr.current.useReducer(e,t,n)},or.useRef=function(e){return Fr.current.useRef(e)},or.useState=function(e){return Fr.current.useState(e)},or.useSyncExternalStore=function(e,t,n){return Fr.current.useSyncExternalStore(e,t,n)},or.useTransition=function(){return Fr.current.useTransition()},or.version="18.3.1",sr.exports=or;var Hr=sr.exports;const Wr=ir(Hr),jr=$i({__proto__:null,default:Wr},[Hr]);
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var Gr=Hr,Xr=Symbol.for("react.element"),qr=Symbol.for("react.fragment"),Yr=Object.prototype.hasOwnProperty,$r=Gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kr={key:!0,ref:!0,__self:!0,__source:!0};function Zr(e,t,n){var i,r={},a=null,s=null;for(i in void 0!==n&&(a=""+n),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(s=t.ref),t)Yr.call(t,i)&&!Kr.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:Xr,type:e,key:a,ref:s,props:r,_owner:$r.current}}ar.Fragment=qr,ar.jsx=Zr,ar.jsxs=Zr,rr.exports=ar;var Qr=rr.exports,Jr={exports:{}},ea={},ta={exports:{}},na={};
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,a=e[i];if(!(0<r(a,t)))break e;e[i]=t,e[n]=a,n=i}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,a=e.length,s=a>>>1;i<s;){var o=2*(i+1)-1,l=e[o],c=o+1,u=e[c];if(0>r(l,n))c<a&&0>r(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[o]=n,i=o);else{if(!(c<a&&0>r(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();e.unstable_now=function(){return s.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,_="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function y(e){for(var r=n(c);null!==r;){if(null===r.callback)i(c);else{if(!(r.startTime<=e))break;i(c),r.sortIndex=r.expirationTime,t(l,r)}r=n(c)}}function x(e){if(m=!1,y(e),!f)if(null!==n(l))f=!0,O(w);else{var t=n(c);null!==t&&I(x,t.startTime-e)}}function w(t,r){f=!1,m&&(m=!1,_(S),S=-1),p=!0;var a=d;try{for(y(r),h=n(l);null!==h&&(!(h.expirationTime>r)||t&&!C());){var s=h.callback;if("function"==typeof s){h.callback=null,d=h.priorityLevel;var o=s(h.expirationTime<=r);r=e.unstable_now(),"function"==typeof o?h.callback=o:h===n(l)&&i(l),y(r)}else i(l);h=n(l)}if(null!==h)var u=!0;else{var g=n(c);null!==g&&I(x,g.startTime-r),u=!1}return u}finally{h=null,d=a,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var b,E=!1,M=null,S=-1,T=5,A=-1;function C(){return!(e.unstable_now()-A<T)}function R(){if(null!==M){var t=e.unstable_now();A=t;var n=!0;try{n=M(!0,t)}finally{n?b():(E=!1,M=null)}}else E=!1}if("function"==typeof v)b=function(){v(R)};else if("undefined"!=typeof MessageChannel){var P=new MessageChannel,k=P.port2;P.port1.onmessage=R,b=function(){k.postMessage(null)}}else b=function(){g(R,0)};function O(e){M=e,E||(E=!0,b())}function I(t,n){S=g((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,O(w))},e.unstable_forceFrameRate=function(e){0>e||125<e||(T=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},e.unstable_scheduleCallback=function(i,r,a){var s=e.unstable_now();switch("object"==typeof a&&null!==a?a="number"==typeof(a=a.delay)&&0<a?s+a:s:a=s,i){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return i={id:u++,callback:r,priorityLevel:i,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(i.sortIndex=a,t(c,i),null===n(l)&&i===n(c)&&(m?(_(S),S=-1):m=!0,I(x,a-s))):(i.sortIndex=o,t(l,i),f||p||(f=!0,O(w))),i},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}}(na),ta.exports=na;var ia=ta.exports,ra=Hr,aa=ia;
/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function sa(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oa=new Set,la={};function ca(e,t){ua(e,t),ua(e+"Capture",t)}function ua(e,t){for(la[e]=t,e=0;e<t.length;e++)oa.add(t[e])}var ha=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),da=Object.prototype.hasOwnProperty,pa=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fa={},ma={};function ga(e,t,n,i,r,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var _a={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){_a[e]=new ga(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];_a[t]=new ga(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){_a[e]=new ga(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){_a[e]=new ga(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){_a[e]=new ga(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){_a[e]=new ga(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){_a[e]=new ga(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){_a[e]=new ga(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){_a[e]=new ga(e,5,!1,e.toLowerCase(),null,!1,!1)}));var va=/[\-:]([a-z])/g;function ya(e){return e[1].toUpperCase()}function xa(e,t,n,i){var r=_a.hasOwnProperty(t)?_a[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!da.call(ma,e)||!da.call(fa,e)&&(pa.test(e)?ma[e]=!0:(fa[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(va,ya);_a[t]=new ga(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(va,ya);_a[t]=new ga(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(va,ya);_a[t]=new ga(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){_a[e]=new ga(e,1,!1,e.toLowerCase(),null,!1,!1)})),_a.xlinkHref=new ga("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){_a[e]=new ga(e,1,!1,e.toLowerCase(),null,!0,!0)}));var wa=ra.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ba=Symbol.for("react.element"),Ea=Symbol.for("react.portal"),Ma=Symbol.for("react.fragment"),Sa=Symbol.for("react.strict_mode"),Ta=Symbol.for("react.profiler"),Aa=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Ra=Symbol.for("react.forward_ref"),Pa=Symbol.for("react.suspense"),ka=Symbol.for("react.suspense_list"),Oa=Symbol.for("react.memo"),Ia=Symbol.for("react.lazy"),La=Symbol.for("react.offscreen"),Da=Symbol.iterator;function Na(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Da&&e[Da]||e["@@iterator"])?e:null}var Ua,Fa=Object.assign;function za(e){if(void 0===Ua)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ua=t&&t[1]||""}return"\n"+Ua+e}var Ba=!1;function Va(e,t){if(!e||Ba)return"";Ba=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&"string"==typeof c.stack){for(var r=c.stack.split("\n"),a=i.stack.split("\n"),s=r.length-1,o=a.length-1;1<=s&&0<=o&&r[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(r[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||r[s]!==a[o]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{Ba=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?za(e):""}function Ha(e){switch(e.tag){case 5:return za(e.type);case 16:return za("Lazy");case 13:return za("Suspense");case 19:return za("SuspenseList");case 0:case 2:case 15:return e=Va(e.type,!1);case 11:return e=Va(e.type.render,!1);case 1:return e=Va(e.type,!0);default:return""}}function Wa(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case Ma:return"Fragment";case Ea:return"Portal";case Ta:return"Profiler";case Sa:return"StrictMode";case Pa:return"Suspense";case ka:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Aa:return(e._context.displayName||"Context")+".Provider";case Ra:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case Oa:return null!==(t=e.displayName||null)?t:Wa(e.type)||"Memo";case Ia:t=e._payload,e=e._init;try{return Wa(e(t))}catch(n){}}return null}function ja(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Wa(t);case 8:return t===Sa?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function Ga(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Xa(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function qa(e){e._valueTracker||(e._valueTracker=function(e){var t=Xa(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Ya(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=Xa(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function $a(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Ka(e,t){var n=t.checked;return Fa({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Za(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=Ga(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Qa(e,t){null!=(t=t.checked)&&xa(e,"checked",t,!1)}function Ja(e,t){Qa(e,t);var n=Ga(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ts(e,t.type,n):t.hasOwnProperty("defaultValue")&&ts(e,t.type,Ga(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function es(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ts(e,t,n){"number"===t&&$a(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var ns=Array.isArray;function is(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Ga(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function rs(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(sa(91));return Fa({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function as(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(sa(92));if(ns(n)){if(1<n.length)throw Error(sa(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Ga(n)}}function ss(e,t){var n=Ga(t.value),i=Ga(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function os(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ls(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cs(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ls(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var us,hs,ds=(hs=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((us=us||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=us.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return hs(e,t)}))}:hs);function ps(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ms=["Webkit","ms","Moz","O"];function gs(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||fs.hasOwnProperty(e)&&fs[e]?(""+t).trim():t+"px"}function _s(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=gs(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(fs).forEach((function(e){ms.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fs[t]=fs[e]}))}));var vs=Fa({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ys(e,t){if(t){if(vs[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(sa(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(sa(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(sa(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(sa(62))}}function xs(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ws=null;function bs(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Es=null,Ms=null,Ss=null;function Ts(e){if(e=xu(e)){if("function"!=typeof Es)throw Error(sa(280));var t=e.stateNode;t&&(t=bu(t),Es(e.stateNode,e.type,t))}}function As(e){Ms?Ss?Ss.push(e):Ss=[e]:Ms=e}function Cs(){if(Ms){var e=Ms,t=Ss;if(Ss=Ms=null,Ts(e),t)for(e=0;e<t.length;e++)Ts(t[e])}}function Rs(e,t){return e(t)}function Ps(){}var ks=!1;function Os(e,t,n){if(ks)return e(t,n);ks=!0;try{return Rs(e,t,n)}finally{ks=!1,(null!==Ms||null!==Ss)&&(Ps(),Cs())}}function Is(e,t){var n=e.stateNode;if(null===n)return null;var i=bu(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(sa(231,t,typeof n));return n}var Ls=!1;if(ha)try{var Ds={};Object.defineProperty(Ds,"passive",{get:function(){Ls=!0}}),window.addEventListener("test",Ds,Ds),window.removeEventListener("test",Ds,Ds)}catch(hs){Ls=!1}function Ns(e,t,n,i,r,a,s,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Us=!1,Fs=null,zs=!1,Bs=null,Vs={onError:function(e){Us=!0,Fs=e}};function Hs(e,t,n,i,r,a,s,o,l){Us=!1,Fs=null,Ns.apply(Vs,arguments)}function Ws(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function js(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Gs(e){if(Ws(e)!==e)throw Error(sa(188))}function Xs(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ws(e)))throw Error(sa(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return Gs(r),e;if(a===i)return Gs(r),t;a=a.sibling}throw Error(sa(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,o=r.child;o;){if(o===n){s=!0,n=r,i=a;break}if(o===i){s=!0,i=r,n=a;break}o=o.sibling}if(!s){for(o=a.child;o;){if(o===n){s=!0,n=a,i=r;break}if(o===i){s=!0,i=a,n=r;break}o=o.sibling}if(!s)throw Error(sa(189))}}if(n.alternate!==i)throw Error(sa(190))}if(3!==n.tag)throw Error(sa(188));return n.stateNode.current===n?e:t}(e))?qs(e):null}function qs(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qs(e);if(null!==t)return t;e=e.sibling}return null}var Ys=aa.unstable_scheduleCallback,$s=aa.unstable_cancelCallback,Ks=aa.unstable_shouldYield,Zs=aa.unstable_requestPaint,Qs=aa.unstable_now,Js=aa.unstable_getCurrentPriorityLevel,eo=aa.unstable_ImmediatePriority,to=aa.unstable_UserBlockingPriority,no=aa.unstable_NormalPriority,io=aa.unstable_LowPriority,ro=aa.unstable_IdlePriority,ao=null,so=null;var oo=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(lo(e)/co|0)|0},lo=Math.log,co=Math.LN2;var uo=64,ho=4194304;function po(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function fo(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,s=268435455&n;if(0!==s){var o=s&~r;0!==o?i=po(o):0!==(a&=s)&&(i=po(a))}else 0!==(s=n&~r)?i=po(s):0!==a&&(i=po(a));if(0===i)return 0;if(0!==t&&t!==i&&!(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&4194240&a))return t;if(4&i&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-oo(t)),i|=e[n],t&=~r;return i}function mo(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function go(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function _o(){var e=uo;return!(4194240&(uo<<=1))&&(uo=64),e}function vo(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yo(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-oo(t)]=n}function xo(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-oo(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var wo=0;function bo(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var Eo,Mo,So,To,Ao,Co=!1,Ro=[],Po=null,ko=null,Oo=null,Io=new Map,Lo=new Map,Do=[],No="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Uo(e,t){switch(e){case"focusin":case"focusout":Po=null;break;case"dragenter":case"dragleave":ko=null;break;case"mouseover":case"mouseout":Oo=null;break;case"pointerover":case"pointerout":Io.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lo.delete(t.pointerId)}}function Fo(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=xu(t))&&Mo(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function zo(e){var t=yu(e.target);if(null!==t){var n=Ws(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=js(n)))return e.blockedOn=t,void Ao(e.priority,(function(){So(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Bo(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Zo(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xu(n))&&Mo(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);ws=i,n.target.dispatchEvent(i),ws=null,t.shift()}return!0}function Vo(e,t,n){Bo(e)&&n.delete(t)}function Ho(){Co=!1,null!==Po&&Bo(Po)&&(Po=null),null!==ko&&Bo(ko)&&(ko=null),null!==Oo&&Bo(Oo)&&(Oo=null),Io.forEach(Vo),Lo.forEach(Vo)}function Wo(e,t){e.blockedOn===t&&(e.blockedOn=null,Co||(Co=!0,aa.unstable_scheduleCallback(aa.unstable_NormalPriority,Ho)))}function jo(e){function t(t){return Wo(t,e)}if(0<Ro.length){Wo(Ro[0],e);for(var n=1;n<Ro.length;n++){var i=Ro[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Po&&Wo(Po,e),null!==ko&&Wo(ko,e),null!==Oo&&Wo(Oo,e),Io.forEach(t),Lo.forEach(t),n=0;n<Do.length;n++)(i=Do[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Do.length&&null===(n=Do[0]).blockedOn;)zo(n),null===n.blockedOn&&Do.shift()}var Go=wa.ReactCurrentBatchConfig,Xo=!0;function qo(e,t,n,i){var r=wo,a=Go.transition;Go.transition=null;try{wo=1,$o(e,t,n,i)}finally{wo=r,Go.transition=a}}function Yo(e,t,n,i){var r=wo,a=Go.transition;Go.transition=null;try{wo=4,$o(e,t,n,i)}finally{wo=r,Go.transition=a}}function $o(e,t,n,i){if(Xo){var r=Zo(e,t,n,i);if(null===r)Gc(e,t,i,Ko,n),Uo(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Po=Fo(Po,e,t,n,i,r),!0;case"dragenter":return ko=Fo(ko,e,t,n,i,r),!0;case"mouseover":return Oo=Fo(Oo,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return Io.set(a,Fo(Io.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,Lo.set(a,Fo(Lo.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Uo(e,i),4&t&&-1<No.indexOf(e)){for(;null!==r;){var a=xu(r);if(null!==a&&Eo(a),null===(a=Zo(e,t,n,i))&&Gc(e,t,i,Ko,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Gc(e,t,i,null,n)}}var Ko=null;function Zo(e,t,n,i){if(Ko=null,null!==(e=yu(e=bs(i))))if(null===(t=Ws(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=js(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ko=e,null}function Qo(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Js()){case eo:return 1;case to:return 4;case no:case io:return 16;case ro:return 536870912;default:return 16}default:return 16}}var Jo=null,el=null,tl=null;function nl(){if(tl)return tl;var e,t,n=el,i=n.length,r="value"in Jo?Jo.value:Jo.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var s=i-e;for(t=1;t<=s&&n[i-t]===r[a-t];t++);return tl=r.slice(e,1<t?1-t:void 0)}function il(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rl(){return!0}function al(){return!1}function sl(e){function t(t,n,i,r,a){for(var s in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?rl:al,this.isPropagationStopped=al,this}return Fa(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rl)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rl)},persist:function(){},isPersistent:rl}),t}var ol,ll,cl,ul={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hl=sl(ul),dl=Fa({},ul,{view:0,detail:0}),pl=sl(dl),fl=Fa({},dl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tl,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cl&&(cl&&"mousemove"===e.type?(ol=e.screenX-cl.screenX,ll=e.screenY-cl.screenY):ll=ol=0,cl=e),ol)},movementY:function(e){return"movementY"in e?e.movementY:ll}}),ml=sl(fl),gl=sl(Fa({},fl,{dataTransfer:0})),_l=sl(Fa({},dl,{relatedTarget:0})),vl=sl(Fa({},ul,{animationName:0,elapsedTime:0,pseudoElement:0})),yl=Fa({},ul,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xl=sl(yl),wl=sl(Fa({},ul,{data:0})),bl={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},El={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ml={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sl(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ml[e])&&!!t[e]}function Tl(){return Sl}var Al=Fa({},dl,{key:function(e){if(e.key){var t=bl[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=il(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?El[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tl,charCode:function(e){return"keypress"===e.type?il(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?il(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cl=sl(Al),Rl=sl(Fa({},fl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pl=sl(Fa({},dl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tl})),kl=sl(Fa({},ul,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ol=Fa({},fl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Il=sl(Ol),Ll=[9,13,27,32],Dl=ha&&"CompositionEvent"in window,Nl=null;ha&&"documentMode"in document&&(Nl=document.documentMode);var Ul=ha&&"TextEvent"in window&&!Nl,Fl=ha&&(!Dl||Nl&&8<Nl&&11>=Nl),zl=String.fromCharCode(32),Bl=!1;function Vl(e,t){switch(e){case"keyup":return-1!==Ll.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hl(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Wl=!1;var jl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gl(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!jl[e.type]:"textarea"===t}function Xl(e,t,n,i){As(i),0<(t=qc(t,"onChange")).length&&(n=new hl("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var ql=null,Yl=null;function $l(e){zc(e,0)}function Kl(e){if(Ya(wu(e)))return e}function Zl(e,t){if("change"===e)return t}var Ql=!1;if(ha){var Jl;if(ha){var ec="oninput"in document;if(!ec){var tc=document.createElement("div");tc.setAttribute("oninput","return;"),ec="function"==typeof tc.oninput}Jl=ec}else Jl=!1;Ql=Jl&&(!document.documentMode||9<document.documentMode)}function nc(){ql&&(ql.detachEvent("onpropertychange",ic),Yl=ql=null)}function ic(e){if("value"===e.propertyName&&Kl(Yl)){var t=[];Xl(t,Yl,e,bs(e)),Os($l,t)}}function rc(e,t,n){"focusin"===e?(nc(),Yl=n,(ql=t).attachEvent("onpropertychange",ic)):"focusout"===e&&nc()}function ac(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kl(Yl)}function sc(e,t){if("click"===e)return Kl(t)}function oc(e,t){if("input"===e||"change"===e)return Kl(t)}var lc="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function cc(e,t){if(lc(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!da.call(t,r)||!lc(e[r],t[r]))return!1}return!0}function uc(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hc(e,t){var n,i=uc(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=uc(i)}}function dc(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dc(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pc(){for(var e=window,t=$a();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=$a((e=t.contentWindow).document)}return t}function fc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function mc(e){var t=pc(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dc(n.ownerDocument.documentElement,n)){if(null!==i&&fc(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=hc(n,a);var s=hc(n,i);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gc=ha&&"documentMode"in document&&11>=document.documentMode,_c=null,vc=null,yc=null,xc=!1;function wc(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xc||null==_c||_c!==$a(i)||("selectionStart"in(i=_c)&&fc(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},yc&&cc(yc,i)||(yc=i,0<(i=qc(vc,"onSelect")).length&&(t=new hl("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=_c)))}function bc(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ec={animationend:bc("Animation","AnimationEnd"),animationiteration:bc("Animation","AnimationIteration"),animationstart:bc("Animation","AnimationStart"),transitionend:bc("Transition","TransitionEnd")},Mc={},Sc={};function Tc(e){if(Mc[e])return Mc[e];if(!Ec[e])return e;var t,n=Ec[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sc)return Mc[e]=n[t];return e}ha&&(Sc=document.createElement("div").style,"AnimationEvent"in window||(delete Ec.animationend.animation,delete Ec.animationiteration.animation,delete Ec.animationstart.animation),"TransitionEvent"in window||delete Ec.transitionend.transition);var Ac=Tc("animationend"),Cc=Tc("animationiteration"),Rc=Tc("animationstart"),Pc=Tc("transitionend"),kc=new Map,Oc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ic(e,t){kc.set(e,t),ca(t,[e])}for(var Lc=0;Lc<Oc.length;Lc++){var Dc=Oc[Lc];Ic(Dc.toLowerCase(),"on"+(Dc[0].toUpperCase()+Dc.slice(1)))}Ic(Ac,"onAnimationEnd"),Ic(Cc,"onAnimationIteration"),Ic(Rc,"onAnimationStart"),Ic("dblclick","onDoubleClick"),Ic("focusin","onFocus"),Ic("focusout","onBlur"),Ic(Pc,"onTransitionEnd"),ua("onMouseEnter",["mouseout","mouseover"]),ua("onMouseLeave",["mouseout","mouseover"]),ua("onPointerEnter",["pointerout","pointerover"]),ua("onPointerLeave",["pointerout","pointerover"]),ca("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ca("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ca("onBeforeInput",["compositionend","keypress","textInput","paste"]),ca("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ca("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ca("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Uc=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nc));function Fc(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,a,s,o,l){if(Hs.apply(this,arguments),Us){if(!Us)throw Error(sa(198));var c=Fs;Us=!1,Fs=null,zs||(zs=!0,Bs=c)}}(i,t,void 0,e),e.currentTarget=null}function zc(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var s=i.length-1;0<=s;s--){var o=i[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==a&&r.isPropagationStopped())break e;Fc(r,o,c),a=l}else for(s=0;s<i.length;s++){if(l=(o=i[s]).instance,c=o.currentTarget,o=o.listener,l!==a&&r.isPropagationStopped())break e;Fc(r,o,c),a=l}}}if(zs)throw e=Bs,zs=!1,Bs=null,e}function Bc(e,t){var n=t[gu];void 0===n&&(n=t[gu]=new Set);var i=e+"__bubble";n.has(i)||(jc(t,e,2,!1),n.add(i))}function Vc(e,t,n){var i=0;t&&(i|=4),jc(n,e,i,t)}var Hc="_reactListening"+Math.random().toString(36).slice(2);function Wc(e){if(!e[Hc]){e[Hc]=!0,oa.forEach((function(t){"selectionchange"!==t&&(Uc.has(t)||Vc(t,!1,e),Vc(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Hc]||(t[Hc]=!0,Vc("selectionchange",!1,t))}}function jc(e,t,n,i){switch(Qo(t)){case 1:var r=qo;break;case 4:r=Yo;break;default:r=$o}n=r.bind(null,t,n,e),r=void 0,!Ls||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Gc(e,t,n,i,r){var a=i;if(!(1&t||2&t||null===i))e:for(;;){if(null===i)return;var s=i.tag;if(3===s||4===s){var o=i.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===s)for(s=i.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==o;){if(null===(s=yu(o)))return;if(5===(l=s.tag)||6===l){i=a=s;continue e}o=o.parentNode}}i=i.return}Os((function(){var i=a,r=bs(n),s=[];e:{var o=kc.get(e);if(void 0!==o){var l=hl,c=e;switch(e){case"keypress":if(0===il(n))break e;case"keydown":case"keyup":l=Cl;break;case"focusin":c="focus",l=_l;break;case"focusout":c="blur",l=_l;break;case"beforeblur":case"afterblur":l=_l;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pl;break;case Ac:case Cc:case Rc:l=vl;break;case Pc:l=kl;break;case"scroll":l=pl;break;case"wheel":l=Il;break;case"copy":case"cut":case"paste":l=xl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rl}var u=!!(4&t),h=!u&&"scroll"===e,d=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=i;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=Is(f,d))&&u.push(Xc(f,m,p)))),h)break;f=f.return}0<u.length&&(o=new l(o,c,null,n,r),s.push({event:o,listeners:u}))}}if(!(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===ws||!(c=n.relatedTarget||n.fromElement)||!yu(c)&&!c[mu])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?yu(c):null)&&(c!==(h=Ws(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=ml,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rl,m="onPointerLeave",d="onPointerEnter",f="pointer"),h=null==l?o:wu(l),p=null==c?o:wu(c),(o=new u(m,f+"leave",l,n,r)).target=h,o.relatedTarget=p,m=null,yu(r)===i&&((u=new u(d,f+"enter",c,n,r)).target=p,u.relatedTarget=h,m=u),h=m,l&&c)e:{for(d=c,f=0,p=u=l;p;p=Yc(p))f++;for(p=0,m=d;m;m=Yc(m))p++;for(;0<f-p;)u=Yc(u),f--;for(;0<p-f;)d=Yc(d),p--;for(;f--;){if(u===d||null!==d&&u===d.alternate)break e;u=Yc(u),d=Yc(d)}u=null}else u=null;null!==l&&$c(s,o,l,u,!1),null!==c&&null!==h&&$c(s,h,c,u,!0)}if("select"===(l=(o=i?wu(i):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Zl;else if(Gl(o))if(Ql)g=oc;else{g=ac;var _=rc}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=sc);switch(g&&(g=g(e,i))?Xl(s,g,n,r):(_&&_(e,o,i),"focusout"===e&&(_=o._wrapperState)&&_.controlled&&"number"===o.type&&ts(o,"number",o.value)),_=i?wu(i):window,e){case"focusin":(Gl(_)||"true"===_.contentEditable)&&(_c=_,vc=i,yc=null);break;case"focusout":yc=vc=_c=null;break;case"mousedown":xc=!0;break;case"contextmenu":case"mouseup":case"dragend":xc=!1,wc(s,n,r);break;case"selectionchange":if(gc)break;case"keydown":case"keyup":wc(s,n,r)}var v;if(Dl)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Wl?Vl(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Fl&&"ko"!==n.locale&&(Wl||"onCompositionStart"!==y?"onCompositionEnd"===y&&Wl&&(v=nl()):(el="value"in(Jo=r)?Jo.value:Jo.textContent,Wl=!0)),0<(_=qc(i,y)).length&&(y=new wl(y,e,null,n,r),s.push({event:y,listeners:_}),v?y.data=v:null!==(v=Hl(n))&&(y.data=v))),(v=Ul?function(e,t){switch(e){case"compositionend":return Hl(t);case"keypress":return 32!==t.which?null:(Bl=!0,zl);case"textInput":return(e=t.data)===zl&&Bl?null:e;default:return null}}(e,n):function(e,t){if(Wl)return"compositionend"===e||!Dl&&Vl(e,t)?(e=nl(),tl=el=Jo=null,Wl=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fl&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=qc(i,"onBeforeInput")).length&&(r=new wl("onBeforeInput","beforeinput",null,n,r),s.push({event:r,listeners:i}),r.data=v))}zc(s,t)}))}function Xc(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qc(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Is(e,n))&&i.unshift(Xc(e,a,r)),null!=(a=Is(e,t))&&i.push(Xc(e,a,r))),e=e.return}return i}function Yc(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function $c(e,t,n,i,r){for(var a=t._reactName,s=[];null!==n&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===i)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=Is(n,a))&&s.unshift(Xc(n,l,o)):r||null!=(l=Is(n,a))&&s.push(Xc(n,l,o))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Kc=/\r\n?/g,Zc=/\u0000|\uFFFD/g;function Qc(e){return("string"==typeof e?e:""+e).replace(Kc,"\n").replace(Zc,"")}function Jc(e,t,n){if(t=Qc(t),Qc(e)!==t&&n)throw Error(sa(425))}function eu(){}var tu=null,nu=null;function iu(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ru="function"==typeof setTimeout?setTimeout:void 0,au="function"==typeof clearTimeout?clearTimeout:void 0,su="function"==typeof Promise?Promise:void 0,ou="function"==typeof queueMicrotask?queueMicrotask:void 0!==su?function(e){return su.resolve(null).then(e).catch(lu)}:ru;function lu(e){setTimeout((function(){throw e}))}function cu(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void jo(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);jo(t)}function uu(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var du=Math.random().toString(36).slice(2),pu="__reactFiber$"+du,fu="__reactProps$"+du,mu="__reactContainer$"+du,gu="__reactEvents$"+du,_u="__reactListeners$"+du,vu="__reactHandles$"+du;function yu(e){var t=e[pu];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mu]||n[pu]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=hu(e);null!==e;){if(n=e[pu])return n;e=hu(e)}return t}n=(e=n).parentNode}return null}function xu(e){return!(e=e[pu]||e[mu])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wu(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(sa(33))}function bu(e){return e[fu]||null}var Eu=[],Mu=-1;function Su(e){return{current:e}}function Tu(e){0>Mu||(e.current=Eu[Mu],Eu[Mu]=null,Mu--)}function Au(e,t){Mu++,Eu[Mu]=e.current,e.current=t}var Cu={},Ru=Su(Cu),Pu=Su(!1),ku=Cu;function Ou(e,t){var n=e.type.contextTypes;if(!n)return Cu;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Iu(e){return null!=(e=e.childContextTypes)}function Lu(){Tu(Pu),Tu(Ru)}function Du(e,t,n){if(Ru.current!==Cu)throw Error(sa(168));Au(Ru,t),Au(Pu,n)}function Nu(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!=typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(sa(108,ja(e)||"Unknown",r));return Fa({},n,i)}function Uu(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cu,ku=Ru.current,Au(Ru,e),Au(Pu,Pu.current),!0}function Fu(e,t,n){var i=e.stateNode;if(!i)throw Error(sa(169));n?(e=Nu(e,t,ku),i.__reactInternalMemoizedMergedChildContext=e,Tu(Pu),Tu(Ru),Au(Ru,e)):Tu(Pu),Au(Pu,n)}var zu=null,Bu=!1,Vu=!1;function Hu(e){null===zu?zu=[e]:zu.push(e)}function Wu(){if(!Vu&&null!==zu){Vu=!0;var e=0,t=wo;try{var n=zu;for(wo=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}zu=null,Bu=!1}catch(r){throw null!==zu&&(zu=zu.slice(e+1)),Ys(eo,Wu),r}finally{wo=t,Vu=!1}}return null}var ju=[],Gu=0,Xu=null,qu=0,Yu=[],$u=0,Ku=null,Zu=1,Qu="";function Ju(e,t){ju[Gu++]=qu,ju[Gu++]=Xu,Xu=e,qu=t}function eh(e,t,n){Yu[$u++]=Zu,Yu[$u++]=Qu,Yu[$u++]=Ku,Ku=e;var i=Zu;e=Qu;var r=32-oo(i)-1;i&=~(1<<r),n+=1;var a=32-oo(t)+r;if(30<a){var s=r-r%5;a=(i&(1<<s)-1).toString(32),i>>=s,r-=s,Zu=1<<32-oo(t)+r|n<<r|i,Qu=a+e}else Zu=1<<a|n<<r|i,Qu=e}function th(e){null!==e.return&&(Ju(e,1),eh(e,1,0))}function nh(e){for(;e===Xu;)Xu=ju[--Gu],ju[Gu]=null,qu=ju[--Gu],ju[Gu]=null;for(;e===Ku;)Ku=Yu[--$u],Yu[$u]=null,Qu=Yu[--$u],Yu[$u]=null,Zu=Yu[--$u],Yu[$u]=null}var ih=null,rh=null,ah=!1,sh=null;function oh(e,t){var n=km(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function lh(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ih=e,rh=uu(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ih=e,rh=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ku?{id:Zu,overflow:Qu}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=km(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ih=e,rh=null,!0);default:return!1}}function ch(e){return!(!(1&e.mode)||128&e.flags)}function uh(e){if(ah){var t=rh;if(t){var n=t;if(!lh(e,t)){if(ch(e))throw Error(sa(418));t=uu(n.nextSibling);var i=ih;t&&lh(e,t)?oh(i,n):(e.flags=-4097&e.flags|2,ah=!1,ih=e)}}else{if(ch(e))throw Error(sa(418));e.flags=-4097&e.flags|2,ah=!1,ih=e}}}function hh(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ih=e}function dh(e){if(e!==ih)return!1;if(!ah)return hh(e),ah=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!iu(e.type,e.memoizedProps)),t&&(t=rh)){if(ch(e))throw ph(),Error(sa(418));for(;t;)oh(e,t),t=uu(t.nextSibling)}if(hh(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(sa(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){rh=uu(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}rh=null}}else rh=ih?uu(e.stateNode.nextSibling):null;return!0}function ph(){for(var e=rh;e;)e=uu(e.nextSibling)}function fh(){rh=ih=null,ah=!1}function mh(e){null===sh?sh=[e]:sh.push(e)}var gh=wa.ReactCurrentBatchConfig;function _h(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(sa(309));var i=n.stateNode}if(!i)throw Error(sa(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===a?t.ref:((t=function(e){var t=r.refs;null===e?delete t[a]:t[a]=e})._stringRef=a,t)}if("string"!=typeof e)throw Error(sa(284));if(!n._owner)throw Error(sa(290,e))}return e}function vh(e,t){throw e=Object.prototype.toString.call(t),Error(sa(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function yh(e){return(0,e._init)(e._payload)}function xh(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Im(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function o(e,t,n,i){return null===t||6!==t.tag?((t=Um(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var a=n.type;return a===Ma?u(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"==typeof a&&null!==a&&a.$$typeof===Ia&&yh(a)===t.type)?((i=r(t,n.props)).ref=_h(e,t,n),i.return=e,i):((i=Lm(n.type,n.key,n.props,null,e.mode,i)).ref=_h(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fm(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,i,a){return null===t||7!==t.tag?((t=Dm(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Um(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case ba:return(n=Lm(t.type,t.key,t.props,null,e.mode,n)).ref=_h(e,null,t),n.return=e,n;case Ea:return(t=Fm(t,e.mode,n)).return=e,t;case Ia:return h(e,(0,t._init)(t._payload),n)}if(ns(t)||Na(t))return(t=Dm(t,e.mode,n,null)).return=e,t;vh(e,t)}return null}function d(e,t,n,i){var r=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==r?null:o(e,t,""+n,i);if("object"==typeof n&&null!==n){switch(n.$$typeof){case ba:return n.key===r?l(e,t,n,i):null;case Ea:return n.key===r?c(e,t,n,i):null;case Ia:return d(e,t,(r=n._init)(n._payload),i)}if(ns(n)||Na(n))return null!==r?null:u(e,t,n,i,null);vh(e,n)}return null}function p(e,t,n,i,r){if("string"==typeof i&&""!==i||"number"==typeof i)return o(t,e=e.get(n)||null,""+i,r);if("object"==typeof i&&null!==i){switch(i.$$typeof){case ba:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case Ea:return c(t,e=e.get(null===i.key?n:i.key)||null,i,r);case Ia:return p(e,t,n,(0,i._init)(i._payload),r)}if(ns(i)||Na(i))return u(t,e=e.get(n)||null,i,r,null);vh(t,i)}return null}return function o(l,c,u,f){if("object"==typeof u&&null!==u&&u.type===Ma&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case ba:e:{for(var m=u.key,g=c;null!==g;){if(g.key===m){if((m=u.type)===Ma){if(7===g.tag){n(l,g.sibling),(c=r(g,u.props.children)).return=l,l=c;break e}}else if(g.elementType===m||"object"==typeof m&&null!==m&&m.$$typeof===Ia&&yh(m)===g.type){n(l,g.sibling),(c=r(g,u.props)).ref=_h(l,g,u),c.return=l,l=c;break e}n(l,g);break}t(l,g),g=g.sibling}u.type===Ma?((c=Dm(u.props.children,l.mode,f,u.key)).return=l,l=c):((f=Lm(u.type,u.key,u.props,null,l.mode,f)).ref=_h(l,c,u),f.return=l,l=f)}return s(l);case Ea:e:{for(g=u.key;null!==c;){if(c.key===g){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(c=r(c,u.children||[])).return=l,l=c;break e}n(l,c);break}t(l,c),c=c.sibling}(c=Fm(u,l.mode,f)).return=l,l=c}return s(l);case Ia:return o(l,c,(g=u._init)(u._payload),f)}if(ns(u))return function(r,s,o,l){for(var c=null,u=null,f=s,m=s=0,g=null;null!==f&&m<o.length;m++){f.index>m?(g=f,f=null):g=f.sibling;var _=d(r,f,o[m],l);if(null===_){null===f&&(f=g);break}e&&f&&null===_.alternate&&t(r,f),s=a(_,s,m),null===u?c=_:u.sibling=_,u=_,f=g}if(m===o.length)return n(r,f),ah&&Ju(r,m),c;if(null===f){for(;m<o.length;m++)null!==(f=h(r,o[m],l))&&(s=a(f,s,m),null===u?c=f:u.sibling=f,u=f);return ah&&Ju(r,m),c}for(f=i(r,f);m<o.length;m++)null!==(g=p(f,r,m,o[m],l))&&(e&&null!==g.alternate&&f.delete(null===g.key?m:g.key),s=a(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&f.forEach((function(e){return t(r,e)})),ah&&Ju(r,m),c}(l,c,u,f);if(Na(u))return function(r,s,o,l){var c=Na(o);if("function"!=typeof c)throw Error(sa(150));if(null==(o=c.call(o)))throw Error(sa(151));for(var u=c=null,f=s,m=s=0,g=null,_=o.next();null!==f&&!_.done;m++,_=o.next()){f.index>m?(g=f,f=null):g=f.sibling;var v=d(r,f,_.value,l);if(null===v){null===f&&(f=g);break}e&&f&&null===v.alternate&&t(r,f),s=a(v,s,m),null===u?c=v:u.sibling=v,u=v,f=g}if(_.done)return n(r,f),ah&&Ju(r,m),c;if(null===f){for(;!_.done;m++,_=o.next())null!==(_=h(r,_.value,l))&&(s=a(_,s,m),null===u?c=_:u.sibling=_,u=_);return ah&&Ju(r,m),c}for(f=i(r,f);!_.done;m++,_=o.next())null!==(_=p(f,r,m,_.value,l))&&(e&&null!==_.alternate&&f.delete(null===_.key?m:_.key),s=a(_,s,m),null===u?c=_:u.sibling=_,u=_);return e&&f.forEach((function(e){return t(r,e)})),ah&&Ju(r,m),c}(l,c,u,f);vh(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(c=r(c,u)).return=l,l=c):(n(l,c),(c=Um(u,l.mode,f)).return=l,l=c),s(l)):n(l,c)}}var wh=xh(!0),bh=xh(!1),Eh=Su(null),Mh=null,Sh=null,Th=null;function Ah(){Th=Sh=Mh=null}function Ch(e){var t=Eh.current;Tu(Eh),e._currentValue=t}function Rh(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ph(e,t){Mh=e,Th=Sh=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(vp=!0),e.firstContext=null)}function kh(e){var t=e._currentValue;if(Th!==e)if(e={context:e,memoizedValue:t,next:null},null===Sh){if(null===Mh)throw Error(sa(308));Sh=e,Mh.dependencies={lanes:0,firstContext:e}}else Sh=Sh.next=e;return t}var Oh=null;function Ih(e){null===Oh?Oh=[e]:Oh.push(e)}function Lh(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Ih(t)):(n.next=r.next,r.next=n),t.interleaved=n,Dh(e,i)}function Dh(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Nh=!1;function Uh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fh(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function zh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Bh(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,2&Cf){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,Dh(e,n)}return null===(r=i.interleaved)?(t.next=t,Ih(i)):(t.next=r.next,r.next=t),i.interleaved=t,Dh(e,n)}function Vh(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,xo(e,n)}}function Hh(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=s:a=a.next=s,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wh(e,t,n,i){var r=e.updateQueue;Nh=!1;var a=r.firstBaseUpdate,s=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==a){var h=r.baseState;for(s=0,u=c=l=null,o=a;;){var d=o.lane,p=o.eventTime;if((i&d)===d){null!==u&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(d=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(d="function"==typeof(f=m.payload)?f.call(p,h,d):f))break e;h=Fa({},h,d);break e;case 2:Nh=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(d=r.effects)?r.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=h):u=u.next=p,s|=d;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(d=o).next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}if(null===u&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);Nf|=s,e.lanes=s,e.memoizedState=h}}function jh(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!=typeof r)throw Error(sa(191,r));r.call(i)}}}var Gh={},Xh=Su(Gh),qh=Su(Gh),Yh=Su(Gh);function $h(e){if(e===Gh)throw Error(sa(174));return e}function Kh(e,t){switch(Au(Yh,t),Au(qh,e),Au(Xh,Gh),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:cs(null,"");break;default:t=cs(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Tu(Xh),Au(Xh,t)}function Zh(){Tu(Xh),Tu(qh),Tu(Yh)}function Qh(e){$h(Yh.current);var t=$h(Xh.current),n=cs(t,e.type);t!==n&&(Au(qh,e),Au(Xh,n))}function Jh(e){qh.current===e&&(Tu(Xh),Tu(qh))}var ed=Su(0);function td(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var nd=[];function id(){for(var e=0;e<nd.length;e++)nd[e]._workInProgressVersionPrimary=null;nd.length=0}var rd=wa.ReactCurrentDispatcher,ad=wa.ReactCurrentBatchConfig,sd=0,od=null,ld=null,cd=null,ud=!1,hd=!1,dd=0,pd=0;function fd(){throw Error(sa(321))}function md(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!lc(e[n],t[n]))return!1;return!0}function gd(e,t,n,i,r,a){if(sd=a,od=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,rd.current=null===e||null===e.memoizedState?Jd:ep,e=n(i,r),hd){a=0;do{if(hd=!1,dd=0,25<=a)throw Error(sa(301));a+=1,cd=ld=null,t.updateQueue=null,rd.current=tp,e=n(i,r)}while(hd)}if(rd.current=Qd,t=null!==ld&&null!==ld.next,sd=0,cd=ld=od=null,ud=!1,t)throw Error(sa(300));return e}function _d(){var e=0!==dd;return dd=0,e}function vd(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===cd?od.memoizedState=cd=e:cd=cd.next=e,cd}function yd(){if(null===ld){var e=od.alternate;e=null!==e?e.memoizedState:null}else e=ld.next;var t=null===cd?od.memoizedState:cd.next;if(null!==t)cd=t,ld=e;else{if(null===e)throw Error(sa(310));e={memoizedState:(ld=e).memoizedState,baseState:ld.baseState,baseQueue:ld.baseQueue,queue:ld.queue,next:null},null===cd?od.memoizedState=cd=e:cd=cd.next=e}return cd}function xd(e,t){return"function"==typeof t?t(e):t}function wd(e){var t=yd(),n=t.queue;if(null===n)throw Error(sa(311));n.lastRenderedReducer=e;var i=ld,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var o=s=null,l=null,c=a;do{var u=c.lane;if((sd&u)===u)null!==l&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===l?(o=l=h,s=i):l=l.next=h,od.lanes|=u,Nf|=u}c=c.next}while(null!==c&&c!==a);null===l?s=i:l.next=o,lc(i,t.memoizedState)||(vp=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,od.lanes|=a,Nf|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function bd(e){var t=yd(),n=t.queue;if(null===n)throw Error(sa(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);lc(a,t.memoizedState)||(vp=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Ed(){}function Md(e,t){var n=od,i=yd(),r=t(),a=!lc(i.memoizedState,r);if(a&&(i.memoizedState=r,vp=!0),i=i.queue,Nd(Ad.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==cd&&1&cd.memoizedState.tag){if(n.flags|=2048,kd(9,Td.bind(null,n,i,r,t),void 0,null),null===Rf)throw Error(sa(349));30&sd||Sd(n,t,r)}return r}function Sd(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=od.updateQueue)?(t={lastEffect:null,stores:null},od.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Td(e,t,n,i){t.value=n,t.getSnapshot=i,Cd(t)&&Rd(e)}function Ad(e,t,n){return n((function(){Cd(t)&&Rd(e)}))}function Cd(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!lc(e,n)}catch(i){return!0}}function Rd(e){var t=Dh(e,1);null!==t&&nm(t,e,1,-1)}function Pd(e){var t=vd();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xd,lastRenderedState:e},t.queue=e,e=e.dispatch=Yd.bind(null,od,e),[t.memoizedState,e]}function kd(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=od.updateQueue)?(t={lastEffect:null,stores:null},od.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Od(){return yd().memoizedState}function Id(e,t,n,i){var r=vd();od.flags|=e,r.memoizedState=kd(1|t,n,void 0,void 0===i?null:i)}function Ld(e,t,n,i){var r=yd();i=void 0===i?null:i;var a=void 0;if(null!==ld){var s=ld.memoizedState;if(a=s.destroy,null!==i&&md(i,s.deps))return void(r.memoizedState=kd(t,n,a,i))}od.flags|=e,r.memoizedState=kd(1|t,n,a,i)}function Dd(e,t){return Id(8390656,8,e,t)}function Nd(e,t){return Ld(2048,8,e,t)}function Ud(e,t){return Ld(4,2,e,t)}function Fd(e,t){return Ld(4,4,e,t)}function zd(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Bd(e,t,n){return n=null!=n?n.concat([e]):null,Ld(4,4,zd.bind(null,t,e),n)}function Vd(){}function Hd(e,t){var n=yd();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&md(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Wd(e,t){var n=yd();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&md(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function jd(e,t,n){return 21&sd?(lc(n,t)||(n=_o(),od.lanes|=n,Nf|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,vp=!0),e.memoizedState=n)}function Gd(e,t){var n=wo;wo=0!==n&&4>n?n:4,e(!0);var i=ad.transition;ad.transition={};try{e(!1),t()}finally{wo=n,ad.transition=i}}function Xd(){return yd().memoizedState}function qd(e,t,n){var i=tm(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},$d(e))Kd(t,n);else if(null!==(n=Lh(e,t,n,i))){nm(n,e,i,em()),Zd(n,t,i)}}function Yd(e,t,n){var i=tm(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if($d(e))Kd(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,n);if(r.hasEagerState=!0,r.eagerState=o,lc(o,s)){var l=t.interleaved;return null===l?(r.next=r,Ih(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Lh(e,t,r,i))&&(nm(n,e,i,r=em()),Zd(n,t,i))}}function $d(e){var t=e.alternate;return e===od||null!==t&&t===od}function Kd(e,t){hd=ud=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zd(e,t,n){if(4194240&n){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,xo(e,n)}}var Qd={readContext:kh,useCallback:fd,useContext:fd,useEffect:fd,useImperativeHandle:fd,useInsertionEffect:fd,useLayoutEffect:fd,useMemo:fd,useReducer:fd,useRef:fd,useState:fd,useDebugValue:fd,useDeferredValue:fd,useTransition:fd,useMutableSource:fd,useSyncExternalStore:fd,useId:fd,unstable_isNewReconciler:!1},Jd={readContext:kh,useCallback:function(e,t){return vd().memoizedState=[e,void 0===t?null:t],e},useContext:kh,useEffect:Dd,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,Id(4194308,4,zd.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Id(4194308,4,e,t)},useInsertionEffect:function(e,t){return Id(4,2,e,t)},useMemo:function(e,t){var n=vd();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=vd();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=qd.bind(null,od,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},vd().memoizedState=e},useState:Pd,useDebugValue:Vd,useDeferredValue:function(e){return vd().memoizedState=e},useTransition:function(){var e=Pd(!1),t=e[0];return e=Gd.bind(null,e[1]),vd().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=od,r=vd();if(ah){if(void 0===n)throw Error(sa(407));n=n()}else{if(n=t(),null===Rf)throw Error(sa(349));30&sd||Sd(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Dd(Ad.bind(null,i,a,e),[e]),i.flags|=2048,kd(9,Td.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=vd(),t=Rf.identifierPrefix;if(ah){var n=Qu;t=":"+t+"R"+(n=(Zu&~(1<<32-oo(Zu)-1)).toString(32)+n),0<(n=dd++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=pd++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ep={readContext:kh,useCallback:Hd,useContext:kh,useEffect:Nd,useImperativeHandle:Bd,useInsertionEffect:Ud,useLayoutEffect:Fd,useMemo:Wd,useReducer:wd,useRef:Od,useState:function(){return wd(xd)},useDebugValue:Vd,useDeferredValue:function(e){return jd(yd(),ld.memoizedState,e)},useTransition:function(){return[wd(xd)[0],yd().memoizedState]},useMutableSource:Ed,useSyncExternalStore:Md,useId:Xd,unstable_isNewReconciler:!1},tp={readContext:kh,useCallback:Hd,useContext:kh,useEffect:Nd,useImperativeHandle:Bd,useInsertionEffect:Ud,useLayoutEffect:Fd,useMemo:Wd,useReducer:bd,useRef:Od,useState:function(){return bd(xd)},useDebugValue:Vd,useDeferredValue:function(e){var t=yd();return null===ld?t.memoizedState=e:jd(t,ld.memoizedState,e)},useTransition:function(){return[bd(xd)[0],yd().memoizedState]},useMutableSource:Ed,useSyncExternalStore:Md,useId:Xd,unstable_isNewReconciler:!1};function np(e,t){if(e&&e.defaultProps){for(var n in t=Fa({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ip(e,t,n,i){n=null==(n=n(i,t=e.memoizedState))?t:Fa({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var rp={isMounted:function(e){return!!(e=e._reactInternals)&&Ws(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=em(),r=tm(e),a=zh(i,r);a.payload=t,null!=n&&(a.callback=n),null!==(t=Bh(e,a,r))&&(nm(t,e,r,i),Vh(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=em(),r=tm(e),a=zh(i,r);a.tag=1,a.payload=t,null!=n&&(a.callback=n),null!==(t=Bh(e,a,r))&&(nm(t,e,r,i),Vh(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=em(),i=tm(e),r=zh(n,i);r.tag=2,null!=t&&(r.callback=t),null!==(t=Bh(e,r,i))&&(nm(t,e,i,n),Vh(t,e,i))}};function ap(e,t,n,i,r,a,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!cc(n,i)||!cc(r,a))}function sp(e,t,n){var i=!1,r=Cu,a=t.contextType;return"object"==typeof a&&null!==a?a=kh(a):(r=Iu(t)?ku:Ru.current,a=(i=null!=(i=t.contextTypes))?Ou(e,r):Cu),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=rp,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function op(e,t,n,i){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&rp.enqueueReplaceState(t,t.state,null)}function lp(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Uh(e);var a=t.contextType;"object"==typeof a&&null!==a?r.context=kh(a):(a=Iu(t)?ku:Ru.current,r.context=Ou(e,a)),r.state=e.memoizedState,"function"==typeof(a=t.getDerivedStateFromProps)&&(ip(e,t,a,n),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&rp.enqueueReplaceState(r,r.state,null),Wh(e,n,r,i),r.state=e.memoizedState),"function"==typeof r.componentDidMount&&(e.flags|=4194308)}function cp(e,t){try{var n="",i=t;do{n+=Ha(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function up(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}var hp="function"==typeof WeakMap?WeakMap:Map;function dp(e,t,n){(n=zh(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){jf||(jf=!0,Gf=i)},n}function pp(e,t,n){(n=zh(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(n.callback=function(){"function"!=typeof i&&(null===Xf?Xf=new Set([this]):Xf.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function fp(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new hp;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Sm.bind(null,e,t,n),t.then(e,e))}function mp(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function gp(e,t,n,i,r){return 1&e.mode?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=zh(-1,1)).tag=2,Bh(n,t,1))),n.lanes|=1),e)}var _p=wa.ReactCurrentOwner,vp=!1;function yp(e,t,n,i){t.child=null===e?bh(t,null,n,i):wh(t,e.child,n,i)}function xp(e,t,n,i,r){n=n.render;var a=t.ref;return Ph(t,r),i=gd(e,t,n,i,a,r),n=_d(),null===e||vp?(ah&&n&&th(t),t.flags|=1,yp(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wp(e,t,r))}function wp(e,t,n,i,r){if(null===e){var a=n.type;return"function"!=typeof a||Om(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lm(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,bp(e,t,a,i,r))}if(a=e.child,!(e.lanes&r)){var s=a.memoizedProps;if((n=null!==(n=n.compare)?n:cc)(s,i)&&e.ref===t.ref)return Wp(e,t,r)}return t.flags|=1,(e=Im(a,i)).ref=t.ref,e.return=t,t.child=e}function bp(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(cc(a,i)&&e.ref===t.ref){if(vp=!1,t.pendingProps=i=a,!(e.lanes&r))return t.lanes=e.lanes,Wp(e,t,r);131072&e.flags&&(vp=!0)}}return Sp(e,t,n,i,r)}function Ep(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Au(If,Of),Of|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,Au(If,Of),Of|=i}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Au(If,Of),Of|=n;else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,Au(If,Of),Of|=i;return yp(e,t,r,n),t.child}function Mp(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Sp(e,t,n,i,r){var a=Iu(n)?ku:Ru.current;return a=Ou(t,a),Ph(t,r),n=gd(e,t,n,i,a,r),i=_d(),null===e||vp?(ah&&i&&th(t),t.flags|=1,yp(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Wp(e,t,r))}function Tp(e,t,n,i,r){if(Iu(n)){var a=!0;Uu(t)}else a=!1;if(Ph(t,r),null===t.stateNode)Hp(e,t),sp(t,n,i),lp(t,n,i,r),i=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=n.contextType;"object"==typeof c&&null!==c?c=kh(c):c=Ou(t,c=Iu(n)?ku:Ru.current);var u=n.getDerivedStateFromProps,h="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;h||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==i||l!==c)&&op(t,s,i,c),Nh=!1;var d=t.memoizedState;s.state=d,Wh(t,i,s,r),l=t.memoizedState,o!==i||d!==l||Pu.current||Nh?("function"==typeof u&&(ip(t,n,u,i),l=t.memoizedState),(o=Nh||ap(t,n,o,i,d,l,c))?(h||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.flags|=4194308)):("function"==typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),s.props=i,s.state=l,s.context=c,i=o):("function"==typeof s.componentDidMount&&(t.flags|=4194308),i=!1)}else{s=t.stateNode,Fh(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:np(t.type,o),s.props=c,h=t.pendingProps,d=s.context,"object"==typeof(l=n.contextType)&&null!==l?l=kh(l):l=Ou(t,l=Iu(n)?ku:Ru.current);var p=n.getDerivedStateFromProps;(u="function"==typeof p||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(o!==h||d!==l)&&op(t,s,i,l),Nh=!1,d=t.memoizedState,s.state=d,Wh(t,i,s,r);var f=t.memoizedState;o!==h||d!==f||Pu.current||Nh?("function"==typeof p&&(ip(t,n,p,i),f=t.memoizedState),(c=Nh||ap(t,n,c,i,d,f,l)||!1)?(u||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(i,f,l),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(i,f,l)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=f),s.props=i,s.state=f,s.context=l,i=c):("function"!=typeof s.componentDidUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!=typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),i=!1)}return Ap(e,t,n,i,a,r)}function Ap(e,t,n,i,r,a){Mp(e,t);var s=!!(128&t.flags);if(!i&&!s)return r&&Fu(t,n,!1),Wp(e,t,a);i=t.stateNode,_p.current=t;var o=s&&"function"!=typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&s?(t.child=wh(t,e.child,null,a),t.child=wh(t,null,o,a)):yp(e,t,o,a),t.memoizedState=i.state,r&&Fu(t,n,!0),t.child}function Cp(e){var t=e.stateNode;t.pendingContext?Du(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Du(0,t.context,!1),Kh(e,t.containerInfo)}function Rp(e,t,n,i,r){return fh(),mh(r),t.flags|=256,yp(e,t,n,i),t.child}var Pp,kp,Op,Ip,Lp={dehydrated:null,treeContext:null,retryLane:0};function Dp(e){return{baseLanes:e,cachePool:null,transitions:null}}function Np(e,t,n){var i,r=t.pendingProps,a=ed.current,s=!1,o=!!(128&t.flags);if((i=o)||(i=(null===e||null!==e.memoizedState)&&!!(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Au(ed,1&a),null===e)return uh(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?"$!"===e.data?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,s?(r=t.mode,s=t.child,o={mode:"hidden",children:o},1&r||null===s?s=Nm(o,r,0,null):(s.childLanes=0,s.pendingProps=o),e=Dm(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Dp(n),t.memoizedState=Lp,e):Up(t,o));if(null!==(a=e.memoizedState)&&null!==(i=a.dehydrated))return function(e,t,n,i,r,a,s){if(n)return 256&t.flags?(t.flags&=-257,Fp(e,t,s,i=up(Error(sa(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=i.fallback,r=t.mode,i=Nm({mode:"visible",children:i.children},r,0,null),(a=Dm(a,r,s,null)).flags|=2,i.return=t,a.return=t,i.sibling=a,t.child=i,1&t.mode&&wh(t,e.child,null,s),t.child.memoizedState=Dp(s),t.memoizedState=Lp,a);if(!(1&t.mode))return Fp(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var o=i.dgst;return i=o,Fp(e,t,s,i=up(a=Error(sa(419)),i,void 0))}if(o=!!(s&e.childLanes),vp||o){if(null!==(i=Rf)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=r&(i.suspendedLanes|s)?0:r)&&r!==a.retryLane&&(a.retryLane=r,Dh(e,r),nm(i,e,r,-1))}return mm(),Fp(e,t,s,i=up(Error(sa(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Am.bind(null,e),r._reactRetry=t,null):(e=a.treeContext,rh=uu(r.nextSibling),ih=t,ah=!0,sh=null,null!==e&&(Yu[$u++]=Zu,Yu[$u++]=Qu,Yu[$u++]=Ku,Zu=e.id,Qu=e.overflow,Ku=t),t=Up(t,i.children),t.flags|=4096,t)}(e,t,o,r,i,a,n);if(s){s=r.fallback,o=t.mode,i=(a=e.child).sibling;var l={mode:"hidden",children:r.children};return 1&o||t.child===a?(r=Im(a,l)).subtreeFlags=14680064&a.subtreeFlags:((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null),null!==i?s=Im(i,s):(s=Dm(s,o,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,o=null===(o=e.child.memoizedState)?Dp(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~n,t.memoizedState=Lp,r}return e=(s=e.child).sibling,r=Im(s,{mode:"visible",children:r.children}),!(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Up(e,t){return(t=Nm({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fp(e,t,n,i){return null!==i&&mh(i),wh(t,e.child,null,n),(e=Up(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zp(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Rh(e.return,t,n)}function Bp(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function Vp(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(yp(e,t,i.children,n),2&(i=ed.current))i=1&i|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zp(e,n,t);else if(19===e.tag)zp(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Au(ed,i),1&t.mode)switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===td(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Bp(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===td(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Bp(t,!0,n,null,a);break;case"together":Bp(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function Hp(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wp(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Nf|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(sa(153));if(null!==t.child){for(n=Im(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Im(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function jp(e,t){if(!ah)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Gp(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Xp(e,t,n){var i=t.pendingProps;switch(nh(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gp(t),null;case 1:case 17:return Iu(t.type)&&Lu(),Gp(t),null;case 3:return i=t.stateNode,Zh(),Tu(Pu),Tu(Ru),id(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(dh(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==sh&&(sm(sh),sh=null))),kp(e,t),Gp(t),null;case 5:Jh(t);var r=$h(Yh.current);if(n=t.type,null!==e&&null!=t.stateNode)Op(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(sa(166));return Gp(t),null}if(e=$h(Xh.current),dh(t)){i=t.stateNode,n=t.type;var a=t.memoizedProps;switch(i[pu]=t,i[fu]=a,e=!!(1&t.mode),n){case"dialog":Bc("cancel",i),Bc("close",i);break;case"iframe":case"object":case"embed":Bc("load",i);break;case"video":case"audio":for(r=0;r<Nc.length;r++)Bc(Nc[r],i);break;case"source":Bc("error",i);break;case"img":case"image":case"link":Bc("error",i),Bc("load",i);break;case"details":Bc("toggle",i);break;case"input":Za(i,a),Bc("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Bc("invalid",i);break;case"textarea":as(i,a),Bc("invalid",i)}for(var s in ys(n,a),r=null,a)if(a.hasOwnProperty(s)){var o=a[s];"children"===s?"string"==typeof o?i.textContent!==o&&(!0!==a.suppressHydrationWarning&&Jc(i.textContent,o,e),r=["children",o]):"number"==typeof o&&i.textContent!==""+o&&(!0!==a.suppressHydrationWarning&&Jc(i.textContent,o,e),r=["children",""+o]):la.hasOwnProperty(s)&&null!=o&&"onScroll"===s&&Bc("scroll",i)}switch(n){case"input":qa(i),es(i,a,!0);break;case"textarea":qa(i),os(i);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(i.onclick=eu)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{s=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ls(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=s.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof i.is?e=s.createElement(n,{is:i.is}):(e=s.createElement(n),"select"===n&&(s=e,i.multiple?s.multiple=!0:i.size&&(s.size=i.size))):e=s.createElementNS(e,n),e[pu]=t,e[fu]=i,Pp(e,t,!1,!1),t.stateNode=e;e:{switch(s=xs(n,i),n){case"dialog":Bc("cancel",e),Bc("close",e),r=i;break;case"iframe":case"object":case"embed":Bc("load",e),r=i;break;case"video":case"audio":for(r=0;r<Nc.length;r++)Bc(Nc[r],e);r=i;break;case"source":Bc("error",e),r=i;break;case"img":case"image":case"link":Bc("error",e),Bc("load",e),r=i;break;case"details":Bc("toggle",e),r=i;break;case"input":Za(e,i),r=Ka(e,i),Bc("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=Fa({},i,{value:void 0}),Bc("invalid",e);break;case"textarea":as(e,i),r=rs(e,i),Bc("invalid",e)}for(a in ys(n,r),o=r)if(o.hasOwnProperty(a)){var l=o[a];"style"===a?_s(e,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&ds(e,l):"children"===a?"string"==typeof l?("textarea"!==n||""!==l)&&ps(e,l):"number"==typeof l&&ps(e,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(la.hasOwnProperty(a)?null!=l&&"onScroll"===a&&Bc("scroll",e):null!=l&&xa(e,a,l,s))}switch(n){case"input":qa(e),es(e,i,!1);break;case"textarea":qa(e),os(e);break;case"option":null!=i.value&&e.setAttribute("value",""+Ga(i.value));break;case"select":e.multiple=!!i.multiple,null!=(a=i.value)?is(e,!!i.multiple,a,!1):null!=i.defaultValue&&is(e,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof r.onClick&&(e.onclick=eu)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gp(t),null;case 6:if(e&&null!=t.stateNode)Ip(e,t,e.memoizedProps,i);else{if("string"!=typeof i&&null===t.stateNode)throw Error(sa(166));if(n=$h(Yh.current),$h(Xh.current),dh(t)){if(i=t.stateNode,n=t.memoizedProps,i[pu]=t,(a=i.nodeValue!==n)&&null!==(e=ih))switch(e.tag){case 3:Jc(i.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jc(i.nodeValue,n,!!(1&e.mode))}a&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[pu]=t,t.stateNode=i}return Gp(t),null;case 13:if(Tu(ed),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ah&&null!==rh&&1&t.mode&&!(128&t.flags))ph(),fh(),t.flags|=98560,a=!1;else if(a=dh(t),null!==i&&null!==i.dehydrated){if(null===e){if(!a)throw Error(sa(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(sa(317));a[pu]=t}else fh(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gp(t),a=!1}else null!==sh&&(sm(sh),sh=null),a=!0;if(!a)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,1&t.mode&&(null===e||1&ed.current?0===Lf&&(Lf=3):mm())),null!==t.updateQueue&&(t.flags|=4),Gp(t),null);case 4:return Zh(),kp(e,t),null===e&&Wc(t.stateNode.containerInfo),Gp(t),null;case 10:return Ch(t.type._context),Gp(t),null;case 19:if(Tu(ed),null===(a=t.memoizedState))return Gp(t),null;if(i=!!(128&t.flags),null===(s=a.rendering))if(i)jp(a,!1);else{if(0!==Lf||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(s=td(e))){for(t.flags|=128,jp(a,!1),null!==(i=s.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(a=n).flags&=14680066,null===(s=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=s.childLanes,a.lanes=s.lanes,a.child=s.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=s.memoizedProps,a.memoizedState=s.memoizedState,a.updateQueue=s.updateQueue,a.type=s.type,e=s.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Au(ed,1&ed.current|2),t.child}e=e.sibling}null!==a.tail&&Qs()>Hf&&(t.flags|=128,i=!0,jp(a,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=td(s))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),jp(a,!0),null===a.tail&&"hidden"===a.tailMode&&!s.alternate&&!ah)return Gp(t),null}else 2*Qs()-a.renderingStartTime>Hf&&1073741824!==n&&(t.flags|=128,i=!0,jp(a,!1),t.lanes=4194304);a.isBackwards?(s.sibling=t.child,t.child=s):(null!==(n=a.last)?n.sibling=s:t.child=s,a.last=s)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Qs(),t.sibling=null,n=ed.current,Au(ed,i?1&n|2:1&n),t):(Gp(t),null);case 22:case 23:return hm(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&1&t.mode?!!(1073741824&Of)&&(Gp(t),6&t.subtreeFlags&&(t.flags|=8192)):Gp(t),null;case 24:case 25:return null}throw Error(sa(156,t.tag))}function qp(e,t){switch(nh(t),t.tag){case 1:return Iu(t.type)&&Lu(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Zh(),Tu(Pu),Tu(Ru),id(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Jh(t),null;case 13:if(Tu(ed),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(sa(340));fh()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Tu(ed),null;case 4:return Zh(),null;case 10:return Ch(t.type._context),null;case 22:case 23:return hm(),null;default:return null}}Pp=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},kp=function(){},Op=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,$h(Xh.current);var a,s=null;switch(n){case"input":r=Ka(e,r),i=Ka(e,i),s=[];break;case"select":r=Fa({},r,{value:void 0}),i=Fa({},i,{value:void 0}),s=[];break;case"textarea":r=rs(e,r),i=rs(e,i),s=[];break;default:"function"!=typeof r.onClick&&"function"==typeof i.onClick&&(e.onclick=eu)}for(c in ys(n,i),n=null,r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&null!=r[c])if("style"===c){var o=r[c];for(a in o)o.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==c&&"children"!==c&&"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(la.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(o=null!=r?r[c]:void 0,i.hasOwnProperty(c)&&l!==o&&(null!=l||null!=o))if("style"===c)if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(s||(s=[]),s.push(c,n)),n=l;else"dangerouslySetInnerHTML"===c?(l=l?l.__html:void 0,o=o?o.__html:void 0,null!=l&&o!==l&&(s=s||[]).push(c,l)):"children"===c?"string"!=typeof l&&"number"!=typeof l||(s=s||[]).push(c,""+l):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&(la.hasOwnProperty(c)?(null!=l&&"onScroll"===c&&Bc("scroll",e),s||o===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(t.updateQueue=c)&&(t.flags|=4)}},Ip=function(e,t,n,i){n!==i&&(t.flags|=4)};var Yp=!1,$p=!1,Kp="function"==typeof WeakSet?WeakSet:Set,Zp=null;function Qp(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(i){Mm(e,t,i)}else n.current=null}function Jp(e,t,n){try{n()}catch(i){Mm(e,t,i)}}var ef=!1;function tf(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&Jp(t,n,a)}r=r.next}while(r!==i)}}function nf(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rf(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"==typeof t?t(e):t.current=e}}function af(e){var t=e.alternate;null!==t&&(e.alternate=null,af(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[pu],delete t[fu],delete t[gu],delete t[_u],delete t[vu])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sf(e){return 5===e.tag||3===e.tag||4===e.tag}function of(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function lf(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=eu));else if(4!==i&&null!==(e=e.child))for(lf(e,t,n),e=e.sibling;null!==e;)lf(e,t,n),e=e.sibling}function cf(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(cf(e,t,n),e=e.sibling;null!==e;)cf(e,t,n),e=e.sibling}var uf=null,hf=!1;function df(e,t,n){for(n=n.child;null!==n;)pf(e,t,n),n=n.sibling}function pf(e,t,n){if(so&&"function"==typeof so.onCommitFiberUnmount)try{so.onCommitFiberUnmount(ao,n)}catch(o){}switch(n.tag){case 5:$p||Qp(n,t);case 6:var i=uf,r=hf;uf=null,df(e,t,n),hf=r,null!==(uf=i)&&(hf?(e=uf,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):uf.removeChild(n.stateNode));break;case 18:null!==uf&&(hf?(e=uf,n=n.stateNode,8===e.nodeType?cu(e.parentNode,n):1===e.nodeType&&cu(e,n),jo(e)):cu(uf,n.stateNode));break;case 4:i=uf,r=hf,uf=n.stateNode.containerInfo,hf=!0,df(e,t,n),uf=i,hf=r;break;case 0:case 11:case 14:case 15:if(!$p&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,s=a.destroy;a=a.tag,void 0!==s&&(2&a||4&a)&&Jp(n,t,s),r=r.next}while(r!==i)}df(e,t,n);break;case 1:if(!$p&&(Qp(n,t),"function"==typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(o){Mm(n,t,o)}df(e,t,n);break;case 21:df(e,t,n);break;case 22:1&n.mode?($p=(i=$p)||null!==n.memoizedState,df(e,t,n),$p=i):df(e,t,n);break;default:df(e,t,n)}}function ff(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Kp),t.forEach((function(t){var i=Cm.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function mf(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e,s=t,o=s;e:for(;null!==o;){switch(o.tag){case 5:uf=o.stateNode,hf=!1;break e;case 3:case 4:uf=o.stateNode.containerInfo,hf=!0;break e}o=o.return}if(null===uf)throw Error(sa(160));pf(a,s,r),uf=null,hf=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(c){Mm(r,t,c)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gf(t,e),t=t.sibling}function gf(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mf(t,e),_f(e),4&i){try{tf(3,e,e.return),nf(3,e)}catch(oy){Mm(e,e.return,oy)}try{tf(5,e,e.return)}catch(oy){Mm(e,e.return,oy)}}break;case 1:mf(t,e),_f(e),512&i&&null!==n&&Qp(n,n.return);break;case 5:if(mf(t,e),_f(e),512&i&&null!==n&&Qp(n,n.return),32&e.flags){var r=e.stateNode;try{ps(r,"")}catch(oy){Mm(e,e.return,oy)}}if(4&i&&null!=(r=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,o=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===o&&"radio"===a.type&&null!=a.name&&Qa(r,a),xs(o,s);var c=xs(o,a);for(s=0;s<l.length;s+=2){var u=l[s],h=l[s+1];"style"===u?_s(r,h):"dangerouslySetInnerHTML"===u?ds(r,h):"children"===u?ps(r,h):xa(r,u,h,c)}switch(o){case"input":Ja(r,a);break;case"textarea":ss(r,a);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?is(r,!!a.multiple,p,!1):d!==!!a.multiple&&(null!=a.defaultValue?is(r,!!a.multiple,a.defaultValue,!0):is(r,!!a.multiple,a.multiple?[]:"",!1))}r[fu]=a}catch(oy){Mm(e,e.return,oy)}}break;case 6:if(mf(t,e),_f(e),4&i){if(null===e.stateNode)throw Error(sa(162));r=e.stateNode,a=e.memoizedProps;try{r.nodeValue=a}catch(oy){Mm(e,e.return,oy)}}break;case 3:if(mf(t,e),_f(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{jo(t.containerInfo)}catch(oy){Mm(e,e.return,oy)}break;case 4:default:mf(t,e),_f(e);break;case 13:mf(t,e),_f(e),8192&(r=e.child).flags&&(a=null!==r.memoizedState,r.stateNode.isHidden=a,!a||null!==r.alternate&&null!==r.alternate.memoizedState||(Vf=Qs())),4&i&&ff(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?($p=(c=$p)||u,mf(t,e),$p=c):mf(t,e),_f(e),8192&i){if(c=null!==e.memoizedState,(e.stateNode.isHidden=c)&&!u&&1&e.mode)for(Zp=e,u=e.child;null!==u;){for(h=Zp=u;null!==Zp;){switch(p=(d=Zp).child,d.tag){case 0:case 11:case 14:case 15:tf(4,d,d.return);break;case 1:Qp(d,d.return);var f=d.stateNode;if("function"==typeof f.componentWillUnmount){i=d,n=d.return;try{t=i,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(oy){Mm(i,n,oy)}}break;case 5:Qp(d,d.return);break;case 22:if(null!==d.memoizedState){wf(h);continue}}null!==p?(p.return=d,Zp=p):wf(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{r=h.stateNode,c?"function"==typeof(a=r.style).setProperty?a.setProperty("display","none","important"):a.display="none":(o=h.stateNode,s=null!=(l=h.memoizedProps.style)&&l.hasOwnProperty("display")?l.display:null,o.style.display=gs("display",s))}catch(oy){Mm(e,e.return,oy)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(oy){Mm(e,e.return,oy)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mf(t,e),_f(e),4&i&&ff(e);case 21:}}function _f(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sf(n)){var i=n;break e}n=n.return}throw Error(sa(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(ps(r,""),i.flags&=-33),cf(e,of(e),r);break;case 3:case 4:var a=i.stateNode.containerInfo;lf(e,of(e),a);break;default:throw Error(sa(161))}}catch(s){Mm(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vf(e,t,n){Zp=e,yf(e)}function yf(e,t,n){for(var i=!!(1&e.mode);null!==Zp;){var r=Zp,a=r.child;if(22===r.tag&&i){var s=null!==r.memoizedState||Yp;if(!s){var o=r.alternate,l=null!==o&&null!==o.memoizedState||$p;o=Yp;var c=$p;if(Yp=s,($p=l)&&!c)for(Zp=r;null!==Zp;)l=(s=Zp).child,22===s.tag&&null!==s.memoizedState?bf(r):null!==l?(l.return=s,Zp=l):bf(r);for(;null!==a;)Zp=a,yf(a),a=a.sibling;Zp=r,Yp=o,$p=c}xf(e)}else 8772&r.subtreeFlags&&null!==a?(a.return=r,Zp=a):xf(e)}}function xf(e){for(;null!==Zp;){var t=Zp;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:$p||nf(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!$p)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:np(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&jh(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}jh(t,s,n)}break;case 5:var o=t.stateNode;if(null===n&&4&t.flags){n=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&jo(h)}}}break;default:throw Error(sa(163))}$p||512&t.flags&&rf(t)}catch(d){Mm(t,t.return,d)}}if(t===e){Zp=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zp=n;break}Zp=t.return}}function wf(e){for(;null!==Zp;){var t=Zp;if(t===e){Zp=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zp=n;break}Zp=t.return}}function bf(e){for(;null!==Zp;){var t=Zp;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{nf(4,t)}catch(l){Mm(t,n,l)}break;case 1:var i=t.stateNode;if("function"==typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(l){Mm(t,r,l)}}var a=t.return;try{rf(t)}catch(l){Mm(t,a,l)}break;case 5:var s=t.return;try{rf(t)}catch(l){Mm(t,s,l)}}}catch(l){Mm(t,t.return,l)}if(t===e){Zp=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zp=o;break}Zp=t.return}}var Ef,Mf=Math.ceil,Sf=wa.ReactCurrentDispatcher,Tf=wa.ReactCurrentOwner,Af=wa.ReactCurrentBatchConfig,Cf=0,Rf=null,Pf=null,kf=0,Of=0,If=Su(0),Lf=0,Df=null,Nf=0,Uf=0,Ff=0,zf=null,Bf=null,Vf=0,Hf=1/0,Wf=null,jf=!1,Gf=null,Xf=null,qf=!1,Yf=null,$f=0,Kf=0,Zf=null,Qf=-1,Jf=0;function em(){return 6&Cf?Qs():-1!==Qf?Qf:Qf=Qs()}function tm(e){return 1&e.mode?2&Cf&&0!==kf?kf&-kf:null!==gh.transition?(0===Jf&&(Jf=_o()),Jf):0!==(e=wo)?e:e=void 0===(e=window.event)?16:Qo(e.type):1}function nm(e,t,n,i){if(50<Kf)throw Kf=0,Zf=null,Error(sa(185));yo(e,n,i),2&Cf&&e===Rf||(e===Rf&&(!(2&Cf)&&(Uf|=n),4===Lf&&om(e,kf)),im(e,i),1===n&&0===Cf&&!(1&t.mode)&&(Hf=Qs()+500,Bu&&Wu()))}function im(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-oo(a),o=1<<s,l=r[s];-1===l?o&n&&!(o&i)||(r[s]=mo(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var i=fo(e,e===Rf?kf:0);if(0===i)null!==n&&$s(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&$s(n),1===t)0===e.tag?function(e){Bu=!0,Hu(e)}(lm.bind(null,e)):Hu(lm.bind(null,e)),ou((function(){!(6&Cf)&&Wu()})),n=null;else{switch(bo(i)){case 1:n=eo;break;case 4:n=to;break;case 16:default:n=no;break;case 536870912:n=ro}n=Rm(n,rm.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rm(e,t){if(Qf=-1,Jf=0,6&Cf)throw Error(sa(327));var n=e.callbackNode;if(bm()&&e.callbackNode!==n)return null;var i=fo(e,e===Rf?kf:0);if(0===i)return null;if(30&i||i&e.expiredLanes||t)t=gm(e,i);else{t=i;var r=Cf;Cf|=2;var a=fm();for(Rf===e&&kf===t||(Wf=null,Hf=Qs()+500,dm(e,t));;)try{vm();break}catch(o){pm(e,o)}Ah(),Sf.current=a,Cf=r,null!==Pf?t=0:(Rf=null,kf=0,t=Lf)}if(0!==t){if(2===t&&(0!==(r=go(e))&&(i=r,t=am(e,r))),1===t)throw n=Df,dm(e,0),om(e,i),im(e,Qs()),n;if(6===t)om(e,i);else{if(r=e.current.alternate,!(30&i||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!lc(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)||(t=gm(e,i),2===t&&(a=go(e),0!==a&&(i=a,t=am(e,a))),1!==t)))throw n=Df,dm(e,0),om(e,i),im(e,Qs()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(sa(345));case 2:case 5:wm(e,Bf,Wf);break;case 3:if(om(e,i),(130023424&i)===i&&10<(t=Vf+500-Qs())){if(0!==fo(e,0))break;if(((r=e.suspendedLanes)&i)!==i){em(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ru(wm.bind(null,e,Bf,Wf),t);break}wm(e,Bf,Wf);break;case 4:if(om(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-oo(i);a=1<<s,(s=t[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Qs()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Mf(i/1960))-i)){e.timeoutHandle=ru(wm.bind(null,e,Bf,Wf),i);break}wm(e,Bf,Wf);break;default:throw Error(sa(329))}}}return im(e,Qs()),e.callbackNode===n?rm.bind(null,e):null}function am(e,t){var n=zf;return e.current.memoizedState.isDehydrated&&(dm(e,t).flags|=256),2!==(e=gm(e,t))&&(t=Bf,Bf=n,null!==t&&sm(t)),e}function sm(e){null===Bf?Bf=e:Bf.push.apply(Bf,e)}function om(e,t){for(t&=~Ff,t&=~Uf,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-oo(t),i=1<<n;e[n]=-1,t&=~i}}function lm(e){if(6&Cf)throw Error(sa(327));bm();var t=fo(e,0);if(!(1&t))return im(e,Qs()),null;var n=gm(e,t);if(0!==e.tag&&2===n){var i=go(e);0!==i&&(t=i,n=am(e,i))}if(1===n)throw n=Df,dm(e,0),om(e,t),im(e,Qs()),n;if(6===n)throw Error(sa(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wm(e,Bf,Wf),im(e,Qs()),null}function cm(e,t){var n=Cf;Cf|=1;try{return e(t)}finally{0===(Cf=n)&&(Hf=Qs()+500,Bu&&Wu())}}function um(e){null!==Yf&&0===Yf.tag&&!(6&Cf)&&bm();var t=Cf;Cf|=1;var n=Af.transition,i=wo;try{if(Af.transition=null,wo=1,e)return e()}finally{wo=i,Af.transition=n,!(6&(Cf=t))&&Wu()}}function hm(){Of=If.current,Tu(If)}function dm(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,au(n)),null!==Pf)for(n=Pf.return;null!==n;){var i=n;switch(nh(i),i.tag){case 1:null!=(i=i.type.childContextTypes)&&Lu();break;case 3:Zh(),Tu(Pu),Tu(Ru),id();break;case 5:Jh(i);break;case 4:Zh();break;case 13:case 19:Tu(ed);break;case 10:Ch(i.type._context);break;case 22:case 23:hm()}n=n.return}if(Rf=e,Pf=e=Im(e.current,null),kf=Of=t,Lf=0,Df=null,Ff=Uf=Nf=0,Bf=zf=null,null!==Oh){for(t=0;t<Oh.length;t++)if(null!==(i=(n=Oh[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var s=a.next;a.next=r,i.next=s}n.pending=i}Oh=null}return e}function pm(e,t){for(;;){var n=Pf;try{if(Ah(),rd.current=Qd,ud){for(var i=od.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}ud=!1}if(sd=0,cd=ld=od=null,hd=!1,dd=0,Tf.current=null,null===n||null===n.return){Lf=1,Df=t,Pf=null;break}e:{var a=e,s=n.return,o=n,l=t;if(t=kf,o.flags|=32768,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l,u=o,h=u.tag;if(!(1&u.mode||0!==h&&11!==h&&15!==h)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=mp(s);if(null!==p){p.flags&=-257,gp(p,s,o,0,t),1&p.mode&&fp(a,c,t),l=c;var f=(t=p).updateQueue;if(null===f){var m=new Set;m.add(l),t.updateQueue=m}else f.add(l);break e}if(!(1&t)){fp(a,c,t),mm();break e}l=Error(sa(426))}else if(ah&&1&o.mode){var g=mp(s);if(null!==g){!(65536&g.flags)&&(g.flags|=256),gp(g,s,o,0,t),mh(cp(l,o));break e}}a=l=cp(l,o),4!==Lf&&(Lf=2),null===zf?zf=[a]:zf.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Hh(a,dp(0,l,t));break e;case 1:o=l;var _=a.type,v=a.stateNode;if(!(128&a.flags||"function"!=typeof _.getDerivedStateFromError&&(null===v||"function"!=typeof v.componentDidCatch||null!==Xf&&Xf.has(v)))){a.flags|=65536,t&=-t,a.lanes|=t,Hh(a,pp(a,o,t));break e}}a=a.return}while(null!==a)}xm(n)}catch(y){t=y,Pf===n&&null!==n&&(Pf=n=n.return);continue}break}}function fm(){var e=Sf.current;return Sf.current=Qd,null===e?Qd:e}function mm(){0!==Lf&&3!==Lf&&2!==Lf||(Lf=4),null===Rf||!(268435455&Nf)&&!(268435455&Uf)||om(Rf,kf)}function gm(e,t){var n=Cf;Cf|=2;var i=fm();for(Rf===e&&kf===t||(Wf=null,dm(e,t));;)try{_m();break}catch(r){pm(e,r)}if(Ah(),Cf=n,Sf.current=i,null!==Pf)throw Error(sa(261));return Rf=null,kf=0,Lf}function _m(){for(;null!==Pf;)ym(Pf)}function vm(){for(;null!==Pf&&!Ks();)ym(Pf)}function ym(e){var t=Ef(e.alternate,e,Of);e.memoizedProps=e.pendingProps,null===t?xm(e):Pf=t,Tf.current=null}function xm(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=qp(n,t)))return n.flags&=32767,void(Pf=n);if(null===e)return Lf=6,void(Pf=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Xp(n,t,Of)))return void(Pf=n);if(null!==(t=t.sibling))return void(Pf=t);Pf=t=e}while(null!==t);0===Lf&&(Lf=5)}function wm(e,t,n){var i=wo,r=Af.transition;try{Af.transition=null,wo=1,function(e,t,n,i){do{bm()}while(null!==Yf);if(6&Cf)throw Error(sa(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(sa(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-oo(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,a),e===Rf&&(Pf=Rf=null,kf=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||qf||(qf=!0,Rm(no,(function(){return bm(),null}))),a=!!(15990&n.flags),!!(15990&n.subtreeFlags)||a){a=Af.transition,Af.transition=null;var s=wo;wo=1;var o=Cf;Cf|=4,Tf.current=null,function(e,t){if(tu=Xo,fc(e=pc())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch(x){n=null;break e}var s=0,o=-1,l=-1,c=0,u=0,h=e,d=null;t:for(;;){for(var p;h!==n||0!==r&&3!==h.nodeType||(o=s+r),h!==a||0!==i&&3!==h.nodeType||(l=s+i),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)d=h,h=p;for(;;){if(h===e)break t;if(d===n&&++c===r&&(o=s),d===a&&++u===i&&(l=s),null!==(p=h.nextSibling))break;d=(h=d).parentNode}h=p}n=-1===o||-1===l?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(nu={focusedElem:e,selectionRange:n},Xo=!1,Zp=t;null!==Zp;)if(e=(t=Zp).child,1028&t.subtreeFlags&&null!==e)e.return=t,Zp=e;else for(;null!==Zp;){t=Zp;try{var f=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var m=f.memoizedProps,g=f.memoizedState,_=t.stateNode,v=_.getSnapshotBeforeUpdate(t.elementType===t.type?m:np(t.type,m),g);_.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(sa(163))}}catch(x){Mm(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Zp=e;break}Zp=t.return}f=ef,ef=!1}(e,n),gf(n,e),mc(nu),Xo=!!tu,nu=tu=null,e.current=n,vf(n),Zs(),Cf=o,wo=s,Af.transition=a}else e.current=n;if(qf&&(qf=!1,Yf=e,$f=r),a=e.pendingLanes,0===a&&(Xf=null),function(e){if(so&&"function"==typeof so.onCommitFiberRoot)try{so.onCommitFiberRoot(ao,e,void 0,!(128&~e.current.flags))}catch(t){}}(n.stateNode),im(e,Qs()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(jf)throw jf=!1,e=Gf,Gf=null,e;!!(1&$f)&&0!==e.tag&&bm(),a=e.pendingLanes,1&a?e===Zf?Kf++:(Kf=0,Zf=e):Kf=0,Wu()}(e,t,n,i)}finally{Af.transition=r,wo=i}return null}function bm(){if(null!==Yf){var e=bo($f),t=Af.transition,n=wo;try{if(Af.transition=null,wo=16>e?16:e,null===Yf)var i=!1;else{if(e=Yf,Yf=null,$f=0,6&Cf)throw Error(sa(331));var r=Cf;for(Cf|=4,Zp=e.current;null!==Zp;){var a=Zp,s=a.child;if(16&Zp.flags){var o=a.deletions;if(null!==o){for(var l=0;l<o.length;l++){var c=o[l];for(Zp=c;null!==Zp;){var u=Zp;switch(u.tag){case 0:case 11:case 15:tf(8,u,a)}var h=u.child;if(null!==h)h.return=u,Zp=h;else for(;null!==Zp;){var d=(u=Zp).sibling,p=u.return;if(af(u),u===c){Zp=null;break}if(null!==d){d.return=p,Zp=d;break}Zp=p}}}var f=a.alternate;if(null!==f){var m=f.child;if(null!==m){f.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Zp=a}}if(2064&a.subtreeFlags&&null!==s)s.return=a,Zp=s;else e:for(;null!==Zp;){if(2048&(a=Zp).flags)switch(a.tag){case 0:case 11:case 15:tf(9,a,a.return)}var _=a.sibling;if(null!==_){_.return=a.return,Zp=_;break e}Zp=a.return}}var v=e.current;for(Zp=v;null!==Zp;){var y=(s=Zp).child;if(2064&s.subtreeFlags&&null!==y)y.return=s,Zp=y;else e:for(s=v;null!==Zp;){if(2048&(o=Zp).flags)try{switch(o.tag){case 0:case 11:case 15:nf(9,o)}}catch(w){Mm(o,o.return,w)}if(o===s){Zp=null;break e}var x=o.sibling;if(null!==x){x.return=o.return,Zp=x;break e}Zp=o.return}}if(Cf=r,Wu(),so&&"function"==typeof so.onPostCommitFiberRoot)try{so.onPostCommitFiberRoot(ao,e)}catch(w){}i=!0}return i}finally{wo=n,Af.transition=t}}return!1}function Em(e,t,n){e=Bh(e,t=dp(0,t=cp(n,t),1),1),t=em(),null!==e&&(yo(e,1,t),im(e,t))}function Mm(e,t,n){if(3===e.tag)Em(e,e,n);else for(;null!==t;){if(3===t.tag){Em(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&(null===Xf||!Xf.has(i))){t=Bh(t,e=pp(t,e=cp(n,e),1),1),e=em(),null!==t&&(yo(t,1,e),im(t,e));break}}t=t.return}}function Sm(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=em(),e.pingedLanes|=e.suspendedLanes&n,Rf===e&&(kf&n)===n&&(4===Lf||3===Lf&&(130023424&kf)===kf&&500>Qs()-Vf?dm(e,0):Ff|=n),im(e,t)}function Tm(e,t){0===t&&(1&e.mode?(t=ho,!(130023424&(ho<<=1))&&(ho=4194304)):t=1);var n=em();null!==(e=Dh(e,t))&&(yo(e,t,n),im(e,n))}function Am(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tm(e,n)}function Cm(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(sa(314))}null!==i&&i.delete(t),Tm(e,n)}function Rm(e,t){return Ys(e,t)}function Pm(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function km(e,t,n,i){return new Pm(e,t,n,i)}function Om(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Im(e,t){var n=e.alternate;return null===n?((n=km(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lm(e,t,n,i,r,a){var s=2;if(i=e,"function"==typeof e)Om(e)&&(s=1);else if("string"==typeof e)s=5;else e:switch(e){case Ma:return Dm(n.children,r,a,t);case Sa:s=8,r|=8;break;case Ta:return(e=km(12,n,t,2|r)).elementType=Ta,e.lanes=a,e;case Pa:return(e=km(13,n,t,r)).elementType=Pa,e.lanes=a,e;case ka:return(e=km(19,n,t,r)).elementType=ka,e.lanes=a,e;case La:return Nm(n,r,a,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case Aa:s=10;break e;case Ca:s=9;break e;case Ra:s=11;break e;case Oa:s=14;break e;case Ia:s=16,i=null;break e}throw Error(sa(130,null==e?e:typeof e,""))}return(t=km(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function Dm(e,t,n,i){return(e=km(7,e,i,t)).lanes=n,e}function Nm(e,t,n,i){return(e=km(22,e,i,t)).elementType=La,e.lanes=n,e.stateNode={isHidden:!1},e}function Um(e,t,n){return(e=km(6,e,null,t)).lanes=n,e}function Fm(e,t,n){return(t=km(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zm(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vo(0),this.expirationTimes=vo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vo(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bm(e,t,n,i,r,a,s,o,l){return e=new zm(e,t,n,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=km(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uh(a),e}function Vm(e){if(!e)return Cu;e:{if(Ws(e=e._reactInternals)!==e||1!==e.tag)throw Error(sa(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Iu(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(sa(171))}if(1===e.tag){var n=e.type;if(Iu(n))return Nu(e,n,t)}return t}function Hm(e,t,n,i,r,a,s,o,l){return(e=Bm(n,i,!0,e,0,a,0,o,l)).context=Vm(null),n=e.current,(a=zh(i=em(),r=tm(n))).callback=null!=t?t:null,Bh(n,a,r),e.current.lanes=r,yo(e,r,i),im(e,i),e}function Wm(e,t,n,i){var r=t.current,a=em(),s=tm(r);return n=Vm(n),null===t.context?t.context=n:t.pendingContext=n,(t=zh(a,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Bh(r,t,s))&&(nm(e,r,s,a),Vh(e,r,s)),s}function jm(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gm(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Xm(e,t){Gm(e,t),(e=e.alternate)&&Gm(e,t)}Ef=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Pu.current)vp=!0;else{if(!(e.lanes&n||128&t.flags))return vp=!1,function(e,t,n){switch(t.tag){case 3:Cp(t),fh();break;case 5:Qh(t);break;case 1:Iu(t.type)&&Uu(t);break;case 4:Kh(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;Au(Eh,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Au(ed,1&ed.current),t.flags|=128,null):n&t.child.childLanes?Np(e,t,n):(Au(ed,1&ed.current),null!==(e=Wp(e,t,n))?e.sibling:null);Au(ed,1&ed.current);break;case 19:if(i=!!(n&t.childLanes),128&e.flags){if(i)return Vp(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Au(ed,ed.current),i)break;return null;case 22:case 23:return t.lanes=0,Ep(e,t,n)}return Wp(e,t,n)}(e,t,n);vp=!!(131072&e.flags)}else vp=!1,ah&&1048576&t.flags&&eh(t,qu,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Hp(e,t),e=t.pendingProps;var r=Ou(t,Ru.current);Ph(t,n),r=gd(null,t,i,e,r,n);var a=_d();return t.flags|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Iu(i)?(a=!0,Uu(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Uh(t),r.updater=rp,t.stateNode=r,r._reactInternals=t,lp(t,i,e,n),t=Ap(null,t,i,!0,a,n)):(t.tag=0,ah&&a&&th(t),yp(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Hp(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"==typeof e)return Om(e)?1:0;if(null!=e){if((e=e.$$typeof)===Ra)return 11;if(e===Oa)return 14}return 2}(i),e=np(i,e),r){case 0:t=Sp(null,t,i,e,n);break e;case 1:t=Tp(null,t,i,e,n);break e;case 11:t=xp(null,t,i,e,n);break e;case 14:t=wp(null,t,i,np(i.type,e),n);break e}throw Error(sa(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Sp(e,t,i,r=t.elementType===i?r:np(i,r),n);case 1:return i=t.type,r=t.pendingProps,Tp(e,t,i,r=t.elementType===i?r:np(i,r),n);case 3:e:{if(Cp(t),null===e)throw Error(sa(387));i=t.pendingProps,r=(a=t.memoizedState).element,Fh(e,t),Wh(t,i,null,n);var s=t.memoizedState;if(i=s.element,a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Rp(e,t,i,n,r=cp(Error(sa(423)),t));break e}if(i!==r){t=Rp(e,t,i,n,r=cp(Error(sa(424)),t));break e}for(rh=uu(t.stateNode.containerInfo.firstChild),ih=t,ah=!0,sh=null,n=bh(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fh(),i===r){t=Wp(e,t,n);break e}yp(e,t,i,n)}t=t.child}return t;case 5:return Qh(t),null===e&&uh(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,iu(i,r)?s=null:null!==a&&iu(i,a)&&(t.flags|=32),Mp(e,t),yp(e,t,s,n),t.child;case 6:return null===e&&uh(t),null;case 13:return Np(e,t,n);case 4:return Kh(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=wh(t,null,i,n):yp(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,xp(e,t,i,r=t.elementType===i?r:np(i,r),n);case 7:return yp(e,t,t.pendingProps,n),t.child;case 8:case 12:return yp(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,s=r.value,Au(Eh,i._currentValue),i._currentValue=s,null!==a)if(lc(a.value,s)){if(a.children===r.children&&!Pu.current){t=Wp(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var o=a.dependencies;if(null!==o){s=a.child;for(var l=o.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=zh(-1,n&-n)).tag=2;var c=a.updateQueue;if(null!==c){var u=(c=c.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Rh(a.return,n,t),o.lanes|=n;break}l=l.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(sa(341));s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),Rh(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}yp(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Ph(t,n),i=i(r=kh(r)),t.flags|=1,yp(e,t,i,n),t.child;case 14:return r=np(i=t.type,t.pendingProps),wp(e,t,i,r=np(i.type,r),n);case 15:return bp(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:np(i,r),Hp(e,t),t.tag=1,Iu(i)?(e=!0,Uu(t)):e=!1,Ph(t,n),sp(t,i,r),lp(t,i,r,n),Ap(null,t,i,!0,e,n);case 19:return Vp(e,t,n);case 22:return Ep(e,t,n)}throw Error(sa(156,t.tag))};var qm="function"==typeof reportError?reportError:function(e){};function Ym(e){this._internalRoot=e}function $m(e){this._internalRoot=e}function Km(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zm(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Qm(){}function Jm(e,t,n,i,r){var a=n._reactRootContainer;if(a){var s=a;if("function"==typeof r){var o=r;r=function(){var e=jm(s);o.call(e)}}Wm(t,s,e,r)}else s=function(e,t,n,i,r){if(r){if("function"==typeof i){var a=i;i=function(){var e=jm(s);a.call(e)}}var s=Hm(t,i,e,0,null,!1,0,"",Qm);return e._reactRootContainer=s,e[mu]=s.current,Wc(8===e.nodeType?e.parentNode:e),um(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"==typeof i){var o=i;i=function(){var e=jm(l);o.call(e)}}var l=Bm(e,0,!1,null,0,!1,0,"",Qm);return e._reactRootContainer=l,e[mu]=l.current,Wc(8===e.nodeType?e.parentNode:e),um((function(){Wm(t,l,n,i)})),l}(n,t,e,r,i);return jm(s)}$m.prototype.render=Ym.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(sa(409));Wm(e,t,null,null)},$m.prototype.unmount=Ym.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;um((function(){Wm(null,e,null,null)})),t[mu]=null}},$m.prototype.unstable_scheduleHydration=function(e){if(e){var t=To();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Do.length&&0!==t&&t<Do[n].priority;n++);Do.splice(n,0,e),0===n&&zo(e)}},Eo=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=po(t.pendingLanes);0!==n&&(xo(t,1|n),im(t,Qs()),!(6&Cf)&&(Hf=Qs()+500,Wu()))}break;case 13:um((function(){var t=Dh(e,1);if(null!==t){var n=em();nm(t,e,1,n)}})),Xm(e,1)}},Mo=function(e){if(13===e.tag){var t=Dh(e,134217728);if(null!==t)nm(t,e,134217728,em());Xm(e,134217728)}},So=function(e){if(13===e.tag){var t=tm(e),n=Dh(e,t);if(null!==n)nm(n,e,t,em());Xm(e,t)}},To=function(){return wo},Ao=function(e,t){var n=wo;try{return wo=e,t()}finally{wo=n}},Es=function(e,t,n){switch(t){case"input":if(Ja(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=bu(i);if(!r)throw Error(sa(90));Ya(i),Ja(i,r)}}}break;case"textarea":ss(e,n);break;case"select":null!=(t=n.value)&&is(e,!!n.multiple,t,!1)}},Rs=cm,Ps=um;var eg={usingClientEntryPoint:!1,Events:[xu,wu,bu,As,Cs,cm]},tg={findFiberByHostInstance:yu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ng={bundleType:tg.bundleType,version:tg.version,rendererPackageName:tg.rendererPackageName,rendererConfig:tg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:wa.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Xs(e))?null:e.stateNode},findFiberByHostInstance:tg.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ig=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ig.isDisabled&&ig.supportsFiber)try{ao=ig.inject(ng),so=ig}catch(hs){}}ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eg,ea.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Km(t))throw Error(sa(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:Ea,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},ea.createRoot=function(e,t){if(!Km(e))throw Error(sa(299));var n=!1,i="",r=qm;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Bm(e,1,!1,null,0,n,0,i,r),e[mu]=t.current,Wc(8===e.nodeType?e.parentNode:e),new Ym(t)},ea.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(sa(188));throw e=Object.keys(e).join(","),Error(sa(268,e))}return e=null===(e=Xs(t))?null:e.stateNode},ea.flushSync=function(e){return um(e)},ea.hydrate=function(e,t,n){if(!Zm(t))throw Error(sa(200));return Jm(null,e,t,!0,n)},ea.hydrateRoot=function(e,t,n){if(!Km(e))throw Error(sa(405));var i=null!=n&&n.hydratedSources||null,r=!1,a="",s=qm;if(null!=n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Hm(t,null,e,1,null!=n?n:null,r,0,a,s),e[mu]=t.current,Wc(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new $m(t)},ea.render=function(e,t,n){if(!Zm(t))throw Error(sa(200));return Jm(null,e,t,!1,n)},ea.unmountComponentAtNode=function(e){if(!Zm(e))throw Error(sa(40));return!!e._reactRootContainer&&(um((function(){Jm(null,null,e,!1,(function(){e._reactRootContainer=null,e[mu]=null}))})),!0)},ea.unstable_batchedUpdates=cm,ea.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!Zm(n))throw Error(sa(200));if(null==e||void 0===e._reactInternals)throw Error(sa(38));return Jm(e,t,n,!1,i)},ea.version="18.3.1-next-f1338f8080-20240426",function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){}}(),Jr.exports=ea;var rg,ag=Jr.exports;rg=ag.createRoot,ag.hydrateRoot;var sg={exports:{}},og={},lg=Hr;var cg="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ug=lg.useSyncExternalStore,hg=lg.useRef,dg=lg.useEffect,pg=lg.useMemo,fg=lg.useDebugValue;og.useSyncExternalStoreWithSelector=function(e,t,n,i,r){var a=hg(null);if(null===a.current){var s={hasValue:!1,value:null};a.current=s}else s=a.current;a=pg((function(){function e(e){if(!l){if(l=!0,a=e,e=i(e),void 0!==r&&s.hasValue){var t=s.value;if(r(t,e))return o=t}return o=e}if(t=o,cg(a,e))return t;var n=i(e);return void 0!==r&&r(t,n)?t:(a=e,o=n)}var a,o,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,i,r]);var o=ug(e,a[0],a[1]);return dg((function(){s.hasValue=!0,s.value=o}),[o]),fg(o),o},sg.exports=og;var mg=sg.exports,gg="default"in jr?Wr:jr,_g=Symbol.for("react-redux-context"),vg="undefined"!=typeof globalThis?globalThis:{};function yg(){if(!gg.createContext)return{};const e=vg[_g]??(vg[_g]=new Map);let t=e.get(gg.createContext);return t||(t=gg.createContext(null),e.set(gg.createContext,t)),t}var xg=yg();function wg(e=xg){return function(){return gg.useContext(e)}}var bg=wg(),Eg=()=>{throw new Error("uSES not initialized!")},Mg=(e,t)=>e===t;function Sg(e=xg){const t=e===xg?bg:wg(e),n=(e,n={})=>{const{equalityFn:i=Mg,devModeChecks:r={}}="function"==typeof n?{equalityFn:n}:n,{store:a,subscription:s,getServerState:o,stabilityCheck:l,identityFunctionCheck:c}=t();gg.useRef(!0);const u=gg.useCallback({[e.name]:t=>e(t)}[e.name],[e,l,r.stabilityCheck]),h=Eg(s.addNestedSub,a.getState,o||a.getState,u,i);return gg.useDebugValue(h),h};return Object.assign(n,{withTypes:()=>n}),n}var Tg=Sg();var Ag={notify(){},get:()=>[]};var Cg=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Rg="undefined"!=typeof navigator&&"ReactNative"===navigator.product,Pg=Cg||Rg?gg.useLayoutEffect:gg.useEffect;var kg=function({store:e,context:t,children:n,serverState:i,stabilityCheck:r="once",identityFunctionCheck:a="once"}){const s=gg.useMemo((()=>{const t=function(e){let t,n=Ag,i=0,r=!1;function a(){l.onStateChange&&l.onStateChange()}function s(){i++,t||(t=e.subscribe(a),n=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){(()=>{let t=e;for(;t;)t.callback(),t=t.next})()},get(){const t=[];let n=e;for(;n;)t.push(n),n=n.next;return t},subscribe(n){let i=!0;const r=t={callback:n,next:null,prev:t};return r.prev?r.prev.next=r:e=r,function(){i&&null!==e&&(i=!1,r.next?r.next.prev=r.prev:t=r.prev,r.prev?r.prev.next=r.next:e=r.next)}}}}())}function o(){i--,t&&0===i&&(t(),t=void 0,n.clear(),n=Ag)}const l={addNestedSub:function(e){s();const t=n.subscribe(e);let i=!1;return()=>{i||(i=!0,t(),o())}},notifyNestedSubs:function(){n.notify()},handleChangeWrapper:a,isSubscribed:function(){return r},trySubscribe:function(){r||(r=!0,s())},tryUnsubscribe:function(){r&&(r=!1,o())},getListeners:()=>n};return l}(e);return{store:e,subscription:t,getServerState:i?()=>i:void 0,stabilityCheck:r,identityFunctionCheck:a}}),[e,i,r,a]),o=gg.useMemo((()=>e.getState()),[e]);Pg((()=>{const{subscription:t}=s;return t.onStateChange=t.notifyNestedSubs,t.trySubscribe(),o!==e.getState()&&t.notifyNestedSubs(),()=>{t.tryUnsubscribe(),t.onStateChange=void 0}}),[s,o]);const l=t||xg;return gg.createElement(l.Provider,{value:s},n)};function Og(e=xg){const t=e===xg?bg:wg(e),n=()=>{const{store:e}=t();return e};return Object.assign(n,{withTypes:()=>n}),n}var Ig=Og();function Lg(e=xg){const t=e===xg?Ig:Og(e),n=()=>t().dispatch;return Object.assign(n,{withTypes:()=>n}),n}var Dg,Ng=Lg();function Ug(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}Dg=mg.useSyncExternalStoreWithSelector,Eg=Dg;var Fg=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),zg=()=>Math.random().toString(36).substring(7).split("").join("."),Bg={INIT:`@@redux/INIT${zg()}`,REPLACE:`@@redux/REPLACE${zg()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${zg()}`};function Vg(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function Hg(e,t,n){if("function"!=typeof e)throw new Error(Ug(2));if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(Ug(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(Ug(1));return n(Hg)(e,t)}let i=e,r=t,a=new Map,s=a,o=0,l=!1;function c(){s===a&&(s=new Map,a.forEach(((e,t)=>{s.set(t,e)})))}function u(){if(l)throw new Error(Ug(3));return r}function h(e){if("function"!=typeof e)throw new Error(Ug(4));if(l)throw new Error(Ug(5));let t=!0;c();const n=o++;return s.set(n,e),function(){if(t){if(l)throw new Error(Ug(6));t=!1,c(),s.delete(n),a=null}}}function d(e){if(!Vg(e))throw new Error(Ug(7));if(void 0===e.type)throw new Error(Ug(8));if("string"!=typeof e.type)throw new Error(Ug(17));if(l)throw new Error(Ug(9));try{l=!0,r=i(r,e)}finally{l=!1}return(a=s).forEach((e=>{e()})),e}d({type:Bg.INIT});return{dispatch:d,subscribe:h,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(Ug(10));i=e,d({type:Bg.REPLACE})},[Fg]:function(){const e=h;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error(Ug(11));function n(){const e=t;e.next&&e.next(u())}n();return{unsubscribe:e(n)}},[Fg](){return this}}}}}function Wg(e){const t=Object.keys(e),n={};for(let s=0;s<t.length;s++){const i=t[s];"function"==typeof e[i]&&(n[i]=e[i])}const i=Object.keys(n);let r;try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if(void 0===n(void 0,{type:Bg.INIT}))throw new Error(Ug(12));if(void 0===n(void 0,{type:Bg.PROBE_UNKNOWN_ACTION()}))throw new Error(Ug(13))}))}(n)}catch(a){r=a}return function(e={},t){if(r)throw r;let a=!1;const s={};for(let r=0;r<i.length;r++){const o=i[r],l=n[o],c=e[o],u=l(c,t);if(void 0===u)throw t&&t.type,new Error(Ug(14));s[o]=u,a=a||u!==c}return a=a||i.length!==Object.keys(e).length,a?s:e}}function jg(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...n)=>e(t(...n))))}var Gg=Symbol.for("immer-nothing"),Xg=Symbol.for("immer-draftable"),qg=Symbol.for("immer-state");function Yg(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var $g=Object.getPrototypeOf;function Kg(e){return!!e&&!!e[qg]}function Zg(e){var t;return!!e&&(Jg(e)||Array.isArray(e)||!!e[Xg]||!!(null==(t=e.constructor)?void 0:t[Xg])||r_(e)||a_(e))}var Qg=Object.prototype.constructor.toString();function Jg(e){if(!e||"object"!=typeof e)return!1;const t=$g(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Qg}function e_(e,t){0===t_(e)?Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)})):e.forEach(((n,i)=>t(i,n,e)))}function t_(e){const t=e[qg];return t?t.type_:Array.isArray(e)?1:r_(e)?2:a_(e)?3:0}function n_(e,t){return 2===t_(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function i_(e,t,n){const i=t_(e);2===i?e.set(t,n):3===i?e.add(n):e[t]=n}function r_(e){return e instanceof Map}function a_(e){return e instanceof Set}function s_(e){return e.copy_||e.base_}function o_(e,t){if(r_(e))return new Map(e);if(a_(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=Jg(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[qg];let n=Reflect.ownKeys(t);for(let i=0;i<n.length;i++){const r=n[i],a=t[r];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[r]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[r]})}return Object.create($g(e),t)}{const t=$g(e);if(null!==t&&n)return{...e};const i=Object.create(t);return Object.assign(i,e)}}function l_(e,t=!1){return u_(e)||Kg(e)||!Zg(e)||(t_(e)>1&&(e.set=e.add=e.clear=e.delete=c_),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>l_(t,!0)))),e}function c_(){Yg(2)}function u_(e){return Object.isFrozen(e)}var h_,d_={};function p_(e){const t=d_[e];return t||Yg(0),t}function f_(){return h_}function m_(e,t){t&&(p_("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function g_(e){__(e),e.drafts_.forEach(y_),e.drafts_=null}function __(e){e===h_&&(h_=e.parent_)}function v_(e){return h_={drafts_:[],parent_:h_,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function y_(e){const t=e[qg];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function x_(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[qg].modified_&&(g_(t),Yg(4)),Zg(e)&&(e=w_(t,e),t.parent_||E_(t,e)),t.patches_&&p_("Patches").generateReplacementPatches_(n[qg].base_,e,t.patches_,t.inversePatches_)):e=w_(t,n,[]),g_(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Gg?e:void 0}function w_(e,t,n){if(u_(t))return t;const i=t[qg];if(!i)return e_(t,((r,a)=>b_(e,i,t,r,a,n))),t;if(i.scope_!==e)return t;if(!i.modified_)return E_(e,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const t=i.copy_;let r=t,a=!1;3===i.type_&&(r=new Set(t),t.clear(),a=!0),e_(r,((r,s)=>b_(e,i,t,r,s,n,a))),E_(e,t,!1),n&&e.patches_&&p_("Patches").generatePatches_(i,n,e.patches_,e.inversePatches_)}return i.copy_}function b_(e,t,n,i,r,a,s){if(Kg(r)){const s=w_(e,r,a&&t&&3!==t.type_&&!n_(t.assigned_,i)?a.concat(i):void 0);if(i_(n,i,s),!Kg(s))return;e.canAutoFreeze_=!1}else s&&n.add(r);if(Zg(r)&&!u_(r)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;w_(e,r),t&&t.scope_.parent_||"symbol"==typeof i||!Object.prototype.propertyIsEnumerable.call(n,i)||E_(e,r)}}function E_(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&l_(t,n)}var M_={get(e,t){if(t===qg)return e;const n=s_(e);if(!n_(n,t))return function(e,t,n){var i;const r=A_(t,n);return r?"value"in r?r.value:null==(i=r.get)?void 0:i.call(e.draft_):void 0}(e,n,t);const i=n[t];return e.finalized_||!Zg(i)?i:i===T_(e.base_,t)?(R_(e),e.copy_[t]=P_(i,e)):i},has:(e,t)=>t in s_(e),ownKeys:e=>Reflect.ownKeys(s_(e)),set(e,t,n){const i=A_(s_(e),t);if(null==i?void 0:i.set)return i.set.call(e.draft_,n),!0;if(!e.modified_){const i=T_(s_(e),t),s=null==i?void 0:i[qg];if(s&&s.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((r=n)===(a=i)?0!==r||1/r==1/a:r!=r&&a!=a)&&(void 0!==n||n_(e.base_,t)))return!0;R_(e),C_(e)}var r,a;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==T_(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,R_(e),C_(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=s_(e),i=Reflect.getOwnPropertyDescriptor(n,t);return i?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:i.enumerable,value:n[t]}:i},defineProperty(){Yg(11)},getPrototypeOf:e=>$g(e.base_),setPrototypeOf(){Yg(12)}},S_={};function T_(e,t){const n=e[qg];return(n?s_(n):e)[t]}function A_(e,t){if(!(t in e))return;let n=$g(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=$g(n)}}function C_(e){e.modified_||(e.modified_=!0,e.parent_&&C_(e.parent_))}function R_(e){e.copy_||(e.copy_=o_(e.base_,e.scope_.immer_.useStrictShallowCopy_))}e_(M_,((e,t)=>{S_[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),S_.deleteProperty=function(e,t){return S_.set.call(this,e,t,void 0)},S_.set=function(e,t,n){return M_.set.call(this,e[0],t,n,e[0])};function P_(e,t){const n=r_(e)?p_("MapSet").proxyMap_(e,t):a_(e)?p_("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),i={type_:n?1:0,scope_:t?t.scope_:f_(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=i,a=M_;n&&(r=[i],a=S_);const{revoke:s,proxy:o}=Proxy.revocable(r,a);return i.draft_=o,i.revoke_=s,o}(e,t);return(t?t.scope_:f_()).drafts_.push(n),n}function k_(e){if(!Zg(e)||u_(e))return e;const t=e[qg];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=o_(e,t.scope_.immer_.useStrictShallowCopy_)}else n=o_(e,!0);return e_(n,((e,t)=>{i_(n,e,k_(t))})),t&&(t.finalized_=!1),n}var O_=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const i=this;return function(e=n,...r){return i.produce(e,(e=>t.call(this,e,...r)))}}let i;if("function"!=typeof t&&Yg(6),void 0!==n&&"function"!=typeof n&&Yg(7),Zg(e)){const r=v_(this),a=P_(e,void 0);let s=!0;try{i=t(a),s=!1}finally{s?g_(r):__(r)}return m_(r,n),x_(i,r)}if(!e||"object"!=typeof e){if(i=t(e),void 0===i&&(i=e),i===Gg&&(i=void 0),this.autoFreeze_&&l_(i,!0),n){const t=[],r=[];p_("Patches").generateReplacementPatches_(e,i,t,r),n(t,r)}return i}Yg(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...n)=>this.produceWithPatches(t,(t=>e(t,...n)));let n,i;return[this.produce(e,t,((e,t)=>{n=e,i=t})),n,i]},"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof(null==e?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Zg(e)||Yg(8),Kg(e)&&(e=function(e){Kg(e)||Yg(10);return k_(e)}(e));const t=v_(this),n=P_(e,void 0);return n[qg].isManual_=!0,__(t),n}finishDraft(e,t){const n=e&&e[qg];n&&n.isManual_||Yg(9);const{scope_:i}=n;return m_(i,t),x_(void 0,i)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const i=t[n];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}n>-1&&(t=t.slice(n+1));const i=p_("Patches").applyPatches_;return Kg(e)?i(e,t):this.produce(e,(e=>i(e,t)))}},I_=O_.produce;function L_(e){return({dispatch:t,getState:n})=>i=>r=>"function"==typeof r?r(t,n,e):i(r)}O_.produceWithPatches.bind(O_),O_.setAutoFreeze.bind(O_),O_.setUseStrictShallowCopy.bind(O_),O_.applyPatches.bind(O_),O_.createDraft.bind(O_),O_.finishDraft.bind(O_);var D_=L_(),N_=L_,U_="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?jg:jg.apply(null,arguments)};function F_(e,t){function n(...t){return{type:e,payload:t[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>function(e){return Vg(e)&&"type"in e&&"string"==typeof e.type}(t)&&t.type===e,n}var z_=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function B_(e){return Zg(e)?I_(e,(()=>{})):e}var V_=e=>t=>{setTimeout(t,e)},H_="undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:V_(10),W_=e=>function(t){const{autoBatch:n=!0}=t??{};let i=new z_(e);return n&&i.push(((e={type:"raf"})=>t=>(...n)=>{const i=t(...n);let r=!0,a=!1,s=!1;const o=new Set,l="tick"===e.type?queueMicrotask:"raf"===e.type?H_:"callback"===e.type?e.queueNotification:V_(e.timeout),c=()=>{s=!1,a&&(a=!1,o.forEach((e=>e())))};return Object.assign({},i,{subscribe(e){const t=i.subscribe((()=>r&&e()));return o.add(e),()=>{t(),o.delete(e)}},dispatch(e){var t;try{return r=!(null==(t=null==e?void 0:e.meta)?void 0:t.RTK_autoBatch),a=!r,a&&(s||(s=!0,l(c))),i.dispatch(e)}finally{r=!0}}})})("object"==typeof n?n:void 0)),i};function j_(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}const G_=F_("CHANGE_TITLE"),X_=F_("CLICK_CONTAINER"),q_=F_("ENTER_ROOM"),Y_=F_("SLEEP"),$_=F_("END_SLEEP"),K_=F_("NEW_DAY"),Z_=F_("DISPLAY_ITEM"),Q_=F_("PICK_UP_ITEM"),J_=F_("TOGGLE_EQUIP_ITEM"),ev=F_("EQUIP_ITEMS"),tv=F_("CLICK_LAMP"),nv=F_("CLICK_LAMPPOST"),iv=F_("CLICK_TV"),rv=F_("READ_DIARY"),av=F_("START_CONVO"),sv=F_("END_CONVO"),ov=F_("PLAY_SOUND_EFFECT"),lv=F_("START_PARTY"),cv=F_("TOGGLE_BOINK_DREAM"),uv=F_("LAUNCH_HORNY_VORTEX_PHASE"),hv=F_("TURN_LIGHTS_RED"),dv=F_("WAKE_UP"),pv=function(e,t){let n,[i,r,a]=function(e){const t={},n=[];let i;const r={addCase(e,n){const i="string"==typeof e?e:e.type;if(!i)throw new Error(j_(28));if(i in t)throw new Error(j_(29));return t[i]=n,r},addMatcher:(e,t)=>(n.push({matcher:e,reducer:t}),r),addDefaultCase:e=>(i=e,r)};return e(r),[t,n,i]}(t);if("function"==typeof e)n=()=>B_(e());else{const t=B_(e);n=()=>t}function s(e=n(),t){let s=[i[t.type],...r.filter((({matcher:e})=>e(t))).map((({reducer:e})=>e))];return 0===s.filter((e=>!!e)).length&&(s=[a]),s.reduce(((e,n)=>{if(n){if(Kg(e)){const i=n(e,t);return void 0===i?e:i}if(Zg(e))return I_(e,(e=>n(e,t)));{const i=n(e,t);if(void 0===i){if(null===e)return e;throw new Error(j_(9))}return i}}return e}),e)}return s.getInitialState=n,s}({title:"living_room",header:"",dayIndex:0,room:"living_room",subRoom:"living_room1",roomToImgIndex:{living_room:0,nats_room:0,vics_room:0,outside:0,sunset:0},itemDisplayed:null,convoName:null,prevConvoName:null,inventory:[],equipped:[],isSleeping:!1,readingDiary:!1,isInsideBoinksDream:!1,partyTime:!1,tvPlaying:!1,lamppost:{lightbulbColor:"yellow",toggled:!1},hornyVortexPhase:null},(e=>{e.addCase(G_,((e,t)=>{e.title=t.payload})).addCase(X_,(e=>{e.itemDisplayed=null,e.header="",e.readingDiary=!1})).addCase(q_,((e,t)=>{e.room=t.payload.room,e.subRoom=t.payload.subRoom,e.title=t.payload.room,e.header="",e.prevConvoName=null,e.convoName=null,e.readingDiary=!1})).addCase(Y_,(e=>{e.isSleeping=!0})).addCase($_,(e=>{e.isSleeping=!1})).addCase(K_,(e=>{fv(e)})).addCase(dv,(e=>{e.isSleeping=!1,fv(e)})).addCase(tv,(e=>{mv(e)&&gv(e)})).addCase(nv,(e=>{_v(e)})).addCase(iv,(e=>{e.tvPlaying=!e.tvPlaying})).addCase(rv,((e,t)=>{if(!0===t.payload){const t=e.room.includes("vic")?"Vic":"Nat";e.header=`Reading ${t}'s Diary`}else e.header="";e.readingDiary=t.payload})).addCase(Z_,((e,t)=>{e.header=`clicked on: ${t.payload.name}`,e.itemDisplayed=t.payload})).addCase(Q_,((e,t)=>{vv(e.inventory,t.payload),e.header=`picked up: ${t.payload}`,e.itemDisplayed=null})).addCase(J_,((e,t)=>{const n=!e.equipped.includes(t.payload);n?(Qi(t.payload)&&(e.equipped=e.equipped.filter((e=>!Qi(e)))),e.equipped=e.equipped.concat(t.payload)):e.equipped=e.equipped.filter((e=>e!==t.payload)),e.header=n?`equipped: ${t.payload}`:""})).addCase(ev,((e,t)=>{e.equipped=[...t.payload]})).addCase(av,((e,t)=>{e.prevConvoName=e.convoName,e.convoName=t.payload})).addCase(sv,(e=>{e.prevConvoName=null,e.convoName=null})).addCase(lv,(e=>{e.partyTime=!0;for(const t in e.roomToImgIndex)e.roomToImgIndex[t]=er(t).subRooms[0].img.length-1})).addCase(cv,(e=>{e.isInsideBoinksDream=!e.isInsideBoinksDream,e.title=e.isInsideBoinksDream?"boink_dream":e.room})).addCase(uv,((e,t)=>{e.hornyVortexPhase=t.payload,"souls_imbued"===e.hornyVortexPhase&&(vv(e.inventory,"key1"),e.header="picked_up__key1",yv("living_room","living_room3","vics_room1","key2"))})).addCase(hv,(e=>{for(const t in e.roomToImgIndex)e.roomToImgIndex[t]=er(t).subRooms[0].img.length-2;e.lamppost.lightbulbColor="red",e.lamppost.toggled=!0}))})),fv=e=>{1===e.dayIndex?e.dayIndex=3:++e.dayIndex,e.partyTime=!1;for(const t in e.roomToImgIndex)e.roomToImgIndex[t]=0;if(3===e.dayIndex){const t=tr("sunset","sunset1").adjacentRooms[1].entry.dimensions;t.width=80,t.height=150,e.roomToImgIndex.vics_room=tr("vics_room","vics_room1").img.length-3,xv("living_room","living_room3","vics_room1","#c51551"),yv("sunset","sunset1","oracle","key1")}},mv=e=>!e.partyTime&&("outside1"!==e.subRoom||"red"!==e.lamppost.lightbulbColor||!0!==e.lamppost.toggled),gv=e=>{const t=tr(e.room,e.subRoom);if(e.equipped.includes("red_lightbulb")){const n=t.img.length-2;return e.roomToImgIndex[e.room]=n,void(e.equipped=e.equipped.filter((e=>"red_lightbulb"!==e)))}const n="outside1"===e.subRoom?2:1,i=t.img.length-1-n;e.roomToImgIndex[e.room]===i?e.roomToImgIndex[e.room]=0:++e.roomToImgIndex[e.room]},_v=e=>{e.equipped.includes("red_lightbulb")?(e.lamppost.lightbulbColor="red",e.equipped=e.equipped.filter((e=>"red_lightbulb"!==e))):e.lamppost.toggled=!e.lamppost.toggled,"red"===e.lamppost.lightbulbColor&&(e.roomToImgIndex.outside=e.lamppost.toggled?7:0,e.roomToImgIndex.sunset=e.lamppost.toggled?1:0)},vv=(e,t)=>{if(e.includes(t))return;void 0!==Ki.find((e=>e.name===t))&&e.push(t)},yv=(e,t,n,i)=>{const r=tr(e,t).adjacentRooms;for(const a of r)if("door"===a.entry.type&&n===a.subRoom)return a.entry.key=i,void(a.entry.locked=!0)},xv=(e,t,n,i)=>{const r=tr(e,t).adjacentRooms;for(const a of r)if("door"===a.entry.type&&n===a.subRoom)return void(a.entry.roomColor=i)};var wv={exports:{}};!function(e){function t(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function n(e,t){Object.defineProperty(this,"kind",{value:e,enumerable:!0}),t&&t.length&&Object.defineProperty(this,"path",{value:t,enumerable:!0})}function i(e,t,n){i.super_.call(this,"E",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function r(e,t){r.super_.call(this,"N",e),Object.defineProperty(this,"rhs",{value:t,enumerable:!0})}function a(e,t){a.super_.call(this,"D",e),Object.defineProperty(this,"lhs",{value:t,enumerable:!0})}function s(e,t,n){s.super_.call(this,"A",e),Object.defineProperty(this,"index",{value:t,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function o(e,t,n){var i=e.slice(t+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,i),e}function l(e){var t=void 0===e?"undefined":R(e);return"object"!==t?t:e===Math?"math":null===e?"null":Array.isArray(e)?"array":"[object Date]"===Object.prototype.toString.call(e)?"date":"function"==typeof e.toString&&/^\/.*\//.test(e.toString())?"regexp":"object"}function c(e,t,n,u,h,d,p){p=p||[];var f=(h=h||[]).slice(0);if(void 0!==d){if(u){if("function"==typeof u&&u(f,d))return;if("object"===(void 0===u?"undefined":R(u))){if(u.prefilter&&u.prefilter(f,d))return;if(u.normalize){var m=u.normalize(f,d,e,t);m&&(e=m[0],t=m[1])}}}f.push(d)}"regexp"===l(e)&&"regexp"===l(t)&&(e=e.toString(),t=t.toString());var g=void 0===e?"undefined":R(e),_=void 0===t?"undefined":R(t),v="undefined"!==g||p&&p[p.length-1].lhs&&p[p.length-1].lhs.hasOwnProperty(d),y="undefined"!==_||p&&p[p.length-1].rhs&&p[p.length-1].rhs.hasOwnProperty(d);if(!v&&y)n(new r(f,t));else if(!y&&v)n(new a(f,e));else if(l(e)!==l(t))n(new i(f,e,t));else if("date"===l(e)&&e-t!=0)n(new i(f,e,t));else if("object"===g&&null!==e&&null!==t)if(p.filter((function(t){return t.lhs===e})).length)e!==t&&n(new i(f,e,t));else{if(p.push({lhs:e,rhs:t}),Array.isArray(e)){var x;for(e.length,x=0;x<e.length;x++)x>=t.length?n(new s(f,x,new a(void 0,e[x]))):c(e[x],t[x],n,u,f,x,p);for(;x<t.length;)n(new s(f,x,new r(void 0,t[x++])))}else{var w=Object.keys(e),b=Object.keys(t);w.forEach((function(i,r){var a=b.indexOf(i);a>=0?(c(e[i],t[i],n,u,f,i,p),b=o(b,a)):c(e[i],void 0,n,u,f,i,p)})),b.forEach((function(e){c(void 0,t[e],n,u,f,e,p)}))}p.length=p.length-1}else e!==t&&("number"===g&&isNaN(e)&&isNaN(t)||n(new i(f,e,t)))}function u(e,t,n,i){return i=i||[],c(e,t,(function(e){e&&i.push(e)}),n),i.length?i:void 0}function h(e,t,n){if(n.path&&n.path.length){var i,r=e[t],a=n.path.length-1;for(i=0;i<a;i++)r=r[n.path[i]];switch(n.kind){case"A":h(r[n.path[i]],n.index,n.item);break;case"D":delete r[n.path[i]];break;case"E":case"N":r[n.path[i]]=n.rhs}}else switch(n.kind){case"A":h(e[t],n.index,n.item);break;case"D":e=o(e,t);break;case"E":case"N":e[t]=n.rhs}return e}function d(e,t,n){if(e&&t&&n&&n.kind){for(var i=e,r=-1,a=n.path?n.path.length-1:0;++r<a;)void 0===i[n.path[r]]&&(i[n.path[r]]="number"==typeof n.path[r]?[]:{}),i=i[n.path[r]];switch(n.kind){case"A":h(n.path?i[n.path[r]]:i,n.index,n.item);break;case"D":delete i[n.path[r]];break;case"E":case"N":i[n.path[r]]=n.rhs}}}function p(e,t,n){if(n.path&&n.path.length){var i,r=e[t],a=n.path.length-1;for(i=0;i<a;i++)r=r[n.path[i]];switch(n.kind){case"A":p(r[n.path[i]],n.index,n.item);break;case"D":case"E":r[n.path[i]]=n.lhs;break;case"N":delete r[n.path[i]]}}else switch(n.kind){case"A":p(e[t],n.index,n.item);break;case"D":case"E":e[t]=n.lhs;break;case"N":e=o(e,t)}return e}function f(e,t,n){if(e&&t&&n&&n.kind){var i,r,a=e;for(r=n.path.length-1,i=0;i<r;i++)void 0===a[n.path[i]]&&(a[n.path[i]]={}),a=a[n.path[i]];switch(n.kind){case"A":p(a[n.path[i]],n.index,n.item);break;case"D":case"E":a[n.path[i]]=n.lhs;break;case"N":delete a[n.path[i]]}}}function m(e,t,n){e&&t&&c(e,t,(function(i){n&&!n(e,t,i)||d(e,t,i)}))}function g(e){return"color: "+O[e].color+"; font-weight: bold"}function _(e){var t=e.kind,n=e.path,i=e.lhs,r=e.rhs,a=e.index,s=e.item;switch(t){case"E":return[n.join("."),i,"→",r];case"N":return[n.join("."),r];case"D":return[n.join(".")];case"A":return[n.join(".")+"["+a+"]",s];default:return[]}}function v(e,t,n,i){var r=u(e,t);try{i?n.groupCollapsed("diff"):n.group("diff")}catch(a){n.log("diff")}r?r.forEach((function(e){var t=e.kind,i=_(e);n.log.apply(n,["%c "+O[t].text,g(t)].concat(P(i)))})):n.log("—— no diff ——");try{n.groupEnd()}catch(a){n.log("—— diff end —— ")}}function y(e,t,n,i){switch(void 0===e?"undefined":R(e)){case"object":return"function"==typeof e[i]?e[i].apply(e,P(n)):e[i];case"function":return e(t);default:return e}}function x(e){var t=e.timestamp,n=e.duration;return function(e,i,r){var a=["action"];return a.push("%c"+String(e.type)),t&&a.push("%c@ "+i),n&&a.push("%c(in "+r.toFixed(2)+" ms)"),a.join(" ")}}function w(e,t){var n=t.logger,i=t.actionTransformer,r=t.titleFormatter,a=void 0===r?x(t):r,s=t.collapsed,o=t.colors,l=t.level,c=t.diff,u=void 0===t.titleFormatter;e.forEach((function(r,h){var d=r.started,p=r.startedTime,f=r.action,m=r.prevState,g=r.error,_=r.took,x=r.nextState,w=e[h+1];w&&(x=w.prevState,_=w.started-d);var b=i(f),E="function"==typeof s?s((function(){return x}),f,r):s,M=A(p),S=o.title?"color: "+o.title(b)+";":"",T=["color: gray; font-weight: lighter;"];T.push(S),t.timestamp&&T.push("color: gray; font-weight: lighter;"),t.duration&&T.push("color: gray; font-weight: lighter;");var C=a(b,M,_);try{E?o.title&&u?n.groupCollapsed.apply(n,["%c "+C].concat(T)):n.groupCollapsed(C):o.title&&u?n.group.apply(n,["%c "+C].concat(T)):n.group(C)}catch(U){n.log(C)}var R=y(l,b,[m],"prevState"),P=y(l,b,[b],"action"),k=y(l,b,[g,m],"error"),O=y(l,b,[x],"nextState");if(R)if(o.prevState){var I="color: "+o.prevState(m)+"; font-weight: bold";n[R]("%c prev state",I,m)}else n[R]("prev state",m);if(P)if(o.action){var L="color: "+o.action(b)+"; font-weight: bold";n[P]("%c action    ",L,b)}else n[P]("action    ",b);if(g&&k)if(o.error){var D="color: "+o.error(g,m)+"; font-weight: bold;";n[k]("%c error     ",D,g)}else n[k]("error     ",g);if(O)if(o.nextState){var N="color: "+o.nextState(x)+"; font-weight: bold";n[O]("%c next state",N,x)}else n[O]("next state",x);c&&v(m,x,n,E);try{n.groupEnd()}catch(U){n.log("—— log end ——")}}))}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},I,e),n=t.logger,i=t.stateTransformer,r=t.errorTransformer,a=t.predicate,s=t.logErrors,o=t.diffPredicate;if(void 0===n)return function(){return function(e){return function(t){return e(t)}}};if(e.getState&&e.dispatch)return function(){return function(e){return function(t){return e(t)}}};var l=[];return function(e){var n=e.getState;return function(e){return function(c){if("function"==typeof a&&!a(n,c))return e(c);var u={};l.push(u),u.started=C.now(),u.startedTime=new Date,u.prevState=i(n()),u.action=c;var h=void 0;if(s)try{h=e(c)}catch(p){u.error=r(p)}else h=e(c);u.took=C.now()-u.started,u.nextState=i(n());var d=t.diff&&"function"==typeof o?o(n,c):t.diff;if(w(l,Object.assign({},t,{diff:d})),l.length=0,u.error)throw u.error;return h}}}}var E,M,S=function(e,t){return new Array(t+1).join(e)},T=function(e,t){return S("0",t-e.toString().length)+e},A=function(e){return T(e.getHours(),2)+":"+T(e.getMinutes(),2)+":"+T(e.getSeconds(),2)+"."+T(e.getMilliseconds(),3)},C="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance:Date,R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},k=[];E="object"===(void 0===nr?"undefined":R(nr))&&nr?nr:"undefined"!=typeof window?window:{},(M=E.DeepDiff)&&k.push((function(){void 0!==M&&E.DeepDiff===u&&(E.DeepDiff=M,M=void 0)})),t(i,n),t(r,n),t(a,n),t(s,n),Object.defineProperties(u,{diff:{value:u,enumerable:!0},observableDiff:{value:c,enumerable:!0},applyDiff:{value:m,enumerable:!0},applyChange:{value:d,enumerable:!0},revertChange:{value:f,enumerable:!0},isConflict:{value:function(){return void 0!==M},enumerable:!0},noConflict:{value:function(){return k&&(k.forEach((function(e){e()})),k=null),u},enumerable:!0}});var O={E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}},I={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(e){return e},actionTransformer:function(e){return e},errorTransformer:function(e){return e},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dispatch,n=e.getState;return"function"==typeof t||"function"==typeof n?b()({dispatch:t,getState:n}):void 0};e.defaults=I,e.createLogger=b,e.logger=L,e.default=L,Object.defineProperty(e,"__esModule",{value:!0})}(wv.exports);const bv="/audio/そこなしやみ暗闇の世界.mp3",Ev="/audio/dancing_ghosts.mp3",Mv="/audio/teenage_lightning.mp3",Sv="/audio/mario_golf.mp3",Tv="/audio/flower_of_carnage.mp3",Av="/audio/sidequest.mp3",Cv="/audio/map_jazz.mp3",Rv="/audio/mexico.mp3",Pv="/audio/seinfeld.mp3",kv="/audio/calling_from_the_stars.mp3",Ov="/audio/man_crying_dog_barking_in_distance.mp3",Iv="/audio/light_switch.wav",Lv="/audio/bird_tweet.mp3",Dv="/audio/bird_tweet2.mp3",Nv="/audio/creepy_laugh.mp3",Uv="/audio/cat_purr.mp3",Fv={DARK_WORLD:bv,DANCING_GHOSTS:Ev,TEENAGE_LIGHTNING:Mv,MARVELOUS:"/audio/marvelous.wav",WHIMPERING_AND_DOG_BARKING:Ov,MAP_JAZZ:Cv,MEXICO:Rv,SEINFELD:Pv,MARIO_GOLF:Sv,FLOWER_OF_CARNAGE:Tv,LIGHT_SWITCH:Iv,BIRD_TWEET1:Lv,BIRD_TWEET2:Dv,CREEPY_LAUGH:Nv,UNLOCK_DOOR:"/audio/unlock_door.mp3",BINKY_PURR:Uv,CALLING_FROM_THE_STARS:kv,MEDIEVAL_UMPH:Av},zv={};for(const FS of Object.values(Fv))zv[FS]=fetch(FS).then((e=>e.arrayBuffer()));let Bv;class Vv{constructor(){this.audioContext=new AudioContext,this.bufferPromises={},this.musicStartTime=0,this.currentThemeBufferSourceNode=null;for(const[e,t]of Object.entries(zv))this.bufferPromises[e]=t.then((e=>this.audioContext.decodeAudioData(e.slice(0))));this.globalGainNode=this.audioContext.createGain(),this.globalGainNode.gain.value=1,this.globalGainNode.connect(this.audioContext.destination),this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode.type="lowpass",this.filterNode.Q.value=3,this.filterNode.frequency.value=2e4,this.musicGainNode=this.audioContext.createGain(),this.musicGainNode.gain.value=1,this.filterNode.connect(this.musicGainNode),this.musicGainNode.connect(this.globalGainNode),this.musicDestination=this.filterNode,this.sfxGainNode=this.audioContext.createGain(),this.sfxGainNode.gain.value=1,this.sfxGainNode.connect(this.globalGainNode),this.sfxDestination=this.sfxGainNode}setFilterCutoffForMusic(e,t){this.filterNode.frequency.linearRampToValueAtTime(e,t)}setGainForMusic(e){this.musicGainNode.gain.linearRampToValueAtTime(e,this.audioContext.currentTime+1)}setGainForSfx(e){this.sfxGainNode.gain.linearRampToValueAtTime(e,this.audioContext.currentTime+1)}setGainForGlobalAudio(e,t=1){this.globalGainNode.gain.linearRampToValueAtTime(e,this.audioContext.currentTime+t)}getTargetMeasureTimeForNextSection(){const e=this.audioContext.currentTime-this.musicStartTime,t=e-e%2,n=e>t+2-1;return this.musicStartTime+t+2*(n?2:1)}async getBufferForSrc(e){if(!(e in this.bufferPromises))throw new Error(`Unknown src: ${e}`);const t=await this.bufferPromises[e];if(!t)throw new Error(`Unexpected undefined buffer for src: ${e}`);return t}async queueSoundEffect(e,t=this.audioContext.currentTime,n=this.sfxDestination){const i=await this.getBufferForSrc(e),r=this.audioContext.createBufferSource();r.buffer=i,r.connect(n),r.start(t)}async queueSoundEffectLoop(e,t=this.audioContext.currentTime,n=this.sfxDestination){const i=await this.getBufferForSrc(e);let r=this.audioContext.createBufferSource();return r.buffer=i,r.loop=!0,r.connect(n),r.start(t),()=>{r.stop()}}async queueSceneTransitionSoundEffect(e,t=this.getTargetMeasureTimeForNextSection()){return this.queueSoundEffect(e,t-1,this.musicDestination)}async queueTheme(e,t=0){const n=await this.getBufferForSrc(e),i=this.audioContext.createBufferSource();let r;return i.buffer=n,i.loop=!0,i.connect(this.musicDestination),this.currentThemeBufferSourceNode?(r=this.getTargetMeasureTimeForNextSection(),i.start(r,t),this.currentThemeBufferSourceNode.stop(r)):(r=this.audioContext.currentTime,i.start(r,t),this.musicStartTime=r),this.currentThemeBufferSourceNode=i,r}stopTheme(){this.currentThemeBufferSourceNode&&(this.currentThemeBufferSourceNode.stop(),this.currentThemeBufferSourceNode.disconnect(),this.currentThemeBufferSourceNode=null)}destroy(){this.stopTheme(),this.audioContext.close()}}async function Hv(e,t=!1){if(Bv)return t?Bv.queueSoundEffectLoop(e):Bv.queueSoundEffect(e)}const Wv=e=>e=>async t=>{const n=e(t);if("PLAY_SOUND_EFFECT"===t.type){const e=!1;await Hv(Fv[t.payload],e)}return"CLICK_LAMP"!==t.type&&"CLICK_LAMPPOST"!==t.type&&"CLICK_TV"!==t.type||await Hv(Iv),"NEW_DAY"===t.type&&(await Hv(Lv),await Hv(Dv)),"TOGGLE_BOINK_DREAM"===t.type&&(await Hv(Uv),await Hv(Uv)),"LAUNCH_HORNY_VORTEX_PHASE"===t.type&&"world_bathed_in_red"===t.payload&&await Hv(Nv),n},jv=function(e){const t=function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:i=!0,actionCreatorCheck:r=!0}=e??{};let a=new z_;return t&&("boolean"==typeof t?a.push(D_):a.push(N_(t.extraArgument))),a},{reducer:n,middleware:i,devTools:r=!0,preloadedState:a,enhancers:s}=e||{};let o,l;if("function"==typeof n)o=n;else{if(!Vg(n))throw new Error(j_(1));o=Wg(n)}l="function"==typeof i?i(t):t();let c=jg;r&&(c=U_({trace:!1,..."object"==typeof r&&r}));const u=function(...e){return t=>(n,i)=>{const r=t(n,i);let a=()=>{throw new Error(Ug(15))};const s={getState:r.getState,dispatch:(e,...t)=>a(e,...t)},o=e.map((e=>e(s)));return a=jg(...o)(r.dispatch),{...r,dispatch:a}}}(...l),h=W_(u);return Hg(o,a,c(..."function"==typeof s?s(h):h()))}({reducer:pv,middleware:e=>e().concat(Wv)}),Gv=[{living_room1:bv,living_room2:bv,living_room3:bv,nats_room1:bv,vics_room1:Rv,outside1:Sv,sunset1:Tv,oracle:Mv},{living_room1:bv,living_room2:bv,living_room3:bv,nats_room1:bv,vics_room1:Pv,outside1:Sv,sunset1:Tv,oracle:Mv},{living_room1:bv,living_room2:bv,living_room3:bv,nats_room1:bv,vics_room1:Pv,outside1:Sv,sunset1:Tv,oracle:Mv},{living_room1:Ev,living_room2:Ev,living_room3:Ev,nats_room1:Ev,vics_room1:Ev,outside1:Ev,sunset1:Ev,oracle:Mv}];let Xv="";function qv({musicToPlay:e=null,volume:t=1}){const n=Tg((e=>e.dayIndex)),i=Tg((e=>e.subRoom));return Hr.useEffect((()=>()=>{}),[]),Hr.useEffect((()=>{if(null!==e)return e!==Xv&&Yv(e,t),()=>{}}),[e]),Hr.useEffect((()=>{if(null!==e)return;const t=Gv[n][i];t!==Xv&&(Yv(t,0),function(e,t=1){Bv&&Bv.setGainForGlobalAudio(e,t)}(t===Ev?.2:1,10))}),[n,i,e]),Qr.jsx("div",{})}function Yv(e,t=1){Bv&&Bv.stopTheme(),async function(e,t=1){Bv=Bv||new Vv,Bv.globalGainNode.gain.value=t,await Bv.queueTheme(e),Bv.globalGainNode.gain.value=t}(e,t),Xv=e}function $v({thought:e}){return Qr.jsxs("div",{className:"deep-thought",children:[Qr.jsx("div",{className:"deep-thought-background"}),Qr.jsx("p",{className:"deep-thought-text",children:e})]})}function Kv({thought:e,style:t,animate:n=!0}){const i=n?{animation:`typing ${.03*e.length}s steps(50, end)`}:{};return Qr.jsx("div",{className:"passing-thought",style:t,children:Qr.jsx("p",{className:"passing-thought-text",style:i,children:e})},e)}function Zv({door:e,onEnter:t,left:n,top:i}){const r=Ng(),a=Tg((e=>e.equipped)).find((e=>Qi(e))),[s,o]=Hr.useState(0),[l,c]=Hr.useState("/img/rooms/doors/door_closed.webp"),[u,h]=Hr.useState(null);Hr.useEffect((()=>{1===s?c("/img/rooms/doors/door_semiopen.webp"):2===s?c("/img/rooms/doors/door_open.webp"):3===s&&t()}),[s,t]);const d=0===s?{filter:`drop-shadow(16px 16px 20px ${e.roomColor})`}:{},p=a?{}:2===s?{cursor:"n-resize"}:{cursor:"zoom-in"};return Qr.jsxs("div",{className:"door",style:{left:n,top:i,...e.dimensions,backgroundColor:e.roomColor,...d,...p},onClick:t=>{t.stopPropagation(),e.locked?void 0!==a?(r(ov("UNLOCK_DOOR")),a===e.key?(r(J_(e.key)),o(1),e.locked=!1):(h(`Failed to unlock door with ${a}`),setTimeout((()=>h(null)),4e3))):(h("The door is locked"),setTimeout((()=>h(null)),4e3)):o(s+1)},children:[Qr.jsx("img",{src:l}),null!==u&&Qr.jsx(Kv,{thought:u,style:{position:"absolute",bottom:0,left:0},animate:!0})]})}const Qv={roomColor:"red",dimensions:{width:211,height:373}},Jv=325,ey=50,ty=70,ny=35,iy=160,ry=231;function ay({startGame:e}){const[t,n]=Hr.useState(!1);return t?function(e){return Qr.jsxs("div",{className:"prologue",children:[Qr.jsx(qv,{musicToPlay:Av,volume:.1}),Qr.jsxs("div",{className:"prologue-container",children:[Qr.jsx("h2",{className:"prologue-title",children:"Prologue"}),Qr.jsxs("p",{className:"prologue-text",children:[Qr.jsx("dfn",{title:"noun: (obsolete) a person with half their wits",children:"Half-wit"}),","," ",Qr.jsx("dfn",{title:"noun: (obsolete) a person with all their wits",children:"full-wit"}),","," ",Qr.jsx("dfn",{title:"noun: (obsolete) a person with no wit",children:"nit-wit"})," ","is nowise different,",Qr.jsx("br",{})," In a land of"," ",Qr.jsx("dfn",{title:"noun: (obsolete) a foolish or silly person",children:"fops"})," ","whomst can tell no difference,",Qr.jsx("br",{}),"Twixt tic tac nor"," ",Qr.jsx("dfn",{title:"noun: a dog treat (knick knack paddywhack give a dog a bone); a beating or spanking",children:"paddywhack"})," ","nor the devil’s"," ",Qr.jsx("dfn",{title:"noun: a preparation of powdered tobacco to be inhaled through the nostrils, chewed, or placed against the gums",children:"snuff"}),",",Qr.jsx("br",{})," Fops like these are pleased to be picked by the"," ",Qr.jsx("dfn",{title:"noun: the back of the neck",children:"scruff"}),",",Qr.jsx("br",{}),Qr.jsx("br",{})," Biddest them hello, sayest “",Qr.jsx("dfn",{title:"idiom: (archaic) How are things going (since the last time I asked you)?",children:"How now"}),", fop?”",Qr.jsx("br",{})," For a stranger poseth no danger when met in a laptop,",Qr.jsx("br",{})," How now,"," ",Qr.jsx("dfn",{title:"noun: a popular cultivated violet with flowers in rich colors, with both summer- and winter-flowering varieties",children:"pansey"}),", how now,"," ",Qr.jsx("dfn",{title:"noun: a showy Japanese lily that is often cultivated for its delicately spotted white flowers",children:"toadlily"}),",",Qr.jsx("br",{})," Which one of thee be an indelicate surprise,"," ",Qr.jsx("dfn",{title:"interjection: (archaic) please; used to express a wish or request",children:"prithee"}),"?",Qr.jsx("br",{}),Qr.jsx("br",{})," Now!"," ",Qr.jsx("dfn",{title:"idiom: (archaic) what are you doing?; where are you going?",children:"Where fare ye"}),", ye blinking idiot! Go on then,",Qr.jsx("br",{})," Presseth"," ",Qr.jsx("span",{className:"prologue-play",onClick:e,children:"play"}),", ye donkey in a pigpen!"]})]})]})}(e):Qr.jsxs("div",{className:"start-screen-container",children:[Qr.jsx("img",{alt:"title",src:"/img/start-screen/box_of_the_night_title.webp",style:{position:"absolute",width:Jv,height:ey,top:10,left:10}}),Qr.jsxs("div",{className:"front-door-container",style:{position:"relative",left:`calc(50% - ${Qv.dimensions.width/2}px)`,top:`calc(50% - ${Qv.dimensions.height/2}px)`,width:`${Qv.dimensions.width}px`,height:`${Qv.dimensions.height}px`},children:[Qr.jsx("img",{alt:"address number",src:"/img/start-screen/7269.webp",style:{position:"absolute",width:ty,height:ny,top:`-${1.5*ny}px`,right:0,pointerEvents:"none"}}),Qr.jsx(Zv,{door:Qv,onEnter:()=>n(!0),left:0,top:0}),Qr.jsx("img",{alt:"jigsaw",src:"/img/people/jigsaw/cute_jigsaw.webp",style:{position:"absolute",width:iy,height:ry,bottom:`-${ry/3}px`,left:`-${iy/3}px`,pointerEvents:"none"}})]})]})}var sy,oy,ly=Object.create,cy=Object.defineProperty,uy=Object.getOwnPropertyDescriptor,hy=Object.getOwnPropertyNames,dy=Object.getPrototypeOf,py=Object.prototype.hasOwnProperty,fy=(e,t)=>{for(var n in t)cy(e,n,{get:t[n],enumerable:!0})},my=(sy=(e,t)=>{var n,i;n=e,i=function(){function e(e){e=e||{},this.canvasElement=e.canvas||document.createElement("canvas"),this.contextOptions=e.contextOptions,this.type=e.type||"yuv420",this.customYUV444=e.customYUV444,this.conversionType=e.conversionType||"rec601",this.width=e.width||640,this.height=e.height||320,this.animationTime=e.animationTime||0,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.fakeAlphaEnabled=!0===e.fakeAlphaEnabled?1:0,this.initContextGL(),this.contextGL&&(this.initProgram(),this.initBuffers(),this.initTextures()),"yuv420"===this.type?this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,n=this.texturePosBuffer,i=this.uTexturePosBuffer,r=this.vTexturePosBuffer,a=this.yTextureRef,s=this.uTextureRef,o=this.vTextureRef,l=e.yData,c=e.uData,u=e.vData,h=this.width,d=this.height,p=e.yDataPerRow||h,f=e.yRowCnt||d,m=e.uDataPerRow||h/2,g=e.uRowCnt||d/2,_=e.vDataPerRow||m,v=e.vRowCnt||g;t.viewport(0,0,this.viewportWidth||h,this.viewportHeight||d);var y=d/f,x=h/p,w=new Float32Array([x,0,0,0,x,y,0,y]);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,w,t.DYNAMIC_DRAW),this.customYUV444?(y=d/g,x=h/m):(y=d/2/g,x=h/2/m);var b=new Float32Array([x,0,0,0,x,y,0,y]);t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,b,t.DYNAMIC_DRAW),this.customYUV444?(y=d/v,x=h/_):(y=d/2/v,x=h/2/_);var E=new Float32Array([x,0,0,0,x,y,0,y]);t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,E,t.DYNAMIC_DRAW),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,p,f,0,t.LUMINANCE,t.UNSIGNED_BYTE,l),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,m,g,0,t.LUMINANCE,t.UNSIGNED_BYTE,c),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,_,v,0,t.LUMINANCE,t.UNSIGNED_BYTE,u),t.drawArrays(t.TRIANGLE_STRIP,0,4)}:"yuv422"===this.type&&(this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,n=this.texturePosBuffer,i=this.textureRef,r=e.data,a=this.width,s=this.height,o=e.dataPerRow||2*a,l=e.rowCnt||s;t.viewport(0,0,a,s);var c=s/l,u=a/(o/2),h=new Float32Array([u,0,0,0,u,c,0,c]);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,h,t.DYNAMIC_DRAW),t.uniform2f(t.getUniformLocation(this.shaderProgram,"resolution"),o,s),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,o,l,0,t.LUMINANCE,t.UNSIGNED_BYTE,r),t.drawArrays(t.TRIANGLE_STRIP,0,4)})}return e.prototype.isWebGL=function(){return this.contextGL},e.prototype.initContextGL=function(){for(var e=this.canvasElement,t=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!t&&i<n.length;){var r=n[i];try{t=this.contextOptions?e.getContext(r,this.contextOptions):e.getContext(r)}catch{t=null}(!t||"function"!=typeof t.getParameter)&&(t=null),++i}this.contextGL=t},e.prototype.initProgram=function(){var e,t,n=this.contextGL;"yuv420"===this.type?(e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),t=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","uniform int fakeAlphaEnabled;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","  if(fakeAlphaEnabled == 1) {","     highp float maxIntensity = max(max(gl_FragColor.r, gl_FragColor.g), gl_FragColor.b);","     if(maxIntensity < 0.1) gl_FragColor.a = maxIntensity;","  }","}"].join("\n")):"yuv422"===this.type&&(e=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","}"].join("\n"),t=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform highp vec2 resolution;","uniform mat4 YUV2RGB;","uniform int fakeAlphaEnabled;","void main(void) {","  highp float texPixX = 1.0 / resolution.x;","  highp float logPixX = 2.0 / resolution.x;","  highp float logHalfPixX = 4.0 / resolution.x;","  highp float steps = floor(textureCoord.x / logPixX);","  highp float uvSteps = floor(textureCoord.x / logHalfPixX);","  highp float y = texture2D(sampler, vec2((logPixX * steps) + texPixX, textureCoord.y)).r;","  highp float u = texture2D(sampler, vec2((logHalfPixX * uvSteps), textureCoord.y)).r;","  highp float v = texture2D(sampler, vec2((logHalfPixX * uvSteps) + texPixX + texPixX, textureCoord.y)).r;","  gl_FragColor = vec4(y, u, v, 1.0) * YUV2RGB;","  if(fakeAlphaEnabled == 1) {","     highp float maxIntensity = max(max(gl_FragColor.r, gl_FragColor.g), gl_FragColor.b);","     if(maxIntensity < 0.1) gl_FragColor.a = maxIntensity;","  }","}"].join("\n"));var i=[];i="rec709"==this.conversionType?[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1]:[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];var r=n.createShader(n.VERTEX_SHADER);n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS);var a=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(a,t),n.compileShader(a),n.getShaderParameter(a,n.COMPILE_STATUS);var s=n.createProgram();n.attachShader(s,r),n.attachShader(s,a),n.linkProgram(s),n.getProgramParameter(s,n.LINK_STATUS),n.useProgram(s);var o=n.getUniformLocation(s,"YUV2RGB");n.uniformMatrix4fv(o,!1,i);var l=n.getUniformLocation(s,"fakeAlphaEnabled");n.uniform1i(l,this.fakeAlphaEnabled),this.shaderProgram=s},e.prototype.initBuffers=function(){var e=this.contextGL,t=this.shaderProgram,n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var i=e.getAttribLocation(t,"vertexPos");if(e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),this.animationTime){var r=this.animationTime,a=0,s=function(){var n=1*(a+=15)/r;a>=r?n=1:setTimeout(s,15);var i=-1*n,o=1*n,l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array([o,o,i,o,o,i,i,i]),e.STATIC_DRAW);var c=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0);try{e.drawArrays(e.TRIANGLE_STRIP,0,4)}catch{}};s()}var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var l=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0),this.texturePosBuffer=o,"yuv420"===this.type){var c=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var u=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=c;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var d=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(d),e.vertexAttribPointer(d,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=h}},e.prototype.initTextures=function(){var e=this.contextGL,t=this.shaderProgram;if("yuv420"===this.type){var n=this.initTexture(),i=e.getUniformLocation(t,"ySampler");e.uniform1i(i,0),this.yTextureRef=n;var r=this.initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=r;var s=this.initTexture(),o=e.getUniformLocation(t,"vSampler");e.uniform1i(o,2),this.vTextureRef=s}else if("yuv422"===this.type){var l=this.initTexture(),c=e.getUniformLocation(t,"sampler");e.uniform1i(c,0),this.textureRef=l}},e.prototype.initTexture=function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t},e.prototype.drawNextOutputPicture=function(e,t,n,i){this.contextGL?this.drawNextOuptutPictureGL(e,t,n,i):this.drawNextOuptutPictureRGBA(e,t,n,i)},e.prototype.drawNextOuptutPictureRGBA=function(e,t,n,i){var r=i,a=this.canvasElement.getContext("2d"),s=a.getImageData(0,0,e,t);s.data.set(r),a.putImageData(s,0,0)},e},"function"==typeof define&&define.amd?define([],i):"object"==typeof e?t.exports=i():n.YUVCanvas=i()},()=>(oy||sy((oy={exports:{}}).exports,oy),oy.exports)),gy=typeof process<"u"&&null!=process.versions&&null!=process.versions.node,_y=(e=class{static get Core(){if(!ji(e,t))throw new Error("Livelink core not initialized");return ji(e,t)}static load(t="prod"){var a;return ji(e,n)||Xi(e,n,qi(a=e,i,r).call(a,t)),ji(e,n)}constructor(){}},t=new WeakMap,n=new WeakMap,i=new WeakSet,r=async function(n){var r;let s=await qi(r=e,i,a).call(r,n),{LivelinkCore:o}=await s();Xi(e,t,o)},a=async function(e){let t="https://cdn.3dverse.com/livelink/core/1.0/"+("prod"!==e?`core.${e}.mjs`:"core.mjs");if(!gy)return new Function("return import('"+t+"')");let n=await(await fetch(t)).text(),i=await new Function("return import('node:vm')")();return i.SourceTextModule?async()=>{let e=new i.SourceTextModule(n,{identifier:t});return await e.link((()=>{})),await e.evaluate(),e.namespace}:new Function("return import('data:text/javascript;base64,"+btoa(n)+"')")},Gi(e,i),Gi(e,t,null),Gi(e,n,null),e);function vy(e){return[e[12],e[13],e[14]]}function yy(e){let t=[0,0,0,0],n=e[0],i=e[1],r=e[2],a=e[4],s=e[5],o=e[6],l=e[8],c=e[9],u=e[10],h=n+s+u;if(h>0){let e=.5/Math.sqrt(h+1);t[3]=.25/e,t[0]=(o-c)*e,t[1]=(l-r)*e,t[2]=(i-a)*e}else if(n>s&&n>u){let e=2*Math.sqrt(1+n-s-u);t[3]=(o-c)/e,t[0]=.25*e,t[1]=(i+a)/e,t[2]=(r+l)/e}else if(s>u){let e=2*Math.sqrt(1+s-n-u);t[3]=(l-r)/e,t[0]=(i+a)/e,t[1]=.25*e,t[2]=(o+c)/e}else{let e=2*Math.sqrt(1+u-n-s);t[3]=(i-a)/e,t[0]=(r+l)/e,t[1]=(o+c)/e,t[2]=.25*e}return t}var xy=(w=class{constructor(e){Gi(this,h),Gi(this,s),Gi(this,o,[]),Gi(this,l,[0,0]),Gi(this,c,[32,32]),Gi(this,u,!0),Gi(this,g,(()=>{qi(this,h,v).call(this),ji(this,s).isConfigured()&&qi(this,h,p).call(this)&&(ji(this,u)&&(ji(this,l),ji(this,s)._resize({size:ji(this,l)}),Xi(this,u,!1)),ji(this,h,d),ji(this,s)._setViewports({viewport_configs:ji(this,h,d)}))})),Gi(this,_,((e,t)=>Math.floor(e)+(Math.floor(e)%t==0?0:t-Math.floor(e)%t))),Xi(this,s,e)}get dimensions(){return ji(this,l)}get width(){return ji(this,l)[0]}get height(){return ji(this,l)[1]}get viewports(){let e=[];for(let t of ji(this,o))e.push(...t.viewports);return e}init(){ji(this,g).call(this)}release(){for(let e of ji(this,o))e.release();ji(this,o).length=0}consumeDecodedFrame({decoded_frame:e,meta_data:t}){for(let n of ji(this,o))n.drawFrame({frame:e,meta_data:t})}addViewport({viewport:e}){qi(this,h,f).call(this,{viewport:e}),ji(this,g).call(this)}addViewports({viewports:e}){for(let t of e)qi(this,h,f).call(this,{viewport:t});ji(this,g).call(this)}removeViewport({viewport:e}){let t=ji(this,o).indexOf(e.rendering_surface);if(-1===t)throw new Error("Viewport without registered surface");let n=ji(this,o)[t];n.removeViewport({viewport:e}),e.release(),0===n.viewports.length&&(n.removeEventListener("on-rendering-surface-resized",ji(this,g)),n.release(),ji(this,o).splice(t,1)),ji(this,g).call(this)}_computeRemoteCanvasSize({codec:e}){if("h265"===e){Xi(this,c,[64,64]),qi(this,h,v).call(this)}return ji(this,l)}},s=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakSet,d=function(){let e=[];for(let t of ji(this,o))e.push(...t._getViewportConfigs({width:this.width,height:this.height}));return e.sort(((e,t)=>e.z_index-t.z_index))},p=function(){return ji(this,o).every((e=>e.isValid()))},f=function({viewport:e}){e.rendering_surface.addViewport({viewport:e}),!ji(this,o).includes(e.rendering_surface)&&qi(this,h,m).call(this,{surface:e.rendering_surface})},m=function({surface:e}){e.addEventListener("on-rendering-surface-resized",ji(this,g)),ji(this,o).push(e)},g=new WeakMap,_=new WeakMap,v=function(){let{offset:e,width:t,height:n}=qi(this,h,y).call(this);qi(this,h,x).call(this,e);let i=[ji(this,_).call(this,t,ji(this,c)[0]),ji(this,_).call(this,n,ji(this,c)[1])];ji(this,u)||Xi(this,u,i[0]!=ji(this,l)[0]||i[1]!=this.dimensions[1]),Xi(this,l,i)},y=function(){let e=[Number.MAX_VALUE,Number.MAX_VALUE],t=[0,0];for(let n of ji(this,o)){let i=n.getBoundingRect();e[0]=Math.min(e[0],i.left),e[1]=Math.min(e[1],i.top),t[0]=Math.max(t[0],i.right),t[1]=Math.max(t[1],i.bottom)}return{offset:e,width:t[0]-e[0],height:t[1]-e[1]}},x=function(e){for(let t of ji(this,o)){let n=t.getBoundingRect();t.offset[0]=n.left-e[0],t.offset[1]=n.top-e[1]}},w),wy={};fy(wy,{ARRAY_TYPE:()=>Ey,EPSILON:()=>by,RANDOM:()=>My,equals:()=>Cy,setMatrixArrayType:()=>Sy,toRadian:()=>Ay});var by=1e-6,Ey=typeof Float32Array<"u"?Float32Array:Array,My=Math.random;function Sy(e){Ey=e}var Ty=Math.PI/180;function Ay(e){return e*Ty}function Cy(e,t){return Math.abs(e-t)<=by*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Ry={};function Py(){var e=new Ey(9);return Ey!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ky(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Oy(e){var t=new Ey(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Iy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ly(e,t,n,i,r,a,s,o,l){var c=new Ey(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=i,c[4]=r,c[5]=a,c[6]=s,c[7]=o,c[8]=l,c}function Dy(e,t,n,i,r,a,s,o,l,c){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=c,e}function Ny(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Uy(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Fy(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*s-o*c,d=-u*a+o*l,p=c*a-s*l,f=n*h+i*d+r*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*i+r*c)*f,e[2]=(o*i-r*s)*f,e[3]=d*f,e[4]=(u*n-r*l)*f,e[5]=(-o*n+r*a)*f,e[6]=p*f,e[7]=(-c*n+i*l)*f,e[8]=(s*n-i*a)*f,e):null}function zy(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-o*c,e[1]=r*c-i*u,e[2]=i*o-r*s,e[3]=o*l-a*u,e[4]=n*u-r*l,e[5]=r*a-n*o,e[6]=a*c-s*l,e[7]=i*l-n*c,e[8]=n*s-i*a,e}function By(e){var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*(c*a-s*l)+n*(-c*r+s*o)+i*(l*r-a*o)}function Vy(e,t,n){var i=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],_=n[5],v=n[6],y=n[7],x=n[8];return e[0]=d*i+p*s+f*c,e[1]=d*r+p*o+f*u,e[2]=d*a+p*l+f*h,e[3]=m*i+g*s+_*c,e[4]=m*r+g*o+_*u,e[5]=m*a+g*l+_*h,e[6]=v*i+y*s+x*c,e[7]=v*r+y*o+x*u,e[8]=v*a+y*l+x*h,e}function Hy(e,t,n){var i=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=d*i+p*s+c,e[7]=d*r+p*o+u,e[8]=d*a+p*l+h,e}function Wy(e,t,n){var i=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*i+d*s,e[1]=p*r+d*o,e[2]=p*a+d*l,e[3]=p*s-d*i,e[4]=p*o-d*r,e[5]=p*l-d*a,e[6]=c,e[7]=u,e[8]=h,e}function jy(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Gy(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Xy(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function qy(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Yy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function $y(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=n+n,o=i+i,l=r+r,c=n*s,u=i*s,h=i*o,d=r*s,p=r*o,f=r*l,m=a*s,g=a*o,_=a*l;return e[0]=1-h-f,e[3]=u-_,e[6]=d+g,e[1]=u+_,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-h,e}function Ky(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=n*o-i*s,y=n*l-r*s,x=n*c-a*s,w=i*l-r*o,b=i*c-a*o,E=r*c-a*l,M=u*m-h*f,S=u*g-d*f,T=u*_-p*f,A=h*g-d*m,C=h*_-p*m,R=d*_-p*g,P=v*R-y*C+x*A+w*T-b*S+E*M;return P?(P=1/P,e[0]=(o*R-l*C+c*A)*P,e[1]=(l*T-s*R-c*S)*P,e[2]=(s*C-o*T+c*M)*P,e[3]=(r*C-i*R-a*A)*P,e[4]=(n*R-r*T+a*S)*P,e[5]=(i*T-n*C-a*M)*P,e[6]=(m*E-g*b+_*w)*P,e[7]=(g*x-f*E-_*y)*P,e[8]=(f*b-m*x+_*v)*P,e):null}function Zy(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Qy(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Jy(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function ex(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function tx(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function nx(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function ix(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e}function rx(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function ax(e,t){var n=e[0],i=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],f=t[3],m=t[4],g=t[5],_=t[6],v=t[7],y=t[8];return Math.abs(n-h)<=by*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-d)<=by*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-p)<=by*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(a-f)<=by*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-m)<=by*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-g)<=by*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-_)<=by*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-v)<=by*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-y)<=by*Math.max(1,Math.abs(u),Math.abs(y))}fy(Ry,{add:()=>ex,adjoint:()=>zy,clone:()=>Oy,copy:()=>Iy,create:()=>Py,determinant:()=>By,equals:()=>ax,exactEquals:()=>rx,frob:()=>Jy,fromMat2d:()=>Yy,fromMat4:()=>ky,fromQuat:()=>$y,fromRotation:()=>Xy,fromScaling:()=>qy,fromTranslation:()=>Gy,fromValues:()=>Ly,identity:()=>Ny,invert:()=>Fy,mul:()=>sx,multiply:()=>Vy,multiplyScalar:()=>nx,multiplyScalarAndAdd:()=>ix,normalFromMat4:()=>Ky,projection:()=>Zy,rotate:()=>Wy,scale:()=>jy,set:()=>Dy,str:()=>Qy,sub:()=>ox,subtract:()=>tx,translate:()=>Hy,transpose:()=>Uy});var sx=Vy,ox=tx,lx={};function cx(){var e=new Ey(16);return Ey!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ux(e){var t=new Ey(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function hx(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function dx(e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m){var g=new Ey(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=i,g[4]=r,g[5]=a,g[6]=s,g[7]=o,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g}function px(e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e}function fx(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function mx(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=r,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function gx(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],v=n*o-i*s,y=n*l-r*s,x=n*c-a*s,w=i*l-r*o,b=i*c-a*o,E=r*c-a*l,M=u*m-h*f,S=u*g-d*f,T=u*_-p*f,A=h*g-d*m,C=h*_-p*m,R=d*_-p*g,P=v*R-y*C+x*A+w*T-b*S+E*M;return P?(P=1/P,e[0]=(o*R-l*C+c*A)*P,e[1]=(r*C-i*R-a*A)*P,e[2]=(m*E-g*b+_*w)*P,e[3]=(d*b-h*E-p*w)*P,e[4]=(l*T-s*R-c*S)*P,e[5]=(n*R-r*T+a*S)*P,e[6]=(g*x-f*E-_*y)*P,e[7]=(u*E-d*x+p*y)*P,e[8]=(s*C-o*T+c*M)*P,e[9]=(i*T-n*C-a*M)*P,e[10]=(f*b-m*x+_*v)*P,e[11]=(h*x-u*b-p*v)*P,e[12]=(o*S-s*A-l*M)*P,e[13]=(n*A-i*S+r*M)*P,e[14]=(m*y-f*w-g*v)*P,e[15]=(u*w-h*y+d*v)*P,e):null}function _x(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15];return e[0]=o*(d*_-p*g)-h*(l*_-c*g)+m*(l*p-c*d),e[1]=-(i*(d*_-p*g)-h*(r*_-a*g)+m*(r*p-a*d)),e[2]=i*(l*_-c*g)-o*(r*_-a*g)+m*(r*c-a*l),e[3]=-(i*(l*p-c*d)-o*(r*p-a*d)+h*(r*c-a*l)),e[4]=-(s*(d*_-p*g)-u*(l*_-c*g)+f*(l*p-c*d)),e[5]=n*(d*_-p*g)-u*(r*_-a*g)+f*(r*p-a*d),e[6]=-(n*(l*_-c*g)-s*(r*_-a*g)+f*(r*c-a*l)),e[7]=n*(l*p-c*d)-s*(r*p-a*d)+u*(r*c-a*l),e[8]=s*(h*_-p*m)-u*(o*_-c*m)+f*(o*p-c*h),e[9]=-(n*(h*_-p*m)-u*(i*_-a*m)+f*(i*p-a*h)),e[10]=n*(o*_-c*m)-s*(i*_-a*m)+f*(i*c-a*o),e[11]=-(n*(o*p-c*h)-s*(i*p-a*h)+u*(i*c-a*o)),e[12]=-(s*(h*g-d*m)-u*(o*g-l*m)+f*(o*d-l*h)),e[13]=n*(h*g-d*m)-u*(i*g-r*m)+f*(i*d-r*h),e[14]=-(n*(o*g-l*m)-s*(i*g-r*m)+f*(i*l-r*o)),e[15]=n*(o*d-l*h)-s*(i*d-r*h)+u*(i*l-r*o),e}function vx(e){var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*s-n*a)*(h*g-d*m)-(t*o-i*a)*(u*g-d*f)+(t*l-r*a)*(u*m-h*f)+(n*o-i*s)*(c*g-d*p)-(n*l-r*s)*(c*m-h*p)+(i*l-r*o)*(c*f-u*p)}function yx(e,t,n){var i=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],v=t[15],y=n[0],x=n[1],w=n[2],b=n[3];return e[0]=y*i+x*o+w*h+b*m,e[1]=y*r+x*l+w*d+b*g,e[2]=y*a+x*c+w*p+b*_,e[3]=y*s+x*u+w*f+b*v,y=n[4],x=n[5],w=n[6],b=n[7],e[4]=y*i+x*o+w*h+b*m,e[5]=y*r+x*l+w*d+b*g,e[6]=y*a+x*c+w*p+b*_,e[7]=y*s+x*u+w*f+b*v,y=n[8],x=n[9],w=n[10],b=n[11],e[8]=y*i+x*o+w*h+b*m,e[9]=y*r+x*l+w*d+b*g,e[10]=y*a+x*c+w*p+b*_,e[11]=y*s+x*u+w*f+b*v,y=n[12],x=n[13],w=n[14],b=n[15],e[12]=y*i+x*o+w*h+b*m,e[13]=y*r+x*l+w*d+b*g,e[14]=y*a+x*c+w*p+b*_,e[15]=y*s+x*u+w*f+b*v,e}function xx(e,t,n){var i,r,a,s,o,l,c,u,h,d,p,f,m=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(i=t[0],r=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i,e[1]=r,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+o*g+h*_+t[12],e[13]=r*m+l*g+d*_+t[13],e[14]=a*m+c*g+p*_+t[14],e[15]=s*m+u*g+f*_+t[15]),e}function wx(e,t,n){var i=n[0],r=n[1],a=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function bx(e,t,n,i){var r,a,s,o,l,c,u,h,d,p,f,m,g,_,v,y,x,w,b,E,M,S,T,A,C=i[0],R=i[1],P=i[2],k=Math.hypot(C,R,P);return k<by?null:(C*=k=1/k,R*=k,P*=k,r=Math.sin(n),s=1-(a=Math.cos(n)),o=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],p=t[6],f=t[7],m=t[8],g=t[9],_=t[10],v=t[11],y=C*C*s+a,x=R*C*s+P*r,w=P*C*s-R*r,b=C*R*s-P*r,E=R*R*s+a,M=P*R*s+C*r,S=C*P*s+R*r,T=R*P*s-C*r,A=P*P*s+a,e[0]=o*y+h*x+m*w,e[1]=l*y+d*x+g*w,e[2]=c*y+p*x+_*w,e[3]=u*y+f*x+v*w,e[4]=o*b+h*E+m*M,e[5]=l*b+d*E+g*M,e[6]=c*b+p*E+_*M,e[7]=u*b+f*E+v*M,e[8]=o*S+h*T+m*A,e[9]=l*S+d*T+g*A,e[10]=c*S+p*T+_*A,e[11]=u*S+f*T+v*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Ex(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[4],s=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+c*i,e[5]=s*r+u*i,e[6]=o*r+h*i,e[7]=l*r+d*i,e[8]=c*r-a*i,e[9]=u*r-s*i,e[10]=h*r-o*i,e[11]=d*r-l*i,e}function Mx(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],s=t[1],o=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-c*i,e[1]=s*r-u*i,e[2]=o*r-h*i,e[3]=l*r-d*i,e[8]=a*i+c*r,e[9]=s*i+u*r,e[10]=o*i+h*r,e[11]=l*i+d*r,e}function Sx(e,t,n){var i=Math.sin(n),r=Math.cos(n),a=t[0],s=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+c*i,e[1]=s*r+u*i,e[2]=o*r+h*i,e[3]=l*r+d*i,e[4]=c*r-a*i,e[5]=u*r-s*i,e[6]=h*r-o*i,e[7]=d*r-l*i,e}function Tx(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ax(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cx(e,t,n){var i,r,a,s=n[0],o=n[1],l=n[2],c=Math.hypot(s,o,l);return c<by?null:(s*=c=1/c,o*=c,l*=c,i=Math.sin(t),a=1-(r=Math.cos(t)),e[0]=s*s*a+r,e[1]=o*s*a+l*i,e[2]=l*s*a-o*i,e[3]=0,e[4]=s*o*a-l*i,e[5]=o*o*a+r,e[6]=l*o*a+s*i,e[7]=0,e[8]=s*l*a+o*i,e[9]=o*l*a-s*i,e[10]=l*l*a+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Rx(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Px(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kx(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ox(e,t,n){var i=t[0],r=t[1],a=t[2],s=t[3],o=i+i,l=r+r,c=a+a,u=i*o,h=i*l,d=i*c,p=r*l,f=r*c,m=a*c,g=s*o,_=s*l,v=s*c;return e[0]=1-(p+m),e[1]=h+v,e[2]=d-_,e[3]=0,e[4]=h-v,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+_,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Ix(e,t){var n=new Ey(3),i=-t[0],r=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=i*i+r*r+a*a+s*s;return h>0?(n[0]=2*(o*s+u*i+l*a-c*r)/h,n[1]=2*(l*s+u*r+c*i-o*a)/h,n[2]=2*(c*s+u*a+o*r-l*i)/h):(n[0]=2*(o*s+u*i+l*a-c*r),n[1]=2*(l*s+u*r+c*i-o*a),n[2]=2*(c*s+u*a+o*r-l*i)),Ox(e,t,n),e}function Lx(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Dx(e,t){var n=t[0],i=t[1],r=t[2],a=t[4],s=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.hypot(n,i,r),e[1]=Math.hypot(a,s,o),e[2]=Math.hypot(l,c,u),e}function Nx(e,t){var n=new Ey(3);Dx(n,t);var i=1/n[0],r=1/n[1],a=1/n[2],s=t[0]*i,o=t[1]*r,l=t[2]*a,c=t[4]*i,u=t[5]*r,h=t[6]*a,d=t[8]*i,p=t[9]*r,f=t[10]*a,m=s+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(d-l)/g,e[2]=(o-c)/g):s>u&&s>f?(g=2*Math.sqrt(1+s-u-f),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(o+c)/g,e[2]=(d+l)/g):u>f?(g=2*Math.sqrt(1+u-s-f),e[3]=(d-l)/g,e[0]=(o+c)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+f-s-u),e[3]=(o-c)/g,e[0]=(d+l)/g,e[1]=(h+p)/g,e[2]=.25*g),e}function Ux(e,t,n,i){var r=t[0],a=t[1],s=t[2],o=t[3],l=r+r,c=a+a,u=s+s,h=r*l,d=r*c,p=r*u,f=a*c,m=a*u,g=s*u,_=o*l,v=o*c,y=o*u,x=i[0],w=i[1],b=i[2];return e[0]=(1-(f+g))*x,e[1]=(d+y)*x,e[2]=(p-v)*x,e[3]=0,e[4]=(d-y)*w,e[5]=(1-(h+g))*w,e[6]=(m+_)*w,e[7]=0,e[8]=(p+v)*b,e[9]=(m-_)*b,e[10]=(1-(h+f))*b,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Fx(e,t,n,i,r){var a=t[0],s=t[1],o=t[2],l=t[3],c=a+a,u=s+s,h=o+o,d=a*c,p=a*u,f=a*h,m=s*u,g=s*h,_=o*h,v=l*c,y=l*u,x=l*h,w=i[0],b=i[1],E=i[2],M=r[0],S=r[1],T=r[2],A=(1-(m+_))*w,C=(p+x)*w,R=(f-y)*w,P=(p-x)*b,k=(1-(d+_))*b,O=(g+v)*b,I=(f+y)*E,L=(g-v)*E,D=(1-(d+m))*E;return e[0]=A,e[1]=C,e[2]=R,e[3]=0,e[4]=P,e[5]=k,e[6]=O,e[7]=0,e[8]=I,e[9]=L,e[10]=D,e[11]=0,e[12]=n[0]+M-(A*M+P*S+I*T),e[13]=n[1]+S-(C*M+k*S+L*T),e[14]=n[2]+T-(R*M+O*S+D*T),e[15]=1,e}function zx(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=n+n,o=i+i,l=r+r,c=n*s,u=i*s,h=i*o,d=r*s,p=r*o,f=r*l,m=a*s,g=a*o,_=a*l;return e[0]=1-h-f,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bx(e,t,n,i,r,a,s){var o=1/(n-t),l=1/(r-i),c=1/(a-s);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(n+t)*o,e[9]=(r+i)*l,e[10]=(s+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*c,e[15]=0,e}function Vx(e,t,n,i,r){var a,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(a=1/(i-r),e[10]=(r+i)*a,e[14]=2*r*i*a):(e[10]=-1,e[14]=-2*i),e}fy(lx,{add:()=>Qx,adjoint:()=>_x,clone:()=>ux,copy:()=>hx,create:()=>cx,determinant:()=>vx,equals:()=>iw,exactEquals:()=>nw,frob:()=>Zx,fromQuat:()=>zx,fromQuat2:()=>Ix,fromRotation:()=>Cx,fromRotationTranslation:()=>Ox,fromRotationTranslationScale:()=>Ux,fromRotationTranslationScaleOrigin:()=>Fx,fromScaling:()=>Ax,fromTranslation:()=>Tx,fromValues:()=>dx,fromXRotation:()=>Rx,fromYRotation:()=>Px,fromZRotation:()=>kx,frustum:()=>Bx,getRotation:()=>Nx,getScaling:()=>Dx,getTranslation:()=>Lx,identity:()=>fx,invert:()=>gx,lookAt:()=>Yx,mul:()=>rw,multiply:()=>yx,multiplyScalar:()=>ew,multiplyScalarAndAdd:()=>tw,ortho:()=>Xx,orthoNO:()=>Gx,orthoZO:()=>qx,perspective:()=>Hx,perspectiveFromFieldOfView:()=>jx,perspectiveNO:()=>Vx,perspectiveZO:()=>Wx,rotate:()=>bx,rotateX:()=>Ex,rotateY:()=>Mx,rotateZ:()=>Sx,scale:()=>wx,set:()=>px,str:()=>Kx,sub:()=>aw,subtract:()=>Jx,targetTo:()=>$x,translate:()=>xx,transpose:()=>mx});var Hx=Vx;function Wx(e,t,n,i,r){var a,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(a=1/(i-r),e[10]=r*a,e[14]=r*i*a):(e[10]=-1,e[14]=-i),e}function jx(e,t,n,i){var r=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+o),c=2/(r+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-o)*l*.5,e[9]=(r-a)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e}function Gx(e,t,n,i,r,a,s){var o=1/(t-n),l=1/(i-r),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*o,e[13]=(r+i)*l,e[14]=(s+a)*c,e[15]=1,e}var Xx=Gx;function qx(e,t,n,i,r,a,s){var o=1/(t-n),l=1/(i-r),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+n)*o,e[13]=(r+i)*l,e[14]=a*c,e[15]=1,e}function Yx(e,t,n,i){var r,a,s,o,l,c,u,h,d,p,f=t[0],m=t[1],g=t[2],_=i[0],v=i[1],y=i[2],x=n[0],w=n[1],b=n[2];return Math.abs(f-x)<by&&Math.abs(m-w)<by&&Math.abs(g-b)<by?fx(e):(u=f-x,h=m-w,d=g-b,r=v*(d*=p=1/Math.hypot(u,h,d))-y*(h*=p),a=y*(u*=p)-_*d,s=_*h-v*u,(p=Math.hypot(r,a,s))?(r*=p=1/p,a*=p,s*=p):(r=0,a=0,s=0),o=h*s-d*a,l=d*r-u*s,c=u*a-h*r,(p=Math.hypot(o,l,c))?(o*=p=1/p,l*=p,c*=p):(o=0,l=0,c=0),e[0]=r,e[1]=o,e[2]=u,e[3]=0,e[4]=a,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*f+a*m+s*g),e[13]=-(o*f+l*m+c*g),e[14]=-(u*f+h*m+d*g),e[15]=1,e)}function $x(e,t,n,i){var r=t[0],a=t[1],s=t[2],o=i[0],l=i[1],c=i[2],u=r-n[0],h=a-n[1],d=s-n[2],p=u*u+h*h+d*d;p>0&&(u*=p=1/Math.sqrt(p),h*=p,d*=p);var f=l*d-c*h,m=c*u-o*d,g=o*h-l*u;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=r,e[13]=a,e[14]=s,e[15]=1,e}function Kx(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Zx(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Qx(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Jx(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function ew(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function tw(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e}function nw(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function iw(e,t){var n=e[0],i=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],v=t[0],y=t[1],x=t[2],w=t[3],b=t[4],E=t[5],M=t[6],S=t[7],T=t[8],A=t[9],C=t[10],R=t[11],P=t[12],k=t[13],O=t[14],I=t[15];return Math.abs(n-v)<=by*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-y)<=by*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-x)<=by*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(a-w)<=by*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-b)<=by*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(o-E)<=by*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(l-M)<=by*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-S)<=by*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-T)<=by*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-A)<=by*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-C)<=by*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-R)<=by*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(f-P)<=by*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-k)<=by*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-O)<=by*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(_-I)<=by*Math.max(1,Math.abs(_),Math.abs(I))}var rw=yx,aw=Jx,sw={};fy(sw,{add:()=>Tb,calculateW:()=>hb,clone:()=>bb,conjugate:()=>vb,copy:()=>Mb,create:()=>nb,dot:()=>Rb,equals:()=>Ub,exactEquals:()=>Nb,exp:()=>db,fromEuler:()=>xb,fromMat3:()=>yb,fromValues:()=>Eb,getAngle:()=>sb,getAxisAngle:()=>ab,identity:()=>ib,invert:()=>_b,len:()=>Ob,length:()=>kb,lerp:()=>Pb,ln:()=>pb,mul:()=>Ab,multiply:()=>ob,normalize:()=>Db,pow:()=>fb,random:()=>gb,rotateX:()=>lb,rotateY:()=>cb,rotateZ:()=>ub,rotationTo:()=>Fb,scale:()=>Cb,set:()=>Sb,setAxes:()=>Bb,setAxisAngle:()=>rb,slerp:()=>mb,sqlerp:()=>zb,sqrLen:()=>Lb,squaredLength:()=>Ib,str:()=>wb});var ow={};function lw(){var e=new Ey(3);return Ey!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function cw(e){var t=new Ey(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function uw(e){var t=e[0],n=e[1],i=e[2];return Math.hypot(t,n,i)}function hw(e,t,n){var i=new Ey(3);return i[0]=e,i[1]=t,i[2]=n,i}function dw(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pw(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function fw(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function mw(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function gw(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function _w(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function vw(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function yw(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function xw(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function ww(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function bw(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Ew(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Mw(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function Sw(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.hypot(n,i,r)}function Tw(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function Aw(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function Cw(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Rw(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Pw(e,t){var n=t[0],i=t[1],r=t[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function kw(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ow(e,t,n){var i=t[0],r=t[1],a=t[2],s=n[0],o=n[1],l=n[2];return e[0]=r*l-a*o,e[1]=a*s-i*l,e[2]=i*o-r*s,e}function Iw(e,t,n,i){var r=t[0],a=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=a+i*(n[1]-a),e[2]=s+i*(n[2]-s),e}function Lw(e,t,n,i,r,a){var s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,c=s*(a-1),u=s*(3-2*a);return e[0]=t[0]*o+n[0]*l+i[0]*c+r[0]*u,e[1]=t[1]*o+n[1]*l+i[1]*c+r[1]*u,e[2]=t[2]*o+n[2]*l+i[2]*c+r[2]*u,e}function Dw(e,t,n,i,r,a){var s=1-a,o=s*s,l=a*a,c=o*s,u=3*a*o,h=3*l*s,d=l*a;return e[0]=t[0]*c+n[0]*u+i[0]*h+r[0]*d,e[1]=t[1]*c+n[1]*u+i[1]*h+r[1]*d,e[2]=t[2]*c+n[2]*u+i[2]*h+r[2]*d,e}function Nw(e,t){t=t||1;var n=2*My()*Math.PI,i=2*My()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e}function Uw(e,t,n){var i=t[0],r=t[1],a=t[2],s=n[3]*i+n[7]*r+n[11]*a+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/s,e}function Fw(e,t,n){var i=t[0],r=t[1],a=t[2];return e[0]=i*n[0]+r*n[3]+a*n[6],e[1]=i*n[1]+r*n[4]+a*n[7],e[2]=i*n[2]+r*n[5]+a*n[8],e}function zw(e,t,n){var i=n[0],r=n[1],a=n[2],s=n[3],o=t[0],l=t[1],c=t[2],u=r*c-a*l,h=a*o-i*c,d=i*l-r*o,p=r*d-a*h,f=a*u-i*d,m=i*h-r*u,g=2*s;return u*=g,h*=g,d*=g,p*=2,f*=2,m*=2,e[0]=o+u+p,e[1]=l+h+f,e[2]=c+d+m,e}function Bw(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Vw(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Hw(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Ww(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],s=t[1],o=t[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(a*a+s*s+o*o),c=l&&kw(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function jw(e){return e[0]=0,e[1]=0,e[2]=0,e}function Gw(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Xw(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function qw(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(n-a)<=by*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=by*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=by*Math.max(1,Math.abs(r),Math.abs(o))}fy(ow,{add:()=>fw,angle:()=>Ww,bezier:()=>Dw,ceil:()=>vw,clone:()=>cw,copy:()=>dw,create:()=>lw,cross:()=>Ow,dist:()=>Zw,distance:()=>Sw,div:()=>Kw,divide:()=>_w,dot:()=>kw,equals:()=>qw,exactEquals:()=>Xw,floor:()=>yw,forEach:()=>tb,fromValues:()=>hw,hermite:()=>Lw,inverse:()=>Rw,len:()=>Jw,length:()=>uw,lerp:()=>Iw,max:()=>ww,min:()=>xw,mul:()=>$w,multiply:()=>gw,negate:()=>Cw,normalize:()=>Pw,random:()=>Nw,rotateX:()=>Bw,rotateY:()=>Vw,rotateZ:()=>Hw,round:()=>bw,scale:()=>Ew,scaleAndAdd:()=>Mw,set:()=>pw,sqrDist:()=>Qw,sqrLen:()=>eb,squaredDistance:()=>Tw,squaredLength:()=>Aw,str:()=>Gw,sub:()=>Yw,subtract:()=>mw,transformMat3:()=>Fw,transformMat4:()=>Uw,transformQuat:()=>zw,zero:()=>jw});var Yw=mw,$w=gw,Kw=_w,Zw=Sw,Qw=Tw,Jw=uw,eb=Aw,tb=function(){var e=lw();return function(t,n,i,r,a,s){var o,l;for(n||(n=3),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,o=i;o<l;o+=n)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}}();function nb(){var e=new Ey(4);return Ey!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ib(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function rb(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function ab(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return i>by?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n}function sb(e,t){var n=Rb(e,t);return Math.acos(2*n*n-1)}function ob(e,t,n){var i=t[0],r=t[1],a=t[2],s=t[3],o=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+s*o+r*c-a*l,e[1]=r*u+s*l+a*o-i*c,e[2]=a*u+s*c+i*l-r*o,e[3]=s*u-i*o-r*l-a*c,e}function lb(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],s=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+s*o,e[1]=r*l+a*o,e[2]=a*l-r*o,e[3]=s*l-i*o,e}function cb(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],s=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l-a*o,e[1]=r*l+s*o,e[2]=a*l+i*o,e[3]=s*l-r*o,e}function ub(e,t,n){n*=.5;var i=t[0],r=t[1],a=t[2],s=t[3],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l+r*o,e[1]=r*l-i*o,e[2]=a*l+s*o,e[3]=s*l-a*o,e}function hb(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e}function db(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=Math.sqrt(n*n+i*i+r*r),o=Math.exp(a),l=s>0?o*Math.sin(s)/s:0;return e[0]=n*l,e[1]=i*l,e[2]=r*l,e[3]=o*Math.cos(s),e}function pb(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=Math.sqrt(n*n+i*i+r*r),o=s>0?Math.atan2(s,a)/s:0;return e[0]=n*o,e[1]=i*o,e[2]=r*o,e[3]=.5*Math.log(n*n+i*i+r*r+a*a),e}function fb(e,t,n){return pb(e,t),Cb(e,e,n),db(e,e),e}function mb(e,t,n,i){var r,a,s,o,l,c=t[0],u=t[1],h=t[2],d=t[3],p=n[0],f=n[1],m=n[2],g=n[3];return(a=c*p+u*f+h*m+d*g)<0&&(a=-a,p=-p,f=-f,m=-m,g=-g),1-a>by?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-i)*r)/s,l=Math.sin(i*r)/s):(o=1-i,l=i),e[0]=o*c+l*p,e[1]=o*u+l*f,e[2]=o*h+l*m,e[3]=o*d+l*g,e}function gb(e){var t=My(),n=My(),i=My(),r=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*n),e[1]=r*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*i),e[3]=a*Math.cos(2*Math.PI*i),e}function _b(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=n*n+i*i+r*r+a*a,o=s?1/s:0;return e[0]=-n*o,e[1]=-i*o,e[2]=-r*o,e[3]=a*o,e}function vb(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function yb(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var a=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*a+a]-t[3*s+s]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*a+s]-t[3*s+a])*n,e[a]=(t[3*a+r]+t[3*r+a])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e}function xb(e,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var a=Math.sin(t),s=Math.cos(t),o=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=a*l*u-s*o*c,e[1]=s*o*u+a*l*c,e[2]=s*l*c-a*o*u,e[3]=s*l*u+a*o*c,e}function wb(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}!function(){var e=function(){var e=new Ey(4);return Ey!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();var bb=function(e){var t=new Ey(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Eb=function(e,t,n,i){var r=new Ey(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},Mb=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Sb=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},Tb=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Ab=ob,Cb=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},Rb=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Pb=function(e,t,n,i){var r=t[0],a=t[1],s=t[2],o=t[3];return e[0]=r+i*(n[0]-r),e[1]=a+i*(n[1]-a),e[2]=s+i*(n[2]-s),e[3]=o+i*(n[3]-o),e},kb=function(e){var t=e[0],n=e[1],i=e[2],r=e[3];return Math.hypot(t,n,i,r)},Ob=kb,Ib=function(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r},Lb=Ib,Db=function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],s=n*n+i*i+r*r+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=a*s,e},Nb=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Ub=function(e,t){var n=e[0],i=e[1],r=e[2],a=e[3],s=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(n-s)<=by*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-o)<=by*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-l)<=by*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-c)<=by*Math.max(1,Math.abs(a),Math.abs(c))},Fb=function(){var e=lw(),t=hw(1,0,0),n=hw(0,1,0);return function(i,r,a){var s=kw(r,a);return s<-.999999?(Ow(e,t,r),Jw(e)<1e-6&&Ow(e,n,r),Pw(e,e),rb(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Ow(e,r,a),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,Db(i,i))}}(),zb=function(){var e=nb(),t=nb();return function(n,i,r,a,s,o){return mb(e,i,s,o),mb(t,r,a,o),mb(n,e,t,2*o*(1-o)),n}}(),Bb=function(){var e=Py();return function(t,n,i,r){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Db(t,yb(t,e))}}();function Vb(){var e=new Ey(2);return Ey!=Float32Array&&(e[0]=0,e[1]=0),e}function Hb(e){var t=new Ey(2);return t[0]=e[0],t[1]=e[1],t}function Wb(e,t){var n=new Ey(2);return n[0]=e,n[1]=t,n}function jb(e,t){return e[0]=t[0],e[1]=t[1],e}function Gb(e,t,n){return e[0]=t,e[1]=n,e}function Xb(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function qb(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Yb(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function $b(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function Kb(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Zb(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Qb(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function Jb(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function eE(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function tE(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function nE(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function iE(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.hypot(n,i)}function rE(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function aE(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function sE(e){var t=e[0],n=e[1];return t*t+n*n}function oE(e,t){return e[0]=-t[0],e[1]=-t[1],e}function lE(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function cE(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e}function uE(e,t){return e[0]*t[0]+e[1]*t[1]}function hE(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e}function dE(e,t,n,i){var r=t[0],a=t[1];return e[0]=r+i*(n[0]-r),e[1]=a+i*(n[1]-a),e}function pE(e,t){t=t||1;var n=2*My()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function fE(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e}function mE(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function gE(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e}function _E(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}function vE(e,t,n,i){var r=t[0]-n[0],a=t[1]-n[1],s=Math.sin(i),o=Math.cos(i);return e[0]=r*o-a*s+n[0],e[1]=r*s+a*o+n[1],e}function yE(e,t){var n=e[0],i=e[1],r=t[0],a=t[1],s=Math.sqrt(n*n+i*i)*Math.sqrt(r*r+a*a),o=s&&(n*r+i*a)/s;return Math.acos(Math.min(Math.max(o,-1),1))}function xE(e){return e[0]=0,e[1]=0,e}function wE(e){return"vec2("+e[0]+", "+e[1]+")"}function bE(e,t){return e[0]===t[0]&&e[1]===t[1]}function EE(e,t){var n=e[0],i=e[1],r=t[0],a=t[1];return Math.abs(n-r)<=by*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-a)<=by*Math.max(1,Math.abs(i),Math.abs(a))}fy({},{add:()=>Xb,angle:()=>yE,ceil:()=>Kb,clone:()=>Hb,copy:()=>jb,create:()=>Vb,cross:()=>hE,dist:()=>CE,distance:()=>iE,div:()=>AE,divide:()=>$b,dot:()=>uE,equals:()=>EE,exactEquals:()=>bE,floor:()=>Zb,forEach:()=>kE,fromValues:()=>Wb,inverse:()=>lE,len:()=>ME,length:()=>aE,lerp:()=>dE,max:()=>Jb,min:()=>Qb,mul:()=>TE,multiply:()=>Yb,negate:()=>oE,normalize:()=>cE,random:()=>pE,rotate:()=>vE,round:()=>eE,scale:()=>tE,scaleAndAdd:()=>nE,set:()=>Gb,sqrDist:()=>RE,sqrLen:()=>PE,squaredDistance:()=>rE,squaredLength:()=>sE,str:()=>wE,sub:()=>SE,subtract:()=>qb,transformMat2:()=>fE,transformMat2d:()=>mE,transformMat3:()=>gE,transformMat4:()=>_E,zero:()=>xE});var ME=aE,SE=qb,TE=Yb,AE=$b,CE=iE,RE=rE,PE=sE,kE=function(){var e=Vb();return function(t,n,i,r,a,s){var o,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,t.length):t.length,o=i;o<l;o+=n)e[0]=t[o],e[1]=t[o+1],a(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}(),OE=(E=class{constructor(){Gi(this,b,new EventTarget)}addEventListener(e,t,n){ji(this,b).addEventListener(e,t,n)}removeEventListener(e,t,n){ji(this,b).removeEventListener(e,t,n)}_dispatchEvent(e){return ji(this,b).dispatchEvent(e)}},b=new WeakMap,E),IE=(M=class extends OE{constructor({euid:e}){super(),Gi(this,S),Xi(this,S,{euid:e})}get _core(){return ji(this,S)}get euid(){return ji(this,S).euid}get animation_controller(){return ji(this,S).animation_controller}set animation_controller(e){ji(this,S).animation_controller=this._setComponentValue({ref:ji(this,S).animation_controller,component_name:"animation_controller",value:e})}get animation_sequence_controller(){return ji(this,S).animation_sequence_controller}set animation_sequence_controller(e){ji(this,S).animation_sequence_controller=this._setComponentValue({ref:ji(this,S).animation_sequence_controller,component_name:"animation_sequence_controller",value:e})}get bone(){return ji(this,S).bone}set bone(e){ji(this,S).bone=this._setComponentValue({ref:ji(this,S).bone,component_name:"bone",value:e})}get box_geometry(){return ji(this,S).box_geometry}set box_geometry(e){ji(this,S).box_geometry=this._setComponentValue({ref:ji(this,S).box_geometry,component_name:"box_geometry",value:e})}get camera(){return ji(this,S).camera}set camera(e){ji(this,S).camera=this._setComponentValue({ref:ji(this,S).camera,component_name:"camera",value:e})}get capsule_geometry(){return ji(this,S).capsule_geometry}set capsule_geometry(e){ji(this,S).capsule_geometry=this._setComponentValue({ref:ji(this,S).capsule_geometry,component_name:"capsule_geometry",value:e})}get character_controller(){return ji(this,S).character_controller}set character_controller(e){ji(this,S).character_controller=this._setComponentValue({ref:ji(this,S).character_controller,component_name:"character_controller",value:e})}get collision_geometry_ref(){return ji(this,S).collision_geometry_ref}set collision_geometry_ref(e){ji(this,S).collision_geometry_ref=this._setComponentValue({ref:ji(this,S).collision_geometry_ref,component_name:"collision_geometry_ref",value:e})}get constraint(){return ji(this,S).constraint}set constraint(e){ji(this,S).constraint=this._setComponentValue({ref:ji(this,S).constraint,component_name:"constraint",value:e})}get culling_geometry(){return ji(this,S).culling_geometry}set culling_geometry(e){ji(this,S).culling_geometry=this._setComponentValue({ref:ji(this,S).culling_geometry,component_name:"culling_geometry",value:e})}get cylinder_geometry(){return ji(this,S).cylinder_geometry}set cylinder_geometry(e){ji(this,S).cylinder_geometry=this._setComponentValue({ref:ji(this,S).cylinder_geometry,component_name:"cylinder_geometry",value:e})}get debug_name(){return ji(this,S).debug_name}set debug_name(e){ji(this,S).debug_name=this._setComponentValue({ref:ji(this,S).debug_name,component_name:"debug_name",value:e})}get decal_projector(){return ji(this,S).decal_projector}set decal_projector(e){ji(this,S).decal_projector=this._setComponentValue({ref:ji(this,S).decal_projector,component_name:"decal_projector",value:e})}get environment(){return ji(this,S).environment}set environment(e){ji(this,S).environment=this._setComponentValue({ref:ji(this,S).environment,component_name:"environment",value:e})}get joint(){return ji(this,S).joint}set joint(e){ji(this,S).joint=this._setComponentValue({ref:ji(this,S).joint,component_name:"joint",value:e})}get label(){return ji(this,S).label}set label(e){ji(this,S).label=this._setComponentValue({ref:ji(this,S).label,component_name:"label",value:e})}get lineage(){return ji(this,S).lineage}set lineage(e){ji(this,S).lineage=this._setComponentValue({ref:ji(this,S).lineage,component_name:"lineage",value:e})}get local_aabb(){return ji(this,S).local_aabb}set local_aabb(e){ji(this,S).local_aabb=this._setComponentValue({ref:ji(this,S).local_aabb,component_name:"local_aabb",value:e})}get material(){return ji(this,S).material}set material(e){ji(this,S).material=this._setComponentValue({ref:ji(this,S).material,component_name:"material",value:e})}get material_ref(){return ji(this,S).material_ref}set material_ref(e){ji(this,S).material_ref=this._setComponentValue({ref:ji(this,S).material_ref,component_name:"material_ref",value:e})}get measure(){return ji(this,S).measure}set measure(e){ji(this,S).measure=this._setComponentValue({ref:ji(this,S).measure,component_name:"measure",value:e})}get mesh_ref(){return ji(this,S).mesh_ref}set mesh_ref(e){ji(this,S).mesh_ref=this._setComponentValue({ref:ji(this,S).mesh_ref,component_name:"mesh_ref",value:e})}get orthographic_lens(){return ji(this,S).orthographic_lens}set orthographic_lens(e){ji(this,S).orthographic_lens=this._setComponentValue({ref:ji(this,S).orthographic_lens,component_name:"orthographic_lens",value:e})}get overrider(){return ji(this,S).overrider}set overrider(e){ji(this,S).overrider=this._setComponentValue({ref:ji(this,S).overrider,component_name:"overrider",value:e})}get perspective_lens(){return ji(this,S).perspective_lens}set perspective_lens(e){ji(this,S).perspective_lens=this._setComponentValue({ref:ji(this,S).perspective_lens,component_name:"perspective_lens",value:e})}get physics_material(){return ji(this,S).physics_material}set physics_material(e){ji(this,S).physics_material=this._setComponentValue({ref:ji(this,S).physics_material,component_name:"physics_material",value:e})}get plane_geometry(){return ji(this,S).plane_geometry}set plane_geometry(e){ji(this,S).plane_geometry=this._setComponentValue({ref:ji(this,S).plane_geometry,component_name:"plane_geometry",value:e})}get point_cloud_ref(){return ji(this,S).point_cloud_ref}set point_cloud_ref(e){ji(this,S).point_cloud_ref=this._setComponentValue({ref:ji(this,S).point_cloud_ref,component_name:"point_cloud_ref",value:e})}get point_light(){return ji(this,S).point_light}set point_light(e){ji(this,S).point_light=this._setComponentValue({ref:ji(this,S).point_light,component_name:"point_light",value:e})}get reflection_probe(){return ji(this,S).reflection_probe}set reflection_probe(e){ji(this,S).reflection_probe=this._setComponentValue({ref:ji(this,S).reflection_probe,component_name:"reflection_probe",value:e})}get rigid_body(){return ji(this,S).rigid_body}set rigid_body(e){ji(this,S).rigid_body=this._setComponentValue({ref:ji(this,S).rigid_body,component_name:"rigid_body",value:e})}get scene_ref(){return ji(this,S).scene_ref}set scene_ref(e){ji(this,S).scene_ref=this._setComponentValue({ref:ji(this,S).scene_ref,component_name:"scene_ref",value:e})}get script_map(){return ji(this,S).script_map}set script_map(e){ji(this,S).script_map=this._setComponentValue({ref:ji(this,S).script_map,component_name:"script_map",value:e})}get shadow_caster(){return ji(this,S).shadow_caster}set shadow_caster(e){ji(this,S).shadow_caster=this._setComponentValue({ref:ji(this,S).shadow_caster,component_name:"shadow_caster",value:e})}get skeleton_ref(){return ji(this,S).skeleton_ref}set skeleton_ref(e){ji(this,S).skeleton_ref=this._setComponentValue({ref:ji(this,S).skeleton_ref,component_name:"skeleton_ref",value:e})}get sound_ref(){return ji(this,S).sound_ref}set sound_ref(e){ji(this,S).sound_ref=this._setComponentValue({ref:ji(this,S).sound_ref,component_name:"sound_ref",value:e})}get sphere_geometry(){return ji(this,S).sphere_geometry}set sphere_geometry(e){ji(this,S).sphere_geometry=this._setComponentValue({ref:ji(this,S).sphere_geometry,component_name:"sphere_geometry",value:e})}get spline(){return ji(this,S).spline}set spline(e){ji(this,S).spline=this._setComponentValue({ref:ji(this,S).spline,component_name:"spline",value:e})}get spot_light(){return ji(this,S).spot_light}set spot_light(e){ji(this,S).spot_light=this._setComponentValue({ref:ji(this,S).spot_light,component_name:"spot_light",value:e})}get stereoscopic_lens(){return ji(this,S).stereoscopic_lens}set stereoscopic_lens(e){ji(this,S).stereoscopic_lens=this._setComponentValue({ref:ji(this,S).stereoscopic_lens,component_name:"stereoscopic_lens",value:e})}get tags(){return ji(this,S).tags}set tags(e){ji(this,S).tags=this._setComponentValue({ref:ji(this,S).tags,component_name:"tags",value:e})}get vehicle_controller(){return ji(this,S).vehicle_controller}set vehicle_controller(e){ji(this,S).vehicle_controller=this._setComponentValue({ref:ji(this,S).vehicle_controller,component_name:"vehicle_controller",value:e})}get volume_filter(){return ji(this,S).volume_filter}set volume_filter(e){ji(this,S).volume_filter=this._setComponentValue({ref:ji(this,S).volume_filter,component_name:"volume_filter",value:e})}get volume_material_ref(){return ji(this,S).volume_material_ref}set volume_material_ref(e){ji(this,S).volume_material_ref=this._setComponentValue({ref:ji(this,S).volume_material_ref,component_name:"volume_material_ref",value:e})}get volume_ref(){return ji(this,S).volume_ref}set volume_ref(e){ji(this,S).volume_ref=this._setComponentValue({ref:ji(this,S).volume_ref,component_name:"volume_ref",value:e})}toJSON(){let{euid:e,...t}=ji(this,S);return{euid:{value:e.value},...t}}_unsafeSetComponentValue({component_name:e,value:t}){ji(this,S)[e]=t}},S=new WeakMap,Hi(M,"component_names",["animation_controller","animation_sequence_controller","bone","box_geometry","camera","capsule_geometry","character_controller","collision_geometry_ref","constraint","culling_geometry","cylinder_geometry","debug_name","decal_projector","environment","joint","label","lineage","local_aabb","material","material_ref","measure","mesh_ref","orthographic_lens","overrider","perspective_lens","physics_material","plane_geometry","point_cloud_ref","point_light","reflection_probe","rigid_body","scene_ref","script_map","shadow_caster","skeleton_ref","sound_ref","sphere_geometry","spline","spot_light","stereoscopic_lens","tags","vehicle_controller","volume_filter","volume_material_ref","volume_ref"]),M),LE=class extends Event{constructor({change_source:e,new_components:t,updated_components:n,deleted_components:i}){super("on-entity-updated"),Hi(this,"change_source"),Hi(this,"new_components"),Hi(this,"updated_components"),Hi(this,"deleted_components"),this.change_source=e,this.new_components=t,this.updated_components=n,this.deleted_components=i}isAnyComponentDirty({components:e}){return this.new_components.some((t=>e.includes(t)))||this.updated_components.some((t=>e.includes(t)))||this.deleted_components.some((t=>e.includes(t)))}},DE=class extends Event{constructor({is_visible:e}){super("on-entity-visibility-changed"),Hi(this,"is_visible"),this.is_visible=e}};function NE([e,t,n,i]){let r={roll:0,pitch:0,yaw:0},a=e,s=t,o=n,l=i,c=2*(l*a+s*o),u=1-2*(a*a+s*s);r.roll=Math.atan2(c,u);let h=2*(l*s-o*a);Math.abs(h)>=1?r.pitch=function(e,t){return t<0?-Math.abs(e):Math.abs(e)}(Math.PI/2,h):r.pitch=Math.asin(h);let d=2*(l*o+a*s),p=1-2*(s*s+o*o);return r.yaw=Math.atan2(d,p),[r.roll,r.pitch,r.yaw].map((e=>180*e/Math.PI))}function UE(e){let[t,n,i]=e.map((e=>e*Math.PI/180)),r=Math.cos(i/2),a=Math.sin(i/2),s=Math.cos(n/2),o=Math.sin(n/2),l=Math.cos(t/2),c=Math.sin(t/2);return[r*s*c-a*o*l,a*s*c+r*o*l,a*s*l-r*o*c,r*s*l+a*o*c]}var FE=(W=class extends IE{constructor({euid:e,local_transform:t,parent:n}){super({euid:e}),Gi(this,N),Gi(this,T),Gi(this,A),Gi(this,C),Gi(this,R),Gi(this,P,lx.create()),Gi(this,k,lx.create()),Gi(this,O,null),Gi(this,I,!0),Gi(this,L,0),Gi(this,D,0),Hi(this,"_recalculateGlobalTransformIfNeeded",(()=>{ji(this,N,U)&&(qi(this,N,z).call(this),qi(this,N,B).call(this),qi(this,N,H).call(this),qi(this,N,V).call(this),this._computeTransformMatrices(),Xi(this,N,!1,F))})),Xi(this,O,n),Xi(this,C,t),Xi(this,T,{position:[0,0,0],orientation:[0,0,0,1],scale:[1,1,1],eulerOrientation:[0,0,0]}),Xi(this,R,new zE(this,ji(this,C))),Xi(this,A,new BE(this,ji(this,T))),this._unsafeSetComponentValue({component_name:"local_transform",value:ji(this,C)})}get _last_update_id(){return ji(this,L)}get global_transform(){return ji(this,A)}set global_transform(e){this._setGlobalTransform({global_transform:e,change_source:"local"}),this._markComponentAsDirty({component_name:"local_transform"})}get local_transform(){return ji(this,R)}set local_transform(e){Object.assign(ji(this,R),e)}get global_aabb(){let e=-Number.MAX_VALUE,t=this.local_aabb||{min:[-1,-1,-1],max:[1,1,1]},{min:n,max:i}=t,r=[ow.fromValues(n[0],n[1],n[2]),ow.fromValues(i[0],n[1],n[2]),ow.fromValues(n[0],i[1],n[2]),ow.fromValues(n[0],n[1],i[2]),ow.fromValues(i[0],i[1],i[2]),ow.fromValues(n[0],i[1],i[2]),ow.fromValues(i[0],n[1],i[2]),ow.fromValues(i[0],i[1],n[2])];r.forEach((e=>ow.transformMat4(e,e,this.ls_to_ws)));let a=ow.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=ow.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=ow.create();return r.forEach((e=>{ow.min(a,a,e),ow.max(s,s,e),ow.add(o,o,e)})),ow.scale(o,o,1/8),[{vertex:r[0],test_vertices:[r[1],r[2],r[3]]},{vertex:r[6],test_vertices:[r[1],r[3],r[4]]},{vertex:r[5],test_vertices:[r[2],r[3],r[4]]},{vertex:r[7],test_vertices:[r[1],r[2],r[4]]}].forEach((({vertex:t,test_vertices:n})=>{n.forEach((n=>{let i=ow.distance(t,n);i>e&&(e=i)}))})),{min:Array.from(a),max:Array.from(s),center:Array.from(o),longest_edge_length:e}}get parent(){return ji(this,O)}set parent(e){throw new Error("Not implemented")}_setGlobalTransform({global_transform:e,change_source:t}){e.position&&(this._setGlobalPosition(e.position),ow.copy(ji(this,T).position,e.position)),e.orientation&&(this._setGlobalOrientation(e.orientation),sw.copy(ji(this,T).orientation,e.orientation)),e.eulerOrientation&&(this._setGlobalEulerOrientation(e.eulerOrientation),ow.copy(ji(this,T).eulerOrientation,e.eulerOrientation)),e.scale&&(this._setGlobalScale(e.scale),ow.copy(ji(this,T).scale,e.scale)),this._computeTransformMatrices(),this._dispatchEvent(new LE({change_source:t,updated_components:["local_transform"],deleted_components:[],new_components:[]}))}_markGlobalTransformAsDirty(){Xi(this,I,!0),this._markLocalTransformAsDirty()}_markLocalTransformAsDirty(){Yi(this,L)._++,this._markComponentAsDirty({component_name:"local_transform"})}_computeTransformMatrices(){lx.fromRotationTranslationScale(ji(this,P),ji(this,T).orientation,ji(this,T).position,ji(this,T).scale),lx.invert(ji(this,k),ji(this,P))}_setLocalTransform({local_transform:e}){e.position&&ow.copy(ji(this,C).position,e.position),e.orientation&&sw.copy(ji(this,C).orientation,e.orientation),e.eulerOrientation&&ow.copy(ji(this,C).eulerOrientation,e.eulerOrientation),e.scale&&ow.copy(ji(this,C).scale,e.scale),e.globalEulerOrientation&&ow.copy(ji(this,C).globalEulerOrientation,e.globalEulerOrientation),Xi(this,I,!0)}_setGlobalPosition(e){ji(this,O)?ow.transformMat4(ji(this,C).position,e,ji(this,O).ws_to_ls):ow.copy(ji(this,C).position,e)}_setGlobalOrientation(e){if(!ji(this,O))return sw.copy(ji(this,C).orientation,e),void ow.copy(ji(this,C).eulerOrientation,NE(e));let t=sw.conjugate(sw.create(),ji(this,O).global_transform.orientation),n=ji(this,C).orientation;sw.multiply(n,t,e),ji(this,C).eulerOrientation=NE(n)}_setGlobalEulerOrientation(e){let t=UE(e);this._setGlobalOrientation(t),ow.copy(ji(this,C).globalEulerOrientation,e)}_setGlobalScale(e){ji(this,O)?ow.divide(ji(this,C).scale,e,ji(this,O).global_transform.scale):ow.copy(ji(this,C).scale,e)}get ls_to_ws(){return this._recalculateGlobalTransformIfNeeded(),ji(this,P)}get ws_to_ls(){return this._recalculateGlobalTransformIfNeeded(),ji(this,k)}},T=new WeakMap,A=new WeakMap,C=new WeakMap,R=new WeakMap,P=new WeakMap,k=new WeakMap,O=new WeakMap,I=new WeakMap,L=new WeakMap,D=new WeakMap,N=new WeakSet,U=function(){return!(!ji(this,O)||ji(this,O)._last_update_id===ji(this,D)&&!ji(ji(this,O),N,U))||ji(this,I)},F=function(e){var t;Xi(this,I,e),Yi(this,L)._++,Xi(this,D,(null==(t=ji(this,O))?void 0:t._last_update_id)??0)},z=function(){let e=ji(this,C).position;return ji(this,O)?ow.transformMat4(ji(this,T).position,e,ji(this,O).ls_to_ws):ow.copy(ji(this,T).position,e)},B=function(){return ji(this,O)?sw.multiply(ji(this,T).orientation,ji(this,O).global_transform.orientation,ji(this,C).orientation):sw.copy(ji(this,T).orientation,ji(this,C).orientation)},V=function(){let e=UE(ji(this,C).globalEulerOrientation).every(((e,t)=>Math.max(e-ji(this,T).orientation[t])<1e-6))?ji(this,C).globalEulerOrientation:NE(ji(this,T).orientation);return ow.copy(ji(this,T).eulerOrientation,e)},H=function(){let e=ji(this,C).scale;return ji(this,O)?ow.multiply(ji(this,T).scale,ji(this,O).global_transform.scale,e):ow.copy(ji(this,T).scale,e)},W),zE=(Y=class{constructor(e,t){Gi(this,j),Gi(this,G),Gi(this,X),Gi(this,q);let n=()=>({get:(e,t)=>Reflect.get(e,t),set:(t,n,i)=>{let r=Reflect.set(t,n,i);return e._markGlobalTransformAsDirty(),r}});Xi(this,j,new Proxy(t.position,n())),Xi(this,q,new Proxy(t.scale,n())),Xi(this,G,new Proxy(t.orientation,{get:(e,n)=>t.orientation[n],set:(n,i,r)=>{let a=Reflect.set(n,i,r);return t.eulerOrientation=NE(t.orientation),e._markGlobalTransformAsDirty(),a}})),Xi(this,X,new Proxy(t.eulerOrientation,{get:(e,n)=>t.eulerOrientation[n],set:(n,i,r)=>{let a=Reflect.set(n,i,r);return t.orientation=UE(t.eulerOrientation),e._markGlobalTransformAsDirty(),a}}))}get position(){return ji(this,j)}get orientation(){return ji(this,G)}get eulerOrientation(){return ji(this,X)}get scale(){return ji(this,q)}set position(e){Object.assign(ji(this,j),e)}set orientation(e){Object.assign(ji(this,G),e)}set eulerOrientation(e){Object.assign(ji(this,X),e)}set scale(e){Object.assign(ji(this,q),e)}},j=new WeakMap,G=new WeakMap,X=new WeakMap,q=new WeakMap,Y),BE=(J=class{constructor(e,t){Gi(this,$),Gi(this,K),Gi(this,Z),Gi(this,Q),Xi(this,$,new Proxy(t.position,{get:(t,n)=>(e._recalculateGlobalTransformIfNeeded(),Reflect.get(t,n)),set:(t,n,i)=>(Reflect.set(t,n,i),e._setGlobalPosition(t),e._computeTransformMatrices(),e._markLocalTransformAsDirty(),!0)})),Xi(this,K,new Proxy(t.orientation,{get:(t,n)=>(e._recalculateGlobalTransformIfNeeded(),Reflect.get(t,n)),set:(t,n,i)=>(Reflect.set(t,n,i),e._setGlobalOrientation(t),e._computeTransformMatrices(),e._markLocalTransformAsDirty(),!0)})),Xi(this,Z,new Proxy(t.eulerOrientation,{get:(t,n)=>(e._recalculateGlobalTransformIfNeeded(),Reflect.get(t,n)),set:(t,n,i)=>(Reflect.set(t,n,i),e._setGlobalEulerOrientation(t),e._computeTransformMatrices(),e._markLocalTransformAsDirty(),!0)})),Xi(this,Q,new Proxy(t.scale,{get:(t,n)=>(e._recalculateGlobalTransformIfNeeded(),Reflect.get(t,n)),set:(t,n,i)=>(Reflect.set(t,n,i),e._setGlobalScale(t),e._computeTransformMatrices(),e._markLocalTransformAsDirty(),!0)}))}get position(){return ji(this,$)}get orientation(){return ji(this,K)}get eulerOrientation(){return ji(this,Z)}get scale(){return ji(this,Q)}set position(e){Object.assign(ji(this,$),e)}set orientation(e){Object.assign(ji(this,K),e)}set eulerOrientation(e){Object.assign(ji(this,Z),e)}set scale(e){Object.assign(ji(this,Q),e)}},$=new WeakMap,K=new WeakMap,Z=new WeakMap,Q=new WeakMap,J),VE=class e{constructor(e,t){this._entity=e,this._component_name=t}get(t,n){return"object"==typeof t[n]||Array.isArray(t[n])?new Proxy(t[n],new e(this._entity,this._component_name)):Reflect.get(t,n)}set(e,t,n){return this._entity._markComponentAsDirty({component_name:this._component_name}),Reflect.set(e,t,n)}deleteProperty(e,t){return this._entity._markComponentAsDirty({component_name:this._component_name}),Reflect.deleteProperty(e,t)}},HE=class extends Event{constructor({event_name:e,emitter_entity:t,data_object:n}){super(e),Hi(this,"emitter_entity"),Hi(this,"data_object"),this.emitter_entity=t,this.data_object=n}},WE=(ie=class extends Event{constructor({scene:e,event_name:t,emitter_entity:n,target_rtids:i,data_object:r}){super(t),Hi(this,"emitter_entity"),Hi(this,"data_object"),Gi(this,ee),Gi(this,te),Gi(this,ne,null),Xi(this,ee,e),this.emitter_entity=n,Xi(this,te,i),this.data_object=r}get target_entities(){return ji(this,ne)||Xi(this,ne,Promise.all(ji(this,te).map((e=>ji(this,ee)._findEntity({entity_rtid:e}))))),ji(this,ne)}},ee=new WeakMap,te=new WeakMap,ne=new WeakMap,ie),jE=(ge=class extends FE{constructor({scene:e,parent:t=null,components:n,options:i}){super({euid:n.euid,parent:t,local_transform:e._sanitizeComponentValue({component_name:"local_transform",value:n.local_transform})}),Gi(this,de),Gi(this,re),Gi(this,ae,new Set),Gi(this,se,new Set),Gi(this,oe,new OE),Gi(this,le,new OE),Gi(this,ce,!0),Gi(this,ue,!0),Gi(this,he,!0),Xi(this,re,e),this._mergeComponents({components:n,dispatch_event:!1}),ji(this,re)._entity_registry.add({entity:this}),i&&(void 0!==i.auto_broadcast&&(this.auto_broadcast=i.auto_broadcast),void 0!==i.auto_update&&(this.auto_update=i.auto_update))}get rtid(){return this.euid.rtid}get id(){return this.euid.value}get name(){var e;return(null==(e=this.debug_name)?void 0:e.value)??"<unnamed>"}get auto_update(){return ji(this,ce)}set auto_update(e){Xi(this,ce,e)}get auto_broadcast(){return ji(this,ue)}set auto_broadcast(e){Xi(this,ue,e),!1===e&&ji(this,re)._entity_registry._removeEntityFromBroadcastList({entity:this})}get is_visible(){return ji(this,he)}set is_visible(e){ji(this,re)._setEntityVisibility({entity_rtid:this.rtid,is_visible:e}),Xi(this,he,e)}get parent(){return super.parent}set parent(e){super.parent=e}get local_transform(){return super.local_transform}set local_transform(e){super.local_transform=e}get global_transform(){return super.global_transform}set global_transform(e){super.global_transform=e}get ls_to_ws(){return super.ls_to_ws}get ws_to_ls(){return super.ws_to_ls}get _dirty_components(){return Array.from(ji(this,ae))}get _deleted_components(){return Array.from(ji(this,se))}async getChildren(){return await ji(this,re)._getChildren({entity:this})}addScriptEventListener({event_map_id:e,event_name:t,onReceived:n,onEmitted:i}){n&&ji(this,oe).addEventListener(e+"/"+t,n),i&&ji(this,le).addEventListener(e+"/"+t,i)}removeScriptEventListener({event_map_id:e,event_name:t,onReceived:n,onEmitted:i}){n&&ji(this,oe).removeEventListener(e+"/"+t,n),i&&ji(this,le).removeEventListener(e+"/"+t,i)}async assignClientToScripts({client_uuid:e}){if(!this.script_map||!this.script_map.elements)throw new Error("Entity has no scripts");let t=Object.keys(this.script_map.elements);await Promise.all(t.map((t=>ji(this,re)._assignClientToScripts({client_uuid:e,entity_rtid:this.rtid,script_uuid:t}))))}_mergeComponents({components:e,dispatch_event:t,change_source:n}){for(let i in e){let t=i;switch(t){case"euid":break;case"local_transform":this._setLocalTransform({local_transform:e[t]});break;default:qi(this,de,fe).call(this,{component_name:t,value:e[t]})}}t&&this._dispatchEvent(new LE({change_source:n,updated_components:Object.keys(e),deleted_components:[],new_components:[]}))}_markComponentAsDirty({component_name:e}){ji(this,ae).add(e),ji(this,re)._entity_registry._addDirtyEntity({entity:this});let t=void 0===this[e];this._dispatchEvent(new LE({change_source:"local",updated_components:t?[]:[e],deleted_components:[],new_components:t?[e]:[]}))}_markComponentAsDeleted({component_name:e}){ji(this,se).add(e),ji(this,re)._entity_registry._addDirtyEntity({entity:this}),this._dispatchEvent(new LE({change_source:"local",updated_components:[],deleted_components:[e],new_components:[]}))}_clearDirtyState(){ji(this,ae).clear(),ji(this,se).clear()}_onVisibilityChanged({is_visible:e}){Xi(this,he,e),this._dispatchEvent(new DE({is_visible:e}))}_onScriptEventEmitted({scene:e,event_name:t,target_rtids:n,data_object:i}){ji(this,le)._dispatchEvent(new WE({scene:e,event_name:t,emitter_entity:this,target_rtids:n,data_object:i}))}_onScriptEventReceived({script_event_received_event:e}){ji(this,oe)._dispatchEvent(e)}_setComponentValue({ref:e,component_name:t,value:n}){if(void 0!==n||void 0!==e){if(void 0===n)return this._markComponentAsDeleted({component_name:t}),void Reflect.deleteProperty(this,`#${t}`);if("default"===n&&(n=ji(this,re)._sanitizeComponentValue({component_name:t,value:void 0})),void 0===e)return this._markComponentAsDirty({component_name:t}),qi(this,de,me).call(this,{component_name:t,value:n});if(void 0!==e)return Object.assign(e,n),e}}},re=new WeakMap,ae=new WeakMap,se=new WeakMap,oe=new WeakMap,le=new WeakMap,ce=new WeakMap,ue=new WeakMap,he=new WeakMap,de=new WeakSet,pe=function({component_name:e}){return Reflect.get(this,`#${e}`)},fe=function({component_name:e,value:t}){let n=qi(this,de,pe).call(this,{component_name:e});if(n)return void Object.assign(n,t);let i=qi(this,de,me).call(this,{component_name:e,value:t});this._unsafeSetComponentValue({component_name:e,value:i})},me=function({component_name:e,value:t}){let n=ji(this,re)._sanitizeComponentValue({component_name:e,value:t});return Reflect.set(this,`#${e}`,n),new Proxy(n,new VE(this,e))},ge),GE={"!":3,"&":2,"|":1,"^":1};function XE(e){return Object.prototype.hasOwnProperty.call(GE,e)}function qE(e,t){return GE[e]>GE[t]}var YE=(Me=class{constructor(){Gi(this,be),Gi(this,_e,new Set),Gi(this,ve,new Map),Gi(this,ye,new Map),Gi(this,xe,new Set),Gi(this,we,new Map)}add({entity:e}){let t=ji(this,ve).get(e.rtid);if(t)throw new Error(`Cannot add entity ${e.name} to the registry, because entity ${t.name} has the same RTID.`);ji(this,_e).add(e),ji(this,ve).set(e.rtid,e);let n=ji(this,ye).get(e.id);n?n.push(e):ji(this,ye).set(e.id,[e])}remove({entity:e}){if(!ji(this,ve).delete(e.rtid))throw new Error(`Trying to remove entity ${e.rtid} which has not been registred to the RTID LUT.`);let t=ji(this,ye).get(e.id);if(!t)throw new Error(`Trying to remove entity ${e.id} which has not been registered to the EUID LUT.`);let n=t.indexOf(e);if(-1==n)throw new Error(`Trying to remove entity ${e.id} which has not been registered to the EUID LUT.`);if(t.slice(n,1),0===t.length&&ji(this,ye).delete(e.id),!ji(this,_e).delete(e))throw new Error(`Trying to remove entity ${e.id} which has not been registered to the registry.`)}get({entity_rtid:e}){return ji(this,ve).get(e)??null}find({entity_euid:e}){return ji(this,ye).get(e)??[]}_addDirtyEntity({entity:e}){ji(this,xe).add(e)}_removeEntityFromBroadcastList({entity:e}){ji(this,we).delete(e)}_getEntitiesToUpdate(){let e=new Array(ji(this,xe).size),t=0;for(let n of ji(this,xe))e[t++]={entity_components:n._core,dirty_components:n._dirty_components,deleted_components:n._deleted_components},n.auto_broadcast&&qi(this,be,Ee).call(this,{entity:n}),n._clearDirtyState();return ji(this,xe).clear(),e}_getEntitiesToPersist(){let e=new Array(ji(this,we).size),t=0;for(let[n,i]of ji(this,we))e[t++]={entity_components:n._core,dirty_components:Array.from(i),deleted_components:[]};return ji(this,we).clear(),e}},_e=new WeakMap,ve=new WeakMap,ye=new WeakMap,xe=new WeakMap,we=new WeakMap,be=new WeakSet,Ee=function({entity:e}){let t=ji(this,we).get(e);if(t)for(let n of e._dirty_components)t.add(n);else ji(this,we).set(e,new Set([...e._dirty_components]))},Me),$E=(ke=class{constructor(e){Gi(this,Ae),Gi(this,Se),Hi(this,"_entity_registry",new YE),Gi(this,Te,new Map),Gi(this,Re,(e=>{let t=this._entity_registry.get({entity_rtid:e.components.euid.rtid});if(t)return t;let n=e.ancestors?ji(this,Pe).call(this,e.ancestors):null;return new jE({scene:this,parent:n,components:e.components})})),Gi(this,Pe,(e=>{let t=null;for(let n of e){let e=this._entity_registry.get({entity_rtid:n.components.euid.rtid});t=e||new jE({scene:this,parent:t,components:n.components})}return t})),Hi(this,"_onEntityVisibilityChanged",(({entity_rtid:e,is_visible:t})=>{let n=this._entity_registry.get({entity_rtid:e});n&&n._onVisibilityChanged({is_visible:t})})),Hi(this,"_onScriptEventReceived",(({emitter_rtid:e,event_name:t,target_rtids:n,data_object:i})=>{let r=this._entity_registry.get({entity_rtid:e});r&&r._onScriptEventEmitted({scene:this,event_name:t,target_rtids:n,data_object:i});let a=new HE({event_name:t,emitter_entity:r,data_object:i});for(let s of n){let e=this._entity_registry.get({entity_rtid:s});e&&e._onScriptEventReceived({script_event_received_event:a})}})),Xi(this,Se,e)}async newEntity({name:e,components:t,options:n,parent:i=null}){let r=i?{parentUUID:i.id}:void 0,a=await ji(this,Se).createEntities({components:[{debug_name:{value:e},...t,lineage:r}],delete_on_client_disconnection:(null==n?void 0:n.delete_on_client_disconnection)??!1,is_transient:!0});return new jE({scene:this,parent:i,components:a[0],options:n})}async newEntities({components_array:e,options:t}){return(await ji(this,Se).createEntities({components:e,delete_on_client_disconnection:(null==t?void 0:t.delete_on_client_disconnection)??!1,is_transient:!0})).map((e=>new jE({scene:this,parent:null,components:e,options:t})))}async findEntity({entity_uuid:e,linkage:t=[]}){let n=this._entity_registry.find({entity_euid:e}).find((e=>{var n,i,r;return((null==(i=null==(n=e.lineage)?void 0:n.value)?void 0:i.length)??0)===t.length&&((null==(r=e.lineage)?void 0:r.value)??[]).every(((e,n)=>e===t[n]))}));if(n)return n;let i=await ji(this,Se).findEntities({query:{euid:e,linkage:t},options:{include_ancestors:!0}});return 0===i.length?null:ji(this,Re).call(this,i[0])}async findEntities({entity_uuid:e}){let t=this._entity_registry.find({entity_euid:e});if(t.length>0)return t;let n=await ji(this,Se).findEntities({query:{euid:e},options:{include_ancestors:!0}});return qi(this,Ae,Ce).call(this,{entity_responses:n})}async deleteEntities({entities:e}){await ji(this,Se).deleteEntities({entity_uuids:e.map((e=>e.id))});for(let t of e)this._entity_registry.remove({entity:t})}async highlightEntities({entities:e,keep_old_selection:t=!1}){ji(this,Se).highlightEntities({highlightEntitiesMessage:{entities:e.map((e=>e.rtid)),keep_old_selection:t}})}fireEvent({event_map_id:e,event_name:t,emitter_entity:n,target_entities:i=[],data_object:r={}}){ji(this,Se).fireEvent({event_map_id:e,event_name:t,emitter_entity:n?n.rtid:0n,target_entities:i.map((e=>e.rtid)),data_object:r})}setFilter({name:e,value:t}){let n=function(e){let t=e.split(" "),n=[],i=[];for(let r of t)switch(r){case"!":case"&":case"|":case"^":for(;i.length>0;){let e=i[i.length-1];if(!XE(e)||qE(r,e))break;i.pop(),n.push(e)}i.push(r);break;case"(":i.push(r);break;case")":for(;"("!==i[i.length-1];)n.push(i.pop());i.pop();break;default:n.push(r)}for(;0!==i.length;){let e=i.pop();n.push(e)}return JSON.stringify(n)}(t);ji(this,Se).setFilter({name:e,rpn:n})}toggleFilter({name:e,enabled:t}){ji(this,Se).toggleFilter({name:e,enabled:t})}removeFilter({name:e}){ji(this,Se).removeFilter({name:e})}async findEntitiesByNames({entity_names:e}){let t=await ji(this,Se).findEntities({query:{names:e},options:{include_ancestors:!0}});return qi(this,Ae,Ce).call(this,{entity_responses:t})}async findEntitiesWithComponents({mandatory_components:e,forbidden_components:t}){let n=await ji(this,Se).findEntities({query:{mandatory_components:e,forbidden_components:t},options:{include_ancestors:!0}});return qi(this,Ae,Ce).call(this,{entity_responses:n})}async _findEntity({entity_rtid:e}){if(0n===e)return null;let t=this._entity_registry.get({entity_rtid:e});if(t)return t;let n=ji(this,Te).get(e);n||(n=ji(this,Se).findEntities({query:{rtid:e}}),ji(this,Te).set(e,n));let i=await n;return ji(this,Te).delete(e),0===i.length?null:ji(this,Re).call(this,i[0])}async _getChildren({entity:e}){return(await ji(this,Se).getChildren({entity_rtid:e.rtid})).map((t=>new jE({scene:this,parent:e,components:t})))}_assignClientToScripts({client_uuid:e,entity_rtid:t,script_uuid:n}){ji(this,Se).assignClientToScript({client_uuid:e,script_uuid:n,entity_rtid:t})}async _setEntityVisibility({entity_rtid:e,is_visible:t}){return ji(this,Se).setEntityVisibility({entity_rtid:e,is_visible:t})}_updateEntityFromEvent({entity_euid:e,updated_components:t}){let n=this._entity_registry.find({entity_euid:e});if(0!==n.length)for(let i of n)i._mergeComponents({components:t,dispatch_event:!0,change_source:"external"})}_sanitizeComponentValue({component_name:e,value:t}){return ji(this,Se).sanitizeComponentValue({component_name:e,value:t})}},Se=new WeakMap,Te=new WeakMap,Ae=new WeakSet,Ce=function({entity_responses:e}){return e.map(ji(this,Re))},Re=new WeakMap,Pe=new WeakMap,ke),KE=(Ne=class{constructor({core:e,client_info:t,client_meta_data:n}){Gi(this,Oe),Gi(this,Ie),Gi(this,Le,[]),Gi(this,De,null),Xi(this,Oe,e),Xi(this,Ie,t),this._updateFromClientMetaData({client_meta_data:n})}get id(){return ji(this,Ie).client_id}get user_id(){return ji(this,Ie).user_id}get username(){return ji(this,Ie).username}get camera_rtids(){return ji(this,Le)}get cursor_data(){return ji(this,De)}async getCameraEntities(){return(await Promise.all(ji(this,Le).map((e=>ji(this,Oe).scene._findEntity({entity_rtid:e}))))).filter((e=>null!=e))}async getHoveredEntity(){return null==ji(this,De)?null:await ji(this,Oe).scene._findEntity({entity_rtid:ji(this,De).hovered_entity_rtid})}_updateFromClientMetaData({client_meta_data:e}){Xi(this,Le,e.viewports.map((e=>e.camera_rtid))),0n!=e.hovered_entity_rtid?Xi(this,De,{hovered_entity_rtid:e.hovered_entity_rtid,hovered_ws_position:e.ws_hovered_position,hovered_ws_normal:e.ws_hovered_normal}):Xi(this,De,null)}},Oe=new WeakMap,Ie=new WeakMap,Le=new WeakMap,De=new WeakMap,Ne),ZE=class extends Event{constructor({viewports:e}){super("TO_REMOVE__viewports-added"),Hi(this,"viewports"),this.viewports=e}},QE=class extends Event{constructor({reason:e}){super("on-disconnected"),Hi(this,"reason"),this.reason=e}},JE=class extends Event{constructor({seconds_remaining:e,reset_timer:t}){super("on-inactivity-warning"),Hi(this,"seconds_remaining"),Hi(this,"resetTimer"),this.seconds_remaining=e,this.resetTimer=t}},eM=class extends Event{constructor(){super("on-activity-detected")}},tM=class extends Event{constructor({client:e}){super("on-client-joined"),Hi(this,"client"),this.client=e}},nM=class extends Event{constructor({client:e}){super("on-client-left"),Hi(this,"client"),this.client=e}},iM=(Ye=class extends OE{constructor({token:e,session_info:t,created:n}){super(),Gi(this,Ve),Hi(this,"info"),Hi(this,"has_been_created"),Hi(this,"client_id",null),Hi(this,"token"),Gi(this,Ue,null),Gi(this,Fe,null),Gi(this,ze,new Map),Gi(this,Be,new Set),Hi(this,"_onDisconnected",(e=>{this._dispatchEvent(new QE({reason:e.reason}))})),Hi(this,"_onInactivityWarning",(e=>{this._dispatchEvent(new JE({seconds_remaining:e.seconds_remaining,reset_timer:e.resetTimer}))})),Hi(this,"_onActivityDetected",(e=>{this._dispatchEvent(new eM)})),this.token=e,this.info=t,this.has_been_created=n}static async create({scene_id:e,token:t,is_transient:n}){let i=await fetch(`${mM._api_url}/sessions`,{method:"POST",body:JSON.stringify({scene_id:e,is_transient:n}),headers:{"Content-Type":"application/json",user_token:t}});if(200!==i.status)throw new Error("Error when creating session");let r=await i.json();return new Ye({token:t,session_info:{...r,scene_id:e,is_transient_session:n??!1},created:!0})}static async find({scene_id:e,token:t,session_selector:n}){let i=await(await fetch(`${mM._api_url}/sessions?filters[scene_id]=${e}`,{method:"GET",headers:{user_token:t}})).json();if(0===i.length)return null;let r=n({sessions:i});return r?new Ye({token:t,session_info:r,created:!1}):null}static async findById({session_id:e,token:t}){let n=await fetch(`${mM._api_url}/sessions/${e}`,{method:"GET",headers:{user_token:t}});if(200!=n.status)return null;let i=await n.json();return new Ye({token:t,session_info:i,created:!1})}get scene_id(){return this.info.scene_id}get session_id(){return this.info.session_id}get client_ids(){return Array.from(ji(this,ze).keys())}get clients(){return Array.from(ji(this,ze).values())}get other_clients(){return Array.from(ji(this,ze).values()).filter((e=>e.id!==this.client_id))}get current_client(){return this.client_id?ji(this,ze).get(this.client_id)??null:null}get gateway_url(){return ji(this,Ue)}get session_key(){return ji(this,Fe)}isJoinable(){return null!==ji(this,Ue)&&null!==ji(this,Fe)}async registerClient(){let e=await fetch(`${mM._api_url}/sessions/${this.session_id}/clients`,{method:"POST",headers:{user_token:this.token}}),{session_token:t,endpoint_info:n}=await e.json(),i=n.ssl_port?"wss":"ws",r=0!==n.ssl_port?n.ssl_port:n.port;Xi(this,Ue,`${i}://${n.ip}:${r}`),Xi(this,Fe,t)}async close(){if(null===this.info)throw new Error("Cannot close session as it has not been opened yet");await fetch(`${mM._api_url}/sessions/${this.session_id}`,{method:"DELETE",headers:{api_key:this.token}})}getClient({client_id:e}){return ji(this,ze).get(e)??null}async evictClient({client:e}){let t=e instanceof KE?e.id:e;return 200===(await fetch(`${mM._api_url}/sessions/${this.session_id}/clients/${t}`,{method:"DELETE",headers:{user_token:this.token}})).status}_updateClients({core:e,client_data:t}){for(let n of t){let t=n.client_id;if(ji(this,Be).has(t))continue;let i=ji(this,ze).get(t);i?qi(this,Ve,We).call(this,{client:i,client_meta_data:n}):qi(this,Ve,He).call(this,{core:e,client_meta_data:n})}qi(this,Ve,je).call(this,{client_data:t})}},Ue=new WeakMap,Fe=new WeakMap,ze=new WeakMap,Be=new WeakMap,Ve=new WeakSet,He=async function({core:e,client_meta_data:t}){if(0===t.viewports.length)return;let n=t.client_id;ji(this,Be).add(n);let i=null;try{i=await qi(this,Ve,qe).call(this,{client_id:t.client_id})}catch(a){i={client_id:n,client_type:"unknown",user_id:"",username:"unknown user"}}let r=new KE({core:e,client_info:i,client_meta_data:t});qi(this,Ve,Ge).call(this,{client:r}),ji(this,Be).delete(n)},We=function({client:e,client_meta_data:t}){e._updateFromClientMetaData({client_meta_data:t})},je=function({client_data:e}){let t=e.map((e=>e.client_id));for(let[n]of ji(this,ze))t.includes(n)||qi(this,Ve,Xe).call(this,{client_id:n})},Ge=function({client:e}){ji(this,ze).set(e.id,e),e.id!==this.client_id&&this._dispatchEvent(new tM({client:e}))},Xe=function({client_id:e}){let t=this.getClient({client_id:e});t&&(ji(this,ze).delete(e),this._dispatchEvent(new nM({client:t})))},qe=async function({client_id:e}){return await(await fetch(`${mM._api_url}/sessions/${this.session_id}/clients/${e}`,{method:"GET",headers:{user_token:this.token}})).json()},Ye),rM=(st=class{constructor(e){Gi(this,nt),Gi(this,$e),Gi(this,Ke,!1),Gi(this,Ze,{x:0,y:0}),Gi(this,Qe,new Map),Gi(this,Je,(({viewport:e,event:t})=>{if(t.button>2)return;t.stopPropagation();let n=qi(this,nt,it).call(this,t),i=qi(this,nt,at).call(this,{viewport:e,x:n.x,y:n.y});ji(this,$e)._sendInput({input_state:{input_operation:["lbutton_down","mbutton_down","rbutton_down"][t.button],input_data:i}})})),Gi(this,et,(({viewport:e,event:t})=>{if(t.button>2)return;t.stopPropagation();let n=qi(this,nt,it).call(this,t),i=qi(this,nt,at).call(this,{viewport:e,x:n.x,y:n.y});ji(this,$e)._sendInput({input_state:{input_operation:["lbutton_up","mbutton_up","rbutton_up"][t.button],input_data:i}})})),Gi(this,tt,(({viewport:e,event:t})=>{t.stopPropagation();let n=qi(this,nt,it).call(this,t),i=qi(this,nt,at).call(this,{viewport:e,x:n.x,y:n.y});ji(this,$e)._sendInput({input_state:{input_operation:"mouse_move",input_data:i}})})),Gi(this,rt,(()=>{let e=Array.from(ji(this,Qe).values());Xi(this,Ke,e.some((e=>document.pointerLockElement===e.dom_element)))})),Xi(this,$e,e),document.addEventListener("pointerlockchange",ji(this,rt))}enableOnViewport({viewport:e}){let t=ji(this,Qe).get(e);if(t)return void t.ref_count++;let n=e.dom_element,i=new AbortController;n.addEventListener("mousedown",(t=>ji(this,Je).call(this,{viewport:e,event:t})),{signal:i.signal}),n.addEventListener("mouseup",(t=>ji(this,et).call(this,{viewport:e,event:t})),{signal:i.signal}),n.addEventListener("mousemove",(t=>ji(this,tt).call(this,{viewport:e,event:t})),{signal:i.signal}),ji(this,Qe).set(e,{dom_element:n,abort_controller:i,ref_count:1})}disableFromViewport({viewport:e}){let t=ji(this,Qe).get(e);t&&(--t.ref_count>0||(t.abort_controller.abort(),ji(this,Qe).delete(e)))}},$e=new WeakMap,Ke=new WeakMap,Ze=new WeakMap,Qe=new WeakMap,Je=new WeakMap,et=new WeakMap,tt=new WeakMap,nt=new WeakSet,it=function(e){let t=e;return ji(this,Ke)?(ji(this,Ze).x+=t.movementX,ji(this,Ze).y+=t.movementY):(ji(this,Ze).x=t.clientX,ji(this,Ze).y=t.clientY),ji(this,Ze)},rt=new WeakMap,at=function({viewport:e,x:t,y:n,bufferSize:i=8}){let r=new ArrayBuffer(i),a=new DataView(r),[s,o]=ji(this,$e)._projectViewportPositionOnRemoteFrame({viewport:e,position:[t,n]});return a.setFloat32(0,s,!0),a.setFloat32(4,o,!0),new Uint8Array(r)},st),aM=(ft=class{constructor(e){Gi(this,ht),Gi(this,ot),Gi(this,lt,(e=>{e.preventDefault();let t=qi(this,ht,dt).call(this,e);ji(this,ot)._sendInput({input_state:{input_operation:"on_key_down",input_data:t}})})),Gi(this,ct,(e=>{e.preventDefault();let t=qi(this,ht,dt).call(this,e);ji(this,ot)._sendInput({input_state:{input_operation:"on_key_up",input_data:t}})})),Gi(this,ut,(()=>{ji(this,ot)._sendInput({input_state:{input_operation:"reset"}})})),Xi(this,ot,e)}enable(){window.addEventListener("keydown",ji(this,lt)),window.addEventListener("keyup",ji(this,ct)),window.addEventListener("blur",ji(this,ut))}disable(){window.removeEventListener("keydown",ji(this,lt)),window.removeEventListener("keyup",ji(this,ct)),window.removeEventListener("blur",ji(this,ut)),ji(this,ut).call(this)}},ot=new WeakMap,lt=new WeakMap,ct=new WeakMap,ut=new WeakMap,ht=new WeakSet,dt=function(e){let t=qi(this,ht,pt).call(this,e),n=new Uint8Array(4);return n[0]=255&t,n[1]=t>>8&255,n[2]=t>>16&255,n[3]=t>>24&255,n},pt=function(e){let{code:t,key:n}=e;if(!(null==t?void 0:t.startsWith("Key")))return e.keyCode;let i=t[t.length-1];return i!==n?i.charCodeAt(0):e.keyCode},ft),sM=[4,8,16,32,1024,2048,0,0,2,1,4096,8192,64,128,256,512],oM=0,lM=1,cM=2,uM=3,hM=4,dM=5;function pM(e){let t=0;for(let n in sM)e.buttons[n].pressed&&(t|=sM[n]);return t}var fM=(Tt=class{constructor(e){Gi(this,wt),Gi(this,mt),Gi(this,gt,[]),Gi(this,_t,null),Gi(this,vt,(()=>{ji(this,_t)||ji(this,yt).call(this)})),Gi(this,yt,(()=>{let e=ji(this,xt).call(this);if(window.document.hasFocus())e.forEach(((e,t)=>{let n=ji(this,gt)[t];n&&e&&ji(this,Mt).call(this,t,n,e),ji(this,gt)[t]=e})),Xi(this,_t,requestAnimationFrame(ji(this,yt)));else{Xi(this,_t,null);for(let t=0;t<e.length;t++)ji(this,St).call(this,t)}})),Gi(this,xt,(()=>{let e=navigator.getGamepads(),t=[];for(let n of e)n&&(t[n.index]={buttons:pM(n),leftTrigger:n.buttons[6].value,rightTrigger:n.buttons[7].value,leftThumbstickX:-n.axes[0],leftThumbstickY:n.axes[1],rightThumbstickX:-n.axes[2],rightThumbstickY:n.axes[3]});return t})),Gi(this,Mt,((e,t,n)=>{n.leftThumbstickX!=t.leftThumbstickX&&qi(this,wt,bt).call(this,0,oM,n.leftThumbstickX),n.leftThumbstickY!=t.leftThumbstickY&&qi(this,wt,bt).call(this,0,lM,n.leftThumbstickY),n.rightThumbstickX!=t.rightThumbstickX&&qi(this,wt,bt).call(this,0,cM,n.rightThumbstickX),n.rightThumbstickY!=t.rightThumbstickY&&qi(this,wt,bt).call(this,0,uM,n.rightThumbstickY),n.leftTrigger!=t.leftTrigger&&qi(this,wt,bt).call(this,0,hM,n.leftTrigger),n.rightTrigger!=t.rightTrigger&&qi(this,wt,bt).call(this,0,dM,n.rightTrigger),n.buttons!=t.buttons&&qi(this,wt,Et).call(this,0,n.buttons)})),Gi(this,St,(e=>{qi(this,wt,bt).call(this,e,oM,0),qi(this,wt,bt).call(this,e,lM,0),qi(this,wt,bt).call(this,e,cM,0),qi(this,wt,bt).call(this,e,uM,0),qi(this,wt,bt).call(this,e,hM,0),qi(this,wt,bt).call(this,e,dM,0),qi(this,wt,Et).call(this,e,0)})),Xi(this,mt,e)}enable(){ji(this,yt).call(this),window.addEventListener("focus",ji(this,vt))}disable(){ji(this,_t)&&(cancelAnimationFrame(ji(this,_t)),Xi(this,_t,null)),window.removeEventListener("focus",ji(this,vt))}},mt=new WeakMap,gt=new WeakMap,_t=new WeakMap,vt=new WeakMap,yt=new WeakMap,xt=new WeakMap,wt=new WeakSet,bt=function(e,t,n){let i=new ArrayBuffer(6),r=new DataView(i);r.setUint8(0,e),r.setUint8(1,t),r.setFloat32(2,n,!0),ji(this,mt)._sendInput({input_state:{input_operation:"gamepad_axis",input_data:new Uint8Array(i)}})},Et=function(e,t){let n=new ArrayBuffer(5),i=new DataView(n);i.setUint8(0,e),i.setUint16(1,t,!0),ji(this,mt)._sendInput({input_state:{input_operation:"gamepad_buttons",input_data:new Uint8Array(n)}})},Mt=new WeakMap,St=new WeakMap,Tt),mM=(Rt=class{constructor({session:e}){Gi(this,zt),Gi(this,At,null),Gi(this,Ct,null),Hi(this,"session"),Hi(this,"scene"),Gi(this,Pt),Gi(this,kt,null),Gi(this,Ot,new xy(this)),Gi(this,It,null),Gi(this,Lt),Gi(this,Dt),Gi(this,Nt),Gi(this,Ut,0),Gi(this,Ft,0),Gi(this,Wt,(e=>{this.session._updateClients({core:this,client_data:e.meta_data.clients});let t=function({raw_frame_meta_data:e,client_id:t,entity_registry:n,viewports:i}){let r={renderer_timestamp:e.renderer_timestamp,frame_counter:e.frame_counter,viewport_layout_camera_entities:[],other_clients_camera_entities:[]};for(let a of e.clients){let e=a.client_id===t;for(let t of a.viewports){let a=n.get({entity_rtid:t.camera_rtid});if(!a)continue;let s=i.find((e=>{var t;return(null==(t=e.camera_projection)?void 0:t.camera_entity.rtid)===a.rtid}));e?s&&r.viewport_layout_camera_entities.push({camera_entity:a,world_from_view_matrix:t.ws_from_ls,world_position:vy(t.ws_from_ls),world_orientation:yy(t.ws_from_ls),viewport:s}):s&&s.is_camera_controlled_by_current_client||r.other_clients_camera_entities.push({camera_entity:a,world_from_view_matrix:t.ws_from_ls,world_position:vy(t.ws_from_ls),world_orientation:yy(t.ws_from_ls)})}}return r}({raw_frame_meta_data:e.meta_data,client_id:this.session.client_id,entity_registry:this.scene._entity_registry,viewports:this.viewports});ji(this,It).consumeEncodedFrame({encoded_frame:e.encoded_frame,meta_data:t})})),Gi(this,jt,(({updated_entities:e})=>{for(let{entity_euid:t,updated_components:n}of e)this.scene._updateEntityFromEvent({entity_euid:t,updated_components:n})})),this.session=e,Xi(this,Pt,new _y.Core),this.scene=new $E(ji(this,Pt)),Xi(this,Lt,new rM(this)),Xi(this,Dt,new aM(this)),Xi(this,Nt,new fM(this))}TO_REMOVE__setReadyCallback(e){Xi(this,At,e)}TO_REMOVE__startIfReady(){this.isConfigured()&&(this.viewports.some((e=>!e.TO_REMOVE__ready))||ji(this,At)&&(ji(this,At).call(this),Xi(this,At,null)))}static async start({scene_id:e,token:t,is_transient:n}){let i=await iM.create({scene_id:e,token:t,is_transient:n});return await Rt.join({session:i})}static async join_or_start({scene_id:e,token:t,session_selector:n=({sessions:e})=>e[0],is_transient:i}){let r=await iM.find({scene_id:e,token:t,session_selector:n});if(null===r)return await Rt.start({scene_id:e,token:t,is_transient:i});try{return await Rt.join({session:r})}catch{return await Rt.join_or_start({scene_id:e,token:t,session_selector:({sessions:e})=>(e=e.filter((e=>e.session_id!==r.session_id)),0===e.length?null:n({sessions:e}))})}}static async join({session:e}){var t;return await _y.load(),qi(t=new Rt({session:e}),zt,Bt).call(t)}get default_decoded_frame_consumer(){return ji(this,Ot)}get activity_watcher(){return ji(this,Pt).activity_watcher}get latency(){return ji(this,Pt).latency}get viewports(){return ji(this,Ot).viewports}async disconnect(){qi(this,zt,Ht).call(this),0!==ji(this,Ut)&&clearInterval(ji(this,Ut)),0!==ji(this,Ft)&&clearInterval(ji(this,Ft)),null!==ji(this,It)&&ji(this,It).release(),await this.session.close(),ji(this,Ot).release(),await ji(this,Pt).disconnect()}addViewports({viewports:e}){ji(this,Ot).addViewports({viewports:e}),this.session._dispatchEvent(new ZE({viewports:e}))}removeViewport({viewport:e}){ji(this,Ot).removeViewport({viewport:e})}async configureRemoteServer({codec:e="h264"}){let t={remote_canvas_size:ji(this,Ot)._computeRemoteCanvasSize({codec:e}),encoder_config:{codec:e,profile:"main",frame_rate:60,lossy:!0},supported_devices:{keyboard:!0,mouse:!0,gamepad:!0,hololens:!1,touchscreen:!1}};ji(this,Ot).dimensions;let n=await ji(this,Pt).configureClient({client_config:t});return Xi(this,kt,n.codec),n}isConfigured(){return null!==ji(this,kt)}async setEncodedFrameConsumer({encoded_frame_consumer:e}){if(null===ji(this,kt))throw new Error("Client not configured.");Xi(this,It,await e.configure({codec:ji(this,kt),frame_dimensions:ji(this,Ot).dimensions}))}startStreaming(){if(!this.isConfigured())throw new Error("The Livelink instance is not configured yet");ji(this,Ot).init(),ji(this,Pt).resume(),qi(this,zt,Gt).call(this,{})}startSimulation(){ji(this,Pt).setSimulationState({state:"start_simulation"})}pauseSimulation(){ji(this,Pt).setSimulationState({state:"pause_simulation"})}stopSimulation(){ji(this,Pt).setSimulationState({state:"stop_simulation"})}sendSkeletonPose({controller:e,partial_pose:t}){ji(this,Pt).sendSkeletonPose({controller_rtid:e.rtid,partial_pose:t})}get devices(){return{mouse:ji(this,Lt),keyboard:ji(this,Dt),gamepad:ji(this,Nt)}}async configureHeadlessClient(){let e=await ji(this,Pt).configureClient({client_config:{remote_canvas_size:[8,8],encoder_config:{codec:"h264",profile:"main",frame_rate:30,lossy:!0},supported_devices:{keyboard:!0,mouse:!1,gamepad:!1,hololens:!1,touchscreen:!1}}});return Xi(this,kt,e.codec),e}_sendInput({input_state:e}){ji(this,Pt).sendInputState({input_state:e})}async _resize({size:e}){var t;let{size:n}=await ji(this,Pt).resize({size:e});null==(t=ji(this,It))||t.resize({frame_dimensions:n})}_setViewports({viewport_configs:e}){ji(this,Pt).setViewports({viewport_configs:e})}async _castScreenSpaceRay({screenSpaceRayQuery:e}){return ji(this,Pt).castScreenSpaceRay({screenSpaceRayQuery:e})}_refreshViewports(){ji(this,At)||(null!==ji(this,Ct)&&clearTimeout(ji(this,Ct)),Xi(this,Ct,setTimeout((()=>{ji(this,Ot).init()}),0)))}_projectViewportPositionOnRemoteFrame({viewport:e,position:t}){let n=ji(this,Ot).width,i=ji(this,Ot).height,r=e._getScreenPosition({position:t}),a=[e.rendering_surface.offset[0]+e.offset[0],e.rendering_surface.offset[1]+e.offset[1]];return[(a[0]+r[0]*e.width)/n,(a[1]+r[1]*e.height)/i]}},At=new WeakMap,Ct=new WeakMap,Pt=new WeakMap,kt=new WeakMap,Ot=new WeakMap,It=new WeakMap,Lt=new WeakMap,Dt=new WeakMap,Nt=new WeakMap,Ut=new WeakMap,Ft=new WeakMap,zt=new WeakSet,Bt=async function(){return await this.session.registerClient(),await ji(this,Pt).connect({session:this.session,editor_url:Rt._editor_url}),qi(this,zt,Vt).call(this),this},Vt=function(){ji(this,Pt).addEventListener("on-disconnected",this.session._onDisconnected),ji(this,Pt).addEventListener("on-inactivity-warning",this.session._onInactivityWarning),ji(this,Pt).addEventListener("on-activity-detected",this.session._onActivityDetected),ji(this,Pt).addEventListener("on-frame-received",ji(this,Wt)),ji(this,Pt).addEventListener("on-entities-updated",ji(this,jt)),ji(this,Pt).addEventListener("on-entity-visibility-changed",this.scene._onEntityVisibilityChanged),ji(this,Pt).addEventListener("on-script-event-received",this.scene._onScriptEventReceived)},Ht=function(){ji(this,Pt).removeEventListener("on-disconnected",this.session._onDisconnected),ji(this,Pt).removeEventListener("on-inactivity-warning",this.session._onInactivityWarning),ji(this,Pt).removeEventListener("on-activity-detected",this.session._onActivityDetected),ji(this,Pt).removeEventListener("on-frame-received",ji(this,Wt)),ji(this,Pt).removeEventListener("on-entities-updated",ji(this,jt)),ji(this,Pt).removeEventListener("on-entity-visibility-changed",this.scene._onEntityVisibilityChanged),ji(this,Pt).removeEventListener("on-script-event-received",this.scene._onScriptEventReceived)},Wt=new WeakMap,jt=new WeakMap,Gt=function({updatesPerSecond:e=30,broadcastsPerSecond:t=1}){Xi(this,Ut,setInterval((()=>{let e=this.scene._entity_registry._getEntitiesToUpdate();e.length>0&&ji(this,Pt).updateEntities({update_commands:e,persist:!1})}),1e3/e)),Xi(this,Ft,setInterval((()=>{let e=this.scene._entity_registry._getEntitiesToPersist();e.length>0&&ji(this,Pt).updateEntities({update_commands:e,persist:!0})}),1e3/t))},Hi(Rt,"_api_url","https://api.3dverse.com/app/v1"),Hi(Rt,"_editor_url","wss://api.3dverse.com/editor-backend"),Rt),gM=(Yt=class{constructor({left:e=0,top:t=0,right:n,bottom:i,width:r,height:a}){Gi(this,Xt),Hi(this,"left"),Hi(this,"top"),Hi(this,"right"),Hi(this,"bottom"),Hi(this,"width"),Hi(this,"height"),qi(this,Xt,qt).call(this,{left:e,top:t,right:n,bottom:i,width:r,height:a}),this.left=e,this.top=t,this.right=void 0!==n?n:e+r,this.bottom=void 0!==i?i:t+a,this.width=void 0!==r?r:n-e,this.height=void 0!==a?a:i-t}},Xt=new WeakSet,qt=function({left:e=0,top:t=0,right:n,bottom:i,width:r,height:a}){return!(e<0||t<0||void 0!==n&&n<0||void 0!==i&&i<0||void 0!==r&&r<0||void 0!==a&&a<0||void 0===n&&void 0===r||void 0===i&&void 0===a||void 0!==n&&e>=n||void 0!==i&&t>=i||void 0!==r&&void 0!==n&&e+r!==n||void 0!==a&&void 0!==i&&t+a!==i)},Yt),_M=class extends Error{constructor(e){super(`Element has an invalid size : [${e.width} x ${e.height}]`),Hi(this,"rect"),this.rect=e}},vM=class extends Error{constructor(e,t){super("Element MUST be contained into its parent bounds."),Hi(this,"rect"),Hi(this,"parentRect"),this.rect=e,this.parentRect=t}},yM=(Zt=class extends gM{constructor({left:e=0,top:t=0,right:n,bottom:i,width:r=1,height:a=1}){super({left:e,top:t,right:n,bottom:i,width:r,height:a}),Gi(this,$t),qi(this,$t,Kt).call(this)}static from_dom_elements({element:e,parent:t}){let n=e.getBoundingClientRect(),i=t.getBoundingClientRect();if(!n.width||!n.height)throw new _M(n);let r=n.left-i.left,a=n.top-i.top;if(r<0||a<0||r+n.width>i.left+i.width||a+n.height>i.top+i.height)throw new vM(n,i);return new Zt({left:parseFloat((r/i.width).toPrecision(6)),top:parseFloat((a/i.height).toPrecision(6)),width:parseFloat((n.width/i.width).toPrecision(6)),height:parseFloat((n.height/i.height).toPrecision(6))})}},$t=new WeakSet,Kt=function(){return this.left<1&&this.top<1&&this.right<=1&&this.bottom<=1&&this.width<=1&&this.height<=1},Zt),xM=class extends Event{constructor({hovered_entity:e,ws_position:t,ws_normal:n}){super("on-entity-hovered"),Hi(this,"hovered_entity"),Hi(this,"ws_position"),Hi(this,"ws_normal"),this.hovered_entity=e,this.ws_position=t,this.ws_normal=n}},wM=class extends Event{constructor({picked_entity:e,ws_position:t,ws_normal:n}){super("on-entity-picked"),Hi(this,"picked_entity"),Hi(this,"ws_position"),Hi(this,"ws_normal"),this.picked_entity=e,this.ws_position=t,this.ws_normal=n}},bM=(pn=class extends OE{constructor({core:e,rendering_surface:t,options:n}){super(),Gi(this,Qt),Hi(this,"TO_REMOVE__ready",!1),Gi(this,en),Gi(this,tn),Gi(this,nn,[]),Gi(this,rn,null),Gi(this,an,null),Gi(this,sn,0),Gi(this,on),Gi(this,ln,-1),Gi(this,cn,!1),Gi(this,un,!1),Hi(this,"is_camera_controlled_by_current_client",!1),Gi(this,hn,(async e=>{var t;e.stopPropagation();let n=null,i=null==(t=ji(this,en).session.current_client)?void 0:t.cursor_data;if(i){let e=await ji(this,en).scene._findEntity({entity_rtid:i.hovered_entity_rtid});e&&(n={entity:e,ws_position:i.hovered_ws_position,ws_normal:i.hovered_ws_normal})}this._dispatchEvent(new wM({picked_entity:(null==n?void 0:n.entity)??null,ws_position:(null==n?void 0:n.ws_position)??null,ws_normal:(null==n?void 0:n.ws_normal)??null}))})),Gi(this,dn,(async()=>{var e;let t=null,n=null==(e=ji(this,en).session.current_client)?void 0:e.cursor_data;if(n){let e=await ji(this,en).scene._findEntity({entity_rtid:n.hovered_entity_rtid});e&&(t={entity:e,ws_position:n.hovered_ws_position,ws_normal:n.hovered_ws_normal})}this._dispatchEvent(new xM({hovered_entity:(null==t?void 0:t.entity)??null,ws_position:(null==t?void 0:t.ws_position)??null,ws_normal:(null==t?void 0:t.ws_normal)??null}))})),Xi(this,en,e),Xi(this,tn,t),Xi(this,on,new yM((null==n?void 0:n.rect)??{left:0,top:0,width:1,height:1})),Xi(this,ln,(null==n?void 0:n.render_target_index)??-1),Xi(this,sn,(null==n?void 0:n.z_index)??0),Xi(this,rn,(null==n?void 0:n.dom_element)??null)}get rendering_surface(){return ji(this,tn)}get camera_projection(){return ji(this,an)}get width(){return ji(this,on).width*this.rendering_surface.width}get height(){return ji(this,on).height*this.rendering_surface.height}get offset(){return[ji(this,on).left*this.rendering_surface.width,ji(this,on).top*this.rendering_surface.height]}get aspect_ratio(){return this.height>0?this.width/this.height:1}get z_index(){return ji(this,sn)}get render_target_index(){return ji(this,ln)}get relative_rect(){return ji(this,on)}get dom_element(){if(!ji(this,rn))throw new Error("No DOM element set on viewport");return ji(this,rn)}set z_index(e){Xi(this,sn,e),ji(this,en)._refreshViewports()}set relative_rect(e){Xi(this,on,e),ji(this,en)._refreshViewports()}set camera_projection(e){Xi(this,an,e),ji(this,en)._refreshViewports(),qi(this,Qt,Jt).call(this)}set render_target_index(e){Xi(this,ln,e),ji(this,en)._refreshViewports()}isValid(){return null!==ji(this,an)}release(){this.deactivatePicking(),this.deactivateHovering()}activatePicking(){ji(this,cn)||(this.dom_element.addEventListener("click",ji(this,hn)),ji(this,en).devices.mouse.enableOnViewport({viewport:this}),Xi(this,cn,!0))}deactivatePicking(){ji(this,cn)&&(this.dom_element.removeEventListener("click",ji(this,hn)),ji(this,en).devices.mouse.disableFromViewport({viewport:this}),Xi(this,cn,!1))}activateHovering(){ji(this,un)||(this.dom_element.addEventListener("pointermove",ji(this,dn)),ji(this,en).devices.mouse.enableOnViewport({viewport:this}),Xi(this,un,!0))}deactivateHovering(){ji(this,un)&&(this.dom_element.removeEventListener("pointermove",ji(this,dn)),ji(this,en).devices.mouse.disableFromViewport({viewport:this}),Xi(this,un,!1))}async castScreenSpaceRay({screen_position:e,mode:t="None"}){if(!ji(this,an))return null;let n=await ji(this,en)._castScreenSpaceRay({screenSpaceRayQuery:{camera_rtid:ji(this,an).camera_entity.rtid,pos:e,mode:t}});if(null===n.entity_rtid)return null;let i=await ji(this,en).scene._findEntity({entity_rtid:n.entity_rtid});return null===i?null:{entity:i,world_position:n.position,world_normal:n.normal}}projectWorldToScreen({world_position:e,out_screen_position:t=ow.create()}){if(!ji(this,an))throw new Error("No camera set on viewport");let n=ji(this,an).projectWorldToClip({world_position:e,out_clip_position:t}),i=n;return i[0]=(n[0]+1)*this.width*.5,i[1]=(1-n[1])*this.height*.5,i}addOverlay({overlay:e}){ji(this,nn).includes(e)||(ji(this,nn).push(e),this.rendering_surface.redrawLastFrame())}removeOverlay({overlay:e}){e.release();let t=ji(this,nn).indexOf(e);-1!==t&&(ji(this,nn).splice(t,1),this.rendering_surface.redrawLastFrame())}_drawOverlays(){let e=null;for(let t of ji(this,nn)){let n=t.draw({output_canvas:e});e||(e=n)}return e}_onResize(){var e;null==(e=this.camera_projection)||e.updateProjectionMatrix();for(let t of ji(this,nn))t.resize({width:this.width,height:this.height})}getScreenPositionFromEvent({event:e}){return this._getScreenPosition({position:[e.clientX,e.clientY]})}_getScreenPosition({position:e}){let t=this.dom_element.getBoundingClientRect();return[(e[0]-t.left)/t.width,(e[1]-t.top)/t.height]}},Qt=new WeakSet,Jt=function(){this.TO_REMOVE__ready=!0,ji(this,en).TO_REMOVE__startIfReady()},en=new WeakMap,tn=new WeakMap,nn=new WeakMap,rn=new WeakMap,an=new WeakMap,sn=new WeakMap,on=new WeakMap,ln=new WeakMap,cn=new WeakMap,un=new WeakMap,hn=new WeakMap,dn=new WeakMap,pn),EM=class e{constructor(t=0,n=0){e.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}rotateAround(e,t){let n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};function MM(e,t,n){return Math.max(t,Math.min(n,e))}var SM=class{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,a,s){let o=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3],h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||o!==h||l!==d||c!==p){let e=1-s,t=o*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){let r=Math.sqrt(i),a=Math.atan2(r,t*n);e=Math.sin(e*a)/r,s=Math.sin(s*a)/r}let r=s*n;if(o=o*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-s){let e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,a){let s=n[i],o=n[i+1],l=n[i+2],c=n[i+3],u=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return e[t]=s*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-o*u,e[t+3]=c*p-s*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let n=e._x,i=e._y,r=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),h=o(n/2),d=o(i/2),p=o(r/2);switch(a){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){let e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(a-i)*e}else if(n>s&&n>u){let e=2*Math.sqrt(1+n-s-u);this._w=(c-o)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(r+l)/e}else if(s>u){let e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(o+c)/e}else{let e=2*Math.sqrt(1+u-n-s);this._w=(a-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(MM(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(0===n)return this;let i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,i=e._y,r=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+a*s+i*l-r*o,this._y=i*c+a*o+r*s-n*l,this._z=r*c+a*l+n*o-i*s,this._w=a*c-n*s-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let n=this._x,i=this._y,r=this._z,a=this._w,s=a*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;let o=1-s*s;if(o<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=a*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){let e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},TM=class e{constructor(t=0,n=0,i=0){e.prototype.isVector3=!0,this.x=t,this.y=n,this.z=i}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(CM.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(CM.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(e){let t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,s=e.z,o=e.w,l=o*t+a*i-s*n,c=o*n+s*t-r*i,u=o*i+r*n-a*t,h=-r*t-a*n-s*i;return this.x=l*o+h*-r+c*-s-u*-a,this.y=c*o+h*-a+u*-r-l*-s,this.z=u*o+h*-s+l*-a-c*-r,this}transformDirection(e){let t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,i=e.y,r=e.z,a=t.x,s=t.y,o=t.z;return this.x=i*o-r*s,this.y=r*a-n*o,this.z=n*s-i*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return AM.copy(this).projectOnVector(e),this.sub(AM)}reflect(e){return this.sub(AM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(MM(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},AM=new TM,CM=new SM,RM=class{constructor(e=new TM(1/0,1/0,1/0),t=new TM(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,s=-1/0;for(let o=0,l=e.length;o<l;o+=3){let l=e[o],c=e[o+1],u=e[o+2];l<t&&(t=l),c<n&&(n=c),u<i&&(i=u),l>r&&(r=l),c>a&&(a=c),u>s&&(s=u)}return this.min.set(t,n,i),this.max.set(r,a,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=kM.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e=new TM){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e=new TM){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,kM),kM.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(FM),zM.subVectors(this.max,FM),OM.subVectors(e.a,FM),IM.subVectors(e.b,FM),LM.subVectors(e.c,FM),DM.subVectors(IM,OM),NM.subVectors(LM,IM),UM.subVectors(OM,LM);let t=[0,-DM.z,DM.y,0,-NM.z,NM.y,0,-UM.z,UM.y,DM.z,0,-DM.x,NM.z,0,-NM.x,UM.z,0,-UM.x,-DM.y,DM.x,0,-NM.y,NM.x,0,-UM.y,UM.x,0];return!(!HM(t,OM,IM,LM,zM)||(t=[1,0,0,0,1,0,0,0,1],!HM(t,OM,IM,LM,zM)))&&(BM.crossVectors(DM,NM),t=[BM.x,BM.y,BM.z],HM(t,OM,IM,LM,zM))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return kM.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(kM).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(PM[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),PM[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),PM[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),PM[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),PM[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),PM[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),PM[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),PM[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(PM)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},PM=[new TM,new TM,new TM,new TM,new TM,new TM,new TM,new TM],kM=new TM,OM=new TM,IM=new TM,LM=new TM,DM=new TM,NM=new TM,UM=new TM,FM=new TM,zM=new TM,BM=new TM,VM=new TM;function HM(e,t,n,i,r){for(let a=0,s=e.length-3;a<=s;a+=3){VM.fromArray(e,a);let s=r.x*Math.abs(VM.x)+r.y*Math.abs(VM.y)+r.z*Math.abs(VM.z),o=t.dot(VM),l=n.dot(VM),c=i.dot(VM);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}var WM=class e{constructor(){e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new e).fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,i=1/jM.setFromMatrixColumn(e,0).length(),r=1/jM.setFromMatrixColumn(e,1).length(),a=1/jM.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),s=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){let e=a*c,n=a*u,i=s*c,r=s*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=a*o}else if("YXZ"===e.order){let e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=a*o}else if("ZXY"===e.order){let e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-a*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=a*c,t[9]=r-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){let e=a*c,n=a*u,i=s*c,r=s*u;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){let e=a*o,n=a*l,i=s*o,r=s*l;t[0]=o*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){let e=a*o,n=a*l,i=s*o,r=s*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=a*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(XM,e,qM)}lookAt(e,t,n){let i=this.elements;return KM.subVectors(e,t),0===KM.lengthSq()&&(KM.z=1),KM.normalize(),YM.crossVectors(n,KM),0===YM.lengthSq()&&(1===Math.abs(n.z)?KM.x+=1e-4:KM.z+=1e-4,KM.normalize(),YM.crossVectors(n,KM)),YM.normalize(),$M.crossVectors(KM,YM),i[0]=YM.x,i[4]=$M.x,i[8]=KM.x,i[1]=YM.y,i[5]=$M.y,i[9]=KM.y,i[2]=YM.z,i[6]=$M.z,i[10]=KM.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,i=t.elements,r=this.elements,a=n[0],s=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],x=n[15],w=i[0],b=i[4],E=i[8],M=i[12],S=i[1],T=i[5],A=i[9],C=i[13],R=i[2],P=i[6],k=i[10],O=i[14],I=i[3],L=i[7],D=i[11],N=i[15];return r[0]=a*w+s*S+o*R+l*I,r[4]=a*b+s*T+o*P+l*L,r[8]=a*E+s*A+o*k+l*D,r[12]=a*M+s*C+o*O+l*N,r[1]=c*w+u*S+h*R+d*I,r[5]=c*b+u*T+h*P+d*L,r[9]=c*E+u*A+h*k+d*D,r[13]=c*M+u*C+h*O+d*N,r[2]=p*w+f*S+m*R+g*I,r[6]=p*b+f*T+m*P+g*L,r[10]=p*E+f*A+m*k+g*D,r[14]=p*M+f*C+m*O+g*N,r[3]=_*w+v*S+y*R+x*I,r[7]=_*b+v*T+y*P+x*L,r[11]=_*E+v*A+y*k+x*D,r[15]=_*M+v*C+y*O+x*N,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*o*u-i*l*u-r*s*h+n*l*h+i*s*d-n*o*d)+e[7]*(+t*o*d-t*l*h+r*a*h-i*a*d+i*l*c-r*o*c)+e[11]*(+t*l*u-t*s*d-r*a*u+n*a*d+r*s*c-n*l*c)+e[15]*(-i*s*c-t*o*u+t*s*h+i*a*u-n*a*h+n*o*c)}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,n){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*h*l+f*o*d-s*m*d-u*o*g+s*h*g,v=p*h*l-c*m*l-p*o*d+a*m*d+c*o*g-a*h*g,y=c*f*l-p*u*l+p*s*d-a*f*d-c*s*g+a*u*g,x=p*u*o-c*f*o-p*s*h+a*f*h+c*s*m-a*u*m,w=t*_+n*v+i*y+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let b=1/w;return e[0]=_*b,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*b,e[2]=(s*m*r-f*o*r+f*i*l-n*m*l-s*i*g+n*o*g)*b,e[3]=(u*o*r-s*h*r-u*i*l+n*h*l+s*i*d-n*o*d)*b,e[4]=v*b,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*b,e[6]=(p*o*r-a*m*r-p*i*l+t*m*l+a*i*g-t*o*g)*b,e[7]=(a*h*r-c*o*r+c*i*l-t*h*l-a*i*d+t*o*d)*b,e[8]=y*b,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*b,e[10]=(a*f*r-p*s*r+p*n*l-t*f*l-a*n*g+t*s*g)*b,e[11]=(c*s*r-a*u*r-c*n*l+t*u*l+a*n*d-t*s*d)*b,e[12]=x*b,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*b,e[14]=(p*s*i-a*f*i-p*n*o+t*f*o+a*n*m-t*s*m)*b,e[15]=(a*u*i-c*s*i+c*n*o-t*u*o-a*n*h+t*s*h)*b,this}scale(e){let t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,s=e.y,o=e.z,l=r*a,c=r*s;return this.set(l*a+n,l*s-i*o,l*o+i*s,0,l*s+i*o,c*s+n,c*o-i*a,0,l*o-i*s,c*o+i*a,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){let i=this.elements,r=t._x,a=t._y,s=t._z,o=t._w,l=r+r,c=a+a,u=s+s,h=r*l,d=r*c,p=r*u,f=a*c,m=a*u,g=s*u,_=o*l,v=o*c,y=o*u,x=n.x,w=n.y,b=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+y)*x,i[2]=(p-v)*x,i[3]=0,i[4]=(d-y)*w,i[5]=(1-(h+g))*w,i[6]=(m+_)*w,i[7]=0,i[8]=(p+v)*b,i[9]=(m-_)*b,i[10]=(1-(h+f))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){let i=this.elements,r=jM.set(i[0],i[1],i[2]).length(),a=jM.set(i[4],i[5],i[6]).length(),s=jM.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],GM.copy(this);let o=1/r,l=1/a,c=1/s;return GM.elements[0]*=o,GM.elements[1]*=o,GM.elements[2]*=o,GM.elements[4]*=l,GM.elements[5]*=l,GM.elements[6]*=l,GM.elements[8]*=c,GM.elements[9]*=c,GM.elements[10]*=c,t.setFromRotationMatrix(GM),n.x=r,n.y=a,n.z=s,this}makePerspective(e,t,n,i,r,a){let s=this.elements,o=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),u=(n+i)/(n-i),h=-(a+r)/(a-r),d=-2*a*r/(a-r);return s[0]=o,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=u,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,i,r,a){let s=this.elements,o=1/(t-e),l=1/(n-i),c=1/(a-r),u=(t+e)*o,h=(n+i)*l,d=(a+r)*c;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-u,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}},jM=new TM,GM=new WM,XM=new TM(0,0,0),qM=new TM(1,1,1),YM=new TM,$M=new TM,KM=new TM;new WM;var ZM=class{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(MM(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},QM=class e{constructor(t=0,n=0,i=0,r=1){e.prototype.isVector4=!0,this.x=t,this.y=n,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r,a=e.elements,s=a[0],o=a[4],l=a[8],c=a[1],u=a[5],h=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let e=(s+1)/2,a=(u+1)/2,m=(f+1)/2,g=(o+c)/4,_=(l+d)/4,v=(h+p)/4;return e>a&&e>m?e<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=g/n,r=_/n):a>m?a<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=g/i,r=v/i):m<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(m),n=_/r,i=v/r),this.set(n,i,r,t),this}let m=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(l-d)/m,this.z=(c-o)/m,this.w=Math.acos((s+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},JM=1,eS=2,tS=4,nS=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),iS=0,rS=1,aS=-1,sS=2*Math.PI,oS=Math.PI/2,lS=1e-5,cS=Math.PI/180;function uS(e,t,n){return Math.max(t,Math.min(n,e))}function hS(e,t=lS){return Math.abs(e)<t}function dS(e,t,n=lS){return hS(e-t,n)}function pS(e,t){return Math.round(e/t)*t}function fS(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function mS(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function gS(e,t,n,i,r=1/0,a){let s=2/(i=Math.max(1e-4,i)),o=s*a,l=1/(1+o+.48*o*o+.235*o*o*o),c=e-t,u=t,h=r*i;c=uS(c,-h,h),t=e-c;let d=(n.value+s*c)*a;n.value=(n.value-s*d)*l;let p=t+(c+d)*l;return u-e>0==p>u&&(p=u,n.value=(p-u)/a),p}function _S(e,t,n,i,r=1/0,a,s){let o=2/(i=Math.max(1e-4,i)),l=o*a,c=1/(1+l+.48*l*l+.235*l*l*l),u=t.x,h=t.y,d=t.z,p=e.x-u,f=e.y-h,m=e.z-d,g=u,_=h,v=d,y=r*i,x=p*p+f*f+m*m;if(x>y*y){let e=Math.sqrt(x);p=p/e*y,f=f/e*y,m=m/e*y}u=e.x-p,h=e.y-f,d=e.z-m;let w=(n.x+o*p)*a,b=(n.y+o*f)*a,E=(n.z+o*m)*a;n.x=(n.x-o*w)*c,n.y=(n.y-o*b)*c,n.z=(n.z-o*E)*c,s.x=u+(p+w)*c,s.y=h+(f+b)*c,s.z=d+(m+E)*c;let M=g-e.x,S=_-e.y,T=v-e.z;return M*(s.x-g)+S*(s.y-_)+T*(s.z-v)>0&&(s.x=g,s.y=_,s.z=v,n.x=(s.x-g)/a,n.y=(s.y-_)/a,n.z=(s.z-v)/a),s}function vS(e,t){t.set(0,0),e.forEach((e=>{t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}var yS=new WM,xS=new TM,wS=class{constructor(e){Hi(this,"position"),Hi(this,"quaternion"),Hi(this,"up"),Hi(this,"scale",new TM(1,1,1)),Hi(this,"matrix",new WM),Hi(this,"matrixWorld",new WM),Hi(this,"matrixWorldInverse",new WM),Hi(this,"projectionMatrix",new WM),Hi(this,"projectionMatrixInverse",new WM),Hi(this,"zoom",1),Hi(this,"matrixWorldNeedsUpdate",!0),Hi(this,"matrixAutoUpdate",!0),Hi(this,"matrixWorldAutoUpdate",!0),this.position=(new TM).fromArray(e.position),this.quaternion=(new SM).fromArray(e.orientation),this.up=new TM(0,1,0)}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e=!1){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1),this.matrixWorldInverse.copy(this.matrixWorld).invert()}lookAt(e){this.updateMatrixWorld(),xS.setFromMatrixPosition(this.matrixWorld),yS.lookAt(xS,e,this.up),this.quaternion.setFromRotationMatrix(yS)}},bS=class extends wS{constructor(e,t,n){super(e),Hi(this,"lens"),this.lens=t,this.updateProjectionMatrix(n)}updateProjectionMatrix(e){let t=this.lens.nearPlane,n=t*Math.tan(.5*cS*this.lens.fovy)/this.zoom,i=2*n,r=e*i,a=-.5*r;this.projectionMatrix.makePerspective(a,a+r,n,n-i,t,this.lens.farPlane),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},ES=class extends wS{constructor(e,t,n){super(e),Hi(this,"lens"),Hi(this,"left",0),Hi(this,"right",0),Hi(this,"top",0),Hi(this,"bottom",0),this.lens=t,this.updateProjectionMatrix(n)}updateProjectionMatrix(e){this.left=-e*this.lens.zoomFactor[0],this.right=e*this.lens.zoomFactor[0],this.top=this.lens.zoomFactor[1],this.bottom=-this.lens.zoomFactor[1];let t=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,a=i-t,s=i+t,o=r+n,l=r-n;this.projectionMatrix.makeOrthographic(a,s,o,l,this.lens.zNear,this.lens.zFar),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}};function MS(e){return e instanceof bS}function SS(e){return e instanceof ES}function TS(e,t){return!!SS(e)}var AS,CS=class{constructor(){Hi(this,"_listeners",{})}addEventListener(e,t){let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}removeAllEventListeners(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}}dispatchEvent(e){let t=this._listeners[e.type];if(void 0!==t){e.target=this;let n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e)}}},RS=1/8,PS=/Mac/.test(null==(fn=null==globalThis?void 0:globalThis.navigator)?void 0:fn.platform),kS=Object.freeze(new TM(0,1,0)),OS=Object.freeze(new TM(0,0,1)),IS=new EM,LS=new TM,DS=new TM,NS=new TM,US=new TM,zS=new TM,BS=new TM,VS=new TM,HS=new TM,WS=new TM,jS=new ZM,GS=new ZM,XS=new RM,qS=new SM,YS=new SM,$S=class e extends CS{constructor(t,n,i,r){super(),Hi(this,"minPolarAngle",0),Hi(this,"maxPolarAngle",Math.PI),Hi(this,"minAzimuthAngle",-1/0),Hi(this,"maxAzimuthAngle",1/0),Hi(this,"minDistance",Number.EPSILON),Hi(this,"maxDistance",1/0),Hi(this,"infinityDolly",!1),Hi(this,"minZoom",.01),Hi(this,"maxZoom",1/0),Hi(this,"smoothTime",.25),Hi(this,"draggingSmoothTime",.125),Hi(this,"maxSpeed",1/0),Hi(this,"azimuthRotateSpeed",1),Hi(this,"polarRotateSpeed",1),Hi(this,"dollySpeed",1),Hi(this,"dollyDragInverted",!1),Hi(this,"truckSpeed",2),Hi(this,"dollyToCursor",!1),Hi(this,"dragToOffset",!1),Hi(this,"boundaryFriction",0),Hi(this,"restThreshold",.01),Hi(this,"mouseButtons"),Hi(this,"touches"),Hi(this,"cancel",(()=>{})),Hi(this,"lockPointer"),Hi(this,"unlockPointer"),Hi(this,"_enabled",!0),Hi(this,"_camera"),Hi(this,"_yAxisUpSpace"),Hi(this,"_yAxisUpSpaceInverse"),Hi(this,"_state",nS.NONE),Hi(this,"_aspectRatio"),Hi(this,"_domElement"),Hi(this,"_viewport",null),Hi(this,"_target"),Hi(this,"_targetEnd"),Hi(this,"_focalOffset"),Hi(this,"_focalOffsetEnd"),Hi(this,"_spherical"),Hi(this,"_sphericalEnd"),Hi(this,"_lastDistance"),Hi(this,"_zoom"),Hi(this,"_zoomEnd"),Hi(this,"_lastZoom"),Hi(this,"_cameraUp0"),Hi(this,"_target0"),Hi(this,"_position0"),Hi(this,"_zoom0"),Hi(this,"_focalOffset0"),Hi(this,"_dollyControlCoord"),Hi(this,"_changedDolly",0),Hi(this,"_changedZoom",0),Hi(this,"_nearPlaneCorners"),Hi(this,"_hasRested",!0),Hi(this,"_boundary"),Hi(this,"_boundaryEnclosesCamera",!1),Hi(this,"_needsUpdate",!0),Hi(this,"_updatedLastTime",!1),Hi(this,"_elementRect",new DOMRect),Hi(this,"_isDragging",!1),Hi(this,"_dragNeedsUpdate",!0),Hi(this,"_activePointers",[]),Hi(this,"_lockedPointer",null),Hi(this,"_interactiveArea",new DOMRect(0,0,1,1)),Hi(this,"_isUserControllingRotate",!1),Hi(this,"_isUserControllingDolly",!1),Hi(this,"_isUserControllingTruck",!1),Hi(this,"_isUserControllingOffset",!1),Hi(this,"_isUserControllingZoom",!1),Hi(this,"_lastDollyDirection",iS),Hi(this,"_thetaVelocity",{value:0}),Hi(this,"_phiVelocity",{value:0}),Hi(this,"_radiusVelocity",{value:0}),Hi(this,"_targetVelocity",new TM),Hi(this,"_focalOffsetVelocity",new TM),Hi(this,"_zoomVelocity",{value:0}),Hi(this,"_truckInternal",((e,t,n,i)=>{let r,a;if(MS(this._camera)){let n=LS.copy(this._camera.position).sub(this._target),i=this._camera.lens.fovy*cS,s=n.length()*Math.tan(.5*i);r=this.truckSpeed*e*s/this._elementRect.height,a=this.truckSpeed*t*s/this._elementRect.height}else{if(!SS(this._camera))return;{let n=this._camera;r=e*(n.right-n.left)/n.zoom/this._elementRect.width,a=t*(n.top-n.bottom)/n.zoom/this._elementRect.height}}i?(n?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(r,0,!0),this.forward(-a,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(r,a,!0)})),Hi(this,"_rotateInternal",((e,t)=>{let n=sS*this.azimuthRotateSpeed*e/this._elementRect.height,i=sS*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(n,i,!0)})),Hi(this,"_dollyInternal",((e,t,n)=>{let i=Math.pow(.95,-e*this.dollySpeed),r=this._sphericalEnd.radius,a=this._sphericalEnd.radius*i,s=uS(a,this.minDistance,this.maxDistance),o=s-a;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(a,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(o,!0),this._dollyToNoClamp(s,!0)):this._dollyToNoClamp(s,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?a:s)-r,this._dollyControlCoord.set(t,n)),this._lastDollyDirection=Math.sign(-e)})),Hi(this,"_zoomInternal",((e,t,n)=>{let i=Math.pow(.95,e*this.dollySpeed),r=this._zoom,a=this._zoom*i;this.zoomTo(a,!0),this.dollyToCursor&&(this._changedZoom+=a-r,this._dollyControlCoord.set(t,n))}));let a="fovy"in n;this._aspectRatio=i,this._camera=a?new bS(t,n,i):new ES(t,n,i),this._yAxisUpSpace=(new SM).setFromUnitVectors(this._camera.up,kS),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=nS.NONE,this._target=new TM,this._targetEnd=this._target.clone(),this._focalOffset=new TM,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new ZM).setFromVector3(LS.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new TM,new TM,new TM,new TM],this._updateNearPlaneCorners(),this._boundary=new RM(new TM(-1/0,-1/0,-1/0),new TM(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new EM,this.mouseButtons={left:nS.ROTATE,middle:nS.DOLLY,right:nS.TRUCK,wheel:MS(this._camera)?nS.DOLLY:SS(this._camera)?nS.ZOOM:nS.NONE},this.touches={one:nS.TOUCH_ROTATE,two:MS(this._camera)?nS.TOUCH_DOLLY_TRUCK:SS(this._camera)?nS.TOUCH_ZOOM_TRUCK:nS.NONE,three:nS.TOUCH_TRUCK};let s=new EM,o=new EM,l=new EM,c=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,i=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}let t="mouse"!==e.pointerType?null:(e.buttons&JM)===JM?JM:(e.buttons&tS)===tS?tS:(e.buttons&eS)===eS?eS:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if((e.buttons&JM)===JM&&this._lockedPointer)return;let n={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(n),e.stopPropagation(),this._domElement.ownerDocument.removeEventListener("pointermove",u,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.addEventListener("pointermove",u,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",h),this._isDragging=!0,m(e)},u=e=>{e.cancelable&&e.preventDefault();let t=e.pointerId,n=this._lockedPointer||this._findPointerById(t);if(n){if(n.clientX=e.clientX,n.clientY=e.clientY,n.deltaX=e.movementX,n.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(e.buttons&JM)===JM)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(e.buttons&tS)===tS&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(e.buttons&eS)===eS&&(this._state=this._state|this.mouseButtons.right);g()}},h=e=>{let t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=nS.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=nS.NONE;_()}},d=-1,p=e=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===nS.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),n=e.clientX/t.width,i=e.clientY/t.height;if(n<this._interactiveArea.left||n>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}if(e.preventDefault(),e.stopPropagation(),this.dollyToCursor||this.mouseButtons.wheel===nS.ROTATE||this.mouseButtons.wheel===nS.TRUCK){let e=performance.now();d-e<1e3&&this._getClientRect(this._elementRect),d=e}let t=PS?-1:-3,n=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),i=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,r=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case nS.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case nS.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1,!1),this._isUserControllingTruck=!0;break;case nS.SCREEN_PAN:this._truckInternal(e.deltaX,e.deltaY,!1,!0),this._isUserControllingTruck=!0;break;case nS.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0,!1),this._isUserControllingOffset=!0;break;case nS.DOLLY:this._dollyInternal(-n,i,r),this._isUserControllingDolly=!0;break;case nS.ZOOM:this._zoomInternal(-n,i,r),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},f=t=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===e.ACTION.NONE){let e=t instanceof PointerEvent?t.pointerId:0,n=this._findPointerById(e);return n&&this._disposePointer(n),this._domElement.ownerDocument.removeEventListener("pointermove",u,{passive:!1}),void this._domElement.ownerDocument.removeEventListener("pointerup",h)}t.preventDefault(),t.stopPropagation()}},m=e=>{if(this._enabled){if(vS(this._activePointers,IS),this._getClientRect(this._elementRect),s.copy(IS),o.copy(IS),this._activePointers.length>=2){let e=IS.x-this._activePointers[1].clientX,t=IS.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t);l.set(0,n);let i=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),r=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);o.set(i,r)}if(this._state=0,e)if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else!this._lockedPointer&&(e.buttons&JM)===JM&&(this._state=this._state|this.mouseButtons.left),(e.buttons&tS)===tS&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&eS)===eS&&(this._state=this._state|this.mouseButtons.right);else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);((this._state&nS.ROTATE)===nS.ROTATE||(this._state&nS.TOUCH_ROTATE)===nS.TOUCH_ROTATE||(this._state&nS.TOUCH_DOLLY_ROTATE)===nS.TOUCH_DOLLY_ROTATE||(this._state&nS.TOUCH_ZOOM_ROTATE)===nS.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&nS.TRUCK)===nS.TRUCK||(this._state&nS.SCREEN_PAN)===nS.SCREEN_PAN||(this._state&nS.TOUCH_TRUCK)===nS.TOUCH_TRUCK||(this._state&nS.TOUCH_SCREEN_PAN)===nS.TOUCH_SCREEN_PAN||(this._state&nS.TOUCH_DOLLY_TRUCK)===nS.TOUCH_DOLLY_TRUCK||(this._state&nS.TOUCH_DOLLY_SCREEN_PAN)===nS.TOUCH_DOLLY_SCREEN_PAN||(this._state&nS.TOUCH_ZOOM_TRUCK)===nS.TOUCH_ZOOM_TRUCK||(this._state&nS.TOUCH_ZOOM_SCREEN_PAN)===nS.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&nS.DOLLY)===nS.DOLLY||(this._state&nS.TOUCH_DOLLY)===nS.TOUCH_DOLLY||(this._state&nS.TOUCH_DOLLY_TRUCK)===nS.TOUCH_DOLLY_TRUCK||(this._state&nS.TOUCH_DOLLY_SCREEN_PAN)===nS.TOUCH_DOLLY_SCREEN_PAN||(this._state&nS.TOUCH_DOLLY_OFFSET)===nS.TOUCH_DOLLY_OFFSET||(this._state&nS.TOUCH_DOLLY_ROTATE)===nS.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&nS.ZOOM)===nS.ZOOM||(this._state&nS.TOUCH_ZOOM)===nS.TOUCH_ZOOM||(this._state&nS.TOUCH_ZOOM_TRUCK)===nS.TOUCH_ZOOM_TRUCK||(this._state&nS.TOUCH_ZOOM_SCREEN_PAN)===nS.TOUCH_ZOOM_SCREEN_PAN||(this._state&nS.TOUCH_ZOOM_OFFSET)===nS.TOUCH_ZOOM_OFFSET||(this._state&nS.TOUCH_ZOOM_ROTATE)===nS.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&nS.OFFSET)===nS.OFFSET||(this._state&nS.TOUCH_OFFSET)===nS.TOUCH_OFFSET||(this._state&nS.TOUCH_DOLLY_OFFSET)===nS.TOUCH_DOLLY_OFFSET||(this._state&nS.TOUCH_ZOOM_OFFSET)===nS.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,vS(this._activePointers,IS);let e=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:o.x-IS.x,n=e?-e.deltaY:o.y-IS.y;if(o.copy(IS),((this._state&nS.ROTATE)===nS.ROTATE||(this._state&nS.TOUCH_ROTATE)===nS.TOUCH_ROTATE||(this._state&nS.TOUCH_DOLLY_ROTATE)===nS.TOUCH_DOLLY_ROTATE||(this._state&nS.TOUCH_ZOOM_ROTATE)===nS.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(t,n),this._isUserControllingRotate=!0),(this._state&nS.DOLLY)===nS.DOLLY||(this._state&nS.ZOOM)===nS.ZOOM){let e=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,i=this.dollyDragInverted?-1:1;(this._state&nS.DOLLY)===nS.DOLLY?(this._dollyInternal(i*n*RS,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(i*n*RS,e,t),this._isUserControllingZoom=!0)}if((this._state&nS.TOUCH_DOLLY)===nS.TOUCH_DOLLY||(this._state&nS.TOUCH_ZOOM)===nS.TOUCH_ZOOM||(this._state&nS.TOUCH_DOLLY_TRUCK)===nS.TOUCH_DOLLY_TRUCK||(this._state&nS.TOUCH_ZOOM_TRUCK)===nS.TOUCH_ZOOM_TRUCK||(this._state&nS.TOUCH_DOLLY_SCREEN_PAN)===nS.TOUCH_DOLLY_SCREEN_PAN||(this._state&nS.TOUCH_ZOOM_SCREEN_PAN)===nS.TOUCH_ZOOM_SCREEN_PAN||(this._state&nS.TOUCH_DOLLY_OFFSET)===nS.TOUCH_DOLLY_OFFSET||(this._state&nS.TOUCH_ZOOM_OFFSET)===nS.TOUCH_ZOOM_OFFSET||(this._state&nS.TOUCH_DOLLY_ROTATE)===nS.TOUCH_DOLLY_ROTATE||(this._state&nS.TOUCH_ZOOM_ROTATE)===nS.TOUCH_ZOOM_ROTATE){let e=IS.x-this._activePointers[1].clientX,t=IS.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t),i=l.y-n;l.set(0,n);let r=this.dollyToCursor?(o.x-this._elementRect.x)/this._elementRect.width*2-1:0,a=this.dollyToCursor?(o.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&nS.TOUCH_DOLLY)===nS.TOUCH_DOLLY||(this._state&nS.TOUCH_DOLLY_ROTATE)===nS.TOUCH_DOLLY_ROTATE||(this._state&nS.TOUCH_DOLLY_TRUCK)===nS.TOUCH_DOLLY_TRUCK||(this._state&nS.TOUCH_DOLLY_SCREEN_PAN)===nS.TOUCH_DOLLY_SCREEN_PAN||(this._state&nS.TOUCH_DOLLY_OFFSET)===nS.TOUCH_DOLLY_OFFSET?(this._dollyInternal(i*RS,r,a),this._isUserControllingDolly=!0):(this._zoomInternal(i*RS,r,a),this._isUserControllingZoom=!0)}((this._state&nS.TRUCK)===nS.TRUCK||(this._state&nS.TOUCH_TRUCK)===nS.TOUCH_TRUCK||(this._state&nS.TOUCH_DOLLY_TRUCK)===nS.TOUCH_DOLLY_TRUCK||(this._state&nS.TOUCH_ZOOM_TRUCK)===nS.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(t,n,!1,!1),this._isUserControllingTruck=!0),((this._state&nS.SCREEN_PAN)===nS.SCREEN_PAN||(this._state&nS.TOUCH_SCREEN_PAN)===nS.TOUCH_SCREEN_PAN||(this._state&nS.TOUCH_DOLLY_SCREEN_PAN)===nS.TOUCH_DOLLY_SCREEN_PAN||(this._state&nS.TOUCH_ZOOM_SCREEN_PAN)===nS.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(t,n,!1,!0),this._isUserControllingTruck=!0),((this._state&nS.OFFSET)===nS.OFFSET||(this._state&nS.TOUCH_OFFSET)===nS.TOUCH_OFFSET||(this._state&nS.TOUCH_DOLLY_OFFSET)===nS.TOUCH_DOLLY_OFFSET||(this._state&nS.TOUCH_ZOOM_OFFSET)===nS.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(t,n,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{vS(this._activePointers,IS),o.copy(IS),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",u,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",u,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",y),this._domElement.ownerDocument.addEventListener("pointermove",u,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",h),m())},this.unlockPointer=()=>{var e,t,n;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null==(e=this._domElement)||e.ownerDocument.exitPointerLock(),null==(t=this._domElement)||t.ownerDocument.removeEventListener("pointerlockchange",v),null==(n=this._domElement)||n.ownerDocument.removeEventListener("pointerlockerror",y),this.cancel()};let v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},y=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",c),this._domElement.addEventListener("pointercancel",h),this._domElement.addEventListener("wheel",p,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",c),this._domElement.removeEventListener("pointercancel",h),this._domElement.removeEventListener("wheel",p,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",u,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",y))},this.cancel=()=>{this._state!==nS.NONE&&(this._state=nS.NONE,this._activePointers.length=0,_())},r&&this.connect(r),this.update(0)}static get ACTION(){return nS}get position(){return this._camera.position}get orientation(){return this._camera.quaternion}get direction(){return this._getCameraDirection(new TM).normalize()}updateTransform(e,t){this._camera.position.fromArray(e),this._camera.quaternion.fromArray(t),this.applyCameraUp(),this._needsUpdate=!0}set aspectRatio(e){this._aspectRatio=e,this._camera.updateProjectionMatrix(this._aspectRatio),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=uS(e.width,0,1),this._interactiveArea.height=uS(e.height,0,1),this._interactiveArea.x=uS(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=uS(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;let i=uS(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=uS(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!n||dS(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&dS(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=iS,this._changedDolly=0,this._dollyToNoClamp(uS(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){this._sphericalEnd.radius=e,this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);let n=!t||dS(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(US).multiplyScalar(e)),t||this._target.copy(this._targetEnd);let n=!t||dS(this._target.x,this._targetEnd.x,this.restThreshold)&&dS(this._target.y,this._targetEnd.y,this.restThreshold)&&dS(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=uS(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);let n=!t||dS(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(n)}pan(e,t,n=!1){return this.truck(e,t,n)}truck(e,t,n=!1){this._camera.updateMatrix(),zS.setFromMatrixColumn(this._camera.matrix,0),BS.setFromMatrixColumn(this._camera.matrix,1),zS.multiplyScalar(e),BS.multiplyScalar(-t);let i=LS.copy(zS).add(BS),r=DS.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,n)}forward(e,t=!1){LS.setFromMatrixColumn(this._camera.matrix,0),LS.crossVectors(this._camera.up,LS),LS.multiplyScalar(e);let n=DS.copy(this._targetEnd).add(LS);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return LS.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+LS.x,this._targetEnd.y+LS.y,this._targetEnd.z+LS.z,t)}moveTo(e,t,n,i=!1){this._isUserControllingTruck=!1;let r=LS.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);let a=!i||dS(this._target.x,this._targetEnd.x,this.restThreshold)&&dS(this._target.y,this._targetEnd.y,this.restThreshold)&&dS(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,n,i=!1){let r=LS.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,i)}fitToBox(e,t,{cover:n=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:a=0,paddingTop:s=0}={}){let o=[];e.isEmpty()&&Promise.resolve();let l=pS(this._sphericalEnd.theta,oS),c=pS(this._sphericalEnd.phi,oS);o.push(this.rotateTo(l,c,t));let u=LS.setFromSpherical(this._sphericalEnd).normalize(),h=qS.setFromUnitVectors(u,OS),d=dS(Math.abs(u.y),1);d&&h.multiply(YS.setFromAxisAngle(kS,l)),h.multiply(this._yAxisUpSpaceInverse);let p=XS.makeEmpty();DS.copy(e.min).applyQuaternion(h),p.expandByPoint(DS),DS.copy(e.min).setX(e.max.x).applyQuaternion(h),p.expandByPoint(DS),DS.copy(e.min).setY(e.max.y).applyQuaternion(h),p.expandByPoint(DS),DS.copy(e.max).setZ(e.min.z).applyQuaternion(h),p.expandByPoint(DS),DS.copy(e.min).setZ(e.max.z).applyQuaternion(h),p.expandByPoint(DS),DS.copy(e.max).setY(e.min.y).applyQuaternion(h),p.expandByPoint(DS),DS.copy(e.max).setX(e.min.x).applyQuaternion(h),p.expandByPoint(DS),DS.copy(e.max).applyQuaternion(h),p.expandByPoint(DS),p.min.x-=i,p.min.y-=a,p.max.x+=r,p.max.y+=s,h.setFromUnitVectors(OS,u),d&&h.premultiply(YS.invert()),h.premultiply(this._yAxisUpSpace);let f=p.getSize(LS),m=p.getCenter(DS).applyQuaternion(h);if(MS(this._camera)){let e=this.getDistanceToFitBox(f.x,f.y,f.z,n);o.push(this.moveTo(m.x,m.y,m.z,t)),o.push(this.dollyTo(e,t)),o.push(this.setFocalOffset(0,0,0,t))}else if(SS(this._camera)){let e=this._camera,i=e.right-e.left,r=e.top-e.bottom,a=n?Math.max(i/f.x,r/f.y):Math.min(i/f.x,r/f.y);o.push(this.moveTo(m.x,m.y,m.z,t)),o.push(this.zoomTo(a,t)),o.push(this.setFocalOffset(0,0,0,t))}return Promise.all(o)}fitToSphere(e,t){let n=[];if(n.push(this.moveTo(e.center.x,e.center.y,e.center.z,t)),MS(this._camera)){let i=this.getDistanceToFitSphere(e.radius);n.push(this.dollyTo(i,t))}else if(SS(this._camera)){let i=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,a=2*e.radius,s=Math.min(i/a,r/a);n.push(this.zoomTo(s,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,i,r,a,s=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=iS,this._changedDolly=0;let o=DS.set(i,r,a),l=LS.set(e,t,n);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(l.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let c=!s||dS(this._target.x,this._targetEnd.x,this.restThreshold)&&dS(this._target.y,this._targetEnd.y,this.restThreshold)&&dS(this._target.z,this._targetEnd.z,this.restThreshold)&&dS(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&dS(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&dS(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,n,i,r,a,s,o,l,c,u,h,d,p=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=iS,this._changedDolly=0;let f=LS.set(i,r,a),m=DS.set(e,t,n);jS.setFromVector3(m.sub(f).applyQuaternion(this._yAxisUpSpace));let g=NS.set(c,u,h),_=DS.set(s,o,l);GS.setFromVector3(_.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(g,d));let v=GS.theta-jS.theta,y=GS.phi-jS.phi,x=GS.radius-jS.radius;this._sphericalEnd.set(jS.radius+x*d,jS.phi+y*d,jS.theta+v*d),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let w=!p||dS(this._target.x,this._targetEnd.x,this.restThreshold)&&dS(this._target.y,this._targetEnd.y,this.restThreshold)&&dS(this._target.z,this._targetEnd.z,this.restThreshold)&&dS(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&dS(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&dS(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(w)}setPosition(e,t,n,i=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,n,i=!1){let r=this.getPosition(LS),a=this.setLookAt(r.x,r.y,r.z,e,t,n,i);return this._sphericalEnd.phi=uS(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,n,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);let r=!i||dS(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&dS(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&dS(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),zS.setFromMatrixColumn(this._camera.matrixWorldInverse,0),BS.setFromMatrixColumn(this._camera.matrixWorldInverse,1),VS.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let i=LS.set(e,t,n),r=i.distanceTo(this._camera.position),a=i.sub(this._camera.position);zS.multiplyScalar(a.x),BS.multiplyScalar(a.y),VS.multiplyScalar(a.z),LS.copy(zS).add(BS).add(VS),LS.z=LS.z+r,this.dollyTo(r,!1),this.setFocalOffset(-LS.x,LS.y,-LS.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,i){null!==e?(this._viewport=this._viewport||new QM,"number"==typeof e?this._viewport.set(e,t,n,i):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,n,i=!1){if(TS(this._camera))return this._spherical.radius;let r=e/t,a=this._camera.lens.fovy*cS,s=this._camera.lens.aspectRatio;return.5*((i?r>s:r<s)?t:e/s)/Math.tan(.5*a)+.5*n}getDistanceToFitSphere(e){if(TS(this._camera))return this._spherical.radius;let t=this._camera.lens.fovy*cS,n=2*Math.atan(Math.tan(.5*t)*this._camera.lens.aspectRatio),i=1<this._camera.lens.aspectRatio?t:n;return e/Math.sin(.5*i)}getTarget(e,t=!0){return(e&&e.isVector3?e:new TM).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new TM).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new ZM).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new TM).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%sS,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=sS),this._spherical.theta+=sS*Math.round((this._sphericalEnd.theta-this._spherical.theta)/sS)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!dS(this._camera.up.x,this._cameraUp0.x)||!dS(this._camera.up.y,this._cameraUp0.y)||!dS(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let e=this.getPosition(LS);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}let t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,kS),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let e=LS.subVectors(this._target,this._camera.position).normalize(),t=DS.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();let n=this.getPosition(LS);this.updateCameraUp(),this.setPosition(n.x,n.y,n.z)}update(e){let t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=HS.subVectors(this._targetEnd,this._target),a=WS.subVectors(this._focalOffsetEnd,this._focalOffset),s=this._zoomEnd-this._zoom;if(hS(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=gS(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(hS(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=gS(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(hS(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=gS(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(hS(r.x)&&hS(r.y)&&hS(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;_S(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(hS(a.x)&&hS(a.y)&&hS(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;_S(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(hS(s))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=gS(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor)if(MS(this._camera)&&0!==this._changedDolly){let e=this._spherical.radius-this._lastDistance,t=this._camera,n=this._getCameraDirection(US),i=LS.copy(n).cross(t.up).normalize();0===i.lengthSq()&&(i.x=1);let r=DS.crossVectors(i,n),a=this._sphericalEnd.radius*Math.tan(t.lens.fovy*cS*.5),s=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,o=NS.copy(this._targetEnd).add(i.multiplyScalar(this._dollyControlCoord.x*a*t.lens.aspectRatio)).add(r.multiplyScalar(this._dollyControlCoord.y*a)),l=LS.copy(this._targetEnd).lerp(o,s),c=this._lastDollyDirection===rS&&this._spherical.radius<=this.minDistance,u=this._lastDollyDirection===aS&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(c||u)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;let t=DS.copy(n).multiplyScalar(-e);l.add(t)}this._boundary.clampPoint(l,l);let h=DS.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(h),this._changedDolly-=e,hS(this._changedDolly)&&(this._changedDolly=0)}else if(SS(this._camera)&&0!==this._changedZoom){let e=this._zoom-this._lastZoom,t=this._camera,n=function(e,t){return e.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}(LS.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.lens.zNear+t.lens.zFar)/(t.lens.zNear-t.lens.zFar)),t),i=DS.set(0,0,-1).applyQuaternion(t.quaternion),r=NS.copy(n).add(i.multiplyScalar(-n.dot(t.up))),a=-(this._zoom-e-this._zoom)/this._zoom,s=this._getCameraDirection(US),o=this._targetEnd.dot(s),l=LS.copy(this._targetEnd).lerp(r,a),c=l.dot(s),u=s.multiplyScalar(c-o);l.sub(u),this._boundary.clampPoint(l,l);let h=DS.subVectors(l,this._targetEnd);this._targetEnd.copy(l),this._target.add(h),this._changedZoom-=e,hS(this._changedZoom)&&(this._changedZoom=0)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(this._aspectRatio),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0,this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!hS(this._focalOffset.x)||!hS(this._focalOffset.y)||!hS(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),zS.setFromMatrixColumn(this._camera.matrix,0),BS.setFromMatrixColumn(this._camera.matrix,1),VS.setFromMatrixColumn(this._camera.matrix,2),zS.multiplyScalar(this._focalOffset.x),BS.multiplyScalar(-this._focalOffset.y),VS.multiplyScalar(this._focalOffset.z),LS.copy(zS).add(BS).add(VS),this._camera.position.add(LS)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),LS.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let o=this._needsUpdate;return o&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):o?(this.dispatchEvent({type:"update"}),hS(t,this.restThreshold)&&hS(n,this.restThreshold)&&hS(i,this.restThreshold)&&hS(r.x,this.restThreshold)&&hS(r.y,this.restThreshold)&&hS(r.z,this.restThreshold)&&hS(a.x,this.restThreshold)&&hS(a.y,this.restThreshold)&&hS(a.z,this.restThreshold)&&hS(s,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!o&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=o,this._needsUpdate=!1,o}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:fS(this.maxDistance),minZoom:this.minZoom,maxZoom:fS(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:fS(this.maxPolarAngle),minAzimuthAngle:fS(this.minAzimuthAngle),maxAzimuthAngle:fS(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:LS.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){let n=JSON.parse(e);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=mS(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=mS(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=mS(n.maxPolarAngle),this.minAzimuthAngle=mS(n.minAzimuthAngle),this.maxAzimuthAngle=mS(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),jS.setFromVector3(LS.fromArray(n.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(jS.theta,jS.phi,t),this.dollyTo(jS.radius,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement||(e.setAttribute("data-camera-controls-version","0.4.2"),this._addAllEventListeners(e),this._getClientRect(this._elementRect))}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find((t=>t.pointerId===e))}_findPointerByMouseButton(e){return this._activePointers.find((t=>t.mouseButton===e))}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,n){let i=t.lengthSq();if(0===i)return e;let r=DS.copy(t).add(e),a=this._boundary.clampPoint(r,NS).sub(r),s=a.lengthSq();if(0===s)return e.add(t);if(s===i)return e;if(0===n)return e.add(t).add(a);{let i=1+n*s/t.dot(a);return e.add(DS.copy(t).multiplyScalar(i)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(MS(this._camera)){let e=this._camera,t=e.lens.nearPlane,n=e.lens.fovy*cS,i=Math.tan(.5*n)*t,r=i*e.lens.aspectRatio;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(SS(this._camera)){let e=this._camera,t=1/e.zoom,n=e.left*t,i=e.right*t,r=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(n,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,a,0),this._nearPlaneCorners[3].set(n,a,0)}}_getClientRect(e){if(!this._domElement)return;let t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((e=>{let t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)})))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return 0}set dampingFactor(e){}get draggingDampingFactor(){return 0}set draggingDampingFactor(e){}};!function(e){e.HOLD_START="holdStart",e.HOLD_END="holdEnd",e.HOLDING="holding"}(AS||(AS={}));var KS=class{constructor(){Hi(this,"_listeners",{})}addEventListener(e,t){let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}removeEventListener(e,t){let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){let t=this._listeners[e.type];if(void 0!==t){e.target=this;let n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e)}}},ZS=class extends KS{constructor(e){super(),Hi(this,"holdIntervalDelay"),Hi(this,"_enabled",!0),Hi(this,"_holding",!1),Hi(this,"_intervalId",-1),Hi(this,"_deltaTime",0),Hi(this,"_elapsedTime",0),Hi(this,"_lastTime",0),Hi(this,"_holdStart",(e=>{if(!this._enabled||this._holding)return;this._deltaTime=0,this._elapsedTime=0,this._lastTime=performance.now(),this.dispatchEvent({type:AS.HOLD_START,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:e}),this._holding=!0;let t=()=>{this._intervalId=this.holdIntervalDelay?window.setTimeout(t,this.holdIntervalDelay):window.requestAnimationFrame(t);let n=performance.now();this._deltaTime=n-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:AS.HOLDING,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:e})};this._intervalId=this.holdIntervalDelay?window.setTimeout(t,this.holdIntervalDelay):window.requestAnimationFrame(t)})),Hi(this,"_holdEnd",(e=>{if(this._holding){let t=performance.now();this._deltaTime=t-this._lastTime,this._elapsedTime+=this._deltaTime,this._lastTime=performance.now(),this.dispatchEvent({type:AS.HOLD_END,deltaTime:this._deltaTime,elapsedTime:this._elapsedTime,originalEvent:e}),this._holding=!1}window.clearTimeout(this._intervalId),window.cancelAnimationFrame(this._intervalId)})),this.holdIntervalDelay=e}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this._enabled||this._holdEnd())}get holding(){return this._holding}},QS=class extends ZS{constructor(e,t){if("string"!=typeof e)return;super(t),this._holdStart=this._holdStart.bind(this),this._holdEnd=this._holdEnd.bind(this);document.addEventListener("keydown",(t=>{(function(e){let t=e.target;return"INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable})(t)||t.code===e&&this._holdStart(t)})),document.addEventListener("keyup",(t=>{t.code===e&&this._holdEnd(t)})),window.addEventListener("blur",this._holdEnd)}};var JS="KeyW",eT="KeyA",tT="KeyS",nT="KeyD",iT="KeyE",rT="KeyQ",aT="ArrowLeft",sT="ArrowUp",oT="ArrowRight",lT="ArrowDown",cT="ShiftRight",uT="ControlRight",hT=16.666,dT=(mn=class{constructor(e,t){Hi(this,"_cameraControls"),Hi(this,"_clock"),Hi(this,"speedMultiplier",2e-5),Hi(this,"_truckLeft",(e=>{e&&(this._cameraControls.truck(-this.speedMultiplier*-this._cameraControls.truckSpeed*e.deltaTime,0,!1),this._updateClock())})),Hi(this,"_truckRight",(e=>{e&&(this._cameraControls.truck(this.speedMultiplier*-this._cameraControls.truckSpeed*e.deltaTime,0,!1),this._updateClock())})),Hi(this,"_moveUp",(e=>{e&&(this._cameraControls.elevate(this.speedMultiplier*-this._cameraControls.truckSpeed*e.deltaTime,!1),this._updateClock())})),Hi(this,"_moveDown",(e=>{e&&(this._cameraControls.elevate(-this.speedMultiplier*-this._cameraControls.truckSpeed*e.deltaTime,!1),this._updateClock())})),Hi(this,"_moveFront",(e=>{if(!e)return;let t=this.speedMultiplier*-this._cameraControls.truckSpeed*e.deltaTime,n=this._cameraControls.direction.multiplyScalar(t);n.add(this._cameraControls.getPosition(new TM)),this._cameraControls.moveTo(...n.toArray(),!1),this._updateClock()})),Hi(this,"_moveBack",(e=>{if(!e)return;let t=this.speedMultiplier*this._cameraControls.truckSpeed*e.deltaTime,n=this._cameraControls.direction.multiplyScalar(t);n.add(this._cameraControls.getPosition(new TM)),this._cameraControls.moveTo(...n.toArray(),!1),this._updateClock()})),this._cameraControls=e,this._clock=t,0===Object.keys(mn._keys).length&&(mn._keys={q:new QS(rT,hT),w:new QS(JS,hT),s:new QS(tT,hT),a:new QS(eT,hT),d:new QS(nT,hT),e:new QS(iT,hT),up:new QS(sT,hT),right:new QS(oT,hT),down:new QS(lT,hT),left:new QS(aT,hT),shift:new QS(cT,hT),ctrl:new QS(uT,hT)});let{w:n,a:i,s:r,d:a,e:s,q:o,up:l,right:c,down:u,left:h,shift:d,ctrl:p}=mn._keys;i.addEventListener("holding",this._truckLeft),a.addEventListener("holding",this._truckRight),n.addEventListener("holding",this._moveFront),r.addEventListener("holding",this._moveBack),o.addEventListener("holding",this._moveDown),s.addEventListener("holding",this._moveUp),h.addEventListener("holding",this._truckLeft),c.addEventListener("holding",this._truckRight),l.addEventListener("holding",this._moveFront),u.addEventListener("holding",this._moveBack),p.addEventListener("holding",this._moveDown),d.addEventListener("holding",this._moveUp)}dispose(){let{w:e,a:t,s:n,d:i,e:r,q:a,up:s,right:o,down:l,left:c,ctrl:u,shift:h}=mn._keys;t.removeEventListener("holding",this._truckLeft),i.removeEventListener("holding",this._truckRight),e.removeEventListener("holding",this._moveFront),n.removeEventListener("holding",this._moveBack),a.removeEventListener("holding",this._moveDown),r.removeEventListener("holding",this._moveUp),c.removeEventListener("holding",this._truckLeft),o.removeEventListener("holding",this._truckRight),s.removeEventListener("holding",this._moveFront),l.removeEventListener("holding",this._moveBack),u.removeEventListener("holding",this._moveDown),h.removeEventListener("holding",this._moveUp)}enable(){Object.keys(mn._keys).forEach((e=>{mn._keys[e].enabled=!0}))}disable(){Object.keys(mn._keys).forEach((e=>{mn._keys[e].enabled=!1}))}_updateClock(){let e=this._clock.getDelta();return this._cameraControls.update(e)}},Hi(mn,"_keys",{}),mn),pT=class{constructor(e=!0){Hi(this,"autoStart"),Hi(this,"startTime"),Hi(this,"oldTime"),Hi(this,"elapsedTime"),Hi(this,"running"),this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=fT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=fT();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function fT(){return performance.now()}typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink-camera-controls")||(window.__LIVELINK__["@3dverse/livelink-camera-controls"]="0.4.2"));var mT={};fy(mT,{fly:()=>vT,orbital:()=>gT,pointer_locked_orbital:()=>_T});var gT=Object.freeze({init_options:{target:[0,0,0]}}),_T=Object.freeze({mouseButtons:{left:nS.ROTATE,middle:nS.DOLLY,wheel:nS.DOLLY,right:nS.TRUCK},touches:{one:nS.TOUCH_ROTATE,two:nS.TOUCH_DOLLY_TRUCK,three:nS.TOUCH_TRUCK},truckSpeed:-2,dollyToCursor:!0,infinityDolly:!0,minDistance:.5,maxDistance:1/0,invert_middle_button_dolly:!0,orbit_on_cursor:{enabled:!0,cancel_target_offset:!0},lock_pointer:{aim:"on-drag",on_drag_threshold_in_pixels:10}}),vT=Object.freeze({mouseButtons:{left:nS.SCREEN_PAN,middle:nS.TRUCK,wheel:nS.SCREEN_PAN,right:nS.ROTATE},touches:{one:nS.TOUCH_ROTATE,two:nS.TOUCH_DOLLY_TRUCK,three:nS.TOUCH_SCREEN_PAN},truckSpeed:-3e3,infinityDolly:!0,minDistance:.5,maxDistance:1/0,lock_pointer:{aim:"on-drag",on_drag_threshold_in_pixels:10},init_options:{forward_target_distance:.001,keyboard_fly_controls:{enabled:!0,speed_multiplier:2e-6}}}),yT=(Vn=class extends $S{constructor({camera_entity:e,viewport:t,activate:n=!0,preset:i=gT}){super(e.local_transform,function(e){let t=e.perspective_lens||e.orthographic_lens;if(!t)throw new Error("Camera entity must have a perspective or orthographic lens");return t}(e),t.aspect_ratio,t.dom_element),Gi(this,bn),Gi(this,gn),Gi(this,_n),Gi(this,vn,new pT),Gi(this,yn,0),Hi(this,"invert_middle_button_dolly",!1),Hi(this,"orbit_on_cursor",{enabled:!1,cancel_target_offset:!1}),Gi(this,xn,{orbit_point:[0,0,0],wheel_timer:0}),Hi(this,"lock_pointer",{aim:"off",on_drag_threshold_in_pixels:0}),Gi(this,wn,{count:0,down_position:null}),Hi(this,"init_options",{}),Hi(this,"keyboard_fly_controls",null),Hi(this,"onViewportResize",(()=>{this.aspectRatio=ji(this,_n).aspect_ratio})),Gi(this,Tn,(()=>{this.position.toArray(ji(this,gn).local_transform.position),this.orientation.toArray(ji(this,gn).local_transform.orientation)})),Gi(this,Rn,(()=>{ji(this,bn,En)||qi(this,bn,Cn).call(this)})),Gi(this,Pn,(()=>{qi(this,bn,Cn).call(this)})),Gi(this,kn,(e=>{var t;"always"!==this.lock_pointer.aim&&ji(this,wn).count++,!ji(this,bn,En)&&"off"!==this.lock_pointer.aim&&(ji(this,wn).down_position=[e.clientX,e.clientY],null==(t=this._domElement)||t.addEventListener("mousemove",ji(this,In)))})),Gi(this,On,(e=>{ji(this,wn).count>0&&ji(this,wn).count--,!(ji(this,wn).count>0)&&ji(this,bn,En)&&this._domElement&&0===ji(this,wn).count&&qi(this,bn,Cn).call(this)})),Gi(this,In,(e=>{var t;let{on_drag_threshold_in_pixels:n}=this.lock_pointer,{down_position:i}=ji(this,wn);if(i&&this._domElement&&!ji(this,bn,En)){if(n>0){let{clientX:t,clientY:r}=e;if(Math.sqrt(Math.pow(t-i[0],2)+Math.pow(r-i[1],2))<n)return}this._domElement.removeEventListener("mousemove",ji(this,In)),"always"!==this.lock_pointer.aim&&this._domElement.addEventListener("mouseup",ji(this,On)),qi(this,bn,Cn).call(this),qi(this,bn,An).call(this)}else null==(t=this._domElement)||t.removeEventListener("mousemove",ji(this,In))})),Gi(this,Nn,(e=>{this.invert_middle_button_dolly&&1===e.button&&this.mouseButtons.middle===nS.DOLLY&&(this.dollySpeed=-Math.abs(this.dollySpeed)),this.orbit_on_cursor.enabled&&qi(this,bn,Dn).call(this,e)&&qi(this,bn,Bn).call(this,e)})),Gi(this,Un,(e=>{this.invert_middle_button_dolly&&1===e.button&&this.mouseButtons.middle===nS.DOLLY&&(this.dollySpeed=Math.abs(this.dollySpeed))})),Gi(this,Fn,(e=>{e.stopPropagation()})),Xi(this,gn,e),Xi(this,_n,t),ji(this,_n).is_camera_controlled_by_current_client=!0,qi(this,bn,Mn).call(this,this,i),qi(this,bn,Sn).call(this),n&&this.activate(),ji(this,_n).rendering_surface.addEventListener("on-rendering-surface-resized",this.onViewportResize)}release(){var e;ji(this,_n).is_camera_controlled_by_current_client=!1,ji(this,_n).rendering_surface.removeEventListener("on-rendering-surface-resized",this.onViewportResize),this.deactivate(),this.dispose(),null==(e=this.keyboard_fly_controls)||e.dispose()}activate(){var e,t,n,i;0===ji(this,yn)&&(Xi(this,yn,setInterval((()=>{this.update(ji(this,vn).getDelta())}),1e3/60)),null==(e=this._domElement)||e.addEventListener("pointerdown",ji(this,Nn)),null==(t=this._domElement)||t.addEventListener("pointerup",ji(this,Un)),null==(n=this._domElement)||n.addEventListener("mousedown",ji(this,kn)),null==(i=this.keyboard_fly_controls)||i.enable())}deactivate(){var e,t,n,i,r,a;null==(e=this._domElement)||e.removeEventListener("pointerdown",ji(this,Nn)),null==(t=this._domElement)||t.removeEventListener("pointerup",ji(this,Un)),null==(n=this._domElement)||n.removeEventListener("mousedown",ji(this,kn)),null==(i=this._domElement)||i.removeEventListener("mouseup",ji(this,On)),null==(r=this._domElement)||r.removeEventListener("mousemove",ji(this,In)),null==(a=this.keyboard_fly_controls)||a.disable(),0!==ji(this,yn)&&(clearInterval(ji(this,yn)),Xi(this,yn,0))}},gn=new WeakMap,_n=new WeakMap,vn=new WeakMap,yn=new WeakMap,xn=new WeakMap,wn=new WeakMap,bn=new WeakSet,En=function(){var e;return(null==(e=this._domElement)?void 0:e.ownerDocument.pointerLockElement)===this._domElement},Mn=function(e,...t){let n=e=>"object"==typeof e&&null!==e&&!Array.isArray(e);return t.forEach((t=>{n(t)&&Reflect.ownKeys(t).forEach((i=>{let r,a=e[i],s=t[i];r=n(a)&&n(s)?qi(this,bn,Mn).call(this,Object.create(Object.getPrototypeOf(a)),a,s):window.structuredClone(s),e[i]=r}))})),e},Sn=function(){let{target:e}=this.init_options;e&&this.setLookAt(...ji(this,gn).local_transform.position,...e);let{forward_target_distance:t}=this.init_options;if(void 0!==t){let e=this.direction.multiplyScalar(t),n=this.getPosition(new TM).add(e);this.setTarget(...n.toArray())}let{keyboard_fly_controls:n}=this.init_options;if(null==n?void 0:n.enabled){let{speed_multiplier:e}=n;this.keyboard_fly_controls=new dT(this,ji(this,vn)),void 0!==e&&(this.keyboard_fly_controls.speedMultiplier=e)}this.saveState(),this.addEventListener("update",ji(this,Tn))},Tn=new WeakMap,An=function(){if(!this._domElement)return;let{ownerDocument:e}=this._domElement;this._domElement.requestPointerLock(),e.addEventListener("pointerlockchange",ji(this,Rn)),e.addEventListener("pointerlockerror",ji(this,Pn))},Cn=function(){if(!this._domElement)return;let{ownerDocument:e}=this._domElement;e.exitPointerLock(),e.removeEventListener("pointerlockchange",ji(this,Rn)),e.removeEventListener("pointerlockerror",ji(this,Pn))},Rn=new WeakMap,Pn=new WeakMap,kn=new WeakMap,On=new WeakMap,In=new WeakMap,Ln=function({event:e,touch_actions:t,mouse_actions:n}){if(t&&t.length>0&&"touch"===e.pointerType){let e=t.reduce(((e,t)=>e|t),0);switch(this._activePointers.length){case 1:return(this.touches.one|e)>0;case 2:return(this.touches.two|e)>0;case 3:return(this.touches.three|e)>0;default:return!1}}if(!n||0===n.length)return!1;let i=nS.NONE;switch(e.button){case 0:i=this.mouseButtons.left;break;case 2:i=this.mouseButtons.right;break;case 1:i=this.mouseButtons.middle;break;default:return!1}return n.includes(i)},Dn=function(e){let{ROTATE:t,TOUCH_ROTATE:n,TOUCH_ZOOM_ROTATE:i,TOUCH_DOLLY_ROTATE:r}=nS;return qi(this,bn,Ln).call(this,{event:e,touch_actions:[n,i,r],mouse_actions:[t]})},Nn=new WeakMap,Un=new WeakMap,Fn=new WeakMap,zn=async function(e){var t;if(!this._domElement)return;let{clientX:n,clientY:i}=e,{left:r,top:a}=this._domElement.getBoundingClientRect(),s=[(n-r)/this._domElement.clientWidth,(i-a)/this._domElement.clientHeight],o=null==(t=await ji(this,_n).castScreenSpaceRay({screen_position:s,mode:"None"}))?void 0:t.world_position;o?(ji(this,xn).orbit_point=o,this.setOrbitPoint(...o)):this.orbit_on_cursor.cancel_target_offset&&this.setOrbitPoint(...ji(this,xn).orbit_point),this.update(ji(this,vn).getDelta())},Bn=async function(e){ji(this,xn).rotate_speed||(ji(this,xn).rotate_speed={azimuth:this.azimuthRotateSpeed,polar:this.polarRotateSpeed}),this.polarRotateSpeed=0,this.azimuthRotateSpeed=0,document.removeEventListener("pointermove",ji(this,Fn),!0),document.addEventListener("pointermove",ji(this,Fn),{capture:!0,once:!0});try{await qi(this,bn,zn).call(this,e)}finally{if(document.removeEventListener("pointermove",ji(this,Fn),!0),ji(this,xn).rotate_speed){let{azimuth:e,polar:t}=ji(this,xn).rotate_speed;ji(this,xn).rotate_speed=void 0,this.azimuthRotateSpeed=e,this.polarRotateSpeed=t}}},Vn);var xT,wT=(ni=class{constructor({camera_entity:e,viewport:t}){Gi(this,$n),Hi(this,"camera_entity"),Hi(this,"viewport"),Gi(this,Hn,[0,0,0]),Gi(this,Wn,[0,0,0,1]),Gi(this,jn,lx.create()),Gi(this,Gn,lx.create()),Gi(this,Xn,lx.create()),Gi(this,qn,lx.create()),Gi(this,Yn,(e=>{e.isAnyComponentDirty({components:["perspective_lens","orthographic_lens"]})&&this.updateProjectionMatrix()})),qi(this,$n,Kn).call(this,{camera_entity:e}),this.camera_entity=e,this.viewport=t,this.updateProjectionMatrix(),e.addEventListener("on-entity-updated",ji(this,Yn))}get clip_from_view_matrix(){return ji(this,jn)}get view_from_clip_matrix(){return ji(this,Gn)}get clip_from_world_matrix(){return ji(this,Xn)}get world_from_clip_matrix(){return lx.invert(lx.create(),ji(this,Xn))}get world_from_view_matrix(){return ji(this,qn)}get world_position(){return ji(this,Hn)}get world_orientation(){return ji(this,Wn)}get world_euler_orientation(){return NE(ji(this,Wn))}projectWorldToClip({world_position:e,out_clip_position:t=ow.create()}){return ow.transformMat4(t,e,ji(this,Xn)),t}projectClipToWorld({clip_position:e,out_world_position:t=ow.create()}){return ow.transformMat4(t,e,this.world_from_clip_matrix),t}computeRayFromScreenPosition({screen_position:e}){let t=qi(this,$n,Jn).call(this,{screen_position:e});return this.computeRayFromClipPosition({clip_position:t})}computeRayFromClipPosition({clip_position:e}){if(this.camera_entity.perspective_lens)return qi(this,$n,Zn).call(this,{clip_position:e});if(this.camera_entity.orthographic_lens)return qi(this,$n,Qn).call(this,{lens:this.camera_entity.orthographic_lens,clip_position:e});throw new Error("Camera entity must have a perspective or orthographic lens component")}updateProjectionMatrix(){this.camera_entity.perspective_lens?qi(this,$n,ei).call(this,{lens:this.camera_entity.perspective_lens}):this.camera_entity.orthographic_lens&&qi(this,$n,ti).call(this,{lens:this.camera_entity.orthographic_lens}),lx.invert(ji(this,Gn),ji(this,jn))}updateFromFrameCameraTransform({frame_camera_transform:e}){Xi(this,Hn,e.world_position),Xi(this,Wn,e.world_orientation),Xi(this,qn,Array.from(e.world_from_view_matrix));let t=ji(this,Xn),n=lx.invert(t,e.world_from_view_matrix);n||(n=lx.identity(t)),Xi(this,Xn,lx.multiply(ji(this,Xn),ji(this,jn),n))}},Hn=new WeakMap,Wn=new WeakMap,jn=new WeakMap,Gn=new WeakMap,Xn=new WeakMap,qn=new WeakMap,Yn=new WeakMap,$n=new WeakSet,Kn=function({camera_entity:e}){if(!e.camera)throw new Error("Camera entity must have a camera component");if(!e.perspective_lens&&!e.orthographic_lens)throw new Error("Camera entity must have a perspective or orthographic lens component")},Zn=function({clip_position:e}){let t={origin:ow.fromValues(...ji(this,Hn)),direction:ow.create()};return this.projectClipToWorld({clip_position:e,out_world_position:t.direction}),ow.sub(t.direction,t.direction,t.origin),ow.normalize(t.direction,t.direction),t},Qn=function({lens:e,clip_position:t}){let{zNear:n,zFar:i}=e,r={origin:ow.fromValues(t[0],t[1],(n+i)/(n-i)),direction:ow.fromValues(0,0,-1)};this.projectClipToWorld({clip_position:t,out_world_position:r.origin});let a=Ry.fromMat4(Ry.create(),this.world_from_view_matrix);return ow.transformMat3(r.direction,r.direction,a),r},Jn=function({screen_position:e}){return ow.fromValues(2*e[0]-1,1-2*e[1],.5)},ei=function({lens:e}){lx.perspective(ji(this,jn),wy.toRadian(e.fovy),this.viewport.aspect_ratio,e.nearPlane,e.farPlane||1e5)},ti=function({lens:e}){lx.ortho(ji(this,jn),-this.viewport.aspect_ratio*e.zoomFactor[0],this.viewport.aspect_ratio*e.zoomFactor[0],-e.zoomFactor[1],e.zoomFactor[1],e.zNear,e.zFar)},ni);!function(){(xT=this)||(typeof window<"u"?xT=window:typeof self<"u"&&(xT=self))}();var bT="https://cdn.3dverse.com/legacy/sdk/avc.wasm",ET=function(e,t){var n,i=typeof i<"u"?i:{},r={};for(n in i)i.hasOwnProperty(n)&&(r[n]=i[n]);i.arguments=[],i.thisProgram="./this.program",i.quit=function(e,t){throw t},i.preRun=[],i.postRun=[];var a=!1,s=!1,o=!1,l=!1;if(i.ENVIRONMENT)if("WEB"===i.ENVIRONMENT)a=!0;else if("WORKER"===i.ENVIRONMENT)s=!0;else if("NODE"===i.ENVIRONMENT)o=!0;else{if("SHELL"!==i.ENVIRONMENT)throw new Error("Module['ENVIRONMENT'] value is not valid. must be one of: WEB|WORKER|NODE|SHELL.");l=!0}else a="object"==typeof window,s="function"==typeof importScripts,o="object"==typeof process&&!1,l=!a&&!o&&!s;if(l)typeof read<"u"&&(i.read=function(e){return read(e)}),i.readBinary=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(d("object"==typeof(t=read(e,"binary"))),t)},typeof scriptArgs<"u"?i.arguments=scriptArgs:typeof arguments<"u"&&(i.arguments=arguments),"function"==typeof quit&&(i.quit=function(e,t){quit(e)});else{if(!a&&!s)throw new Error("not compiled for this environment");i.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},s&&(i.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),i.readAsync=function(e,t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status||0==i.status&&i.response?t(i.response):n()},i.onerror=n,i.send(null)},i.setWindowTitle=function(e){document.title=e}}for(n in i.print=typeof console<"u"?function(){}.bind():typeof print<"u"?print:null,i.printErr=typeof printErr<"u"?printErr:typeof console<"u"&&function(){}.bind()||i.print,i.print=i.print,i.printErr=i.printErr,r)r.hasOwnProperty(n)&&(i[n]=r[n]);r=void 0;function c(e,t){return t||(t=16),e=Math.ceil(e/t)*t}var u={"f64-rem":function(e,t){return e%t},debugger:function(){}};new Array(0);var h=0;function d(e,t){e||$("Assertion failed: "+t)}function p(e,t){if(0===t||!e)return"";for(var n,i=0,r=0;i|=n=_[e+r|0],(0!=n||t)&&(r++,!t||r!=t););t||(t=r);var a="";if(i<128){for(var s,o=1024;t>0;)s=String.fromCharCode.apply(String,_.subarray(e,e+Math.min(t,o))),a=a?a+s:s,e+=o,t-=o;return a}return function(e){return m(_,e)}(e)}var f=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function m(e,t){for(var n=t;e[n];)++n;if(n-t>16&&e.subarray&&f)return f.decode(e.subarray(t,n));for(var i,r,a,s,o,l="";;){if(!(i=e[t++]))return l;if(128&i)if(r=63&e[t++],192!=(224&i))if(a=63&e[t++],224==(240&i)?i=(15&i)<<12|r<<6|a:(s=63&e[t++],240==(248&i)?i=(7&i)<<18|r<<12|a<<6|s:(o=63&e[t++],248==(252&i)?i=(3&i)<<24|r<<18|a<<12|s<<6|o:i=(1&i)<<30|r<<24|a<<18|s<<12|o<<6|63&e[t++])),i<65536)l+=String.fromCharCode(i);else{var c=i-65536;l+=String.fromCharCode(55296|c>>10,56320|1023&c)}else l+=String.fromCharCode((31&i)<<6|r);else l+=String.fromCharCode(i)}}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");var g,_,v,y,x,w,b,E,M,S,T=65536;function A(){i.HEAP8=new Int8Array(g),i.HEAP16=v=new Int16Array(g),i.HEAP32=y=new Int32Array(g),i.HEAPU8=_=new Uint8Array(g),i.HEAPU16=new Uint16Array(g),i.HEAPU32=new Uint32Array(g),i.HEAPF32=new Float32Array(g),i.HEAPF64=new Float64Array(g)}function C(){$("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+P+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}x=E=0,w=!1;var R=i.TOTAL_STACK||5242880,P=i.TOTAL_MEMORY||52428800;if(P<R&&i.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+P+"! (TOTAL_STACK="+R+")"),i.buffer?g=i.buffer:("object"==typeof WebAssembly&&"function"==typeof WebAssembly.Memory?(i.wasmMemory=new WebAssembly.Memory({initial:P/T,maximum:P/T}),g=i.wasmMemory.buffer):g=new ArrayBuffer(P),i.buffer=g),A(),y[0]=1668509029,v[1]=25459,115!==_[2]||99!==_[3])throw"Runtime error: expected the system to be little-endian!";function k(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?i.dynCall_v(n):i.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t()}}var O=[],I=[],L=[],D=[],N=[],U=!1;var F=0,z=null;i.preloadedImages={},i.preloadedAudios={};var B="data:application/octet-stream;base64,";function V(e){return String.prototype.startsWith?e.startsWith(B):0===e.indexOf(B)}(function(){var e="avc.wast",t="avc.temp.asm.js";"function"==typeof i.locateFile&&(V(e)||(e=i.locateFile(e)),V(bT)||(bT=i.locateFile(bT)),V(t)||(t=i.locateFile(t)));var n={global:null,env:null,asm2wasm:u,parent:i},r=null;function o(e){var t=i.buffer;e.byteLength<t.byteLength&&i.printErr("the new buffer in mergeMemory is smaller than the previous one. in native wasm, we should grow memory here");var n=new Int8Array(t);new Int8Array(e).set(n),function(e){i.buffer=g=e}(e),A()}function l(){try{if(i.wasmBinary)return new Uint8Array(i.wasmBinary);if(i.readBinary)return i.readBinary(bT);throw"on the web, we need the wasm binary to be preloaded and set on Module['wasmBinary']. emcc.py will do that for you when generating HTML (but not JS)"}catch(e){$(e)}}function c(e,t,c){if("object"!=typeof WebAssembly)return i.printErr("no native wasm support detected"),!1;if(!(i.wasmMemory instanceof WebAssembly.Memory))return i.printErr("no native wasm Memory in use"),!1;function u(e,t){(r=e.exports).memory&&o(r.memory),i.asm=r,i.usingWasm=!0,function(){if(F--,i.monitorRunDependencies&&i.monitorRunDependencies(F),0==F&&z){var e=z;z=null,e()}}()}if(t.memory=i.wasmMemory,n.global={NaN:NaN,Infinity:1/0},n["global.Math"]=Math,n.env=t,F++,i.monitorRunDependencies&&i.monitorRunDependencies(F),i.instantiateWasm)try{return i.instantiateWasm(n,u)}catch(p){return i.printErr("Module.instantiateWasm callback failed with error: "+p),!1}function h(e){u(e.instance,e.module)}function d(e){(i.wasmBinary||!a&&!s||"function"!=typeof fetch?new Promise((function(e,t){e(l())})):fetch(bT,{}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+bT+"'";return e.arrayBuffer()})).catch((function(){return l()}))).then((function(e){return WebAssembly.instantiate(e,n)})).then(e).catch((function(e){i.printErr("failed to asynchronously prepare wasm: "+e),$(e)}))}return i.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||V(bT)||"function"!=typeof fetch?d(h):WebAssembly.instantiateStreaming(fetch(bT,{}),n).then(h).catch((function(e){i.printErr("wasm streaming compile failed: "+e),i.printErr("falling back to ArrayBuffer instantiation"),d(h)})),{}}i.asmPreload=i.asm;var h=i.reallocBuffer;i.reallocBuffer=function(e){return"asmjs"===p?h(e):function(e){e=function(e,t){return e%t>0&&(e+=t-e%t),e}(e,i.usingWasm?T:16777216);var t=i.buffer.byteLength;if(i.usingWasm)try{return-1!==i.wasmMemory.grow((e-t)/65536)?i.buffer=i.wasmMemory.buffer:null}catch{return null}}(e)};var p="";i.asm=function(e,t,n){if(!t.table){var r=i.wasmTableSize;void 0===r&&(r=1024);var a=i.wasmMaxTableSize;"object"==typeof WebAssembly&&"function"==typeof WebAssembly.Table?t.table=void 0!==a?new WebAssembly.Table({initial:r,maximum:a,element:"anyfunc"}):new WebAssembly.Table({initial:r,element:"anyfunc"}):t.table=new Array(r),i.wasmTable=t.table}var s;return t.memoryBase||(t.memoryBase=i.STATIC_BASE),t.tableBase||(t.tableBase=0),d(s=c(0,t),"no binaryen method succeeded."),s}})(),x=10912,I.push();i.STATIC_BASE=1024,i.STATIC_BUMP=9888,x+=16;var H={varargs:0,get:function(e){return H.varargs+=4,y[H.varargs-4>>2]},getStr:function(){return p(H.get())},get64:function(){var e=H.get(),t=H.get();return d(e>=0?0===t:-1===t),e},getZero:function(){d(0===H.get())}};function W(){e()}function j(e,n,i){t(e,n,i)}i._broadwayOnHeadersDecoded=W,i._broadwayOnPictureDecoded=j,S=function(e){d(!w);var t=x;return x=x+e+15&-16,t}(4),b=E=c(x),M=c(b+R),y[S>>2]=M,w=!0,i.wasmTableSize=10,i.wasmMaxTableSize=10,i.asmGlobalArg={},i.asmLibraryArg={abort:$,enlargeMemory:function(){C()},getTotalMemory:function(){return P},abortOnCannotGrowMemory:C,___setErrNo:function(e){return i.___errno_location&&(y[i.___errno_location()>>2]=e),e},___syscall140:function(e,t){H.varargs=t;try{var n=H.getStreamFromFD(),i=(H.get(),H.get()),r=H.get(),a=H.get(),s=i;return FS.llseek(n,s,a),y[r>>2]=n.position,n.getdents&&0===s&&0===a&&(n.getdents=null),0}catch(o){return(typeof FS>"u"||!(o instanceof FS.ErrnoError))&&$(o),-o.errno}},___syscall146:function e(t,n){H.varargs=n;try{var r=H.get(),a=H.get(),s=H.get(),o=0;e.buffers||(e.buffers=[null,[],[]],e.printChar=function(t,n){var r=e.buffers[t];d(r),0===n||10===n?((1===t?i.print:i.printErr)(m(r,0)),r.length=0):r.push(n)});for(var l=0;l<s;l++){for(var c=y[a+8*l>>2],u=y[a+(8*l+4)>>2],h=0;h<u;h++)e.printChar(r,_[c+h]);o+=u}return o}catch(p){return(typeof FS>"u"||!(p instanceof FS.ErrnoError))&&$(p),-p.errno}},___syscall54:function(e,t){H.varargs=t;try{return 0}catch(n){return(typeof FS>"u"||!(n instanceof FS.ErrnoError))&&$(n),-n.errno}},___syscall6:function(e,t){H.varargs=t;try{var n=H.getStreamFromFD();return FS.close(n),0}catch(i){return(typeof FS>"u"||!(i instanceof FS.ErrnoError))&&$(i),-i.errno}},_broadwayOnHeadersDecoded:W,_broadwayOnPictureDecoded:j,_emscripten_memcpy_big:function(e,t,n){return _.set(_.subarray(t,t+n),e),e},DYNAMICTOP_PTR:S,STACKTOP:E};var G,X=i.asm(i.asmGlobalArg,i.asmLibraryArg,g);function q(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Y(e){function t(){i.calledRun||(i.calledRun=!0,!h&&(U||(U=!0,k(I)),k(L),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),N.unshift(e);var e;k(N)}()))}e=e||i.arguments,F>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),O.unshift(e);var e;k(O)}(),F>0)||i.calledRun||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t())}function $(e){throw i.onAbort&&i.onAbort(e),void 0!==e?(i.print(e),i.printErr(e),e=JSON.stringify(e)):e="",h=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(i.asm=X,i._broadwayCreateStream=function(){return i.asm._broadwayCreateStream.apply(null,arguments)},i._broadwayExit=function(){return i.asm._broadwayExit.apply(null,arguments)},i._broadwayGetMajorVersion=function(){return i.asm._broadwayGetMajorVersion.apply(null,arguments)},i._broadwayGetMinorVersion=function(){return i.asm._broadwayGetMinorVersion.apply(null,arguments)},i._broadwayInit=function(){return i.asm._broadwayInit.apply(null,arguments)},i._broadwayPlayStream=function(){return i.asm._broadwayPlayStream.apply(null,arguments)},i.asm=X,q.prototype=new Error,q.prototype.constructor=q,z=function e(){i.calledRun||Y(),i.calledRun||(z=e)},i.run=Y,i.exit=function(e,t){t&&i.noExitRuntime&&0===e||(i.noExitRuntime||(h=!0,E=undefined,k(D),i.onExit&&i.onExit(e)),o&&process.exit(e),i.quit(e,new q(e)))},i.abort=$,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();i.noExitRuntime=!0,Y(),typeof xT<"u"&&xT.Module&&(G=xT.Module),typeof i<"u"&&(G=i),G._broadwayOnHeadersDecoded=e,G._broadwayOnPictureDecoded=t;var K,Z=!1;return G.onRuntimeInitialized=function(){Z=!0,K&&K(G)},function(e){Z?e(G):K=e}},MT=function(){return(new Date).getTime()};typeof performance<"u"&&performance.now&&(MT=function(){return performance.now()});var ST=function(e){this.options=e||{},this.now=MT;var t,n,i,r=function(e,i,r){var a=this.pictureBuffers[e];a||(a=this.pictureBuffers[e]=n(e,i*r*3/2));var s,o=!1;if(this.infoAr.length&&(o=!0,s=this.infoAr),this.infoAr=[],this.options.rgb){t||(t=GT(i,r)),t.inp.set(a),t.doit();var l=new Uint8Array(t.outSize);return l.set(t.out),o&&(s[0].finishDecoding=MT()),void this.onPictureDecoded(l,i,r,s)}o&&(s[0].finishDecoding=MT()),this.onPictureDecoded(a,i,r,s)}.bind(this);this.options.sliceMode&&(r=function(e,t,r,a){var s=this.pictureBuffers[e];s||(s=this.pictureBuffers[e]=n(e,t*r*3/2));var o,l=this.pictureBuffers[a];l||(l=this.pictureBuffers[a]=i(a,18)),this.infoAr.length&&(o=this.infoAr),this.infoAr=[],o[0].finishDecoding=MT();for(var c=[],u=0;u<20;++u)c.push(l[u]);o[0].sliceInfoAr=c,this.onPictureDecoded(s,t,r,o)}.bind(this));var a=ET.apply({},[function(){},r]),s=1048576,o=this;this.onPictureDecoded=function(e,t,n,i){},this.onDecoderReady=function(){};var l=[];this.decode=function(e,t,n){l.push([e,t,n])},a((function(e){e.HEAP8;var t=e.HEAPU8;e.HEAP16,e.HEAP32,e._broadwayInit(),n=function(e,n){return t.subarray(e,e+n)},i=function(e,n){return new Uint32Array(t.buffer,e,n)},o.streamBuffer=n(e._broadwayCreateStream(s),s),o.pictureBuffers={},o.infoAr=[];var r=0;if(o.options.sliceMode?(r=o.options.sliceNum,o.decode=function(t,n,i){o.infoAr.push(n),n.startDecoding=MT();var a,s=n.nals;if(!s){s=[],n.nals=s;var l=t.length,c=!1,u=0,h=0;for(a=0;a<l;++a)if(1===t[a]&&0===t[a-1]&&0===t[a-2]){var d=a-2;0===t[a-3]&&(d=a-3),c&&s.push({offset:u,end:d,type:31&t[h]}),u=d,h=d+3,0===t[a-3]&&(h=d+4),c=!0}c&&s.push({offset:u,end:a,type:31&t[h]})}var p,f=0,m=0;for(a=0;a<s.length;++a)1===s[a].type||5===s[a].type?(f===r&&(p=t.subarray(s[a].offset,s[a].end),o.streamBuffer[m]=0,m+=1,o.streamBuffer.set(p,m),m+=p.length),f+=1):(p=t.subarray(s[a].offset,s[a].end),o.streamBuffer[m]=0,m+=1,o.streamBuffer.set(p,m),m+=p.length,e._broadwayPlayStream(m),m=0);i(),e._broadwayPlayStream(m)}):o.decode=function(t,n){n&&(o.infoAr.push(n),n.startDecoding=MT()),o.streamBuffer.set(t),e._broadwayPlayStream(t.length)},l.length){var a=0;for(a=0;a<l.length;++a)o.decode(l[a][0],l[a][1],l[a][2]);l=[]}o.onDecoderReady(o)}))};ST.prototype={};var TT,AT,CT,RT,PT,kT,OT,IT,LT,DT,NT,UT,FT,zT,BT,VT,HT,WT,jT={},GT=function(e,t){var n=e+"x"+t;if(jT[n])return jT[n];for(var i=e*t,r=i>>2,a=i+r+r,s=e*t*4,o=a+s+4*Math.pow(2,24),l=Math.pow(2,24),c=l;c<o;)c+=l;var u=new ArrayBuffer(c),h=function(e,t,n){var i=e.Math.imul,r=e.Math.min,a=e.Math.max,s=e.Math.pow;new e.Uint8Array(n),new e.Uint32Array(n);var o=new e.Uint8Array(n);new e.Uint8Array(n);var l=new e.Uint32Array(n),c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0;function v(e,t){t|=0;var n=0,r=0;for(c=e|=0,g=0|i(e,4),h=0|i(0|c,0|(u=t)),d=h>>2,p=0|i(0|i(c,u),4),_=(f=(m=0)+p|0)+(h+d|0+d)|0,r=~~+s(2,24),r=0|i(r,4),n=0;(0|n)<(0|r)|0;n=n+4|0)l[_+n>>2]=0}function y(){var e=0,t=0,n=0,i=0,r=0,a=0,s=0,p=0,v=0,y=0,w=0,b=0;for(w=0|m,n=(t=(e=0|f)+h|0)+d|0,v=0;(0|v)<(0|u);v=v+2|0){for(y=0;(0|y)<(0|c);y=y+2|0)i=0|o[e|0],r=0|o[e+c|0],a=0|o[t|0],s=0|o[n|0],(p=0|l[_+(b=((i<<16)+(a<<8)|0)+s|0)>>2])||(p=0|x(i,a,s),l[_+b>>2]=0|p),l[w>>2]=p,(p=0|l[_+(b=((r<<16)+(a<<8)|0)+s|0)>>2])||(p=0|x(r,a,s),l[_+b>>2]=0|p),l[w+g>>2]=p,w=w+4|0,i=0|o[(e=e+1|0)|0],r=0|o[e+c|0],(p=0|l[_+(b=((i<<16)+(a<<8)|0)+s|0)>>2])||(p=0|x(i,a,s),l[_+b>>2]=0|p),l[w>>2]=p,(p=0|l[_+(b=((r<<16)+(a<<8)|0)+s|0)>>2])||(p=0|x(r,a,s),l[_+b>>2]=0|p),l[w+g>>2]=p,w=w+4|0,e=e+1|0,t=t+1|0,n=n+1|0;w=w+g|0,e=e+c|0}}function x(e,t,n){t|=0,n|=0;var s=0,o=0,l=0,c=0,u=0,h=0;return u=0|i(1192,(e|=0)-16|0),h=0|i(1634,n-128|0),o=(u-(0|i(832,n-128|0))|0)-(0|i(400,t-128|0))>>10,l=u+(0|i(2066,t-128|0))>>10,(255&(s=u+h>>10))!=(0|s)|0&&(s=0|r(255,0|a(0,0|s))),(255&o)!=(0|o)|0&&(o=0|r(255,0|a(0,0|o))),(255&l)!=(0|l)|0&&(l=0|r(255,0|a(0,0|l))),c=255,c=(c<<=8)+l|0,c=(c<<=8)+o|0,0|(c=(c<<=8)+s|0)}return{init:v,doit:y}}(xT,0,u);return h.init(e,t),jT[n]=h,h.heap=u,h.out=new Uint8Array(u,0,s),h.inp=new Uint8Array(u,s,a),h.outSize=s,h};typeof self<"u"&&(TT=!1,CT=!1,RT=!1,PT=0,kT=0,OT=0,DT=0,NT=[],BT=[],VT=function(e){if(BT.length){for(var t=BT.shift();t&&t.byteLength!==e;)t=BT.shift();if(t)return t}return new ArrayBuffer(e)},HT=function(e,t,n,i,r){var a=function(n,r){var a=0;for(a=0;a<16;++a){var s=n+i*a,o=r+i*a;t.set(e.subarray(s,o),s)}},s=function(n,r){var a=0;for(a=0;a<8;++a){var s=n+i/2*a,o=r+i/2*a;t.set(e.subarray(s,o),s)}},o=function(n,i){t.set(e.subarray(n,i),n)},l=n[0],c=n[1];c>0&&(a(l,c),s(n[2],n[3]),s(n[4],n[5])),l=n[6],(c=n[7])>0&&(a(l,c),s(n[8],n[9]),s(n[10],n[11])),l=n[12],(c=n[15])>0&&(o(l,c),o(n[13],n[16]),o(n[14],n[17]))},WT=function(e){OT=(kT=e)-1},self.addEventListener("message",(function(e){if(TT){if(CT&&e.data.reuse&&BT.push(e.data.reuse),e.data.buf)return void(RT&&0!==DT?NT.push(e.data):AT.decode(new Uint8Array(e.data.buf,e.data.offset||0,e.data.length),e.data.info,(function(){RT&&PT!==OT&&postMessage(e.data,[e.data.buf])})));if(e.data.slice){var t=MT();if(HT(new Uint8Array(e.data.slice),LT,e.data.infos[0].sliceInfoAr,e.data.width,e.data.height),e.data.theOne&&(HT(LT,new Uint8Array(e.data.slice),IT,e.data.width,e.data.height),zT>e.data.infos[0].timeDecoding&&(e.data.infos[0].timeDecoding=zT),e.data.infos[0].timeCopy+=MT()-t),postMessage(e.data,[e.data.slice]),0===(DT-=1)&&NT.length){var n=NT.shift();AT.decode(new Uint8Array(n.buf,n.offset||0,n.length),n.info,(function(){RT&&PT!==OT&&postMessage(n,[n.buf])}))}return}if(e.data.setSliceCnt)return void WT(e.data.sliceCnt)}else e.data&&"Broadway.js - Worker init"===e.data.type&&(TT=!0,AT=new ST(e.data.options),e.data.options.sliceMode?(CT=!0,RT=!0,PT=e.data.options.sliceNum,WT(e.data.options.sliceCnt),AT.onPictureDecoded=function(e,t,n,i){var r=new Uint8Array(VT(e.length));HT(e,r,i[0].sliceInfoAr,t),UT=i[0].startDecoding,FT=i[0].finishDecoding,zT=FT-UT,i[0].timeDecoding=zT,i[0].timeCopy=0,postMessage({slice:r.buffer,sliceNum:PT,width:t,height:n,infos:i},[r.buffer]),DT=kT-1,LT=e,IT=i[0].sliceInfoAr}):e.data.options.reuseMemory?(CT=!0,AT.onPictureDecoded=function(e,t,n,i){var r=new Uint8Array(VT(e.length));r.set(e,0,e.length),postMessage({buf:r.buffer,length:e.length,width:t,height:n,infos:i},[r.buffer])}):AT.onPictureDecoded=function(e,t,n,i){e&&(e=new Uint8Array(e));var r=new Uint8Array(e.length);r.set(e,0,e.length),postMessage({buf:r.buffer,length:e.length,width:t,height:n,infos:i},[r.buffer])},postMessage({consoleLog:"broadway worker initialized"}))}),!1)),ST.nowValue=MT;var XT=ST,qT=((e,t,n)=>(n=null!=e?ly(dy(e)):{},((e,t,n,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of hy(t))!py.call(e,r)&&r!==n&&cy(e,r,{get:()=>t[r],enumerable:!(i=uy(t,r))||i.enumerable});return e})(e&&e.__esModule?n:cy(n,"default",{value:e,enumerable:!0}),e)))(my()),YT=(oi=class{constructor({decoded_frame_consumer:e}){Gi(this,ri),Gi(this,ii,null),Xi(this,ii,e)}_onFrameDecoded(e){var t;qi(this,ri,ai).call(this,e),null==(t=ji(this,ii))||t.consumeDecodedFrame(e)}},ii=new WeakMap,ri=new WeakSet,ai=function({meta_data:e}){var t;qi(this,ri,si).call(this,{meta_data:e});for(let n of e.viewport_layout_camera_entities)null==(t=n.viewport.camera_projection)||t.updateFromFrameCameraTransform({frame_camera_transform:n})},si=function({meta_data:e}){for(let{camera_entity:t,world_position:n,world_orientation:i}of e.other_clients_camera_entities)t._setGlobalTransform({global_transform:{position:n,orientation:i},change_source:"external"})},oi),$T=(di=class extends YT{constructor({decoded_frame_consumer:e}){super({decoded_frame_consumer:e}),Gi(this,li,new XT),Gi(this,ci,null),Gi(this,ui,null),Gi(this,hi,((e,t,n,i)=>{let r=t,a=n,s=t/2,o=n/2,l=r*a,c=s*o;ji(this,ui).drawNextOutputPicture({yData:e.subarray(0,l),uData:e.subarray(l,l+c),vData:e.subarray(l+c,l+c+c),yDataPerRow:r,yRowCnt:a,uDataPerRow:s,uRowCnt:o});let u=i[0];super._onFrameDecoded({decoded_frame:ji(this,ci),meta_data:u})}))}configure({codec:e,frame_dimensions:t}){if("h264"!==e)throw new Error("Software decoder supports only h264 encoding");return Xi(this,ci,new OffscreenCanvas(t[0],t[1])),Xi(this,ui,new qT.default({canvas:ji(this,ci),width:t[0],height:t[1]})),ji(this,li).onPictureDecoded=ji(this,hi),Promise.resolve(this)}resize({frame_dimensions:e}){ji(this,ci)&&(ji(this,ci).width=e[0],ji(this,ci).height=e[1]),ji(this,ui)&&(ji(this,ui).width=e[0],ji(this,ui).height=e[1])}release(){}consumeEncodedFrame({encoded_frame:e,meta_data:t}){let n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);ji(this,li).decode(n,t)}},li=new WeakMap,ci=new WeakMap,ui=new WeakMap,hi=new WeakMap,di),KT=(fi=class extends YT{constructor({decoded_frame_consumer:e}){super({decoded_frame_consumer:e}),Gi(this,_i,null),Gi(this,vi,null),Gi(this,yi,!0),Gi(this,xi,new Map),Gi(this,wi,null),Gi(this,bi,(e=>{ji(this,wi)&&ji(this,wi).close();let t=ji(this,xi).get(e.timestamp);t&&(super._onFrameDecoded({decoded_frame:e,meta_data:t}),Xi(this,wi,e))}))}static async findSupportedCodec(){var e;if(typeof VideoDecoder>"u")return null;for(let t of ji(this,pi,mi).keys()){let n=await qi(e=fi,pi,gi).call(e,{codec:t});if(n)return n.codec,t}return null}async configure({codec:e,frame_dimensions:t}){var n;this.release();let i=await qi(n=fi,pi,gi).call(n,{codec:e,frame_dimensions:t});if(!i)throw new Error("Codec not supported");return Xi(this,_i,new VideoDecoder({output:ji(this,bi),error:e=>{}})),Xi(this,vi,i),ji(this,_i).configure(ji(this,vi)),ji(this,vi),this}resize({frame_dimensions:e}){ji(this,_i)&&ji(this,vi)&&(ji(this,vi).codedWidth=e[0],ji(this,vi).codedHeight=e[1],Xi(this,yi,!1),ji(this,_i).configure(ji(this,vi)))}release(){var e,t;null==(e=ji(this,wi))||e.close(),null==(t=ji(this,_i))||t.close()}consumeEncodedFrame({encoded_frame:e,meta_data:t}){let n=new EncodedVideoChunk({timestamp:t.frame_counter,type:ji(this,yi)?"key":"delta",data:new Uint8Array(e.buffer,e.byteOffset,e.byteLength)});Xi(this,yi,!1),ji(this,xi).set(t.frame_counter,t),ji(this,_i).decode(n)}},pi=new WeakSet,mi=function(){return Object.freeze(new Map([["h265",["hvc1.1.6.L123.00"]],["h264",["avc1.42001E","avc1.42002A","avc1.42E01E","avc1.64001f","avc1.42002A"]]]))},gi=async function({codec:e,frame_dimensions:t}){if(typeof VideoDecoder>"u"||!ji(fi,pi,mi).has(e))return null;let n=ji(fi,pi,mi).get(e),i={codec:"",codedWidth:null==t?void 0:t[0],codedHeight:null==t?void 0:t[1],optimizeForLatency:!0},r=["prefer-hardware","prefer-software","no-preference"];for(let a of r)if("h264"!==e||"prefer-hardware"!==a)for(let e of n){i.codec=e;let t=await VideoDecoder.isConfigSupported({...i,hardwareAcceleration:a});if(t.supported&&t.config)return t.config}return null},_i=new WeakMap,vi=new WeakMap,yi=new WeakMap,xi=new WeakMap,wi=new WeakMap,bi=new WeakMap,Gi(fi,pi),fi),ZT=class{refreshSize(){}},QT=class extends ZT{constructor(e,t){super(),Hi(this,"_canvas"),Hi(this,"_context2D");let n=e.getContext("2d",t);if(null===n)throw new Error(`Cannot create a 2d context from canvas ${e}`);this._canvas=e,this._context2D=n}drawFrame({frame:e,left:t,top:n}){this._context2D.drawImage(e,t,n,this._canvas.width,this._canvas.height,0,0,this._canvas.width,this._canvas.height)}release(){this._context2D.reset()}},JT=class extends ZT{constructor(e,t="webgl",n){super(),Hi(this,"_canvas"),Hi(this,"_context"),Hi(this,"_texture_ref",null),Hi(this,"_shader_program",null),Hi(this,"_frame_buffer",null);let i=e.getContext(t,n);if(null===i)throw new Error(`Cannot create a ${t} context from canvas`);this._canvas=e,this._context=i,this._initShaderProgram(),this._initBuffers(),this._initTexture()}get native(){return this._context}set frame_buffer(e){this._frame_buffer=e}drawFrame({frame:e,left:t,top:n}){let i=this._context;null!==this._frame_buffer&&i.bindFramebuffer(i.FRAMEBUFFER,this._frame_buffer),i.clearColor(1,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);let r=e.width||e.displayWidth,a=e.height||e.displayHeight,s=i.getUniformLocation(this._shader_program,"size"),o=i.getUniformLocation(this._shader_program,"offset");i.uniform2fv(s,[this._canvas.width/r,this._canvas.height/a]),i.uniform2fv(o,[t/r,n/a]),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._texture_ref),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),i.drawArrays(i.TRIANGLE_STRIP,0,4)}refreshSize(){this._context.viewport(0,0,this._canvas.width,this._canvas.height)}release(){let e=this._context;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}_initShaderProgram(){let e=this._context,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,"\n            attribute vec2 position;\n            varying vec2 texCoord;\n            uniform vec2 size;\n            uniform vec2 offset;\n\n            void main() {\n                texCoord = (position + 1.0) * 0.5;\n                texCoord.y = 1.0 - texCoord.y;\n                texCoord = size * texCoord + offset;\n                gl_Position = vec4(position, 0.0, 1.0);\n            }"),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS);let n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,"\n            precision mediump float;\n            varying vec2 texCoord;\n            uniform sampler2D texture;\n\n            void main() {\n                gl_FragColor = texture2D(texture, texCoord);\n            }"),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS);let i=e.createProgram();e.attachShader(i,t),e.attachShader(i,n),e.linkProgram(i),e.useProgram(i),e.getProgramParameter(i,e.LINK_STATUS),e.useProgram(i),this._shader_program=i}_initBuffers(){let e=this._context,t=e.createBuffer(),n=new Float32Array([1,1,-1,1,1,-1,-1,-1]);e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);let i=e.getAttribLocation(this._shader_program,"position");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0)}_initTexture(){let e=this._context;this._texture_ref=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texture_ref),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null);let t=e.getUniformLocation(this._shader_program,"texture");e.uniform1i(t,0)}},eA=(Mi=class extends OE{constructor(){super(...arguments),Hi(this,"viewports",[]),Gi(this,Ei,null),Hi(this,"offset",[0,0])}drawFrame({frame:e,meta_data:t}){Xi(this,Ei,{frame:e,meta_data:t}),this._drawFrame({frame:e,meta_data:t})}redrawLastFrame(){null!==ji(this,Ei)&&this._drawFrame(ji(this,Ei))}addViewport({viewport:e}){this.viewports.push(e)}removeViewport({viewport:e}){let t=this.viewports.indexOf(e);-1!==t&&this.viewports.splice(t,1)}release(){Xi(this,Ei,null);for(let e of this.viewports)e.release()}isValid(){return this.viewports.length>0&&this.viewports.every((e=>e.isValid()))}_getViewportConfigs({width:e,height:t}){if(!this.isValid())throw new Error("Invalid config");return this.viewports.map((n=>({camera_rtid:n.camera_projection.camera_entity.rtid,left:(this.offset[0]+n.relative_rect.left*this.width)/e,top:(this.offset[1]+n.relative_rect.top*this.height)/t,width:n.width/e,height:n.height/t,render_target_index:n.render_target_index,z_index:n.z_index})))}},Ei=new WeakMap,Mi),tA=(Li=class{constructor({canvas:e,onResized:t}){Gi(this,Oi),Gi(this,Si),Gi(this,Ti),Gi(this,Ai,0),Gi(this,Ci,500),Gi(this,Ri),Gi(this,Pi,(()=>{0!==ji(this,Ai)&&clearTimeout(ji(this,Ai)),Xi(this,Ai,setTimeout(ji(this,ki),ji(this,Ci)))})),Gi(this,ki,(()=>{let e=[ji(this,Si).width,ji(this,Si).height];ji(this,Si).width=ji(this,Si).clientWidth,ji(this,Si).height=ji(this,Si).clientHeight;let t=[ji(this,Si).width,ji(this,Si).height];0===ji(this,Si).width||0===ji(this,Si).height||qi(this,Oi,Ii).call(this,e,t)&&ji(this,Ri).call(this,{old_size:e,new_size:t})})),Xi(this,Si,e),Xi(this,Ti,new ResizeObserver(ji(this,Pi))),Xi(this,Ri,t),ji(this,Ti).observe(ji(this,Si))}release(){ji(this,Ti).disconnect()}},Si=new WeakMap,Ti=new WeakMap,Ai=new WeakMap,Ci=new WeakMap,Ri=new WeakMap,Pi=new WeakMap,ki=new WeakMap,Oi=new WeakSet,Ii=function(e,t){return e.some(((e,n)=>e!==t[n]))},Li),nA=class extends Event{constructor(){super("on-rendering-surface-resized")}},iA=(zi=class extends eA{constructor({canvas_element:e,context_type:t,context_attributes:n}){super(),Gi(this,Di),Gi(this,Ni),Gi(this,Ui),Gi(this,Fi,(e=>{ji(this,Ni).refreshSize(),this._dispatchEvent(new nA);for(let t of this.viewports)t._onResize()}));let i="string"==typeof e?document.getElementById(e):e;if(null===i)throw new Error(`Cannot find canvas ${e}`);if("CANVAS"!==i.nodeName)throw new Error(`HTML element ${e} is a '${i.nodeName}', it MUST be CANVAS`);switch(Xi(this,Di,i),t){case"2d":Xi(this,Ni,new QT(ji(this,Di)));break;case"webgl":case"webgl2":Xi(this,Ni,new JT(ji(this,Di),t,n))}this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,Xi(this,Ui,new tA({canvas:this.canvas,onResized:ji(this,Fi)})),ji(this,Ni).refreshSize()}get width(){return ji(this,Di).clientWidth}get height(){return ji(this,Di).clientHeight}get dimensions(){return[this.width,this.height]}get canvas(){return ji(this,Di)}release(){super.release(),ji(this,Ui).release(),ji(this,Ni).release()}getContext(){return ji(this,Ni)}getBoundingRect(){let e=this.canvas.getClientRects()[0];return e&&(e.x=Math.ceil(e.x),e.y=Math.ceil(e.y),e.width=Math.ceil(e.width),e.height=Math.ceil(e.height)),new gM(e??{width:this.canvas.width,height:this.canvas.height})}_drawFrame({frame:e,meta_data:t}){ji(this,Ni).drawFrame({frame:e,left:this.offset[0],top:this.offset[1],meta_data:t});for(let n of this.viewports){let e=n._drawOverlays();e&&ji(this,Ni).drawFrame({frame:e,left:n.offset[0],top:n.offset[1],meta_data:t})}}},Di=new WeakMap,Ni=new WeakMap,Ui=new WeakMap,Fi=new WeakMap,zi);typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink")||(window.__LIVELINK__["@3dverse/livelink"]="0.8.25"));var rA=Object.defineProperty,aA=Hr.createContext({instance:null,isConnecting:!1,isDisconnected:!1,disconnect:()=>{}});function sA({sceneId:e,sessionId:t,isTransient:n,token:i,LoadingPanel:r,InactivityWarningPanel:a,ConnectionErrorPanel:s,autoJoinExisting:o=!0,children:l}){let[c,u]=Hr.useState(null),[h,d]=Hr.useState(!0),[p,f]=Hr.useState(!1),[m,g]=Hr.useState(null),[_,v]=Hr.useState("Unknown error"),y=Hr.useRef(new Map),x=Hr.useCallback((()=>null==c?void 0:c.disconnect()),[c]);return Hr.useEffect((()=>{let r=new AbortController,a=()=>{g(null)};return(e=>{let t=function(e){return JSON.stringify(e)}(e),r=y.current.get(t);return r||(r=(async({autoJoinExisting:e,sceneId:t,sessionId:r})=>{if(r){let e=await iM.findById({session_id:r,token:i});if(!e)throw new Error(`Session '${r}' not found on scene '${t}'`);return mM.join({session:e})}if(t)return e?mM.join_or_start({scene_id:t,token:i,is_transient:n}):mM.start({scene_id:t,token:i,is_transient:n});throw new Error("What are we doing here?!")})(e).then((e=>(y.current.delete(t),e))),y.current.set(t,r)),r})({autoJoinExisting:o,sceneId:e,sessionId:t,token:i}).then((e=>{r.signal.aborted||(function(e){let t=async()=>{e.session.removeEventListener("TO_REMOVE__viewports-added",t);let n=await KT.findSupportedCodec();await e.configureRemoteServer({codec:n||void 0}),await e.setEncodedFrameConsumer({encoded_frame_consumer:null!==n?new KT({decoded_frame_consumer:e.default_decoded_frame_consumer}):new $T({decoded_frame_consumer:e.default_decoded_frame_consumer})}),e.TO_REMOVE__startIfReady()};e.session.addEventListener("TO_REMOVE__viewports-added",t)}(e),u(e),e.TO_REMOVE__setReadyCallback((async()=>{e.startStreaming(),d(!1)})),e.session.addEventListener("on-inactivity-warning",g),e.session.addEventListener("on-activity-detected",a))})).catch((e=>{d(!1),f(!0),v(e)})),()=>{r.abort(),null==c||c.session.removeEventListener("on-inactivity-warning",g),null==c||c.session.removeEventListener("on-activity-detected",a),u(null),d(!0),f(!1),g(null)}}),[i,o,e,t,n]),Hr.useEffect((()=>{if(!c)return;let e=e=>{f(!0),g(null),v(e.reason)};return c.session.addEventListener("on-disconnected",e),()=>{c.session.removeEventListener("on-disconnected",e)}}),[c]),Hr.useEffect((()=>()=>{null==c||c.disconnect()}),[c]),Wr.createElement(aA.Provider,{value:{instance:c,isConnecting:h,isDisconnected:p,disconnect:x}},h&&r&&Wr.createElement(r,{stage:""}),p&&s&&Wr.createElement(s,{error:_}),m&&a&&Wr.createElement(a,{warningDuration:m.seconds_remaining,onActivityDetected:()=>{m.resetTimer(),g(null)}}),l)}function oA(e={},t=[]){let{name:n="Camera",position:i=[0,1,5],orientation:r=[0,0,0,1],eulerOrientation:a=[0,0,0],renderGraphRef:s="398ee642-030a-45e7-95df-7147f6c43392",settings:o={grid:!0,skybox:!1,gradient:!0},renderTargetIndex:l=-1,perspective_lens:c={fovy:60,nearPlane:.1,farPlane:1e4}}=e,u="orientation"in e?r:void 0,h=!u&&"eulerOrientation"in e?a:void 0,d="orthographic_lens"in e?e.orthographic_lens:void 0,p=d?void 0:c,{isPending:f,entity:m}=function(e,t=[]){let{instance:n}=Hr.useContext(aA),[i,r]=Hr.useState(null),[a,s]=Hr.useState(!0),[,o]=Hr.useReducer((e=>e+1),0),l=e;return Hr.useEffect((()=>n?((async()=>"components"in e?await n.scene.newEntity(e):"linkage"in l?await n.scene.findEntity({entity_uuid:l.euid,linkage:l.linkage}):"euid"in l?(await n.scene.findEntities({entity_uuid:l.euid}))[0]:"names"in l?(await n.scene.findEntitiesByNames({entity_names:l.names}))[0]:"mandatory_components"in l?(await n.scene.findEntitiesWithComponents({mandatory_components:l.mandatory_components,forbidden_components:l.forbidden_components}))[0]:null)().then((e=>r(e))).finally((()=>s(!1))),()=>{r(null),s(!0)}):void 0),[n,l.euid,l.linkage,l.names,l.mandatory_components,l.forbidden_components]),Hr.useEffect((()=>{let e="any"===t,n=0===t.length;if(!i||n)return;let r=e?o:e=>{e.isAnyComponentDirty({components:t})&&o()};return i.addEventListener("on-entity-updated",r),()=>{i.removeEventListener("on-entity-updated",r)}}),[i,t]),{isPending:a,entity:i}}({name:n,components:{local_transform:{position:i,orientation:u,eulerOrientation:h},camera:{renderGraphRef:s,dataJSON:o,renderTargetIndex:l},perspective_lens:p,orthographic_lens:d},options:{auto_broadcast:!1,delete_on_client_disconnection:!0}},t);return{isPending:f,cameraEntity:m}}var lA=Hr.createContext({canvas:null,renderingSurface:null});function cA({children:e,contextType:t="2d",contextAttributes:n,width:i,height:r,...a}){let{instance:s}=Hr.useContext(aA),{canvas:o}=Hr.useContext(lA),[l,c]=Hr.useState(null),u=Hr.useRef(null);return Hr.useEffect((()=>{if(!s||!u.current)return;let e=u.current.getBoundingClientRect();if(!e.width||!e.height)return;let i=new iA({canvas_element:u.current,context_type:t,context_attributes:n});return c(i),()=>{i.release(),c(null)}}),[s,t,n]),Wr.createElement(lA.Provider,{value:{canvas:u.current,renderingSurface:l}},Wr.createElement("div",{"data-role":"canvas-container",style:uA({parentCanvas:o,width:i,height:r}),...a},Wr.createElement("canvas",{ref:u,style:{position:"absolute",width:"100%",height:"100%",pointerEvents:"none"}}),e))}function uA({parentCanvas:e,width:t,height:n}){return{overflow:"clip",...e?{position:"absolute",width:t,height:n}:{position:"relative",width:t??"100%",height:n??"100%"}}}var hA=Hr.createContext({viewport:null,viewportDomElement:null,zIndex:0,camera:null});function dA({setHoveredEntity:e,setPickedEntity:t,renderTargetIndex:n=-1,children:i,...r}){let{cameraEntity:a,client:s,cameraIndex:o,...l}=r,{instance:c}=Hr.useContext(aA),{renderingSurface:u,canvas:h}=Hr.useContext(lA),{zIndex:d=0}=Hr.useContext(hA),[p,f]=Hr.useState(null),[m,g]=Hr.useState(null),[_,v]=Hr.useState(null),y=Hr.useRef(null),x=Hr.useCallback((()=>{!y.current||!h||!p||(y.current,p.relative_rect=yM.from_dom_elements({element:y.current,parent:h}))}),[p,h,y.current]);Hr.useEffect((()=>{if(!y.current)return;let e=new ResizeObserver(x);return e.observe(y.current),()=>{e.disconnect()}}),[y.current,x]),Hr.useEffect((()=>{if(u)return u.addEventListener("on-rendering-surface-resized",x),()=>{u.removeEventListener("on-rendering-surface-resized",x)}}),[u,x]);let w=d+1;return Hr.useEffect((()=>{if(c&&u&&h&&y.current)try{let e=yM.from_dom_elements({element:y.current,parent:h}),t=new bM({core:c,rendering_surface:u,options:{rect:e,z_index:w,render_target_index:n,dom_element:y.current}});return t.width,t.height,c.addViewports({viewports:[t]}),f(t),()=>{c.removeViewport({viewport:t}),t.release(),f(null)}}catch(e){}}),[c,u,h,w]),Hr.useEffect((()=>{s?s.getCameraEntities().then((e=>{g(e[o??0])})):g(a??null)}),[a,s,o]),Hr.useEffect((()=>{!p||!m||(p.camera_projection=new wT({camera_entity:m,viewport:p}),v(p.camera_projection))}),[p,m]),Hr.useEffect((()=>{if(!p)return;let n=e=>null==t?void 0:t(e.picked_entity&&e.ws_position&&e.ws_normal?{entity:e.picked_entity,ws_position:e.ws_position,ws_normal:e.ws_normal}:null);t&&(p.activatePicking(),p.addEventListener("on-entity-picked",n));let i=t=>null==e?void 0:e(t.hovered_entity&&t.ws_position&&t.ws_normal?{entity:t.hovered_entity,ws_position:t.ws_position,ws_normal:t.ws_normal}:null);return e&&(p.activateHovering(),p.addEventListener("on-entity-hovered",i)),()=>{t&&(p.removeEventListener("on-entity-picked",n),p.deactivatePicking()),e&&(p.removeEventListener("on-entity-hovered",i),p.deactivateHovering())}}),[p,t,e]),Wr.createElement(hA.Provider,{value:{viewport:p,viewportDomElement:y.current,zIndex:w,camera:_}},Wr.createElement("div",{ref:y,"data-role":"viewport",...l},i))}var pA=Hr.createContext({cameraController:void 0}),fA=Hr.forwardRef((function({preset:e=mT.orbital,children:t},n){let{viewport:i,camera:r}=Hr.useContext(hA),[a,s]=Hr.useState(void 0);return Hr.useImperativeHandle(n,(()=>a),[a]),Hr.useEffect((()=>{if(!i||!r)return;let t=new yT({camera_entity:r.camera_entity,viewport:i,preset:e});return s(t),()=>{t.release(),s(void 0)}}),[i,r,e]),Wr.createElement(pA.Provider,{value:{cameraController:a}},t)}));Hr.createContext({webXRHelper:null});var mA=1e-6,gA=typeof Float32Array<"u"?Float32Array:Array,_A=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function vA(){var e=new gA(3);return gA!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function yA(e){var t=new gA(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function xA(e){var t=e[0],n=e[1],i=e[2];return Math.hypot(t,n,i)}function wA(e,t,n){var i=new gA(3);return i[0]=e,i[1]=t,i[2]=n,i}function bA(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function EA(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e}function MA(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function SA(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function TA(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function AA(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function CA(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function RA(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function PA(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function kA(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function OA(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function IA(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function LA(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e}function DA(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.hypot(n,i,r)}function NA(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r}function UA(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function FA(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function zA(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function BA(e,t){var n=t[0],i=t[1],r=t[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function VA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function HA(e,t,n){var i=t[0],r=t[1],a=t[2],s=n[0],o=n[1],l=n[2];return e[0]=r*l-a*o,e[1]=a*s-i*l,e[2]=i*o-r*s,e}function WA(e,t,n,i){var r=t[0],a=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=a+i*(n[1]-a),e[2]=s+i*(n[2]-s),e}function jA(e,t,n,i,r,a){var s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,c=s*(a-1),u=s*(3-2*a);return e[0]=t[0]*o+n[0]*l+i[0]*c+r[0]*u,e[1]=t[1]*o+n[1]*l+i[1]*c+r[1]*u,e[2]=t[2]*o+n[2]*l+i[2]*c+r[2]*u,e}function GA(e,t,n,i,r,a){var s=1-a,o=s*s,l=a*a,c=o*s,u=3*a*o,h=3*l*s,d=l*a;return e[0]=t[0]*c+n[0]*u+i[0]*h+r[0]*d,e[1]=t[1]*c+n[1]*u+i[1]*h+r[1]*d,e[2]=t[2]*c+n[2]*u+i[2]*h+r[2]*d,e}function XA(e,t){t=t||1;var n=2*_A()*Math.PI,i=2*_A()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e}function qA(e,t,n){var i=t[0],r=t[1],a=t[2],s=n[3]*i+n[7]*r+n[11]*a+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/s,e}function YA(e,t,n){var i=t[0],r=t[1],a=t[2];return e[0]=i*n[0]+r*n[3]+a*n[6],e[1]=i*n[1]+r*n[4]+a*n[7],e[2]=i*n[2]+r*n[5]+a*n[8],e}function $A(e,t,n){var i=n[0],r=n[1],a=n[2],s=n[3],o=t[0],l=t[1],c=t[2],u=r*c-a*l,h=a*o-i*c,d=i*l-r*o,p=r*d-a*h,f=a*u-i*d,m=i*h-r*u,g=2*s;return u*=g,h*=g,d*=g,p*=2,f*=2,m*=2,e[0]=o+u+p,e[1]=l+h+f,e[2]=c+d+m,e}function KA(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function ZA(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function QA(e,t,n,i){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function JA(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],s=t[1],o=t[2],l=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(a*a+s*s+o*o),c=l&&VA(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function eC(e){return e[0]=0,e[1]=0,e[2]=0,e}function tC(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function nC(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function iC(e,t){var n=e[0],i=e[1],r=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(n-a)<=mA*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=mA*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=mA*Math.max(1,Math.abs(r),Math.abs(o))}((e,t)=>{for(var n in t)rA(e,n,{get:t[n],enumerable:!0})})({},{add:()=>MA,angle:()=>JA,bezier:()=>GA,ceil:()=>CA,clone:()=>yA,copy:()=>bA,create:()=>vA,cross:()=>HA,dist:()=>lC,distance:()=>DA,div:()=>oC,divide:()=>AA,dot:()=>VA,equals:()=>iC,exactEquals:()=>nC,floor:()=>RA,forEach:()=>dC,fromValues:()=>wA,hermite:()=>jA,inverse:()=>zA,len:()=>uC,length:()=>xA,lerp:()=>WA,max:()=>kA,min:()=>PA,mul:()=>sC,multiply:()=>TA,negate:()=>FA,normalize:()=>BA,random:()=>XA,rotateX:()=>KA,rotateY:()=>ZA,rotateZ:()=>QA,round:()=>OA,scale:()=>IA,scaleAndAdd:()=>LA,set:()=>EA,sqrDist:()=>cC,sqrLen:()=>hC,squaredDistance:()=>NA,squaredLength:()=>UA,str:()=>tC,sub:()=>aC,subtract:()=>SA,transformMat3:()=>YA,transformMat4:()=>qA,transformQuat:()=>$A,zero:()=>eC});var rC,aC=SA,sC=TA,oC=AA,lC=DA,cC=NA,uC=xA,hC=UA,dC=(rC=vA(),function(e,t,n,i,r,a){var s,o;for(t||(t=3),n||(n=0),o=i?Math.min(i*t+n,e.length):e.length,s=n;s<o;s+=t)rC[0]=e[s],rC[1]=e[s+1],rC[2]=e[s+2],r(rC,rC,a),e[s]=rC[0],e[s+1]=rC[1],e[s+2]=rC[2];return e});Hr.createContext(null),typeof window<"u"&&(window.__LIVELINK__||(window.__LIVELINK__={}),Object.prototype.hasOwnProperty.call(window.__LIVELINK__,"@3dverse/livelink-react")||(window.__LIVELINK__["@3dverse/livelink-react"]="0.2.36"));function pC(){const e=Ng(),t=()=>{const{cameraEntity:t}=oA({position:[-4.228181,3.767539,-2.622507],eulerOrientation:[145.11,-54.1,180],settings:{grid:!1,skybox:!0,bloom:!0,edgeOutlines:!0}});return Qr.jsxs(cA,{className:"boink-canvas",children:[Qr.jsx(dA,{cameraEntity:t,className:"boink-viewport",children:Qr.jsx(fA,{})}),Qr.jsx("button",{className:"end-dream",onClick:()=>e(cv()),children:"Exit Dream"})]})};return Qr.jsx(sA,{sceneId:"138aa249-059e-4e20-a2bb-caa3ff268262",token:"public_C6CX5OR6VcWdWW4O",LoadingPanel:()=>Qr.jsx("div",{className:"boink-loading",children:"Loading Boink..."}),children:Qr.jsx(t,{})})}function fC({type:e="none",...t}){const n=void 0===t.onClick;return Qr.jsx("button",{className:(n?"unclickable-button ":"")+`${e}-button`,style:t.style,title:t.tooltip,onClick:e=>{e.stopPropagation(),void 0!==t.onClick&&t.onClick()},children:t.children})}function mC(e){return"sardine_pen"===e}function gC(e){return{name:e.name,img:e.img,desc:e.desc,viewCounter:e.viewCounter||1,imgPosition:e.imgPosition,imgDimensions:e.imgDimensions}}function _C({item:e}){const t=Ng(),n=Tg((e=>e.partyTime)),i=Tg((e=>e.inventory)),r=mC(e.name)&&i.find((t=>t===e.name)),a=e.desc[e.viewCounter-1];return Qr.jsxs("div",{id:"main-item",children:[Qr.jsx("div",{className:"main-item-container",children:void 0!==e.img&&Qr.jsx("img",{src:e.img,alt:"A living room item",className:n?"party-time":""})}),""!==a&&void 0!==a&&Qr.jsx("div",{className:"main-item-description",children:Qr.jsx("p",{children:a})}),mC(e.name)&&Qr.jsx("div",{className:"main-item-action",children:Qr.jsx(fC,{type:"none",onClick:r?void 0:()=>{t(Q_(e.name))},style:{width:"200px",height:"50px"},children:r?"ALREADY PICKED UP :--)":"PICK UP"})})]})}function vC(e){const t=e.naturalWidth/e.naturalHeight;let n=e.height*t,i=e.height;return n>e.width&&(n=e.width,i=e.width/t),{width:n,height:i}}const yC=[{name:"day0",date:"Day 1: Summer 2022",diaryEntries:{vic:[{entry:"\nDear Universe,\nThank you so much for Binky, thank you so much for Noah, thank you for making me beautiful, thank you for Anne, thank you Universe for Binky, she is healthy and happy. Thank you for my friends. I am so thankful God!\n",written:!0}],nat:[{entry:"You think the Fun Lady sees you as demented.\nBut from her view, all she sees is your Mona Lisa smile."},{entry:"I thought I wouldn't have any real friends in adulthood after failing so hard for years, and I think I had come to accept that, with difficulty and sadness. But I have close friends now, and somehow the intimacy feels even more complex than it was when I was a little shifting transforming kid."},{entry:"I guess my friends today are childlike, they are all playful in their own way, and some exhibit this innocence, they are looking at the world with new eyes and have interesting things to say about it. I am bewildered by how happy I am."},{entry:"Moving here with Vic was the greatest decision I've made, her joy and humor and positivity are infectious. I feel for the first time I am somewhere bursting with potential. I guess what I've been missing this whole time was friendship, maybe it was that simple. If it could happen to me, it could happen to anyone... hang on."}]},actions:{living_room:{living_room1:[],living_room2:[],living_room3:[{name:"Jigsaw",desc:[""],img:"/img/people/jigsaw/jigsaw_on_bike.webp",imgDimensions:[.15,.3],imgPosition:[.51,.75],actionOptions:[{name:"Poke it",reduxAction:{type:"START_CONVO",payload:"meet_dinky"}},{name:"Play a little game with it",reduxAction:{type:"START_CONVO",payload:"play_a_little_game"}},{name:"Ask it what it's favorite color is",reduxAction:{type:"START_CONVO",payload:"dinky_favorite_color"}}],optionDisplayOffset:[.09,0],position:[.51,.75],dimensions:[.15,.3]}]},nats_room:{nats_room1:[{name:"binky",desc:["The magnificent"],actionOptions:[{name:"have a conversation",reduxAction:{type:"START_CONVO",payload:"meet_binky"}}],optionDisplayOffset:[.05,-.05],position:[.7315,.67],dimensions:[.06,.13]}]},vics_room:{vics_room1:[{name:"vic",desc:["my crazy roommate"],actionOptions:[{name:"say hello",reduxAction:{type:"START_CONVO",payload:"meet_vic"}}],optionDisplayOffset:[.02,-.02],position:[.53,.36],dimensions:[.04,.08]}]},outside:{outside1:[{name:"Nat from the future",desc:["with six pack"],img:"/img/people/nat/future_nat.webp",imgDimensions:[.1,.22],imgPosition:[.6,.67],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_future_nat"}}],optionDisplayOffset:[.05,-.05],position:[.6,.67],dimensions:[.1,.22]}]},sunset:{sunset1:[],oracle:[]}},canSleep:e=>e.inventory.includes("red_lightbulb")?e.inventory.includes("box_of_the_night")?[!0,""]:[!1,"Have you tried climbing out your window? It's a good core workout."]:[!1,"No, lazy. You can't sleep now. Don't be shy. Go talk to the weird man in your living room."],whatsOnTv:"https://www.youtube.com/embed/mSX3OyW9Rao?si=asiLf1e2GS-Ri8Gp&autoplay=1"},{name:"day1",date:"Day 2: Canada Day",diaryEntries:{vic:[{entry:"\nUniverse, \nThank you for my beauty. I am beautiful and loved and I am going to be a model. Thank you for blessing me with Anne and Noah and Binky. They are healthy and happy and they care for me. I am eternally grateful, Universe.\n",written:!0}],nat:[{entry:"I saw Paul's big sweaty gabagool face today, and others."},{entry:"It's easier to camouflage depression in a sea of people."},{entry:"Emotions can be like weather. As significant as the fleeting shape of a cloud."},{entry:"Bad past experience has got me associating falling in love with a long process that eventually leads to suicidal ideation and total shrinkage of the soul. I only feel comfortable on some weird periphery."},{entry:"God I'm such a virgin cuck. I'm kinda into that too, whatever, and who knows what'll happen."},{entry:"Vic's spirit animal is a mosquito."}]},actions:{living_room:{living_room1:[],living_room2:[{name:"vic",desc:['"la belle gonzesse"'],img:"/img/people/vic/vic_yoga.webp",imgDimensions:[.8,1.2],imgPosition:[.6,.8],optionDisplayOffset:[-.15,-.2],actionOptions:[{name:"interrupt whatever this is",reduxAction:{type:"START_CONVO",payload:"yoga_vic"}},{name:"admire",reduxAction:{type:"PLAY_SOUND_EFFECT",payload:"MARVELOUS"}}],position:[.84,.6],dimensions:[.2,.28]}],living_room3:[]},nats_room:{nats_room1:[{name:"binky",desc:["The magnificent"],actionOptions:[{name:"greet her",reduxAction:{type:"START_CONVO",payload:"greet_binky_on_canada_day"}},{name:"enter her dream",reduxAction:{type:"START_CONVO",payload:"binky_dream"}}],optionDisplayOffset:[.05,-.05],position:[.7315,.67],dimensions:[.06,.13]}]},vics_room:{vics_room1:[{name:"vic",desc:["my beautiful roommate"],actionOptions:[{name:"wait...isn't she in the living room?",reduxAction:{type:"START_CONVO",payload:"drunk_vic_in_bed"}}],optionDisplayOffset:[.02,-.02],position:[.53,.36],dimensions:[.04,.08]}]},outside:{outside1:[{name:"Crackhead",desc:["Crackhead with no eyes"],img:"/img/people/crackheads/crackhead7.webp",imgDimensions:[.08,.14],imgPosition:[.7,.66],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"diary_goggles"}}],position:[.7,.66],dimensions:[.08,.14]},{name:"Paul",desc:["My annoying neighbor"],img:"/img/people/paul/paul_pumpkin.webp",imgDimensions:[.07,.13],imgPosition:[.594,.322],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_paul"}}],position:[.594,.322],dimensions:[.07,.13]},{name:"Homeless dude",desc:["with an occulus rift and vox blox™️"],img:"/img/people/crackheads/crackhead8.webp",imgDimensions:[.1,.15],imgPosition:[.47,.538],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"occulus_rift"}}],position:[.47,.538],dimensions:[.1,.15]},{name:"Khronos",desc:["greek fat slob that snorts cocaine"],img:"/img/people/crackheads/greek_dude.webp",imgDimensions:[.1,.15],imgPosition:[.45,.27],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_greek_dude"}}],position:[.45,.27],dimensions:[.1,.15]},{name:"Truck",desc:["big"],img:"/img/people/crackheads/truck.webp",imgDimensions:[.17,.17],imgPosition:[.86,.67],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_truck"}}],position:[.86,.67],dimensions:[.17,.17]},{name:"Plane",desc:["boeing 737 max"],img:"/img/people/crackheads/plane.webp",imgDimensions:[.09,.14],imgPosition:[.94,.34],optionDisplayOffset:[-.08,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_plane"}}],position:[.94,.34],dimensions:[.09,.14]},{name:"Cool Manager",desc:[""],img:"/img/people/crackheads/cool_manager.webp",imgDimensions:[.09,.22],imgPosition:[.61,.84],optionDisplayOffset:[-.08,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_cool_manager"}}],position:[.61,.84],dimensions:[.09,.22]},{name:"Tan Man",desc:["local business owner"],img:"/img/people/crackheads/italoman.webp",imgPosition:[.14,.85],imgDimensions:[.07,.13],optionDisplayOffset:[.04,-.06],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_italoman"}}],position:[.14,.85],dimensions:[.07,.13]}]},sunset:{sunset1:[],oracle:[]}},canSleep:e=>e.inventory.includes("Diary Goggles")?e.inventory.includes("sardine_pen")?[!0,""]:[!1,"So now that you got those diary goggles. You're gonna read diaries but you're not going to write in them? Find a pen. Write your thoughts."]:[!1,"Don't be shy...go meet some more people outside."],whatsOnTv:"https://www.youtube.com/embed/39x-SJTbpVE?autoplay=1"},{name:"day2",date:"Day 3: Party",diaryEntries:{vic:[{entry:"\nUniverse, \nThank you for my beauty. I am beautiful and loved and I am going to be a model. Thank you for blessing me with Anne and Noah and Binky. They are healthy and happy and they care for me. I am eternally grateful, Universe.\n"}],nat:[{entry:"Vic's spirit animal is a mosquito."}]},actions:{living_room:{living_room1:[],living_room2:[],living_room3:[]},nats_room:{nats_room1:[]},vics_room:{vics_room1:[]},outside:{outside1:[{name:"Rando Crackhead",desc:["Some crackhead"],img:"/img/people/crackheads/crackhead2.webp",imgDimensions:[.08,.14],imgPosition:[.66,.6],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"diary_goggles"}}],position:[.7,.66],dimensions:[.08,.14]}]},sunset:{sunset1:[],oracle:[]}},canSleep:e=>e.partyTime?[!0,""]:[!1,"You want to go to bed before the party even started. Fantastic hosting skills."],whatsOnTv:"nada"},{name:"day3",date:"Day 3: Horny Vortex",diaryEntries:{vic:[{entry:"\nUniverse, \nThank you for making me so good at sex.\n",written:!0}],nat:[{entry:"I've been having uncouth thoughts. If you know, you know."},{entry:"Where the fuck is this all leading to?"},{entry:"This is surreal as shit. I love it, not turning back."}]},actions:{living_room:{living_room1:[{name:"Dinky",desc:[""],img:"/img/people/jigsaw/jigsaw.webp",imgDimensions:[.075,.15],imgPosition:[.242,.765],actionOptions:[{name:"talk",isActive:e=>3==e.roomToImgIndex.living_room&&null===e.hornyVortexPhase,reduxAction:{type:"START_CONVO",payload:"dinky_puzzle"}},{name:"reconvene",isActive:e=>3==e.roomToImgIndex.living_room&&"world_bathed_in_red"===e.hornyVortexPhase,reduxAction:{type:"START_CONVO",payload:"dinky_puzzle_solved"}}],optionDisplayOffset:[.05,-.05],position:[.242,.765],dimensions:[.075,.15]}],living_room2:[],living_room3:[{name:"Horny Legs",desc:["rotating"],img:"/img/people/crackheads/showmi.webp",imgPosition:[.5,.5],imgDimensions:[.07,.13],position:[.5,.5],dimensions:[.07,.13],optionDisplayOffset:[-.05,-.05],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_showmi"}}]}]},nats_room:{nats_room1:[]},vics_room:{vics_room1:[{name:"Horny Vic",desc:[""],img:"/img/people/vic/red_vic.webp",imgPosition:[.52,.5],imgDimensions:[.15,.4],position:[.52,.5],dimensions:[.15,.4],actionOptions:[{name:"ask what happened last night",isActive:e=>null===e.hornyVortexPhase||"world_bathed_in_red"===e.hornyVortexPhase,reduxAction:{type:"START_CONVO",payload:"horny_vic"}}],optionDisplayOffset:[.05,-.15]}]},outside:{outside1:[{name:"Horny Paul",desc:["sweating"],img:"/img/people/paul/red_paul.webp",imgDimensions:[.07,.13],imgPosition:[.594,.322],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"horny_paul"}}],position:[.594,.322],dimensions:[.07,.13]},{name:"Horny Tricycle Man",desc:["sweating"],img:"/img/people/crackheads/tricycle_man.webp",imgDimensions:[.07,.13],imgPosition:[.495,.62],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_tricyle_man"}}],position:[.495,.623],dimensions:[.07,.13]},{name:"Horny manager",desc:["sweating"],img:"/img/people/crackheads/cool_manager_laying_down.webp",imgPosition:[.17,.92],imgDimensions:[.15,.13],position:[.17,.92],dimensions:[.15,.13],optionDisplayOffset:[-.05,-.08],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"greet_cool_manager_laying_down"}}]},{name:"Horny orbs",desc:["sweating"],img:"/img/people/crackheads/showmi2.webp",imgPosition:[.69,.77],imgDimensions:[.07,.13],position:[.69,.77],dimensions:[.07,.13],optionDisplayOffset:[-.05,-.05],actionOptions:[{name:"talk",reduxAction:{type:"START_CONVO",payload:"meet_showmi2"}}]},{name:"lamppost",desc:["A lamppost."],img:"/img/rooms/outside/lamppost_yellow.webp",imgDimensions:[.13,.6],imgPosition:[.9,.7],action:{reduxAction:{type:"CLICK_LAMPPOST"},compatibleCursorItemName:"red_lightbulb"},position:[.855,.42],dimensions:[.035,.05]}]},sunset:{sunset1:[],oracle:[]}},canSleep:e=>[!1,"Sleep is for the weak."],whatsOnTv:"https://www.youtube.com/embed/WxecWkI_QBI?autoplay=1&mute=1"}],xC="/img/rooms/misc/diary_paper.webp";function wC(){const e=Tg((e=>e.dayIndex)),t=Tg((e=>e.room)).includes("vic")?"vic":"nat",[n,i]=Hr.useState(0),[r,a]=Hr.useState([]),[s,o]=Hr.useState([]),l=Tg((e=>e.equipped.includes("sardine_pen"))),c=2==n?3:n,u=c+1,h=yC[c],d=yC[u];Hr.useEffect((()=>{const n=void 0===h||c>e?[]:h.diaryEntries[t].filter((({written:e})=>!0===e)).map((({entry:e})=>e)),i=void 0===d||u>e?[]:d.diaryEntries[t].filter((({written:e})=>!0===e)).map((({entry:e})=>e));a(n),o(i)}),[n]);const p=n=>{if(!l||"vic"===t)return;if("left"===n&&(void 0===h||c>e)||"right"===n&&(void 0===d||u>e))return;const i="left"===n?h.diaryEntries:d.diaryEntries,p=i[t].findIndex((e=>!0!==e.written));if(-1===p)return;const f=i[t][p];f.written=!0,"left"!==n?o([...s,f.entry]):a([...r,f.entry])},f="diary "+("vic"===t?"vic-diary":"");return Qr.jsxs("div",{onClick:e=>e.stopPropagation(),className:f,children:[Qr.jsxs("div",{className:"diary-page",style:{borderRight:"0"},children:[Qr.jsx("img",{src:xC,alt:"left page",className:"diary-paper-image"}),Qr.jsx("p",{style:{left:"0"},className:"diary-page-number",children:n}),void 0!==h&&c<=e&&Qr.jsxs("div",{className:"diary-page-text",onClick:()=>{p("left")},children:[Qr.jsx("h1",{children:h.date}),r.map(((e,t)=>Qr.jsx("p",{className:"paper-text",children:e},`left-entry-${t}`)))]})]}),Qr.jsxs("div",{className:"diary-page",children:[Qr.jsx("img",{src:xC,alt:"right page",className:"diary-paper-image"}),Qr.jsx("p",{style:{right:"0"},className:"diary-page-number",children:n+1}),void 0!==d&&u<=e&&Qr.jsxs("div",{className:"diary-page-text",onClick:()=>{p("right")},children:[Qr.jsx("h1",{children:d.date}),s.map(((e,t)=>Qr.jsx("p",{className:"paper-text",children:e},`right-entry-${t}`)))]})]}),n>0&&Qr.jsx("button",{className:"diary-navigation-button",style:{left:"0"},onClick:()=>i(n-2),children:"←"}),n+2<3&&Qr.jsx("button",{className:"diary-navigation-button",style:{right:"0"},onClick:()=>i(n+2),children:"→"})]})}function bC({day:e,debugMode:t=!1,setItemsDiscovered:n=()=>{},setTotalItems:i=()=>{},canPointAndClick:r=()=>!1,className:a=""}){const s=Ng();!function(){const[e,t]=Hr.useState([0,0]);Hr.useLayoutEffect((()=>{function e(){t([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}),[])}();const o=Tg((e=>e.partyTime)),l=Tg((e=>e.dayIndex)),c=Hr.useRef(null),[u,h]=Hr.useState(""),[d,p]=Hr.useState(!1),[f,m]=Hr.useState(void 0),g=Tg((e=>e.room)),_=Tg((e=>e.subRoom)),v=Tg((e=>e.roomToImgIndex[e.room])),y=er(g),x=tr(g,_),w=v===x.img.length-2,b=Tg((e=>e.equipped)),E=b.find((e=>Qi(e))),M=void 0!==b.find((e=>Qi(e))),S=b.includes("Diary Goggles"),T=e.actions[y.name][x.name].concat(x.actionItems||(x.actionItems=[])),[A,C]=Hr.useState(null),R=Tg((e=>e.tvPlaying&&"living_room2"===e.subRoom)),P=Tg((e=>e.readingDiary)),k=Tg((e=>e.lamppost)),[,O]=Hr.useReducer((e=>e+1),0),I=Tg((e=>e.prevConvoName)),L=Tg((e=>e.convoName));Hr.useEffect((()=>{null===I&&null!==L&&O(),null===I&&null===L&&O()}),[L]),Hr.useEffect((()=>{const e=function(e){const t=[...e.img];for(const n of e.items)void 0!==n.img&&t.push(n.img);if(void 0!==e.actionItems){for(const n of e.actionItems)void 0!==n.img&&t.push(n.img);return t}}(tr(g,_));e&&m(e)}),[_]),Hr.useEffect((()=>{const e=x.img[v];e!==u&&(h(e),p(!1))}),[_,v]),Hr.useEffect((()=>{const e=T.find((e=>"lamppost"===e.name));void 0!==e&&("yellow"===k.lightbulbColor?e.img=k.toggled?"/img/rooms/outside/lamppost_yellow_toggled.webp":"/img/rooms/outside/lamppost_yellow.webp":"red"===k.lightbulbColor&&(e.img=k.toggled?"/img/rooms/outside/lamppost_red_toggled.webp":"/img/rooms/outside/lamppost_red.webp"),O())}),[k]);let D=x.items.filter((e=>e.viewCounter&&e.viewCounter>0)).length;Hr.useEffect((()=>{C(null),n(D);const e=x.items.filter((e=>!e.shouldntTally)).length;i(e)}),[x]);const N=e=>void 0===e.isActive||e.isActive(jv.getState()),U=e=>void 0===E||e.compatibleCursorItemName===E;function F(e,t){if(null===c||null===c.current)return[0,0];const n=c.current.width,i=c.current.height;if("fill"===c.current.style.objectFit)return[e*n,t*i];const r=vC(c.current),a=[(n-r.width)/2,(i-r.height)/2];return[a[0]+e*r.width,a[1]+t*r.height]}function z(e,t){if(null===c||null===c.current)return[0,0];if("fill"===c.current.style.objectFit)return[e*c.current.width,t*c.current.height];const n=vC(c.current);return[e*n.width,t*n.height]}return Qr.jsxs("div",{className:`point-and-click-area ${a}`,onClick:e=>{if(null!==A&&C(null),r()){e.preventDefault(),e.stopPropagation();(function(e){const t=document.getElementById("point-and-click-image"),n=t.width,i=t.height,r=vC(t),a=(n-r.width)/2,s=(i-r.height)/2,o=e.nativeEvent.offsetX-a,l=e.nativeEvent.offsetY-s;o<0||o>r.width||l<0||l>r.height||(r.width,r.height)})(e)}},children:[void 0!==f&&f.map(((e,t)=>Qr.jsx("link",{rel:"preload",href:e,as:"image"},t))),Qr.jsx("img",{src:x.img[v],alt:"Imagine a room",id:"point-and-click-image",ref:c,onLoad:()=>p(!0),className:P?"blurry":"",style:"sunset"===g?{objectFit:"fill"}:{objectFit:"contain"}}),3===l&&"oracle"!==x.name&&"nats_room1"!==x.name&&!0!==w&&Qr.jsx("img",{src:"sunset"===g?"/img/rooms/misc/vortex_waves2.png":"/img/rooms/misc/vortex_waves.png",alt:"horny vortex waves",id:"point-and-click-image",className:P?"blurry":"",style:{position:"absolute",objectFit:"sunset"===g?"fill":"contain"}}),!0===d&&(B=t,Qr.jsx(Hr.Fragment,{children:x.items.map((e=>{if(void 0!==e.canClick&&!e.canClick(jv.getState()))return;const t=F(e.position[0]-e.dimensions[0]/2,e.position[1]-e.dimensions[1]/2),i=z(e.dimensions[0],e.dimensions[1]),a=void 0!==e.img&&void 0!==e.imgPosition&&void 0!==e.imgDimensions;let o=null,l=null;return a&&(o=F(e.imgPosition[0]-e.imgDimensions[0]/2,e.imgPosition[1]-e.imgDimensions[1]/2),l=z(e.imgDimensions[0],e.imgDimensions[1])),Qr.jsxs(Hr.Fragment,{children:[a&&Qr.jsx("img",{src:e.img,style:{position:"absolute",left:o[0],top:o[1],width:`${l[0]}px`,height:`${l[1]}px`},alt:"Imagine an item...",className:"item-image "+(B?"item-img-bounding-box-visible":"")}),Qr.jsx("div",{className:(M?"":"pointer-cursor-on-hover ")+(B?"bounding-box-visible":""),style:{position:"absolute",left:`${t[0]}px`,top:`${t[1]}px`,width:`${i[0]}px`,height:`${i[1]}px`},onClick:()=>{M||r()&&(e=>{!0!==e.shouldntTally?(void 0===e.viewCounter?(e.viewCounter=1,n(++D)):e.viewCounter===e.desc.length?e.viewCounter=1:++e.viewCounter,s(Z_(gC(e)))):s(Z_(gC(e)))})(e)}})]},e.name)}))})),!0===R&&(e=>{const t=F(.5249,.268),n=z(.34,.344);return Qr.jsx("iframe",{title:"TV time",src:e,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,style:{position:"absolute",left:t[0],top:t[1],width:`${n[0]}px`,height:`${n[1]}px`}})})(e.whatsOnTv),!0===d&&T.length>0&&(e=>T.map((t=>{if(!(e=>void 0!==e.action?N(e.action):e.actionOptions.some((e=>N(e))))(t))return;const n=F(t.position[0]-t.dimensions[0]/2,t.position[1]-t.dimensions[1]/2),i=z(t.dimensions[0],t.dimensions[1]);let a=null,o=null;if(void 0!==t.img){a=F(t.imgPosition[0]-t.imgDimensions[0]/2,t.imgPosition[1]-t.imgDimensions[1]/2),o=z(t.imgDimensions[0],t.imgDimensions[1])}return Qr.jsxs(Hr.Fragment,{children:[void 0!==t.img&&Qr.jsx("img",{src:t.img,style:{position:"absolute",left:a[0],top:a[1],width:`${o[0]}px`,height:`${o[1]}px`},alt:"Imagine an item...",className:"item-image "+(e?"item-img-bounding-box-visible":"")}),Qr.jsx("div",{className:(M?"":"pointer-cursor-on-hover ")+(e?"action-item-bounding-box-visible":""),style:{position:"absolute",left:n[0],top:n[1],width:`${i[0]}px`,height:`${i[1]}px`},onClick:e=>{r()&&(e=>void 0!==e.action?U(e.action):e.actionOptions.some((e=>U(e))))(t)&&(void 0===t.action?A!==t?(e.stopPropagation(),C(t)):C(null):s(t.action.reduxAction))}})]},t.name)})))(t),!0===d&&x.adjacentRooms.map(((e,t)=>function(e,t,n,i,r){const a=()=>n(q_({room:e.room,subRoom:e.subRoom})),s=i(e.entry.position.left,e.entry.position.top);return"arrow"===e.entry.type?function(e,t,n,i,r){return Qr.jsx("button",{className:"adjacent-room-arrow",title:e.tooltip,style:{color:e.color||(r?"#c70def":"black"),left:i[0],top:i[1],transform:"translate(-50%, -50%)"},onClick:e=>{e.stopPropagation(),n()},children:e.char},t)}(e.entry,t,a,s,r):Qr.jsx(Zv,{door:e.entry,onEnter:a,left:s[0],top:s[1]},t)}(e,t,s,F,o))),!0===S&&Qr.jsx("img",{src:"/img/goggles/green_diary_goggles.webp",className:"diary-goggles "+(P?"blurry":""),alt:"Diary goggles"}),null!==A&&(()=>{const e=A.optionDisplayOffset||(A.optionDisplayOffset=[0,0]),t=F(A.position[0]+e[0],A.position[1]+e[1]);return Qr.jsxs(Hr.Fragment,{children:[Qr.jsx(Kv,{thought:`${A.name} : ${A.desc[0]}`,style:{position:"absolute",left:t[0]-20,top:t[1]-50,backgroundColor:"gray"},animate:!1}),A.actionOptions.map(((e,n)=>{if(!N(e))return;return Qr.jsx(fC,{type:"none",style:{position:"absolute",left:t[0],top:t[1]+27*n,height:"22px"},onClick:()=>{s(e.reduxAction),C(null)},children:e.name},`${e.name}-${n}`)}))]},"itemActions")})(),!0===P&&Qr.jsx(wC,{})]});var B}function EC({enabled:e=!0}){const t=Ng(),n=Tg((e=>e.inventory)),i=Tg((e=>e.equipped)),r=Tg((e=>e.itemDisplayed)),a=Array(8).fill(null).map(((e,t)=>t<n.length?n[t]:null));return Qr.jsx("div",{className:"inventory",children:a.map(((n,a)=>{const s=null!==n&&i.includes(n),o=Ki.find((e=>e.name===n)),l=null===r?()=>{"viewable"===o.type?t(Z_(gC(o))):t(J_(o.name))}:void 0;return Qr.jsx(fC,{style:{height:"12.5%",borderTopWidth:"0px",backgroundColor:s?"#d304d32b":""},type:"big-black-box",tooltip:e?null==o?void 0:o.desc[0]:"Can't use this...",onClick:e?l:void 0,children:null!==o&&Qr.jsx("span",{style:{textDecoration:e?"none":"line-through"},children:n})},`inventory-slot-${a}`)}))})}const MC={name:"meet_italoman",speakers:["italoman","nat"],dialogue:[{text:["FFFFFFFFFUUUUUCCCCCCCCCCCCCKKKKKKKKK.","Where are the craziest girls in the world?"]},{text:["Uhhh, Brazil."]},{text:["No. It's Germany.","This? You know this? (makes a gesture of big boobs)",'They have shirts. It says "Welcome. I don\'t have aids"',"They're crazy!! 11pm they party!!!","11pm I sleep!!!","But 11pm they leave!!! For party!!","What is the other place with the crazy girls?"]},{text:["Romania."]},{text:["No. It's England."]}]};const SC=[Object.freeze(Object.defineProperty({__proto__:null,badass1:{name:"badass1",speakers:["dinky","nat"],dialogue:[{text:["No that's definitely coming off of you. Pee and chlamydia."]}]},badass2:{name:"badass2",speakers:["dinky","nat"],dialogue:[{text:["Mmm....that's the spot."]}],actionOnConvoEnd:{reduxAction:{type:"PLAY_SOUND_EFFECT",payload:"CREEPY_LAUGH"}}},dinky_favorite_color:{name:"dinky_favorite_color",speakers:["nat","dinky"],dialogue:[{text:["What's your favorite color?"]},{text:["Red.",".......","What's your favorite color?"]},{options:[{text:"Yellow.",nextConvoName:"dinky_yellow"},{text:"Red.",nextConvoName:"dinky_red"},{text:"Green.",nextConvoName:"dinky_green"}]}]},dinky_green:{name:"dinky_green",speakers:["dinky","nat"],dialogue:[{text:["I hate you."]}]},dinky_red:{name:"dinky_red",speakers:["dinky","nat"],dialogue:[{text:["This is the correct answer.","When the time is right and the world glows red, we shall create a vortex from which I will extract a mysterious goo.","Take this red lightbulb so that you may bathe the world in our favorite color. I'll be around. See ya pookie."]}],actionOnConvoEnd:{reduxAction:{type:"PICK_UP_ITEM",payload:"red_lightbulb"}}},dinky_yellow:{name:"dinky_yellow",speakers:["dinky","nat"],dialogue:[{text:["You disgust me."]}]},meet_binky:{name:"meet_binky",speakers:["nat","binky"],dialogue:[{text:["I wonder...does boink dream of sheep?"]},{text:["Miaou meow."]},{text:["Why, Bonjour hi to you ma belle."]}],actionOnConvoEnd:{reduxAction:{type:"PLAY_SOUND_EFFECT",payload:"BINKY_PURR"}}},meet_dinky:{name:"meet_dinky",speakers:["dinky","nat"],dialogue:[{text:["Hey... you can call me dinky.","Why don't you give me a little pet?"]},{options:[{text:"No.. you smell like pee.",nextConvoName:"badass1"},{text:"Turn around. I'll scratch your back.",nextConvoName:"badass2"}]}]},meet_future_nat:{name:"meet_future_nat",speakers:["future_nat","nat"],dialogue:[{text:["Hi Nat. I am you from the future. Your life is about to get pretty crazy."]},{text:["Got any advice?"]},{text:["When faced with a lake of fire, throw yourself in it and flail."]},{text:["Sure. Anything else?"]},{text:["You're going to make a video game. No one is going to play it including the people in it. Maybe one or two friends will pity play.","It's going to be a Typescript Redux React 3dverse ThreeJS 2D [insert more bullshit here] web game. Haha. Bet you didn't see that one coming.","Some will just call it 'quirky'...sorry.","In many years, it will have a stronger impact and inspire someone to make something a lot better.","Here I'll give you the game case for it. An idea of what's to come."]}],actionOnConvoEnd:{reduxAction:{type:"PICK_UP_ITEM",payload:"box_of_the_night"}}},meet_vic:{name:"meet_vic",speakers:["vic","nat"],dialogue:[{text:["Hiiiiiiiiiiiii gorgeous how are you? 🌸💮🌷🌷"]},{text:["I'm good I had a bit of a long day at work—"]},{text:["Dude I had a crazy day at work I was dyyyyyyying of laughter.","One of my Latino students kept saying he's going to the box of the night tonight. I had no idea what he was talking about. Box. of. the. night. Like you're going to climb in a cardboard box? Is that where you live?",'He meant nightclub but "nightclub" in Spanish literally translates to box of the night or some shit. Like boîte de nuit, genre.',"Box of the night!!","Also, all my Korean students love me because I have good skin. The Korean moms love me and they keep giving me gifts.","I keep getting candy and fancy sunscreen and cashmere scarves and hand lotions and I look them up and some of it's 200$ online. It's insane dude. These Korean moms are loaded.","They need to stop giving me gifts for real. I don't have room to keep all that. I'm the one that lives in a box HAHAHA. I'm the one living in a box of the night HAHA! Cuz I'm poor and I'm a teacher that busts her ass and they don't pay me shit.","Even when I'm on two minutes of sleep I show up and I bust my ass. It's all too much. Having to talk to students all day is exhausting. I think I'm an introvert for real. Whatever I'll just become a stripper. HAHAHA!"]}]},play_a_little_game:{name:"play_a_little_game",speakers:["nat","dinky"],dialogue:[{text:["I want to play a little game."]},{text:["A little game you say? I only play money games.","And I always win. How else do you think I can afford this lifestyle?"]},{text:["I've never lost at poker. Let's go."]},{text:["Yeah, well, I don't play games with fat broke hoes. Eye sore, really."]}]}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,binky_dream:{name:"binky_dream",speakers:["nat","binky"],dialogue:[{text:["May I enter your dream?"]},{text:["(purring)"]}],actionOnConvoEnd:{reduxAction:{type:"TOGGLE_BOINK_DREAM"}}},diary_goggles:{name:"diary_goggles",speakers:["nat","crackhead7"],dialogue:[{text:["Hi.. sorry to bother you. Just wanted to tell you that your look is cool."]},{text:["Oh thanks. It's botox and a few nose jobs. Gotta start early."]},{text:["Love those bleached eyebrows."]},{text:["Haha yeah.. hey you know what? I have something you might like.","I'm a bit of a shopping addict. Actually I just steal a lot.","But yeah anyways, I got these cool sunglasses at Renaissance.","I can't really use them cause my eyes got hit with a crowbar last summer. Fucking Jersey Shore girls, man.","They're really cool glasses, and I tinkered them. They have a special power."]},{text:["Wow!"]},{text:["Basically when you wear them you can read people's diaries."]},{text:["I just need eyeballs to read people's diaries."]},{text:["No, whatever, shut up. Just take them."]}],actionOnConvoEnd:{reduxAction:{type:"PICK_UP_ITEM",payload:"Diary Goggles"}}},drunk_vic_in_bed:{name:"drunk_vic_in_bed",speakers:["nat","vic"],dialogue:[{text:["The fuck. Didn't I just see you in the living room?"]},{text:["Yeah, so what I'm just really good at multitasking."]},{text:["Ok speedy. So good at multitasking you can be two places at once."]},{text:["I'm fast and get things done, unlike some people.","When I'm drinking it goes even faster.","In college I used to chug 8 beers and write a 15 page essay in 3 hours HAHAHA!","Whenever I need to get something important done like taxes or immigration paperwork or an email I just get wasted and it's done in 2 hours."]},{text:["Wow...Wish it were me."]},{text:["You just need to drink dude. Trust me."]},{text:["Yeah I don't think it's that."]}]},greet_binky_on_canada_day:{name:"greet_binky_on_canada_day",speakers:["nat","binky"],dialogue:[{text:["Binky boink. It's Canada Day. Don't you want to go outside and see some action?"]},{text:["(sleeping)"]},{text:["Kooky princess. What goes on in your little boink head when you sleep?"]}],actionOnConvoEnd:{reduxAction:{type:"PLAY_SOUND_EFFECT",payload:"BINKY_PURR"}}},meet_cool_manager:{name:"meet_cool_manager",speakers:["cool_manager"],dialogue:[{text:["I created a dedicated window in my schedule for a guided walk meditation.","Let's do away with mental stack overflow and streamline productivity.","No more waking up in a pool of white vodka vomit."]}]},meet_greek_dude:{name:"meet_greek_dude",speakers:["greek_dude","nat"],dialogue:[{text:["I feel you don't have serious enough intellect to be conversing with me."]}]},meet_italoman:MC,meet_moon:{name:"meet_moon",speakers:["moon","nat"],dialogue:[{text:["The Moooooooon. Beautiful.","The Sun. Even more beautiful, ha, ha, ha."]}]},meet_north_star:{name:"meet_north_star",speakers:["north_star","nat"],dialogue:[{text:["I am your north star.","Some days are harder than others. It's ok,","Today is harder. Doesn't mean you hate it,","Time passes. Change is unavoidable.","Brace yourself. Everything will change! Everything changes! Rejoice!","Don't let your heart sink,","Let it wade and swim, stall,","It will float! It will float!"]}]},meet_paul:{name:"meet_paul",speakers:["paul","nat"],dialogue:[{text:["Wheeeeeyyyy belitz!!"]},{text:["Wheyy"]},{text:["Have you seen my tic tacs? I've been looking all over for them!"]}]},meet_paul_on_tic_tacs:{name:"meet_paul_on_tic_tacs",speakers:["paul","nat"],dialogue:[{text:["MY TIC TACS!"]},{text:["That's not tic tacs"]},{text:["Keeps the mind fresh, huh belitz"]}]},meet_plane:{name:"meet_plane",speakers:["plane"],dialogue:[{text:["Oh look!! a penny!!"]}]},meet_truck:{name:"meet_truck",speakers:["truck"],dialogue:[{text:["Oh look, a penny!"]}]},meet_venus:{name:"meet_venus",speakers:["venus","nat"],dialogue:[{text:["Let me vanish into the thin night."]}]},meet_white_dwarf:{name:"meet_white_dwarf",speakers:["white_dwarf","nat"],dialogue:[{text:["I am on the verge of exhausting my nuclear fuel."]},{text:["Will you become extinct when you do?"]},{text:['In your conception of things, yes. But "I" never really existed.']},{text:["Cool..."]}]},occulus_rift:{name:"occulus_rift",speakers:["crackhead8","nat"],dialogue:[{text:["Hey psss psss Johnny! I'll call you back in a bit.","Excuse me madam can you spare some change?"]},{text:["Oh sorry I don't have any cash on me right now."]},{text:["Bitch."]}]},yoga_vic:{name:"yoga_vic",speakers:["nat","vic"],dialogue:[{text:["Hey what's up?"]},{text:["Scram. I'm doing yoga."]},{text:["Oh cool. Mind if I take a pic?"]},{text:["I'M. DOING. YOGA.","I can't talk right now.","Unf unf unf unf unf.","You talk too much."]}]}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,meet_influencer:{name:"meet_influencer",speakers:["crackhead2","nat"],dialogue:[{text:["Hello?","Hello? I've seen you around... you and the tall skinny one."]},{text:["Oh yeah, that's my roommate."]},{text:["Yeah yeah we talked for a bit! My name's Sasha.","I used to be an influencer. I was travelling the world and booking jobs in Santorini, Capri, Paris. Man, that was wild!","But you know, then I needed a place to fall back for a bit, and my mom got sick, you know, so I came back to take care of her.","So I've been taking a break for a bit, but I'm gonna get back to it."]}]}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,dinky_puzzle:{name:"dinky_puzzle",speakers:["dinky","nat"],dialogue:[{text:["It's my birthday."]},{text:["Happy birthday."]},{text:["Thanks."]},{text:["So now what?"]},{text:["A horny vortex is forming from which I will extract a mysterious goo. I'm itching for some goo..."]},{text:["goo..."]},{text:["A vortex forms in steps."]},{text:["I'm listening."]},{text:["Bathe the world in my favorite color. I beseech you."]}]},dinky_puzzle_solved:{name:"dinky_puzzle_solved",speakers:["dinky","nat"],dialogue:[{text:["Perfect....I'm buzzing...The world is bathed in red.","Excuse me for one moment. (coughs) Ahem. Blegh. (cough, cough, cough)","Hurk hurk hurk. (pukes up a hairball and a key)","Ah yes...perfect. As I intended. I have forged a key.","Take it, horny. She's waiting for you."]}],actionOnConvoEnd:{reduxAction:{type:"LAUNCH_HORNY_VORTEX_PHASE",payload:"souls_imbued"}}},farewell_oracle:{name:"farewell_oracle",speakers:["oracle","nat"],dialogue:[{text:["Ok that's enough questions. Basta la pasta. Ciao."]},{text:["Haha so that was cool...So, can the oracle sleep over tonight?"]},{text:["Obviously 🙄🙄."]},{text:["Fantastic."]},{text:["One more thing. You're my girlfriend now. You have no choice. HAHAHA!"]}]},greet_cool_manager_laying_down:{name:"greet_cool_manager_laying_down",speakers:["nat","cool_manager"],dialogue:[{text:["Are you ok??"]},{text:["Yeah I'm the best I've been in a long time.","I'm trying to fuck the earth."]}]},horny_paul:{name:"horny_paul",speakers:["paul","nat"],dialogue:[{text:["Landing strip! Landing strip! She's julia and I'm romeo!"]},{text:["Oh my fucking god Paul it's Romeo and Juliet not Romeo and Julia. What's wrong with you?"]},{text:["Hehehe let's just say I saw a carribean sunset last night...at your place...lol!","I'm a snake after all...Sent by the Devil to enter the Garden of Eden and manipulate the women Eve..lol..to fish Adam (Power of Pussy..lol) to eat from the forbidden fruit and bite into the apple...so humanity can differentiate between Good and (D)evil.","So now I pray to Jesus the snake I am and synonymous to Evil seen upon mankind as the bearer against God's number rule not to eat from the forbidden fruit...and pray for forgiveness! Lol!!","So I've done my part...but let's face it...I can't help it the Snake that I am! Hahahaahah!!","The forbidden fruit always taste the best!!","Want to play with the devil?? 😎"]},{text:["Paul you need to go to bed."]},{text:["I sleep standing up belitz! How's the fam doing? Say hi to your pop for me!","I'm working neighborhood watch! You're my neighbor belitz that means we are family! Anytime..whatever you need...don't hesitate!"]},{text:["Thanks Paul, I gotta go bye!"]}]},horny_vic:{name:"horny_vic",speakers:["nat","vic"],dialogue:[{text:["Dude. I need all the details. He's yelling about a landing strip outside. What happened last night??"]},{text:["He made me cum a bajillion times."]},{text:["Holy fuck. I heard everything...that's really hot. I can't fucking believe it. I think I heard doggy style 😏"]},{text:["Oh he didn't fuck me fuck me. Are you insane???"]},{text:["You didn't fuck??"]},{text:["I just made him eat me out. For like 8 hours. I didn't want to see his ugly penis 😂😂🙄","And he was super down, he was on the floor begging me to pleasure my pussy and do nothing else. He's obsessed. Obviously. Look at me 🙄"]},{text:["Woahhhh...That's Epic. Respect.",".................","Now I know what you sound like when you cum. Uh uh uh uh, you do little soft moans. Very interesting."]},{text:["Shut the fuck up 🙄🙄🙄"]},{text:["Ok ok ok. I'm just gonna tell you this. I was touching myself at the same time.","Anyways, I need more details on what happened."]},{text:["He said my pussy tastes like strawberries."]},{text:["Get the fuck out no it doesn't. So what's his secret? What's the move?"]},{text:["He does this thing called the claw."]},{text:["The claw?? Tell me. I need to take notes, for research."]},{text:["So you were listening to me the whole time? What were you doing while you were listening?"]},{text:["I already told you what I was doing."]},{text:["Yeah but I forgot. Tell me again."]},{text:["Ah damn, well, I forgot too."]},{text:["Ça va pas la tête? What were you doing??"]},{text:["Masturbating."]},{text:["Why?"]},{text:["Because I wanted to cum at the same time as you. Sync sexually."]},{text:["Why?"]},{text:["I couldn't see you but I could hear you, I had no idea what was actually going on, our bodies were separated by a wall, and we're friends and all, but I wanted to sync pussies.","I wanted to feel what you were feeling while your pussy was getting worked by that horny man. I came when you came. It made me feel close to you. Lowkey my best orgasm in years hahaha."]},{text:["I don't understand what that means."]},{text:["Yes you do."]},{text:["You're a very strange woman.","What are you doing later?"]}]},meet_oracle:{name:"meet_oracle",speakers:["oracle","nat"],dialogue:[{text:["HAHAHA. You walked straight into my horny vortex..."]},{text:["Where are we?? What is this??"]},{text:["You're in my pussy. My pussy is very wise and knows everything. You can ask it questions."]},{text:["I see...like an oracle of sorts...Should I whisper sweet nothings into it?"]},{text:["Don't be gay. You can ask questions. Let's go, I don't have all day. I work, unlike some people."]},{text:["Ok oomf ahem. O oracle, ahem, ugh, what is consciousness?"]},{text:["You have to come closer. Whisper it into my pussy..."]},{text:["Mmm you're a very prurient oracle..."]},{text:["Purrblent."]},{text:["No. Prurient."]},{text:["Purrent."]},{text:["Prurient."]},{text:["Shut up nerd. Any questions for the oracle?"]}]},meet_showmi:{name:"meet_showmi",speakers:["showmi","nat"],dialogue:[{text:["A horny vortex is forming."]},{text:["Where?"]},{text:["Somewhere in this area."]}]},meet_showmi2:{name:"meet_showmi2",speakers:["showmi2","nat"],dialogue:[{text:["A horny vortex is forming."]},{text:["Where?"]},{text:["Somewhere to my right."]}]},meet_tricyle_man:{name:"meet_tricyle_man",speakers:["tricyle_man","nat"],dialogue:[{text:["WEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE.","Some albino rat fuck just left his tricycle on the side of the road."]},{text:["Yeah I think I know who you're talking about. Where did he go?"]},{text:["I think he hopped into an apartment. Anyways.","I'm so horny!!!"]},{text:["You too?!!"]}]}},Symbol.toStringTag,{value:"Module"}))].reduce(((e,t)=>({...e,...Object.values(t).reduce(((e,t)=>({...e,[t.name]:t})),{})})),{}),TC={nat:{avatarImg:"/img/people/nat/nat.webp"},vic:{avatarImg:"/img/people/vic/vic.webp"},binky:{avatarImg:"/img/people/binky/binky.webp"},dinky:{avatarImg:"/img/people/jigsaw/jigsaw.webp"},paul:{avatarImg:"/img/people/paul/paul.webp"},future_nat:{avatarImg:"/img/people/nat/future_nat.webp"},crackhead2:{avatarImg:"/img/people/crackheads/crackhead2.webp"},crackhead7:{avatarImg:"/img/people/crackheads/crackhead7.webp"},crackhead8:{avatarImg:"/img/people/crackheads/crackhead8.webp"},greek_dude:{avatarImg:"/img/people/crackheads/greek_dude.webp"},truck:{avatarImg:"/img/people/crackheads/truck.webp"},plane:{avatarImg:"/img/people/crackheads/plane.webp"},cool_manager:{avatarImg:"/img/people/crackheads/cool_manager.webp"},italoman:{avatarImg:"/img/people/crackheads/italoman.webp"},venus:{avatarImg:"/img/rooms/living_room3/black.webp"},white_dwarf:{avatarImg:"/img/rooms/living_room3/black.webp"},north_star:{avatarImg:"/img/people/jigsaw/cute_jigsaw.webp"},moon:{avatarImg:"/img/people/crackheads/moon.webp"},tricyle_man:{avatarImg:"/img/people/crackheads/tricycle_man.webp"},showmi:{avatarImg:"/img/people/crackheads/showmi.webp"},showmi2:{avatarImg:"/img/people/crackheads/showmi2.webp"},oracle:{avatarImg:"/img/rooms/misc/vortex_waves2.png"}};function AC({convoName:e,prevConvoName:t,className:n}){var i;const r=Ng(),[a,s]=Hr.useState(0),[o,l]=Hr.useState(0),c=SC[e],u=c.dialogue[a],h=a%2==0?0:1,d=c.speakers[h],p=TC[d],f=null==(i=u.text)?void 0:i[o],m=u.options,g=c.dialogue.length===a+1&&void 0!==u.text&&u.text.length===o+1,_=void 0!==m,v=0===a&&0===o&&null===t||g&&void 0!==c.actionOnConvoEnd;return Qr.jsxs("div",{className:`dialogue ${n}`,children:[Qr.jsx("div",{className:"dialogue-speaker",children:Qr.jsx("img",{src:p.avatarImg,alt:"Someone Speaking"})}),Qr.jsxs("div",{className:"dialogue-text-area",children:[m?Qr.jsx("div",{className:"dialogue-text-area-center",children:m.map(((e,t)=>Qr.jsx("div",{className:"dialogue-option",onClick:t=>{t.stopPropagation(),void 0!==e.nextConvoName&&(s(0),l(0),r(av(e.nextConvoName)))},children:`→ ${e.text}`},`dialogue-option-${t}`)))}):Qr.jsx("div",{className:"dialogue-text-area-center",children:Qr.jsx("div",{className:"dialogue-text",children:f})}),Qr.jsxs("div",{className:"navigate-dialogue",children:[Qr.jsx("button",{className:v?"navigate-dialogue-button-disabled":"navigate-dialogue-button",title:"Back",onClick:v?void 0:e=>{e.stopPropagation(),(()=>{if(o>0)l(o-1);else{if(a>0){const e=a-1,t=c.dialogue[e];return s(e),void(void 0!==t.text?l(t.text.length-1):l(0))}if(null!==t){const e=SC[t];r(av(t));const n=e.dialogue.length-1,i=e.dialogue[e.dialogue.length-1],a=void 0!==i.text?i.text.length-1:0;return s(n),void l(a)}s(0),l(0),r(sv())}})()},children:"←"}),Qr.jsx("button",{className:_?"navigate-dialogue-button-disabled":"navigate-dialogue-button",title:g?"End":"Next",style:g?{fontSize:"2rem"}:{fontSize:"3rem"},onClick:_?void 0:e=>{e.stopPropagation(),(()=>{const e=o+1;if(u.text.length===e){const e=a+1;return c.dialogue.length===e?(s(0),l(0),c.actionOnConvoEnd&&r(c.actionOnConvoEnd.reduxAction),void r(sv())):(s(e),void l(0))}l(e)})()},children:g?"End":"→"})]})]})]})}function CC({onHelpFinished:e}){const t=["Hey there... need some help?...","You look lost......",".........","My children have all left me and I only have a friend who lives in Wisconsin. It's a joke...","Do you have some soup for me? I like chicken noodle. Or shrimp noodle.","You should leave."],[n,i]=Hr.useState(0);return Hr.useEffect((()=>{if(n==t.length)return void e();if(n%t.length!=1)return;(async()=>{await Hv(Ov,!1)})()}),[n]),Qr.jsxs(Hr.Fragment,{children:[Qr.jsx("div",{className:"help-background",onClick:()=>i(n+1),children:Qr.jsx("h1",{children:"huMB BELLY coxCOMB give a dog a BONE! HOOHAA HOOHA HA HA TRIM WIG SALLYs PIG POSY POSY IN THE FOPS POCKET! please listen to me...NO!!! SHUT UP!".repeat(200)})}),Qr.jsx("div",{className:"help-hint-container",children:Qr.jsx("h2",{children:t[n]})})]},"help")}function RC(){const e=["Haha look I can write shit in thin air.","Boink boink boink boink boink","If only I could put pen to paper..."],[t,n]=Hr.useState(null),[i,r]=Hr.useState(0);return Qr.jsx("div",{className:"sardine-pen-mode",onClick:t=>{r((i+1)%e.length);n({left:t.clientX+83,top:t.clientY})},children:null!==t&&Qr.jsx(Kv,{thought:e[i],style:{overflow:"hidden",position:"absolute",...t},animate:!0})})}const PC="/img/rooms/nats_room/midday_sun1.webp",kC="/img/rooms/nats_room/midday_sun2.webp",OC=["Dance. Begin, a statue gifted a spine.\nSome sudden decision is made to interrupt the previous pose.\nMove, muscles, dance and flash red stocking.\nJoints now plums about to pop:\nblack, red, yellow.\nLimbs now orbit the head, sunlike.\nMimic those beautiful red figures\non the screen,\nwith hair styled like urchins.\nVeins are now hit with current, soldered.\nClenched fists now draw crude helixes in the air.","I can spot pussy gleaming in the sun a mile away. Nothing around here but weird desert noises of copulating insects, interlacing wings to make electrical clicking music. A girl is spread and pulsating in the middle of an open desert. I make it plain and simple. “I want to pump you”. I fall asleep under a violent noon.","asdsadssadasdsa"],IC=["","What a beautiful sunny day...Happy Canada Day to all.","Today's the partayy..","I'm so hungover...Need fresh air...Something feels different today.\n    Oh fuck. Some crazy shit happened last night."],LC=["","/img/rooms/nats_room/new_day_windows.webp","/img/rooms/nats_room/oily_new_day_windows.webp","/img/rooms/nats_room/red_new_day_windows.webp"],DC=[kC,PC,PC,kC];function NC(){const e=Ng(),t=Tg((e=>e.dayIndex)),n=yC[t],[i,r]=Hr.useState(!1),[a,s]=Hr.useState(void 0);Hr.useEffect((()=>{const[e,t]=n.canSleep(jv.getState());if(e){s("dreaming");const e=setTimeout((()=>r(!0)),3e4);return()=>{clearTimeout(e)}}s("cant_sleep")}),[]);switch(a){case void 0:return;case"cant_sleep":return(()=>{const[i,r]=n.canSleep(jv.getState());return Qr.jsxs("div",{className:"sky-container",children:[Qr.jsx("img",{className:`sky-image sky-image-day${t}`,src:DC[t],alt:"sleep is for the weak"}),Qr.jsxs("div",{className:"sky-thought",children:[Qr.jsx("p",{children:r}),Qr.jsx("button",{onClick:()=>e($_()),children:"Ok"})]})]})})();case"dreaming":return Qr.jsxs("div",{className:"dream-container",children:[Qr.jsx("div",{className:"blinking-eye"}),Qr.jsx("div",{className:"closed-eye",children:Qr.jsx("div",{className:"dream",children:OC[t]})}),!0===i&&Qr.jsx("div",{className:"wake-up",children:Qr.jsx(fC,{onClick:()=>{e(K_()),s("just_woke_up")},type:"html",children:"Wake Up...."})})]});case"just_woke_up":return Qr.jsxs("div",{className:"sky-container",children:[Qr.jsx("img",{className:`sky-image sky-image-day${t}`,src:LC[t],alt:"morning"}),Qr.jsxs("div",{className:"sky-thought",children:[Qr.jsx("p",{children:IC[t]}),Qr.jsx("button",{onClick:()=>e($_()),children:"Ok"})]})]})}}function UC({debugLinesEnabled:e,setDebugLinesEnabled:t,setDeepThought:n,setPassingThought:i,endGame:r}){const a=Ng(),s=Tg((e=>e.equipped)),o=s.includes("Diary Goggles");return Qr.jsxs(Qr.Fragment,{children:[Qr.jsx(fC,{onClick:()=>t(!e),children:e?"Hide Debug Lines":"Show Debug Lines"}),Qr.jsx(fC,{style:o?{backgroundColor:"pink"}:{},onClick:()=>a(J_("Diary Goggles")),children:o?"Take off diary goggles":"Equip diary goggles"}),Qr.jsx(fC,{style:s.includes("red_lightbulb")?{backgroundColor:"pink"}:{},onClick:()=>a(J_("red_lightbulb")),children:s.includes("red_lightbulb")?"Unequip red_lightbulb":"Equip red_lightbulb"}),Qr.jsx(fC,{style:s.includes("key1")?{backgroundColor:"pink"}:{},onClick:()=>a(J_("key1")),children:s.includes("key1")?"Unequip key1":"Equip key1"}),Qr.jsx(fC,{onClick:()=>a(cv()),children:"Does Boink Dream of Sheep?"}),Qr.jsx(fC,{onClick:()=>n("Boink boink boink boink boink Boink boink boink boink boink Boink boink boink boink boink Boink boink boink boink boink Boink boink boink boink boink Boink boink boink boink boink"),children:"Think."}),Qr.jsx(fC,{onClick:()=>n("I've been reading the fucking Book of the Dead for ages, I'm still reading the introduction. Been rereading the chapter on the Egyptian underworld, or the duat. The desert of the duat with winged monsters of terrifying aspect, serpents and scorpions.. wherein the darkness was so thick that it could be felt."),children:"Think Deeply About The Book I'm Reading"}),Qr.jsx(fC,{onClick:()=>i("Hello world... "),children:"Passing Thought"}),Qr.jsx(fC,{onClick:()=>a(Y_()),children:"Sleep"}),Qr.jsx(fC,{onClick:()=>a(dv()),children:"Wake Up"}),Qr.jsx(fC,{onClick:()=>a(lv()),children:"Start Party"}),Qr.jsx("button",{onClick:()=>{a(hv())},children:"Turn Lights Red"}),Qr.jsx("span",{children:Qr.jsxs("form",{method:"post",onSubmit:e=>{e.preventDefault();const t=e.target,n=new FormData(t).values().next().value;a(Q_(n))},children:[Qr.jsx("button",{type:"submit",children:"Pick Up"}),Qr.jsx("select",{name:"selectedItem",defaultValue:Ki[0].name,children:Ki.map((({name:e})=>Qr.jsx("option",{value:e,children:e},e)))})]})}),Qr.jsx("button",{onClick:r,children:"End Game"})]})}
/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const FC="170",zC=0,BC=1,VC=2,HC=100,WC=101,jC=102,GC=200,XC=201,qC=202,YC=203,$C=204,KC=205,ZC=206,QC=207,JC=208,eR=209,tR=210,nR=211,iR=212,rR=213,aR=214,sR=0,oR=1,lR=2,cR=3,uR=4,hR=5,dR=6,pR=7,fR=301,mR=302,gR=306,_R=1e3,vR=1001,yR=1002,xR=1003,wR=1004,bR=1005,ER=1006,MR=1007,SR=1008,TR=1009,AR=1010,CR=1011,RR=1012,PR=1013,kR=1014,OR=1015,IR=1016,LR=1017,DR=1018,NR=1020,UR=35902,FR=1023,zR=1026,BR=1027,VR=1028,HR=1029,WR=1031,jR=1033,GR=33776,XR=33777,qR=33778,YR=33779,$R=35840,KR=35841,ZR=35842,QR=35843,JR=36196,eP=37492,tP=37496,nP=37808,iP=37809,rP=37810,aP=37811,sP=37812,oP=37813,lP=37814,cP=37815,uP=37816,hP=37817,dP=37818,pP=37819,fP=37820,mP=37821,gP=36492,_P=36494,vP=36495,yP=36284,xP=36285,wP=36286,bP="",EP="srgb",MP="srgb-linear",SP="linear",TP="srgb",AP=7680,CP=512,RP=513,PP=514,kP=515,OP=516,IP=517,LP=518,DP=519,NP="300 es",UP=2e3,FP=2001;class zP{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const BP=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],VP=Math.PI/180,HP=180/Math.PI;function WP(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(BP[255&e]+BP[e>>8&255]+BP[e>>16&255]+BP[e>>24&255]+"-"+BP[255&t]+BP[t>>8&255]+"-"+BP[t>>16&15|64]+BP[t>>24&255]+"-"+BP[63&n|128]+BP[n>>8&255]+"-"+BP[n>>16&255]+BP[n>>24&255]+BP[255&i]+BP[i>>8&255]+BP[i>>16&255]+BP[i>>24&255]).toLowerCase()}function jP(e,t,n){return Math.max(t,Math.min(n,e))}function GP(e,t,n){return(1-n)*e+n*t}function XP(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function qP(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}class YP{constructor(e=0,t=0){YP.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(jP(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $P{constructor(e,t,n,i,r,a,s,o,l){$P.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,a,s,o,l)}set(e,t,n,i,r,a,s,o,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=r,c[5]=o,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],s=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],_=i[1],v=i[4],y=i[7],x=i[2],w=i[5],b=i[8];return r[0]=a*f+s*_+o*x,r[3]=a*m+s*v+o*w,r[6]=a*g+s*y+o*b,r[1]=l*f+c*_+u*x,r[4]=l*m+c*v+u*w,r[7]=l*g+c*y+u*b,r[2]=h*f+d*_+p*x,r[5]=h*m+d*v+p*w,r[8]=h*g+d*y+p*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-n*r*c+n*s*o+i*r*l-i*a*o}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=c*a-s*l,h=s*o-c*r,d=l*r-a*o,p=t*u+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-c*n)*f,e[2]=(s*n-i*a)*f,e[3]=h*f,e[4]=(c*t-i*o)*f,e[5]=(i*r-s*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(a*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,a,s){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*a+l*s)+a+e,-i*l,i*o,-i*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(KP.makeScale(e,t)),this}rotate(e){return this.premultiply(KP.makeRotation(-e)),this}translate(e,t){return this.premultiply(KP.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const KP=new $P;function ZP(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function QP(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function JP(){const e=QP("canvas");return e.style.display="block",e}const ek={};function tk(e){e in ek||(ek[e]=!0)}const nk={enabled:!0,workingColorSpace:MP,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===TP&&(e.r=ik(e.r),e.g=ik(e.g),e.b=ik(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===TP&&(e.r=rk(e.r),e.g=rk(e.g),e.b=rk(e.b)),e):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===bP?SP:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function ik(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function rk(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}const ak=[.64,.33,.3,.6,.15,.06],sk=[.2126,.7152,.0722],ok=[.3127,.329],lk=(new $P).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),ck=(new $P).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);let uk;nk.define({[MP]:{primaries:ak,whitePoint:ok,transfer:SP,toXYZ:lk,fromXYZ:ck,luminanceCoefficients:sk,workingColorSpaceConfig:{unpackColorSpace:EP},outputColorSpaceConfig:{drawingBufferColorSpace:EP}},[EP]:{primaries:ak,whitePoint:ok,transfer:TP,toXYZ:lk,fromXYZ:ck,luminanceCoefficients:sk,outputColorSpaceConfig:{drawingBufferColorSpace:EP}}});class hk{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===uk&&(uk=QP("canvas")),uk.width=e.width,uk.height=e.height;const n=uk.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=uk}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=QP("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),r=i.data;for(let e=0;e<r.length;e++)r[e]=255*ik(r[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ik(t[e]/255)):t[e]=ik(t[e]);return{data:t,width:e.width,height:e.height}}return e}}let dk=0;class pk{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:dk++}),this.uuid=WP(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,n=i.length;t<n;t++)i[t].isDataTexture?e.push(fk(i[t].image)):e.push(fk(i[t]))}else e=fk(i);n.url=e}return t||(e.images[this.uuid]=n),n}}function fk(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?hk.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:{}}let mk=0;class gk extends zP{constructor(e=gk.DEFAULT_IMAGE,t=gk.DEFAULT_MAPPING,n=1001,i=1001,r=1006,a=1008,s=1023,o=1009,l=gk.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:mk++}),this.uuid=WP(),this.name="",this.source=new pk(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new YP(0,0),this.repeat=new YP(1,1),this.center=new YP(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $P,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case _R:e.x=e.x-Math.floor(e.x);break;case vR:e.x=e.x<0?0:1;break;case yR:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case _R:e.y=e.y-Math.floor(e.y);break;case vR:e.y=e.y<0?0:1;break;case yR:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}gk.DEFAULT_IMAGE=null,gk.DEFAULT_MAPPING=300,gk.DEFAULT_ANISOTROPY=1;class _k{constructor(e=0,t=0,n=0,i=1){_k.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const a=.01,s=.1,o=e.elements,l=o[0],c=o[4],u=o[8],h=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-h)<a&&Math.abs(u-f)<a&&Math.abs(p-m)<a){if(Math.abs(c+h)<s&&Math.abs(u+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(d+1)/2,_=(g+1)/2,v=(c+h)/4,y=(u+f)/4,x=(p+m)/4;return e>o&&e>_?e<a?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=v/n,r=y/n):o>_?o<a?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=v/i,r=x/i):_<a?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=y/r,i=x/r),this.set(n,i,r,t),this}let _=Math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(u-f)/_,this.z=(h-c)/_,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class vk extends zP{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new _k(0,0,e,t),this.scissorTest=!1,this.viewport=new _k(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ER,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new gk(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const a=n.count;for(let s=0;s<a;s++)this.textures[s]=r.clone(),this.textures[s].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,i=e.textures.length;n<i;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new pk(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class yk extends vk{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class xk extends gk{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=xR,this.minFilter=xR,this.wrapR=vR,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class wk extends gk{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=xR,this.minFilter=xR,this.wrapR=vR,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bk{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,r,a,s){let o=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3];const h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===s)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||o!==h||l!==d||c!==p){let e=1-s;const t=o*h+l*d+c*p+u*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),a=Math.atan2(r,t*n);e=Math.sin(e*a)/r,s=Math.sin(s*a)/r}const r=s*n;if(o=o*e+h*r,l=l*e+d*r,c=c*e+p*r,u=u*e+f*r,e===1-s){const e=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=e,l*=e,c*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,i,r,a){const s=n[i],o=n[i+1],l=n[i+2],c=n[i+3],u=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return e[t]=s*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-s*d,e[t+2]=l*p+c*d+s*h-o*u,e[t+3]=c*p-s*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,r=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(n/2),c=s(i/2),u=s(r/2),h=o(n/2),d=o(i/2),p=o(r/2);switch(a){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=n+s+u;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(a-i)*e}else if(n>s&&n>u){const e=2*Math.sqrt(1+n-s-u);this._w=(c-o)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(r+l)/e}else if(s>u){const e=2*Math.sqrt(1+s-n-u);this._w=(r-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(o+c)/e}else{const e=2*Math.sqrt(1+u-n-s);this._w=(a-i)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(jP(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=n*c+a*s+i*l-r*o,this._y=i*c+a*o+r*s-n*l,this._z=r*c+a*l+n*o-i*s,this._w=a*c-n*s-i*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,a=this._w;let s=a*e._w+n*e._x+i*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const o=1-s*s;if(o<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,s),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=a*u+this._w*h,this._x=n*u+this._x*h,this._y=i*u+this._y*h,this._z=r*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ek{constructor(e=0,t=0,n=0){Ek.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Sk.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Sk.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*i-s*n),c=2*(s*t-r*i),u=2*(r*n-a*t);return this.x=t+o*l+a*u-s*c,this.y=n+o*c+s*l-r*u,this.z=i+o*u+r*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,a=t.x,s=t.y,o=t.z;return this.x=i*o-r*s,this.y=r*a-n*o,this.z=n*s-i*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Mk.copy(this).projectOnVector(e),this.sub(Mk)}reflect(e){return this.sub(Mk.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(jP(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Mk=new Ek,Sk=new bk;class Tk{constructor(e=new Ek(1/0,1/0,1/0),t=new Ek(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Ck.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Ck.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ck.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,n=i.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Ck):Ck.fromBufferAttribute(i,t),Ck.applyMatrix4(e.matrixWorld),this.expandByPoint(Ck);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Rk.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Rk.copy(n.boundingBox)),Rk.applyMatrix4(e.matrixWorld),this.union(Rk)}const i=e.children;for(let r=0,a=i.length;r<a;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Ck),Ck.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Nk),Uk.subVectors(this.max,Nk),Pk.subVectors(e.a,Nk),kk.subVectors(e.b,Nk),Ok.subVectors(e.c,Nk),Ik.subVectors(kk,Pk),Lk.subVectors(Ok,kk),Dk.subVectors(Pk,Ok);let t=[0,-Ik.z,Ik.y,0,-Lk.z,Lk.y,0,-Dk.z,Dk.y,Ik.z,0,-Ik.x,Lk.z,0,-Lk.x,Dk.z,0,-Dk.x,-Ik.y,Ik.x,0,-Lk.y,Lk.x,0,-Dk.y,Dk.x,0];return!!Bk(t,Pk,kk,Ok,Uk)&&(t=[1,0,0,0,1,0,0,0,1],!!Bk(t,Pk,kk,Ok,Uk)&&(Fk.crossVectors(Ik,Lk),t=[Fk.x,Fk.y,Fk.z],Bk(t,Pk,kk,Ok,Uk)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ck).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Ck).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ak[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ak[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ak[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ak[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ak[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ak[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ak[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ak[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ak)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ak=[new Ek,new Ek,new Ek,new Ek,new Ek,new Ek,new Ek,new Ek],Ck=new Ek,Rk=new Tk,Pk=new Ek,kk=new Ek,Ok=new Ek,Ik=new Ek,Lk=new Ek,Dk=new Ek,Nk=new Ek,Uk=new Ek,Fk=new Ek,zk=new Ek;function Bk(e,t,n,i,r){for(let a=0,s=e.length-3;a<=s;a+=3){zk.fromArray(e,a);const s=r.x*Math.abs(zk.x)+r.y*Math.abs(zk.y)+r.z*Math.abs(zk.z),o=t.dot(zk),l=n.dot(zk),c=i.dot(zk);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}const Vk=new Tk,Hk=new Ek,Wk=new Ek;class jk{constructor(e=new Ek,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Vk.setFromPoints(e).getCenter(n);let i=0;for(let r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Hk.subVectors(e,this.center);const t=Hk.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Hk,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Wk.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Hk.copy(e.center).add(Wk)),this.expandByPoint(Hk.copy(e.center).sub(Wk))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Gk=new Ek,Xk=new Ek,qk=new Ek,Yk=new Ek,$k=new Ek,Kk=new Ek,Zk=new Ek;class Qk{constructor(e=new Ek,t=new Ek(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Gk)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Gk.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Gk.copy(this.origin).addScaledVector(this.direction,t),Gk.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Xk.copy(e).add(t).multiplyScalar(.5),qk.copy(t).sub(e).normalize(),Yk.copy(this.origin).sub(Xk);const r=.5*e.distanceTo(t),a=-this.direction.dot(qk),s=Yk.dot(this.direction),o=-Yk.dot(qk),l=Yk.lengthSq(),c=Math.abs(1-a*a);let u,h,d,p;if(c>0)if(u=a*o-s,h=a*s-o,p=r*c,u>=0)if(h>=-p)if(h<=p){const e=1/c;u*=e,h*=e,d=u*(u+a*h+2*s)+h*(a*u+h+2*o)+l}else h=r,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;else h=-r,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-a*r+s)),h=u>0?-r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-r,-o),r),d=h*(h+2*o)+l):(u=Math.max(0,-(a*r+s)),h=u>0?r:Math.min(Math.max(-r,-o),r),d=-u*u+h*(h+2*o)+l);else h=a>0?-r:r,u=Math.max(0,-(a*h+s)),d=-u*u+h*(h+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Xk).addScaledVector(qk,h),d}intersectSphere(e,t){Gk.subVectors(e.center,this.origin);const n=Gk.dot(this.direction),i=Gk.dot(Gk)-n*n,r=e.radius*e.radius;if(i>r)return null;const a=Math.sqrt(r-i),s=n-a,o=n+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,a,s,o;const l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||r>i?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),u>=0?(s=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(s=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),n>o||s>i?null:((s>n||n!=n)&&(n=s),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Gk)}intersectTriangle(e,t,n,i,r){$k.subVectors(t,e),Kk.subVectors(n,e),Zk.crossVectors($k,Kk);let a,s=this.direction.dot(Zk);if(s>0){if(i)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}Yk.subVectors(this.origin,e);const o=a*this.direction.dot(Kk.crossVectors(Yk,Kk));if(o<0)return null;const l=a*this.direction.dot($k.cross(Yk));if(l<0)return null;if(o+l>s)return null;const c=-a*Yk.dot(Zk);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Jk{constructor(e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m){Jk.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m)}set(e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Jk).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/eO.setFromMatrixColumn(e,0).length(),r=1/eO.setFromMatrixColumn(e,1).length(),a=1/eO.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),s=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){const e=a*c,n=a*u,i=s*c,r=s*u;t[0]=o*c,t[4]=-o*u,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-s*o,t[2]=r-e*l,t[6]=i+n*l,t[10]=a*o}else if("YXZ"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e+r*s,t[4]=i*s-n,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-s,t[2]=n*s-i,t[6]=r+e*s,t[10]=a*o}else if("ZXY"===e.order){const e=o*c,n=o*u,i=l*c,r=l*u;t[0]=e-r*s,t[4]=-a*u,t[8]=i+n*s,t[1]=n+i*s,t[5]=a*c,t[9]=r-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){const e=a*c,n=a*u,i=s*c,r=s*u;t[0]=o*c,t[4]=i*l-n,t[8]=e*l+r,t[1]=o*u,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){const e=a*o,n=a*l,i=s*o,r=s*l;t[0]=o*c,t[4]=r-e*u,t[8]=i*u+n,t[1]=u,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=n*u+i,t[10]=e-r*u}else if("XZY"===e.order){const e=a*o,n=a*l,i=s*o,r=s*l;t[0]=o*c,t[4]=-u,t[8]=l*c,t[1]=e*u+r,t[5]=a*c,t[9]=n*u-i,t[2]=i*u-n,t[6]=s*c,t[10]=r*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nO,e,iO)}lookAt(e,t,n){const i=this.elements;return sO.subVectors(e,t),0===sO.lengthSq()&&(sO.z=1),sO.normalize(),rO.crossVectors(n,sO),0===rO.lengthSq()&&(1===Math.abs(n.z)?sO.x+=1e-4:sO.z+=1e-4,sO.normalize(),rO.crossVectors(n,sO)),rO.normalize(),aO.crossVectors(sO,rO),i[0]=rO.x,i[4]=aO.x,i[8]=sO.x,i[1]=rO.y,i[5]=aO.y,i[9]=sO.y,i[2]=rO.z,i[6]=aO.z,i[10]=sO.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],s=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],x=n[15],w=i[0],b=i[4],E=i[8],M=i[12],S=i[1],T=i[5],A=i[9],C=i[13],R=i[2],P=i[6],k=i[10],O=i[14],I=i[3],L=i[7],D=i[11],N=i[15];return r[0]=a*w+s*S+o*R+l*I,r[4]=a*b+s*T+o*P+l*L,r[8]=a*E+s*A+o*k+l*D,r[12]=a*M+s*C+o*O+l*N,r[1]=c*w+u*S+h*R+d*I,r[5]=c*b+u*T+h*P+d*L,r[9]=c*E+u*A+h*k+d*D,r[13]=c*M+u*C+h*O+d*N,r[2]=p*w+f*S+m*R+g*I,r[6]=p*b+f*T+m*P+g*L,r[10]=p*E+f*A+m*k+g*D,r[14]=p*M+f*C+m*O+g*N,r[3]=_*w+v*S+y*R+x*I,r[7]=_*b+v*T+y*P+x*L,r[11]=_*E+v*A+y*k+x*D,r[15]=_*M+v*C+y*O+x*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+r*o*u-i*l*u-r*s*h+n*l*h+i*s*d-n*o*d)+e[7]*(+t*o*d-t*l*h+r*a*h-i*a*d+i*l*c-r*o*c)+e[11]*(+t*l*u-t*s*d-r*a*u+n*a*d+r*s*c-n*l*c)+e[15]*(-i*s*c-t*o*u+t*s*h+i*a*u-n*a*h+n*o*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*h*l+f*o*d-s*m*d-u*o*g+s*h*g,v=p*h*l-c*m*l-p*o*d+a*m*d+c*o*g-a*h*g,y=c*f*l-p*u*l+p*s*d-a*f*d-c*s*g+a*u*g,x=p*u*o-c*f*o-p*s*h+a*f*h+c*s*m-a*u*m,w=t*_+n*v+i*y+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/w;return e[0]=_*b,e[1]=(f*h*r-u*m*r-f*i*d+n*m*d+u*i*g-n*h*g)*b,e[2]=(s*m*r-f*o*r+f*i*l-n*m*l-s*i*g+n*o*g)*b,e[3]=(u*o*r-s*h*r-u*i*l+n*h*l+s*i*d-n*o*d)*b,e[4]=v*b,e[5]=(c*m*r-p*h*r+p*i*d-t*m*d-c*i*g+t*h*g)*b,e[6]=(p*o*r-a*m*r-p*i*l+t*m*l+a*i*g-t*o*g)*b,e[7]=(a*h*r-c*o*r+c*i*l-t*h*l-a*i*d+t*o*d)*b,e[8]=y*b,e[9]=(p*u*r-c*f*r-p*n*d+t*f*d+c*n*g-t*u*g)*b,e[10]=(a*f*r-p*s*r+p*n*l-t*f*l-a*n*g+t*s*g)*b,e[11]=(c*s*r-a*u*r-c*n*l+t*u*l+a*n*d-t*s*d)*b,e[12]=x*b,e[13]=(c*f*i-p*u*i+p*n*h-t*f*h-c*n*m+t*u*m)*b,e[14]=(p*s*i-a*f*i-p*n*o+t*f*o+a*n*m-t*s*m)*b,e[15]=(a*u*i-c*s*i+c*n*o-t*u*o-a*n*h+t*s*h)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,s=e.y,o=e.z,l=r*a,c=r*s;return this.set(l*a+n,l*s-i*o,l*o+i*s,0,l*s+i*o,c*s+n,c*o-i*a,0,l*o-i*s,c*o+i*a,r*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,a=t._y,s=t._z,o=t._w,l=r+r,c=a+a,u=s+s,h=r*l,d=r*c,p=r*u,f=a*c,m=a*u,g=s*u,_=o*l,v=o*c,y=o*u,x=n.x,w=n.y,b=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+y)*x,i[2]=(p-v)*x,i[3]=0,i[4]=(d-y)*w,i[5]=(1-(h+g))*w,i[6]=(m+_)*w,i[7]=0,i[8]=(p+v)*b,i[9]=(m-_)*b,i[10]=(1-(h+f))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=eO.set(i[0],i[1],i[2]).length();const a=eO.set(i[4],i[5],i[6]).length(),s=eO.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],tO.copy(this);const o=1/r,l=1/a,c=1/s;return tO.elements[0]*=o,tO.elements[1]*=o,tO.elements[2]*=o,tO.elements[4]*=l,tO.elements[5]*=l,tO.elements[6]*=l,tO.elements[8]*=c,tO.elements[9]*=c,tO.elements[10]*=c,t.setFromRotationMatrix(tO),n.x=r,n.y=a,n.z=s,this}makePerspective(e,t,n,i,r,a,s=2e3){const o=this.elements,l=2*r/(t-e),c=2*r/(n-i),u=(t+e)/(t-e),h=(n+i)/(n-i);let d,p;if(s===UP)d=-(a+r)/(a-r),p=-2*a*r/(a-r);else{if(s!==FP)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);d=-a/(a-r),p=-a*r/(a-r)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,r,a,s=2e3){const o=this.elements,l=1/(t-e),c=1/(n-i),u=1/(a-r),h=(t+e)*l,d=(n+i)*c;let p,f;if(s===UP)p=(a+r)*u,f=-2*u;else{if(s!==FP)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);p=r*u,f=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const eO=new Ek,tO=new Jk,nO=new Ek(0,0,0),iO=new Ek(1,1,1),rO=new Ek,aO=new Ek,sO=new Ek,oO=new Jk,lO=new bk;class cO{constructor(e=0,t=0,n=0,i=cO.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],a=i[4],s=i[8],o=i[1],l=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(jP(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-jP(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(jP(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-jP(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(jP(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-jP(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return oO.makeRotationFromQuaternion(e),this.setFromRotationMatrix(oO,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return lO.setFromEuler(this),this.setFromQuaternion(lO,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}cO.DEFAULT_ORDER="XYZ";class uO{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let hO=0;const dO=new Ek,pO=new bk,fO=new Jk,mO=new Ek,gO=new Ek,_O=new Ek,vO=new bk,yO=new Ek(1,0,0),xO=new Ek(0,1,0),wO=new Ek(0,0,1),bO={type:"added"},EO={type:"removed"},MO={type:"childadded",child:null},SO={type:"childremoved",child:null};class TO extends zP{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:hO++}),this.uuid=WP(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=TO.DEFAULT_UP.clone();const e=new Ek,t=new cO,n=new bk,i=new Ek(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Jk},normalMatrix:{value:new $P}}),this.matrix=new Jk,this.matrixWorld=new Jk,this.matrixAutoUpdate=TO.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=TO.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new uO,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return pO.setFromAxisAngle(e,t),this.quaternion.multiply(pO),this}rotateOnWorldAxis(e,t){return pO.setFromAxisAngle(e,t),this.quaternion.premultiply(pO),this}rotateX(e){return this.rotateOnAxis(yO,e)}rotateY(e){return this.rotateOnAxis(xO,e)}rotateZ(e){return this.rotateOnAxis(wO,e)}translateOnAxis(e,t){return dO.copy(e).applyQuaternion(this.quaternion),this.position.add(dO.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(yO,e)}translateY(e){return this.translateOnAxis(xO,e)}translateZ(e){return this.translateOnAxis(wO,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(fO.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?mO.copy(e):mO.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),gO.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fO.lookAt(gO,mO,this.up):fO.lookAt(mO,gO,this.up),this.quaternion.setFromRotationMatrix(fO),i&&(fO.extractRotation(i.matrixWorld),pO.setFromRotationMatrix(fO),this.quaternion.premultiply(pO.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this||e&&e.isObject3D&&(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(bO),MO.child=e,this.dispatchEvent(MO),MO.child=null),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(EO),SO.child=e,this.dispatchEvent(SO),SO.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),fO.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),fO.multiply(e.parent.matrixWorld)),e.applyMatrix4(fO),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(bO),MO.child=e,this.dispatchEvent(MO),MO.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gO,e,_O),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gO,vO,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=a(e.geometries),i=a(e.materials),r=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),c=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),s.length>0&&(n.images=s),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),u.length>0&&(n.nodes=u)}return n.object=i,n;function a(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}TO.DEFAULT_UP=new Ek(0,1,0),TO.DEFAULT_MATRIX_AUTO_UPDATE=!0,TO.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const AO=new Ek,CO=new Ek,RO=new Ek,PO=new Ek,kO=new Ek,OO=new Ek,IO=new Ek,LO=new Ek,DO=new Ek,NO=new Ek,UO=new _k,FO=new _k,zO=new _k;class BO{constructor(e=new Ek,t=new Ek,n=new Ek){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),AO.subVectors(e,t),i.cross(AO);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){AO.subVectors(i,t),CO.subVectors(n,t),RO.subVectors(e,t);const a=AO.dot(AO),s=AO.dot(CO),o=AO.dot(RO),l=CO.dot(CO),c=CO.dot(RO),u=a*l-s*s;if(0===u)return r.set(0,0,0),null;const h=1/u,d=(l*o-s*c)*h,p=(a*c-s*o)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return null!==this.getBarycoord(e,t,n,i,PO)&&(PO.x>=0&&PO.y>=0&&PO.x+PO.y<=1)}static getInterpolation(e,t,n,i,r,a,s,o){return null===this.getBarycoord(e,t,n,i,PO)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,PO.x),o.addScaledVector(a,PO.y),o.addScaledVector(s,PO.z),o)}static getInterpolatedAttribute(e,t,n,i,r,a){return UO.setScalar(0),FO.setScalar(0),zO.setScalar(0),UO.fromBufferAttribute(e,t),FO.fromBufferAttribute(e,n),zO.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(UO,r.x),a.addScaledVector(FO,r.y),a.addScaledVector(zO,r.z),a}static isFrontFacing(e,t,n,i){return AO.subVectors(n,t),CO.subVectors(e,t),AO.cross(CO).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return AO.subVectors(this.c,this.b),CO.subVectors(this.a,this.b),.5*AO.cross(CO).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return BO.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return BO.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,r){return BO.getInterpolation(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return BO.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return BO.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let a,s;kO.subVectors(i,n),OO.subVectors(r,n),LO.subVectors(e,n);const o=kO.dot(LO),l=OO.dot(LO);if(o<=0&&l<=0)return t.copy(n);DO.subVectors(e,i);const c=kO.dot(DO),u=OO.dot(DO);if(c>=0&&u<=c)return t.copy(i);const h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return a=o/(o-c),t.copy(n).addScaledVector(kO,a);NO.subVectors(e,r);const d=kO.dot(NO),p=OO.dot(NO);if(p>=0&&d<=p)return t.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return s=l/(l-p),t.copy(n).addScaledVector(OO,s);const m=c*p-d*u;if(m<=0&&u-c>=0&&d-p>=0)return IO.subVectors(r,i),s=(u-c)/(u-c+(d-p)),t.copy(i).addScaledVector(IO,s);const g=1/(m+f+h);return a=f*g,s=h*g,t.copy(n).addScaledVector(kO,a).addScaledVector(OO,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const VO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},HO={h:0,s:0,l:0},WO={h:0,s:0,l:0};function jO(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class GO{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=EP){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,nk.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=nk.workingColorSpace){return this.r=e,this.g=t,this.b=n,nk.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=nk.workingColorSpace){if(e=function(e,t){return(e%t+t)%t}(e,1),t=jP(t,0,1),n=jP(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=jO(r,i,e+1/3),this.g=jO(r,i,e),this.b=jO(r,i,e-1/3)}return nk.toWorkingColorSpace(this,i),this}setStyle(e,t=EP){function n(e){void 0!==e&&parseFloat(e)}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let e;const r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,t);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,t);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],n=e.length;if(3===n)return this.setRGB(parseInt(e.charAt(0),16)/15,parseInt(e.charAt(1),16)/15,parseInt(e.charAt(2),16)/15,t);if(6===n)return this.setHex(parseInt(e,16),t)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=EP){const n=VO[e.toLowerCase()];return void 0!==n&&this.setHex(n,t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ik(e.r),this.g=ik(e.g),this.b=ik(e.b),this}copyLinearToSRGB(e){return this.r=rk(e.r),this.g=rk(e.g),this.b=rk(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=EP){return nk.fromWorkingColorSpace(XO.copy(this),e),65536*Math.round(jP(255*XO.r,0,255))+256*Math.round(jP(255*XO.g,0,255))+Math.round(jP(255*XO.b,0,255))}getHexString(e=EP){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=nk.workingColorSpace){nk.fromWorkingColorSpace(XO.copy(this),t);const n=XO.r,i=XO.g,r=XO.b,a=Math.max(n,i,r),s=Math.min(n,i,r);let o,l;const c=(s+a)/2;if(s===a)o=0,l=0;else{const e=a-s;switch(l=c<=.5?e/(a+s):e/(2-a-s),a){case n:o=(i-r)/e+(i<r?6:0);break;case i:o=(r-n)/e+2;break;case r:o=(n-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=nk.workingColorSpace){return nk.fromWorkingColorSpace(XO.copy(this),t),e.r=XO.r,e.g=XO.g,e.b=XO.b,e}getStyle(e=EP){nk.fromWorkingColorSpace(XO.copy(this),e);const t=XO.r,n=XO.g,i=XO.b;return e!==EP?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(e,t,n){return this.getHSL(HO),this.setHSL(HO.h+e,HO.s+t,HO.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(HO),e.getHSL(WO);const n=GP(HO.h,WO.h,t),i=GP(HO.s,WO.s,t),r=GP(HO.l,WO.l,t);return this.setHSL(n,i,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,r=e.elements;return this.r=r[0]*t+r[3]*n+r[6]*i,this.g=r[1]*t+r[4]*n+r[7]*i,this.b=r[2]*t+r[5]*n+r[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const XO=new GO;GO.NAMES=VO;let qO=0;class YO extends zP{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:qO++}),this.uuid=WP(),this.name="",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=HC,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new GO(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=AP,this.stencilZFail=AP,this.stencilZPass=AP,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n)continue;const i=this[t];void 0!==i&&(i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==HC&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==AP&&(n.stencilFail=this.stencilFail),this.stencilZFail!==AP&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==AP&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){}}class $O extends YO{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new GO(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new cO,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const KO=new Ek,ZO=new YP;class QO{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=35044,this.updateRanges=[],this.gpuType=OR,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ZO.fromBufferAttribute(this,t),ZO.applyMatrix3(e),this.setXY(t,ZO.x,ZO.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)KO.fromBufferAttribute(this,t),KO.applyMatrix3(e),this.setXYZ(t,KO.x,KO.y,KO.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)KO.fromBufferAttribute(this,t),KO.applyMatrix4(e),this.setXYZ(t,KO.x,KO.y,KO.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)KO.fromBufferAttribute(this,t),KO.applyNormalMatrix(e),this.setXYZ(t,KO.x,KO.y,KO.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)KO.fromBufferAttribute(this,t),KO.transformDirection(e),this.setXYZ(t,KO.x,KO.y,KO.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=XP(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=qP(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=XP(t,this.array)),t}setX(e,t){return this.normalized&&(t=qP(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=XP(t,this.array)),t}setY(e,t){return this.normalized&&(t=qP(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=XP(t,this.array)),t}setZ(e,t){return this.normalized&&(t=qP(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=XP(t,this.array)),t}setW(e,t){return this.normalized&&(t=qP(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=qP(t,this.array),n=qP(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=qP(t,this.array),n=qP(n,this.array),i=qP(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=qP(t,this.array),n=qP(n,this.array),i=qP(i,this.array),r=qP(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class JO extends QO{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class eI extends QO{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class tI extends QO{constructor(e,t,n){super(new Float32Array(e),t,n)}}let nI=0;const iI=new Jk,rI=new TO,aI=new Ek,sI=new Tk,oI=new Tk,lI=new Ek;class cI extends zP{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:nI++}),this.uuid=WP(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ZP(e)?eI:JO)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new $P).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return iI.makeRotationFromQuaternion(e),this.applyMatrix4(iI),this}rotateX(e){return iI.makeRotationX(e),this.applyMatrix4(iI),this}rotateY(e){return iI.makeRotationY(e),this.applyMatrix4(iI),this}rotateZ(e){return iI.makeRotationZ(e),this.applyMatrix4(iI),this}translate(e,t,n){return iI.makeTranslation(e,t,n),this.applyMatrix4(iI),this}scale(e,t,n){return iI.makeScale(e,t,n),this.applyMatrix4(iI),this}lookAt(e){return rI.lookAt(e),rI.updateMatrix(),this.applyMatrix4(rI.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(aI).negate(),this.translate(aI.x,aI.y,aI.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}this.setAttribute("position",new tI(t,3))}else{for(let n=0,i=t.count;n<i;n++){const i=e[n];t.setXYZ(n,i.x,i.y,i.z||0)}e.length,t.count,t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Tk);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new Ek(-1/0,-1/0,-1/0),new Ek(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];sI.setFromBufferAttribute(n),this.morphTargetsRelative?(lI.addVectors(this.boundingBox.min,sI.min),this.boundingBox.expandByPoint(lI),lI.addVectors(this.boundingBox.max,sI.max),this.boundingBox.expandByPoint(lI)):(this.boundingBox.expandByPoint(sI.min),this.boundingBox.expandByPoint(sI.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new jk);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new Ek,1/0);else if(e){const n=this.boundingSphere.center;if(sI.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const n=t[e];oI.setFromBufferAttribute(n),this.morphTargetsRelative?(lI.addVectors(sI.min,oI.min),sI.expandByPoint(lI),lI.addVectors(sI.max,oI.max),sI.expandByPoint(lI)):(sI.expandByPoint(oI.min),sI.expandByPoint(oI.max))}sI.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)lI.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(lI));if(t)for(let r=0,a=t.length;r<a;r++){const a=t[r],s=this.morphTargetsRelative;for(let t=0,r=a.count;t<r;t++)lI.fromBufferAttribute(a,t),s&&(aI.fromBufferAttribute(e,t),lI.add(aI)),i=Math.max(i,n.distanceToSquared(lI))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return;const n=t.position,i=t.normal,r=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new QO(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),s=[],o=[];for(let E=0;E<n.count;E++)s[E]=new Ek,o[E]=new Ek;const l=new Ek,c=new Ek,u=new Ek,h=new YP,d=new YP,p=new YP,f=new Ek,m=new Ek;function g(e,t,i){l.fromBufferAttribute(n,e),c.fromBufferAttribute(n,t),u.fromBufferAttribute(n,i),h.fromBufferAttribute(r,e),d.fromBufferAttribute(r,t),p.fromBufferAttribute(r,i),c.sub(l),u.sub(l),d.sub(h),p.sub(h);const a=1/(d.x*p.y-p.x*d.y);isFinite(a)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(a),m.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(a),s[e].add(f),s[t].add(f),s[i].add(f),o[e].add(m),o[t].add(m),o[i].add(m))}let _=this.groups;0===_.length&&(_=[{start:0,count:e.count}]);for(let E=0,M=_.length;E<M;++E){const t=_[E],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)g(e.getX(i+0),e.getX(i+1),e.getX(i+2))}const v=new Ek,y=new Ek,x=new Ek,w=new Ek;function b(e){x.fromBufferAttribute(i,e),w.copy(x);const t=s[e];v.copy(t),v.sub(x.multiplyScalar(x.dot(t))).normalize(),y.crossVectors(w,t);const n=y.dot(o[e])<0?-1:1;a.setXYZW(e,v.x,v.y,v.z,n)}for(let E=0,M=_.length;E<M;++E){const t=_[E],n=t.start;for(let i=n,r=n+t.count;i<r;i+=3)b(e.getX(i+0)),b(e.getX(i+1)),b(e.getX(i+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new QO(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new Ek,r=new Ek,a=new Ek,s=new Ek,o=new Ek,l=new Ek,c=new Ek,u=new Ek;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),s.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(c),o.add(c),l.add(c),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,h=t.count;e<h;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,r),u.subVectors(i,r),c.cross(u),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)lI.fromBufferAttribute(e,t),lI.normalize(),e.setXYZ(t,lI.x,lI.y,lI.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i);let s=0,o=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(let e=0;e<i;e++)a[o++]=n[s++]}return new QO(a,i,r)}if(null===this.index)return this;const t=new cI,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const r=this.morphAttributes;for(const s in r){const i=[],a=r[s];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);i.push(r)}t.morphAttributes[s]=i}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let s=0,o=a.length;s<o;s++){const e=a[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const o in n){const t=n[o];e.data.attributes[o]=t.toJSON(e.data)}const i={};let r=!1;for(const o in this.morphAttributes){const t=this.morphAttributes[o],n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];n.push(r.toJSON(e.data))}n.length>0&&(i[o]=n,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const l in i){const e=i[l];this.setAttribute(l,e.clone(t))}const r=e.morphAttributes;for(const l in r){const e=[],n=r[l];for(let i=0,r=n.length;i<r;i++)e.push(n[i].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const uI=new Jk,hI=new Qk,dI=new jk,pI=new Ek,fI=new Ek,mI=new Ek,gI=new Ek,_I=new Ek,vI=new Ek,yI=new Ek,xI=new Ek;class wI extends TO{constructor(e=new cI,t=new $O){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(r&&s){vI.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=s[n],o=r[n];0!==i&&(_I.fromBufferAttribute(o,e),a?vI.addScaledVector(_I,i):vI.addScaledVector(_I.sub(t),i))}t.add(vI)}return t}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),dI.copy(n.boundingSphere),dI.applyMatrix4(r),hI.copy(e.ray).recast(e.near),!1===dI.containsPoint(hI.origin)){if(null===hI.intersectSphere(dI,pI))return;if(hI.origin.distanceToSquared(pI)>(e.far-e.near)**2)return}uI.copy(r).invert(),hI.copy(e.ray).applyMatrix4(uI),null!==n.boundingBox&&!1===hI.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,hI)}}_computeIntersections(e,t,n){let i;const r=this.geometry,a=this.material,s=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,u=r.attributes.normal,h=r.groups,d=r.drawRange;if(null!==s)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const r=h[p],o=a[r.materialIndex];for(let a=Math.max(r.start,d.start),h=Math.min(s.count,Math.min(r.start+r.count,d.start+d.count));a<h;a+=3){i=bI(this,o,e,n,l,c,u,s.getX(a),s.getX(a+1),s.getX(a+2)),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);r<o;r+=3){i=bI(this,a,e,n,l,c,u,s.getX(r),s.getX(r+1),s.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}else if(void 0!==o)if(Array.isArray(a))for(let p=0,f=h.length;p<f;p++){const r=h[p],s=a[r.materialIndex];for(let a=Math.max(r.start,d.start),h=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));a<h;a+=3){i=bI(this,s,e,n,l,c,u,a,a+1,a+2),i&&(i.faceIndex=Math.floor(a/3),i.face.materialIndex=r.materialIndex,t.push(i))}}else{for(let r=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);r<s;r+=3){i=bI(this,a,e,n,l,c,u,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),t.push(i))}}}}function bI(e,t,n,i,r,a,s,o,l,c){e.getVertexPosition(o,fI),e.getVertexPosition(l,mI),e.getVertexPosition(c,gI);const u=function(e,t,n,i,r,a,s,o){let l;if(l=1===t.side?i.intersectTriangle(s,a,r,!0,o):i.intersectTriangle(r,a,s,0===t.side,o),null===l)return null;xI.copy(o),xI.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(xI);return c<n.near||c>n.far?null:{distance:c,point:xI.clone(),object:e}}(e,t,n,i,fI,mI,gI,yI);if(u){const e=new Ek;BO.getBarycoord(yI,fI,mI,gI,e),r&&(u.uv=BO.getInterpolatedAttribute(r,o,l,c,e,new YP)),a&&(u.uv1=BO.getInterpolatedAttribute(a,o,l,c,e,new YP)),s&&(u.normal=BO.getInterpolatedAttribute(s,o,l,c,e,new Ek),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const t={a:o,b:l,c:c,normal:new Ek,materialIndex:0};BO.getNormal(fI,mI,gI,t.normal),u.face=t,u.barycoord=e}return u}class EI extends cI{constructor(e=1,t=1,n=1,i=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const s=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const o=[],l=[],c=[],u=[];let h=0,d=0;function p(e,t,n,i,r,a,p,f,m,g,_){const v=a/m,y=p/g,x=a/2,w=p/2,b=f/2,E=m+1,M=g+1;let S=0,T=0;const A=new Ek;for(let s=0;s<M;s++){const a=s*y-w;for(let o=0;o<E;o++){const h=o*v-x;A[e]=h*i,A[t]=a*r,A[n]=b,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(o/m),u.push(1-s/g),S+=1}}for(let s=0;s<g;s++)for(let e=0;e<m;e++){const t=h+e+E*s,n=h+e+E*(s+1),i=h+(e+1)+E*(s+1),r=h+(e+1)+E*s;o.push(t,n,r),o.push(n,i,r),T+=6}s.addGroup(d,T,_),d+=T,h+=S}p("z","y","x",-1,-1,n,t,e,a,r,0),p("z","y","x",1,-1,n,t,-e,a,r,1),p("x","z","y",1,1,e,n,t,i,a,2),p("x","z","y",1,-1,e,n,-t,i,a,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new tI(l,3)),this.setAttribute("normal",new tI(c,3)),this.setAttribute("uv",new tI(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new EI(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function MI(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?t[n][i]=null:t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function SI(e){const t={};for(let n=0;n<e.length;n++){const i=MI(e[n]);for(const e in i)t[e]=i[e]}return t}function TI(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:nk.workingColorSpace}const AI={clone:MI,merge:SI};class CI extends YO{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=MI(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class RI extends TO{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Jk,this.projectionMatrix=new Jk,this.projectionMatrixInverse=new Jk,this.coordinateSystem=UP}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const PI=new Ek,kI=new YP,OI=new YP;class II extends RI{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*HP*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*VP*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*HP*Math.atan(Math.tan(.5*VP*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){PI.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(PI.x,PI.y).multiplyScalar(-e/PI.z),PI.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(PI.x,PI.y).multiplyScalar(-e/PI.z)}getViewSize(e,t){return this.getViewBounds(e,kI,OI),t.subVectors(OI,kI)}setViewOffset(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*VP*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/e,t-=a.offsetY*n/s,i*=a.width/e,n*=a.height/s}const s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const LI=-90;class DI extends TO{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new II(LI,1,e,t);i.layers=this.layers,this.add(i);const r=new II(LI,1,e,t);r.layers=this.layers,this.add(r);const a=new II(LI,1,e,t);a.layers=this.layers,this.add(a);const s=new II(LI,1,e,t);s.layers=this.layers,this.add(s);const o=new II(LI,1,e,t);o.layers=this.layers,this.add(o);const l=new II(LI,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,r,a,s,o]=t;for(const l of t)this.remove(l);if(e===UP)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==FP)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,a,s,o,l,c]=this.children,u=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,r),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,s),e.setRenderTarget(n,3,i),e.render(t,o),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(u,h,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class NI extends gk{constructor(e,t,n,i,r,a,s,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:fR,n,i,r,a,s,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class UI extends yk{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new NI(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ER}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new EI(5,5,5),r=new CI({name:"CubemapFromEquirect",uniforms:MI(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;const a=new wI(i,r),s=t.minFilter;t.minFilter===SR&&(t.minFilter=ER);return new DI(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}const FI=new Ek,zI=new Ek,BI=new $P;class VI{constructor(e=new Ek(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=FI.subVectors(n,t).cross(zI.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(FI),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(e.start).addScaledVector(n,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||BI.getNormalMatrix(e),i=this.coplanarPoint(FI).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const HI=new jk,WI=new Ek;class jI{constructor(e=new VI,t=new VI,n=new VI,i=new VI,r=new VI,a=new VI){this.planes=[e,t,n,i,r,a]}set(e,t,n,i,r,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(r),s[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,i=e.elements,r=i[0],a=i[1],s=i[2],o=i[3],l=i[4],c=i[5],u=i[6],h=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],_=i[13],v=i[14],y=i[15];if(n[0].setComponents(o-r,h-l,m-d,y-g).normalize(),n[1].setComponents(o+r,h+l,m+d,y+g).normalize(),n[2].setComponents(o+a,h+c,m+p,y+_).normalize(),n[3].setComponents(o-a,h-c,m-p,y-_).normalize(),n[4].setComponents(o-s,h-u,m-f,y-v).normalize(),t===UP)n[5].setComponents(o+s,h+u,m+f,y+v).normalize();else{if(t!==FP)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,v).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),HI.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),HI.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(HI)}intersectsSprite(e){return HI.center.set(0,0,0),HI.radius=.7071067811865476,HI.applyMatrix4(e.matrixWorld),this.intersectsSphere(HI)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(WI.x=i.normal.x>0?e.max.x:e.min.x,WI.y=i.normal.y>0?e.max.y:e.min.y,WI.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(WI)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function GI(){let e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function XI(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const r=t.get(n);if(void 0===r)t.set(n,function(t,n){const i=t.array,r=t.usage,a=i.byteLength,s=e.createBuffer();let o;if(e.bindBuffer(n,s),e.bufferData(n,i,r),t.onUploadCallback(),i instanceof Float32Array)o=e.FLOAT;else if(i instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=e.SHORT;else if(i instanceof Uint32Array)o=e.UNSIGNED_INT;else if(i instanceof Int32Array)o=e.INT;else if(i instanceof Int8Array)o=e.BYTE;else if(i instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=e.UNSIGNED_BYTE}return{buffer:s,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:a}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,i){const r=n.array,a=n.updateRanges;if(e.bindBuffer(i,t),0===a.length)e.bufferSubData(i,0,r);else{a.sort(((e,t)=>e.start-t.start));let t=0;for(let e=1;e<a.length;e++){const n=a[t],i=a[e];i.start<=n.start+n.count+1?n.count=Math.max(n.count,i.start+i.count-n.start):(++t,a[t]=i)}a.length=t+1;for(let n=0,s=a.length;n<s;n++){const t=a[n];e.bufferSubData(i,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}n.clearUpdateRanges()}n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}class qI extends cI{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,a=t/2,s=Math.floor(n),o=Math.floor(i),l=s+1,c=o+1,u=e/s,h=t/o,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){const e=g*h-a;for(let t=0;t<l;t++){const n=t*u-r;p.push(n,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<s;e++){const t=e+l*g,n=e+l*(g+1),i=e+1+l*(g+1),r=e+1+l*g;d.push(t,n,r),d.push(n,i,r)}this.setIndex(d),this.setAttribute("position",new tI(p,3)),this.setAttribute("normal",new tI(f,3)),this.setAttribute("uv",new tI(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qI(e.width,e.height,e.widthSegments,e.heightSegments)}}const YI={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},$I={common:{diffuse:{value:new GO(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new $P},alphaMap:{value:null},alphaMapTransform:{value:new $P},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new $P}},envmap:{envMap:{value:null},envMapRotation:{value:new $P},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new $P}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new $P}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new $P},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new $P},normalScale:{value:new YP(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new $P},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new $P}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new $P}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new $P}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new GO(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new GO(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new $P},alphaTest:{value:0},uvTransform:{value:new $P}},sprite:{diffuse:{value:new GO(16777215)},opacity:{value:1},center:{value:new YP(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new $P},alphaMap:{value:null},alphaMapTransform:{value:new $P},alphaTest:{value:0}}},KI={basic:{uniforms:SI([$I.common,$I.specularmap,$I.envmap,$I.aomap,$I.lightmap,$I.fog]),vertexShader:YI.meshbasic_vert,fragmentShader:YI.meshbasic_frag},lambert:{uniforms:SI([$I.common,$I.specularmap,$I.envmap,$I.aomap,$I.lightmap,$I.emissivemap,$I.bumpmap,$I.normalmap,$I.displacementmap,$I.fog,$I.lights,{emissive:{value:new GO(0)}}]),vertexShader:YI.meshlambert_vert,fragmentShader:YI.meshlambert_frag},phong:{uniforms:SI([$I.common,$I.specularmap,$I.envmap,$I.aomap,$I.lightmap,$I.emissivemap,$I.bumpmap,$I.normalmap,$I.displacementmap,$I.fog,$I.lights,{emissive:{value:new GO(0)},specular:{value:new GO(1118481)},shininess:{value:30}}]),vertexShader:YI.meshphong_vert,fragmentShader:YI.meshphong_frag},standard:{uniforms:SI([$I.common,$I.envmap,$I.aomap,$I.lightmap,$I.emissivemap,$I.bumpmap,$I.normalmap,$I.displacementmap,$I.roughnessmap,$I.metalnessmap,$I.fog,$I.lights,{emissive:{value:new GO(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:YI.meshphysical_vert,fragmentShader:YI.meshphysical_frag},toon:{uniforms:SI([$I.common,$I.aomap,$I.lightmap,$I.emissivemap,$I.bumpmap,$I.normalmap,$I.displacementmap,$I.gradientmap,$I.fog,$I.lights,{emissive:{value:new GO(0)}}]),vertexShader:YI.meshtoon_vert,fragmentShader:YI.meshtoon_frag},matcap:{uniforms:SI([$I.common,$I.bumpmap,$I.normalmap,$I.displacementmap,$I.fog,{matcap:{value:null}}]),vertexShader:YI.meshmatcap_vert,fragmentShader:YI.meshmatcap_frag},points:{uniforms:SI([$I.points,$I.fog]),vertexShader:YI.points_vert,fragmentShader:YI.points_frag},dashed:{uniforms:SI([$I.common,$I.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:YI.linedashed_vert,fragmentShader:YI.linedashed_frag},depth:{uniforms:SI([$I.common,$I.displacementmap]),vertexShader:YI.depth_vert,fragmentShader:YI.depth_frag},normal:{uniforms:SI([$I.common,$I.bumpmap,$I.normalmap,$I.displacementmap,{opacity:{value:1}}]),vertexShader:YI.meshnormal_vert,fragmentShader:YI.meshnormal_frag},sprite:{uniforms:SI([$I.sprite,$I.fog]),vertexShader:YI.sprite_vert,fragmentShader:YI.sprite_frag},background:{uniforms:{uvTransform:{value:new $P},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:YI.background_vert,fragmentShader:YI.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new $P}},vertexShader:YI.backgroundCube_vert,fragmentShader:YI.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:YI.cube_vert,fragmentShader:YI.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:YI.equirect_vert,fragmentShader:YI.equirect_frag},distanceRGBA:{uniforms:SI([$I.common,$I.displacementmap,{referencePosition:{value:new Ek},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:YI.distanceRGBA_vert,fragmentShader:YI.distanceRGBA_frag},shadow:{uniforms:SI([$I.lights,$I.fog,{color:{value:new GO(0)},opacity:{value:1}}]),vertexShader:YI.shadow_vert,fragmentShader:YI.shadow_frag}};KI.physical={uniforms:SI([KI.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new $P},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new $P},clearcoatNormalScale:{value:new YP(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new $P},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new $P},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new $P},sheen:{value:0},sheenColor:{value:new GO(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new $P},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new $P},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new $P},transmissionSamplerSize:{value:new YP},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new $P},attenuationDistance:{value:0},attenuationColor:{value:new GO(0)},specularColor:{value:new GO(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new $P},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new $P},anisotropyVector:{value:new YP},anisotropyMap:{value:null},anisotropyMapTransform:{value:new $P}}]),vertexShader:YI.meshphysical_vert,fragmentShader:YI.meshphysical_frag};const ZI={r:0,b:0,g:0},QI=new cO,JI=new Jk;function eL(e,t,n,i,r,a,s){const o=new GO(0);let l,c,u=!0===a?0:1,h=null,d=0,p=null;function f(e){let i=!0===e.isScene?e.background:null;if(i&&i.isTexture){i=(e.backgroundBlurriness>0?n:t).get(i)}return i}function m(t,n){t.getRGB(ZI,TI(e)),i.buffers.color.setClear(ZI.r,ZI.g,ZI.b,n,s)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),u=t,m(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(o,u)},render:function(t){let n=!1;const r=f(t);null===r?m(o,u):r&&r.isColor&&(m(r,1),n=!0);const a=e.xr.getEnvironmentBlendMode();"additive"===a?i.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===a&&i.buffers.color.setClear(0,0,0,0,s),(e.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===gR)?(void 0===c&&(c=new wI(new EI(1,1,1),new CI({name:"BackgroundCubeMaterial",uniforms:MI(KI.backgroundCube.uniforms),vertexShader:KI.backgroundCube.vertexShader,fragmentShader:KI.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),QI.copy(n.backgroundRotation),QI.x*=-1,QI.y*=-1,QI.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(QI.y*=-1,QI.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(JI.makeRotationFromEuler(QI)),c.material.toneMapped=nk.getTransfer(i.colorSpace)!==TP,h===i&&d===i.version&&p===e.toneMapping||(c.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),c.layers.enableAll(),t.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new wI(new qI(2,2),new CI({name:"BackgroundMaterial",uniforms:MI(KI.background.uniforms),vertexShader:KI.background.vertexShader,fragmentShader:KI.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=nk.getTransfer(i.colorSpace)!==TP,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),h===i&&d===i.version&&p===e.toneMapping||(l.material.needsUpdate=!0,h=i,d=i.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))}}}function tL(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),i={},r=c(null);let a=r,s=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function c(e){const t=[],i=[],r=[];for(let a=0;a<n;a++)t[a]=0,i[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:r,object:e,attributes:{},index:null}}function u(){const e=a.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function h(e){d(e,0)}function d(t,n){const i=a.newAttributes,r=a.enabledAttributes,s=a.attributeDivisors;i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1),s[t]!==n&&(e.vertexAttribDivisor(t,n),s[t]=n)}function p(){const t=a.newAttributes,n=a.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function f(t,n,i,r,a,s,o){!0===o?e.vertexAttribIPointer(t,n,i,a,s):e.vertexAttribPointer(t,n,i,r,a,s)}function m(){g(),s=!0,a!==r&&(a=r,o(a.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let _=!1;const v=function(t,n,r){const a=!0===r.wireframe;let s=i[t.id];void 0===s&&(s={},i[t.id]=s);let o=s[n.id];void 0===o&&(o={},s[n.id]=o);let l=o[a];void 0===l&&(l=c(e.createVertexArray()),o[a]=l);return l}(m,l,r);a!==v&&(a=v,o(a.object)),_=function(e,t,n,i){const r=a.attributes,s=t.attributes;let o=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){const t=r[a];let n=s[a];if(void 0===n&&("instanceMatrix"===a&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(n=e.instanceColor)),void 0===t)return!0;if(t.attribute!==n)return!0;if(n&&t.data!==n.data)return!0;o++}}return a.attributesNum!==o||a.index!==i}(n,m,l,g),_&&function(e,t,n,i){const r={},s=t.attributes;let o=0;const l=n.getAttributes();for(const a in l){if(l[a].location>=0){let t=s[a];void 0===t&&("instanceMatrix"===a&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===a&&e.instanceColor&&(t=e.instanceColor));const n={};n.attribute=t,t&&t.data&&(n.data=t.data),r[a]=n,o++}}a.attributes=r,a.attributesNum=o,a.index=i}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(_||s)&&(s=!1,function(n,i,r,a){u();const s=a.attributes,o=r.getAttributes(),l=i.defaultAttributeValues;for(const c in o){const i=o[c];if(i.location>=0){let r=s[c];if(void 0===r&&("instanceMatrix"===c&&n.instanceMatrix&&(r=n.instanceMatrix),"instanceColor"===c&&n.instanceColor&&(r=n.instanceColor)),void 0!==r){const s=r.normalized,o=r.itemSize,l=t.get(r);if(void 0===l)continue;const c=l.buffer,u=l.type,p=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||r.gpuType===PR;if(r.isInterleavedBufferAttribute){const t=r.data,l=t.stride,g=r.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)d(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)f(i.location+e,o/i.locationSize,u,s,l*p,(g+o/i.locationSize*e)*p,m)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)d(i.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)h(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<i.locationSize;e++)f(i.location+e,o/i.locationSize,u,s,o*p,o/i.locationSize*e*p,m)}}else if(void 0!==l){const t=l[c];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}p()}(n,r,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in i){const t=i[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete i[e]}},releaseStatesOfGeometry:function(e){if(void 0===i[e.id])return;const t=i[e.id];for(const n in t){const e=t[n];for(const t in e)l(e[t].object),delete e[t];delete t[n]}delete i[e.id]},releaseStatesOfProgram:function(e){for(const t in i){const n=i[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)l(r[e].object),delete r[e];delete n[e.id]}},initAttributes:u,enableAttribute:h,disableUnusedAttributes:p}}function nL(e,t,n){let i;function r(t,r,a){0!==a&&(e.drawArraysInstanced(i,t,r,a),n.update(r,i,a))}this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(e,r,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,e,0,r,0,a);let s=0;for(let t=0;t<a;t++)s+=r[t];n.update(s,i,1)},this.renderMultiDrawInstances=function(e,a,s,o){if(0===s)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)r(e[t],a[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(i,e,0,a,0,o,0,s);let t=0;for(let e=0;e<s;e++)t+=a[e]*o[e];n.update(t,i,1)}}}function iL(e,t,n,i){let r;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp";const o=a(s);o!==s&&(s=o);const l=!0===n.logarithmicDepthBuffer,c=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control"),u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:a,textureFormatReadable:function(t){return t===FR||i.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===IR&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==TR&&i.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==OR&&!r)},precision:s,logarithmicDepthBuffer:l,reverseDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function rL(e){const t=this;let n=null,i=0,r=!1,a=!1;const s=new VI,o=new $P,l={value:null,needsUpdate:!1};function c(e,n,i,r){const a=null!==e?e.length:0;let c=null;if(0!==a){if(c=l.value,!0!==r||null===c){const t=i+4*a,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let n=0,l=i;n!==a;++n,l+=4)s.copy(e[n]).applyMatrix4(r,o),s.normal.toArray(c,l),c[l+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=c(e,t,0)},this.setState=function(s,o,u){const h=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!r||null===h||0===h.length||a&&!p)a?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=a?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(h,o,t,u);for(let i=0;i!==t;++i)r[i]=n[i];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function aL(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=fR:304===t&&(e.mapping=mR),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping;if(303===a||304===a){if(t.has(r)){return n(t.get(r).texture,r.mapping)}{const a=r.image;if(a&&a.height>0){const s=new UI(a.height);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}class sL extends RI{constructor(e=-1,t=1,n=1,i=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,a=n+e,s=i+t,o=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,a=r+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const oL=[.125,.215,.35,.446,.526,.582],lL=20,cL=new sL,uL=new GO;let hL=null,dL=0,pL=0,fL=!1;const mL=(1+Math.sqrt(5))/2,gL=1/mL,_L=[new Ek(-mL,gL,0),new Ek(mL,gL,0),new Ek(-gL,0,mL),new Ek(gL,0,mL),new Ek(0,mL,-gL),new Ek(0,mL,gL),new Ek(-1,1,-1),new Ek(1,1,-1),new Ek(-1,1,1),new Ek(1,1,1)];class vL{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){hL=this._renderer.getRenderTarget(),dL=this._renderer.getActiveCubeFace(),pL=this._renderer.getActiveMipmapLevel(),fL=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=bL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=wL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(hL,dL,pL),this._renderer.xr.enabled=fL,e.scissorTest=!1,xL(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===fR||e.mapping===mR?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),hL=this._renderer.getRenderTarget(),dL=this._renderer.getActiveCubeFace(),pL=this._renderer.getActiveMipmapLevel(),fL=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ER,minFilter:ER,generateMipmaps:!1,type:IR,format:FR,colorSpace:MP,depthBuffer:!1},i=yL(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=yL(e,t,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],i=[];let r=e;const a=e-4+1+oL.length;for(let s=0;s<a;s++){const a=Math.pow(2,r);n.push(a);let o=1/a;s>e-4?o=oL[s-e+4-1]:0===s&&(o=0),i.push(o);const l=1/(a-2),c=-l,u=1+l,h=[c,c,u,c,u,u,c,c,u,u,c,u],d=6,p=6,f=3,m=2,g=1,_=new Float32Array(f*p*d),v=new Float32Array(m*p*d),y=new Float32Array(g*p*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];_.set(i,f*p*e),v.set(h,m*p*e);const r=[e,e,e,e,e,e];y.set(r,g*p*e)}const x=new cI;x.setAttribute("position",new QO(_,f)),x.setAttribute("uv",new QO(v,m)),x.setAttribute("faceIndex",new QO(y,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(e,t,n){const i=new Float32Array(lL),r=new Ek(0,1,0),a=new CI({name:"SphericalGaussianBlur",defines:{n:lL,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:EL(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return a}(i,e,t)}return i}_compileMaterial(e){const t=new wI(this._lodPlanes[0],e);this._renderer.compile(t,cL)}_sceneToCubeUV(e,t,n,i){const r=new II(90,1,t,n),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(uL),o.toneMapping=0,o.autoClear=!1;const u=new $O({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new wI(new EI,u);let d=!1;const p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(uL),d=!0);for(let f=0;f<6;f++){const t=f%3;0===t?(r.up.set(0,a[f],0),r.lookAt(s[f],0,0)):1===t?(r.up.set(0,0,a[f]),r.lookAt(0,s[f],0)):(r.up.set(0,a[f],0),r.lookAt(0,0,s[f]));const n=this._cubeSize;xL(i,t*n,f>2?n:0,n,n),o.setRenderTarget(i),d&&o.render(h,r),o.render(e,r)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===fR||e.mapping===mR;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=bL()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=wL());const r=i?this._cubemapMaterial:this._equirectMaterial,a=new wI(this._lodPlanes[0],r);r.uniforms.envMap.value=e;const s=this._cubeSize;xL(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(a,cL)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let r=1;r<i;r++){const t=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),n=_L[(i-r-1)%_L.length];this._blur(e,r-1,r,t,n)}t.autoClear=n}_blur(e,t,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,a,s){const o=this._renderer,l=this._blurMaterial,c=new wI(this._lodPlanes[i],l),u=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):lL,m=[];let g=0;for(let y=0;y<lL;++y){const e=y/p,t=Math.exp(-e*e/2);m.push(t),0===y?g+=t:y<f&&(g+=2*t)}for(let y=0;y<m.length;y++)m[y]=m[y]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,s&&(u.poleAxis.value=s);const{_lodMax:_}=this;u.dTheta.value=d,u.mipInt.value=_-n;const v=this._sizeLods[i];xL(t,3*v*(i>_-4?i-_+4:0),4*(this._cubeSize-v),3*v,2*v),o.setRenderTarget(t),o.render(c,cL)}}function yL(e,t,n){const i=new yk(e,t,n);return i.texture.mapping=gR,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function xL(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function wL(){return new CI({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:EL(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function bL(){return new CI({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:EL(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function EL(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function ML(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping,s=303===a||304===a,o=a===fR||a===mR;if(s||o){let a=t.get(r);const l=void 0!==a?a.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new vL(e)),a=s?n.fromEquirectangular(r,a):n.fromCubemap(r,a),a.texture.pmremVersion=r.pmremVersion,t.set(r,a),a.texture;if(void 0!==a)return a.texture;{const l=r.image;return s&&l&&l.height>0||o&&l&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(l)?(null===n&&(n=new vL(e)),a=s?n.fromEquirectangular(r):n.fromCubemap(r),a.texture.pmremVersion=r.pmremVersion,t.set(r,a),r.addEventListener("dispose",i),a.texture):null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function SL(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&tk("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function TL(e,t,n,i){const r={},a=new WeakMap;function s(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const n in o.attributes)t.remove(o.attributes[n]);for(const n in o.morphAttributes){const e=o.morphAttributes[n];for(let n=0,i=e.length;n<i;n++)t.remove(e[n])}o.removeEventListener("dispose",s),delete r[o.id];const l=a.get(o);l&&(t.remove(l),a.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],i=e.index,r=e.attributes.position;let s=0;if(null!==i){const e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],a=e[t+2];n.push(i,r,r,a,a,i)}}else{if(void 0===r)return;{const e=r.array;s=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}}const o=new(ZP(n)?eI:JO)(n,1);o.version=s;const l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const a in i)t.update(i[a],e.ARRAY_BUFFER);const r=n.morphAttributes;for(const a in r){const n=r[a];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return a.get(e)}}}function AL(e,t,n){let i,r,a;function s(t,s,o){0!==o&&(e.drawElementsInstanced(i,s,r,t*a,o),n.update(s,i,o))}this.setMode=function(e){i=e},this.setIndex=function(e){r=e.type,a=e.bytesPerElement},this.render=function(t,s){e.drawElements(i,s,r,t*a),n.update(s,i,1)},this.renderInstances=s,this.renderMultiDraw=function(e,a,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,a,0,r,e,0,s);let o=0;for(let t=0;t<s;t++)o+=a[t];n.update(o,i,1)},this.renderMultiDrawInstances=function(e,o,l,c){if(0===l)return;const u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)s(e[t]/a,o[t],c[t]);else{u.multiDrawElementsInstancedWEBGL(i,o,0,r,e,0,c,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*c[e];n.update(t,i,1)}}}function CL(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,r){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=r*(n/3);break;case e.LINES:t.lines+=r*(n/2);break;case e.LINE_STRIP:t.lines+=r*(n-1);break;case e.LINE_LOOP:t.lines+=r*n;break;case e.POINTS:t.points+=r*n}}}}function RL(e,t,n){const i=new WeakMap,r=new _k;return{update:function(a,s,o){const l=a.morphTargetInfluences,c=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,u=void 0!==c?c.length:0;let h=i.get(s);if(void 0===h||h.count!==u){let e=function(){_.dispose(),i.delete(s),s.removeEventListener("dispose",e)};void 0!==h&&h.texture.dispose();const n=void 0!==s.morphAttributes.position,a=void 0!==s.morphAttributes.normal,o=void 0!==s.morphAttributes.color,l=s.morphAttributes.position||[],c=s.morphAttributes.normal||[],d=s.morphAttributes.color||[];let p=0;!0===n&&(p=1),!0===a&&(p=2),!0===o&&(p=3);let f=s.attributes.position.count*p,m=1;f>t.maxTextureSize&&(m=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);const g=new Float32Array(f*m*4*u),_=new xk(g,f,m,u);_.type=OR,_.needsUpdate=!0;const v=4*p;for(let t=0;t<u;t++){const e=l[t],i=c[t],s=d[t],u=f*m*4*t;for(let t=0;t<e.count;t++){const l=t*v;!0===n&&(r.fromBufferAttribute(e,t),g[u+l+0]=r.x,g[u+l+1]=r.y,g[u+l+2]=r.z,g[u+l+3]=0),!0===a&&(r.fromBufferAttribute(i,t),g[u+l+4]=r.x,g[u+l+5]=r.y,g[u+l+6]=r.z,g[u+l+7]=0),!0===o&&(r.fromBufferAttribute(s,t),g[u+l+8]=r.x,g[u+l+9]=r.y,g[u+l+10]=r.z,g[u+l+11]=4===s.itemSize?r.w:1)}}h={count:u,texture:_,size:new YP(f,m)},i.set(s,h),s.addEventListener("dispose",e)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)o.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let t=0;for(let e=0;e<l.length;e++)t+=l[e];const n=s.morphTargetsRelative?1:1-t;o.getUniforms().setValue(e,"morphTargetBaseInfluence",n),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}}}function PL(e,t,n,i){let r=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){const o=i.render.frame,l=s.geometry,c=t.get(s,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),r.get(s)!==o&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),r.set(s,o))),s.isSkinnedMesh){const e=s.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}class kL extends gk{constructor(e,t,n,i,r,a,s,o,l,c=1026){if(c!==zR&&c!==BR)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===zR&&(n=kR),void 0===n&&c===BR&&(n=NR),super(null,i,r,a,s,o,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:xR,this.minFilter=void 0!==o?o:xR,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}const OL=new gk,IL=new kL(1,1),LL=new xk,DL=new wk,NL=new NI,UL=[],FL=[],zL=new Float32Array(16),BL=new Float32Array(9),VL=new Float32Array(4);function HL(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let a=UL[r];if(void 0===a&&(a=new Float32Array(r),UL[r]=a),0!==t){i.toArray(a,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(a,r)}return a}function WL(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function jL(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function GL(e,t){let n=FL[t];void 0===n&&(n=new Int32Array(t),FL[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function XL(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function qL(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(WL(n,t))return;e.uniform2fv(this.addr,t),jL(n,t)}}function YL(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(WL(n,t))return;e.uniform3fv(this.addr,t),jL(n,t)}}function $L(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(WL(n,t))return;e.uniform4fv(this.addr,t),jL(n,t)}}function KL(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(WL(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),jL(n,t)}else{if(WL(n,i))return;VL.set(i),e.uniformMatrix2fv(this.addr,!1,VL),jL(n,i)}}function ZL(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(WL(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),jL(n,t)}else{if(WL(n,i))return;BL.set(i),e.uniformMatrix3fv(this.addr,!1,BL),jL(n,i)}}function QL(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(WL(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),jL(n,t)}else{if(WL(n,i))return;zL.set(i),e.uniformMatrix4fv(this.addr,!1,zL),jL(n,i)}}function JL(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function eD(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(WL(n,t))return;e.uniform2iv(this.addr,t),jL(n,t)}}function tD(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(WL(n,t))return;e.uniform3iv(this.addr,t),jL(n,t)}}function nD(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(WL(n,t))return;e.uniform4iv(this.addr,t),jL(n,t)}}function iD(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function rD(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(WL(n,t))return;e.uniform2uiv(this.addr,t),jL(n,t)}}function aD(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(WL(n,t))return;e.uniform3uiv(this.addr,t),jL(n,t)}}function sD(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(WL(n,t))return;e.uniform4uiv(this.addr,t),jL(n,t)}}function oD(e,t,n){const i=this.cache,r=n.allocateTextureUnit();let a;i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),this.type===e.SAMPLER_2D_SHADOW?(IL.compareFunction=515,a=IL):a=OL,n.setTexture2D(t||a,r)}function lD(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||DL,r)}function cD(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||NL,r)}function uD(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||LL,r)}function hD(e,t){e.uniform1fv(this.addr,t)}function dD(e,t){const n=HL(t,this.size,2);e.uniform2fv(this.addr,n)}function pD(e,t){const n=HL(t,this.size,3);e.uniform3fv(this.addr,n)}function fD(e,t){const n=HL(t,this.size,4);e.uniform4fv(this.addr,n)}function mD(e,t){const n=HL(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function gD(e,t){const n=HL(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function _D(e,t){const n=HL(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function vD(e,t){e.uniform1iv(this.addr,t)}function yD(e,t){e.uniform2iv(this.addr,t)}function xD(e,t){e.uniform3iv(this.addr,t)}function wD(e,t){e.uniform4iv(this.addr,t)}function bD(e,t){e.uniform1uiv(this.addr,t)}function ED(e,t){e.uniform2uiv(this.addr,t)}function MD(e,t){e.uniform3uiv(this.addr,t)}function SD(e,t){e.uniform4uiv(this.addr,t)}function TD(e,t,n){const i=this.cache,r=t.length,a=GL(n,r);WL(i,a)||(e.uniform1iv(this.addr,a),jL(i,a));for(let s=0;s!==r;++s)n.setTexture2D(t[s]||OL,a[s])}function AD(e,t,n){const i=this.cache,r=t.length,a=GL(n,r);WL(i,a)||(e.uniform1iv(this.addr,a),jL(i,a));for(let s=0;s!==r;++s)n.setTexture3D(t[s]||DL,a[s])}function CD(e,t,n){const i=this.cache,r=t.length,a=GL(n,r);WL(i,a)||(e.uniform1iv(this.addr,a),jL(i,a));for(let s=0;s!==r;++s)n.setTextureCube(t[s]||NL,a[s])}function RD(e,t,n){const i=this.cache,r=t.length,a=GL(n,r);WL(i,a)||(e.uniform1iv(this.addr,a),jL(i,a));for(let s=0;s!==r;++s)n.setTexture2DArray(t[s]||LL,a[s])}class PD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return XL;case 35664:return qL;case 35665:return YL;case 35666:return $L;case 35674:return KL;case 35675:return ZL;case 35676:return QL;case 5124:case 35670:return JL;case 35667:case 35671:return eD;case 35668:case 35672:return tD;case 35669:case 35673:return nD;case 5125:return iD;case 36294:return rD;case 36295:return aD;case 36296:return sD;case 35678:case 36198:case 36298:case 36306:case 35682:return oD;case 35679:case 36299:case 36307:return lD;case 35680:case 36300:case 36308:case 36293:return cD;case 36289:case 36303:case 36311:case 36292:return uD}}(t.type)}}class kD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return hD;case 35664:return dD;case 35665:return pD;case 35666:return fD;case 35674:return mD;case 35675:return gD;case 35676:return _D;case 5124:case 35670:return vD;case 35667:case 35671:return yD;case 35668:case 35672:return xD;case 35669:case 35673:return wD;case 5125:return bD;case 36294:return ED;case 36295:return MD;case 36296:return SD;case 35678:case 36198:case 36298:case 36306:case 35682:return TD;case 35679:case 36299:case 36307:return AD;case 35680:case 36300:case 36308:case 36293:return CD;case 36289:case 36303:case 36311:case 36292:return RD}}(t.type)}}class OD{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let r=0,a=i.length;r!==a;++r){const a=i[r];a.setValue(e,t[a.id],n)}}}const ID=/(\w+)(\])?(\[|\.)?/g;function LD(e,t){e.seq.push(t),e.map[t.id]=t}function DD(e,t,n){const i=e.name,r=i.length;for(ID.lastIndex=0;;){const a=ID.exec(i),s=ID.lastIndex;let o=a[1];const l="]"===a[2],c=a[3];if(l&&(o|=0),void 0===c||"["===c&&s+2===r){LD(n,void 0===c?new PD(o,e,t):new kD(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new OD(o),LD(n,e)),n=e}}}class ND{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);DD(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let r=0,a=t.length;r!==a;++r){const a=t[r],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function UD(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}let FD=0;const zD=new $P;function BD(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const i=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){const n=e.split("\n"),i=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let s=r;s<a;s++){const e=s+1;i.push(`${e===t?">":" "} ${e}: ${n[s]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return r}function VD(e,t){const n=function(e){nk._getMatrix(zD,nk.workingColorSpace,e);const t=`mat3( ${zD.elements.map((e=>e.toFixed(4)))} )`;switch(nk.getTransfer(e)){case SP:return[t,"LinearTransferOETF"];case TP:return[t,"sRGBTransferOETF"];default:return[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function HD(e,t){let n;switch(t){case 1:default:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const WD=new Ek;function jD(){nk.getLuminanceCoefficients(WD);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${WD.x.toFixed(4)}, ${WD.y.toFixed(4)}, ${WD.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function GD(e){return""!==e}function XD(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function qD(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const YD=/^[ \t]*#include +<([\w\d./]+)>/gm;function $D(e){return e.replace(YD,ZD)}const KD=new Map;function ZD(e,t){let n=YI[t];if(void 0===n){const e=KD.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=YI[e]}return $D(n)}const QD=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function JD(e){return e.replace(QD,eN)}function eN(e,t,n,i){let r="";for(let a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function tN(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function nN(e,t,n,i){const r=e.getContext(),a=n.defines;let s=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case fR:case mR:t="ENVMAP_TYPE_CUBE";break;case gR:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===mR&&(t="ENVMAP_MODE_REFRACTION");return t}(n),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(GD).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(a),m=r.createProgram();let g,_,v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(GD).join("\n"),g.length>0&&(g+="\n"),_=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(GD).join("\n"),_.length>0&&(_+="\n")):(g=[tN(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(GD).join("\n"),_=[tN(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?YI.tonemapping_pars_fragment:"",0!==n.toneMapping?HD("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",YI.colorspace_pars_fragment,VD("linearToOutputTexel",n.outputColorSpace),jD(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(GD).join("\n")),s=$D(s),s=XD(s,n),s=qD(s,n),o=$D(o),o=XD(o,n),o=qD(o,n),s=JD(s),o=JD(o),!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,_=["#define varying in",n.glslVersion===NP?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===NP?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+_);const y=v+g+s,x=v+_+o,w=UD(r,r.VERTEX_SHADER,y),b=UD(r,r.FRAGMENT_SHADER,x);function E(t){if(e.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(w).trim(),a=r.getShaderInfoLog(b).trim();let s=!0,o=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(s=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(r,m,w,b);else{BD(r,w,"vertex"),BD(r,b,"fragment")}else""!==n||""!==i&&""!==a||(o=!1);o&&(t.diagnostics={runnable:s,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:a,prefix:_}})}r.deleteShader(w),r.deleteShader(b),M=new ND(r,m),S=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),a=i.name;let s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),n[a]={type:i.type,location:e.getAttribLocation(t,a),locationSize:s}}return n}(r,m)}let M,S;r.attachShader(m,w),r.attachShader(m,b),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===M&&E(this),M},this.getAttributes=function(){return void 0===S&&E(this),S};let T=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===T&&(T=r.getProgramParameter(m,37297)),T},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=FD++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=b,this}let iN=0;class rN{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new aN(e),t.set(e,n)),n}}class aN{constructor(e){this.id=iN++,this.code=e,this.usedTimes=0}}function sN(e,t,n,i,r,a,s){const o=new uO,l=new rN,c=new Set,u=[],h=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return c.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(a,o,u,g,_){const v=g.fog,y=_.geometry,x=a.isMeshStandardMaterial?g.environment:null,w=(a.isMeshStandardMaterial?n:t).get(a.envMap||x),b=w&&w.mapping===gR?w.image.height:null,E=f[a.type];null!==a.precision&&(p=r.getMaxPrecision(a.precision),a.precision);const M=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,S=void 0!==M?M.length:0;let T,A,C,R,P=0;if(void 0!==y.morphAttributes.position&&(P=1),void 0!==y.morphAttributes.normal&&(P=2),void 0!==y.morphAttributes.color&&(P=3),E){const e=KI[E];T=e.vertexShader,A=e.fragmentShader}else T=a.vertexShader,A=a.fragmentShader,l.update(a),C=l.getVertexShaderID(a),R=l.getFragmentShaderID(a);const k=e.getRenderTarget(),O=e.state.buffers.depth.getReversed(),I=!0===_.isInstancedMesh,L=!0===_.isBatchedMesh,D=!!a.map,N=!!a.matcap,U=!!w,F=!!a.aoMap,z=!!a.lightMap,B=!!a.bumpMap,V=!!a.normalMap,H=!!a.displacementMap,W=!!a.emissiveMap,j=!!a.metalnessMap,G=!!a.roughnessMap,X=a.anisotropy>0,q=a.clearcoat>0,Y=a.dispersion>0,$=a.iridescence>0,K=a.sheen>0,Z=a.transmission>0,Q=X&&!!a.anisotropyMap,J=q&&!!a.clearcoatMap,ee=q&&!!a.clearcoatNormalMap,te=q&&!!a.clearcoatRoughnessMap,ne=$&&!!a.iridescenceMap,ie=$&&!!a.iridescenceThicknessMap,re=K&&!!a.sheenColorMap,ae=K&&!!a.sheenRoughnessMap,se=!!a.specularMap,oe=!!a.specularColorMap,le=!!a.specularIntensityMap,ce=Z&&!!a.transmissionMap,ue=Z&&!!a.thicknessMap,he=!!a.gradientMap,de=!!a.alphaMap,pe=a.alphaTest>0,fe=!!a.alphaHash,me=!!a.extensions;let ge=0;a.toneMapped&&(null!==k&&!0!==k.isXRRenderTarget||(ge=e.toneMapping));const _e={shaderID:E,shaderType:a.type,shaderName:a.name,vertexShader:T,fragmentShader:A,defines:a.defines,customVertexShaderID:C,customFragmentShaderID:R,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:L,batchingColor:L&&null!==_._colorsTexture,instancing:I,instancingColor:I&&null!==_.instanceColor,instancingMorph:I&&null!==_.morphTexture,supportsVertexTextures:d,outputColorSpace:null===k?e.outputColorSpace:!0===k.isXRRenderTarget?k.texture.colorSpace:MP,alphaToCoverage:!!a.alphaToCoverage,map:D,matcap:N,envMap:U,envMapMode:U&&w.mapping,envMapCubeUVHeight:b,aoMap:F,lightMap:z,bumpMap:B,normalMap:V,displacementMap:d&&H,emissiveMap:W,normalMapObjectSpace:V&&1===a.normalMapType,normalMapTangentSpace:V&&0===a.normalMapType,metalnessMap:j,roughnessMap:G,anisotropy:X,anisotropyMap:Q,clearcoat:q,clearcoatMap:J,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,dispersion:Y,iridescence:$,iridescenceMap:ne,iridescenceThicknessMap:ie,sheen:K,sheenColorMap:re,sheenRoughnessMap:ae,specularMap:se,specularColorMap:oe,specularIntensityMap:le,transmission:Z,transmissionMap:ce,thicknessMap:ue,gradientMap:he,opaque:!1===a.transparent&&1===a.blending&&!1===a.alphaToCoverage,alphaMap:de,alphaTest:pe,alphaHash:fe,combine:a.combine,mapUv:D&&m(a.map.channel),aoMapUv:F&&m(a.aoMap.channel),lightMapUv:z&&m(a.lightMap.channel),bumpMapUv:B&&m(a.bumpMap.channel),normalMapUv:V&&m(a.normalMap.channel),displacementMapUv:H&&m(a.displacementMap.channel),emissiveMapUv:W&&m(a.emissiveMap.channel),metalnessMapUv:j&&m(a.metalnessMap.channel),roughnessMapUv:G&&m(a.roughnessMap.channel),anisotropyMapUv:Q&&m(a.anisotropyMap.channel),clearcoatMapUv:J&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:ee&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ne&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:re&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ae&&m(a.sheenRoughnessMap.channel),specularMapUv:se&&m(a.specularMap.channel),specularColorMapUv:oe&&m(a.specularColorMap.channel),specularIntensityMapUv:le&&m(a.specularIntensityMap.channel),transmissionMapUv:ce&&m(a.transmissionMap.channel),thicknessMapUv:ue&&m(a.thicknessMap.channel),alphaMapUv:de&&m(a.alphaMap.channel),vertexTangents:!!y.attributes.tangent&&(V||X),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,pointsUvs:!0===_.isPoints&&!!y.attributes.uv&&(D||de),fog:!!v,useFog:!0===a.fog,fogExp2:!!v&&v.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:h,reverseDepthBuffer:O,skinning:!0===_.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:S,morphTextureStride:P,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:ge,decodeVideoTexture:D&&!0===a.map.isVideoTexture&&nk.getTransfer(a.map.colorSpace)===TP,decodeVideoTextureEmissive:W&&!0===a.emissiveMap.isVideoTexture&&nk.getTransfer(a.emissiveMap.colorSpace)===TP,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:me&&!0===a.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(me&&!0===a.extensions.multiDraw||L)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return _e.vertexUv1s=c.has(1),_e.vertexUv2s=c.has(2),_e.vertexUv3s=c.has(3),c.clear(),_e},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0);t.instancing&&o.enable(1);t.instancingColor&&o.enable(2);t.instancingMorph&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);t.alphaHash&&o.enable(18);t.batching&&o.enable(19);t.dispersion&&o.enable(20);t.batchingColor&&o.enable(21);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.reverseDepthBuffer&&o.enable(4);t.skinning&&o.enable(5);t.morphTargets&&o.enable(6);t.morphNormals&&o.enable(7);t.morphColors&&o.enable(8);t.premultipliedAlpha&&o.enable(9);t.shadowMapEnabled&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);t.decodeVideoTextureEmissive&&o.enable(20);t.alphaToCoverage&&o.enable(21);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=KI[t];n=AI.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,r=u.length;e<r;e++){const t=u[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new nN(e,n,t,a),u.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function oN(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function lN(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function cN(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function uN(){const e=[];let t=0;const n=[],i=[],r=[];function a(n,i,r,a,s,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:s,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,s,o,l,c){const u=a(e,t,s,o,l,c);s.transmission>0?i.push(u):!0===s.transparent?r.push(u):n.push(u)},unshift:function(e,t,s,o,l,c){const u=a(e,t,s,o,l,c);s.transmission>0?i.unshift(u):!0===s.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||lN),i.length>1&&i.sort(t||cN),r.length>1&&r.sort(t||cN)}}}function hN(){let e=new WeakMap;return{get:function(t,n){const i=e.get(t);let r;return void 0===i?(r=new uN,e.set(t,[r])):n>=i.length?(r=new uN,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function dN(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Ek,color:new GO};break;case"SpotLight":n={position:new Ek,direction:new Ek,color:new GO,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Ek,color:new GO,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Ek,skyColor:new GO,groundColor:new GO};break;case"RectAreaLight":n={color:new GO,position:new Ek,halfWidth:new Ek,halfHeight:new Ek}}return e[t.id]=n,n}}}let pN=0;function fN(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function mN(e){const t=new dN,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new YP};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new YP,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)i.probe.push(new Ek);const r=new Ek,a=new Jk,s=new Jk;return{setup:function(r){let a=0,s=0,o=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,c=0,u=0,h=0,d=0,p=0,f=0,m=0,g=0,_=0,v=0;r.sort(fN);for(let e=0,x=r.length;e<x;e++){const y=r[e],x=y.color,w=y.intensity,b=y.distance,E=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)a+=x.r*w,s+=x.g*w,o+=x.b*w;else if(y.isLightProbe){for(let e=0;e<9;e++)i.probe[e].addScaledVector(y.sh.coefficients[e],w);v++}else if(y.isDirectionalLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,i.directionalShadow[l]=t,i.directionalShadowMap[l]=E,i.directionalShadowMatrix[l]=y.shadow.matrix,p++}i.directional[l]=e,l++}else if(y.isSpotLight){const e=t.get(y);e.position.setFromMatrixPosition(y.matrixWorld),e.color.copy(x).multiplyScalar(w),e.distance=b,e.coneCos=Math.cos(y.angle),e.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),e.decay=y.decay,i.spot[u]=e;const r=y.shadow;if(y.map&&(i.spotLightMap[g]=y.map,g++,r.updateMatrices(y),y.castShadow&&_++),i.spotLightMatrix[u]=r.matrix,y.castShadow){const e=n.get(y);e.shadowIntensity=r.intensity,e.shadowBias=r.bias,e.shadowNormalBias=r.normalBias,e.shadowRadius=r.radius,e.shadowMapSize=r.mapSize,i.spotShadow[u]=e,i.spotShadowMap[u]=E,m++}u++}else if(y.isRectAreaLight){const e=t.get(y);e.color.copy(x).multiplyScalar(w),e.halfWidth.set(.5*y.width,0,0),e.halfHeight.set(0,.5*y.height,0),i.rectArea[h]=e,h++}else if(y.isPointLight){const e=t.get(y);if(e.color.copy(y.color).multiplyScalar(y.intensity),e.distance=y.distance,e.decay=y.decay,y.castShadow){const e=y.shadow,t=n.get(y);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,i.pointShadow[c]=t,i.pointShadowMap[c]=E,i.pointShadowMatrix[c]=y.shadow.matrix,f++}i.point[c]=e,c++}else if(y.isHemisphereLight){const e=t.get(y);e.skyColor.copy(y.color).multiplyScalar(w),e.groundColor.copy(y.groundColor).multiplyScalar(w),i.hemi[d]=e,d++}}h>0&&(!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=$I.LTC_FLOAT_1,i.rectAreaLTC2=$I.LTC_FLOAT_2):(i.rectAreaLTC1=$I.LTC_HALF_1,i.rectAreaLTC2=$I.LTC_HALF_2)),i.ambient[0]=a,i.ambient[1]=s,i.ambient[2]=o;const y=i.hash;y.directionalLength===l&&y.pointLength===c&&y.spotLength===u&&y.rectAreaLength===h&&y.hemiLength===d&&y.numDirectionalShadows===p&&y.numPointShadows===f&&y.numSpotShadows===m&&y.numSpotMaps===g&&y.numLightProbes===v||(i.directional.length=l,i.spot.length=u,i.rectArea.length=h,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-_,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=_,i.numLightProbes=v,y.directionalLength=l,y.pointLength=c,y.spotLength=u,y.rectAreaLength=h,y.hemiLength=d,y.numDirectionalShadows=p,y.numPointShadows=f,y.numSpotShadows=m,y.numSpotMaps=g,y.numLightProbes=v,i.version=pN++)},setupView:function(e,t){let n=0,o=0,l=0,c=0,u=0;const h=t.matrixWorldInverse;for(let d=0,p=e.length;d<p;d++){const t=e[d];if(t.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),n++}else if(t.isSpotLight){const e=i.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),l++}else if(t.isRectAreaLight){const e=i.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),s.identity(),a.copy(t.matrixWorld),a.premultiply(h),s.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),c++}else if(t.isPointLight){const e=i.point[o];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(h),o++}else if(t.isHemisphereLight){const e=i.hemi[u];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(h),u++}}},state:i}}function gN(e){const t=new mN(e),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){r.camera=e,n.length=0,i.length=0},state:r,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){i.push(e)}}}function _N(e){let t=new WeakMap;return{get:function(n,i=0){const r=t.get(n);let a;return void 0===r?(a=new gN(e),t.set(n,[a])):i>=r.length?(a=new gN(e),r.push(a)):a=r[i],a},dispose:function(){t=new WeakMap}}}class vN extends YO{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class yN extends YO{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function xN(e,t,n){let i=new jI;const r=new YP,a=new YP,s=new _k,o=new vN({depthPacking:3201}),l=new yN,c={},u=n.maxTextureSize,h={[zC]:1,[BC]:0,[VC]:2},d=new CI({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new YP},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new cI;f.setAttribute("position",new QO(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new wI(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let _=this.type;function v(n,i){const a=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new yk(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,a,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,a,p,m,null)}function y(t,n,i,r){let a=null;const s=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=a.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let r=i[t];void 0===r&&(r=a.clone(),i[t]=r,n.addEventListener("dispose",w)),a=r}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=3===r?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=i}return a}function x(n,r,a,s,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const i=t.update(n),l=n.material;if(Array.isArray(l)){const t=i.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],h=l[u.materialIndex];if(h&&h.visible){const t=y(n,h,s,o);n.onBeforeShadow(e,n,r,a,i,t,u),e.renderBufferDirect(a,null,i,t,n,u),n.onAfterShadow(e,n,r,a,i,t,u)}}}else if(l.visible){const t=y(n,l,s,o);n.onBeforeShadow(e,n,r,a,i,t,null),e.renderBufferDirect(a,null,i,t,n,null),n.onAfterShadow(e,n,r,a,i,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)x(l[e],r,a,s,o)}function w(e){e.target.removeEventListener("dispose",w);for(const t in c){const n=c[t],i=e.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(t,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=3!==_&&3===this.type,f=3===_&&3!==this.type;for(let m=0,g=t.length;m<g;m++){const l=t[m],c=l.shadow;if(void 0===c)continue;if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);const h=c.getFrameExtents();if(r.multiply(h),a.copy(c.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/h.x),r.x=a.x*h.x,c.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/h.y),r.y=a.y*h.y,c.mapSize.y=a.y)),null===c.map||!0===p||!0===f){const e=3!==this.type?{minFilter:xR,magFilter:xR}:{};null!==c.map&&c.map.dispose(),c.map=new yk(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();const g=c.getViewportCount();for(let e=0;e<g;e++){const t=c.getViewport(e);s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(s),c.updateMatrices(l,e),i=c.getFrustum(),x(n,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&3===this.type&&v(c,o),c.needsUpdate=!1}_=this.type,g.needsUpdate=!1,e.setRenderTarget(l,c,h)}}const wN={[sR]:1,[lR]:6,[uR]:7,[cR]:5,[oR]:0,[dR]:2,[pR]:4,[hR]:3};function bN(e,t){const n=new function(){let t=!1;const n=new _k;let i=null;const r=new _k(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,s,o){!0===o&&(t*=s,i*=s,a*=s),n.set(t,i,a,s),!1===r.equals(n)&&(e.clearColor(t,i,a,s),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},i=new function(){let n=!1,i=!1,r=null,a=null,s=null;return{setReversed:function(e){if(i!==e){const e=t.get("EXT_clip_control");i?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT);const n=s;s=null,this.setClear(n)}i=e},getReversed:function(){return i},setTest:function(t){t?B(e.DEPTH_TEST):V(e.DEPTH_TEST)},setMask:function(t){r===t||n||(e.depthMask(t),r=t)},setFunc:function(t){if(i&&(t=wN[t]),a!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}a=t}},setLocked:function(e){n=e},setClear:function(t){s!==t&&(i&&(t=1-t),e.clearDepth(t),s=t)},reset:function(){n=!1,r=null,a=null,s=null,i=!1}}},r=new function(){let t=!1,n=null,i=null,r=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(n){t||(n?B(e.STENCIL_TEST):V(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,s){i===t&&r===n&&a===s||(e.stencilFunc(t,n,s),i=t,r=n,a=s)},setOp:function(t,n,i){s===t&&o===n&&l===i||(e.stencilOp(t,n,i),s=t,o=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,s=null,o=null,l=null,c=null}}},a=new WeakMap,s=new WeakMap;let o={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,_=null,v=null,y=null,x=new GO(0,0,0),w=0,b=!1,E=null,M=null,S=null,T=null,A=null;const C=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let R=!1,P=0;const k=e.getParameter(e.VERSION);-1!==k.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(k)[1]),R=P>=1):-1!==k.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),R=P>=2);let O=null,I={};const L=e.getParameter(e.SCISSOR_BOX),D=e.getParameter(e.VIEWPORT),N=(new _k).fromArray(L),U=(new _k).fromArray(D);function F(t,n,i,r){const a=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<i;o++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,r,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return s}const z={};function B(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function V(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}z[e.TEXTURE_2D]=F(e.TEXTURE_2D,e.TEXTURE_2D,1),z[e.TEXTURE_CUBE_MAP]=F(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),z[e.TEXTURE_2D_ARRAY]=F(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),z[e.TEXTURE_3D]=F(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),i.setClear(1),r.setClear(0),B(e.DEPTH_TEST),i.setFunc(3),G(!1),X(1),B(e.CULL_FACE),j(0);const H={[HC]:e.FUNC_ADD,[WC]:e.FUNC_SUBTRACT,[jC]:e.FUNC_REVERSE_SUBTRACT};H[103]=e.MIN,H[104]=e.MAX;const W={[GC]:e.ZERO,[XC]:e.ONE,[qC]:e.SRC_COLOR,[$C]:e.SRC_ALPHA,[tR]:e.SRC_ALPHA_SATURATE,[JC]:e.DST_COLOR,[ZC]:e.DST_ALPHA,[YC]:e.ONE_MINUS_SRC_COLOR,[KC]:e.ONE_MINUS_SRC_ALPHA,[eR]:e.ONE_MINUS_DST_COLOR,[QC]:e.ONE_MINUS_DST_ALPHA,[nR]:e.CONSTANT_COLOR,[iR]:e.ONE_MINUS_CONSTANT_COLOR,[rR]:e.CONSTANT_ALPHA,[aR]:e.ONE_MINUS_CONSTANT_ALPHA};function j(t,n,i,r,a,s,o,l,c,u){if(0!==t){if(!1===d&&(B(e.BLEND),d=!0),5===t)a=a||n,s=s||i,o=o||r,n===f&&a===_||(e.blendEquationSeparate(H[n],H[a]),f=n,_=a),i===m&&r===g&&s===v&&o===y||(e.blendFuncSeparate(W[i],W[r],W[s],W[o]),m=i,g=r,v=s,y=o),!1!==l.equals(x)&&c===w||(e.blendColor(l.r,l.g,l.b,c),x.copy(l),w=c),p=t,b=!1;else if(t!==p||u!==b){if(f===HC&&_===HC||(e.blendEquation(e.FUNC_ADD),f=HC,_=HC),u)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR)}m=null,g=null,v=null,y=null,x.set(0,0,0),w=0,p=t,b=u}}else!0===d&&(V(e.BLEND),d=!1)}function G(t){E!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),E=t)}function X(t){0!==t?(B(e.CULL_FACE),t!==M&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):V(e.CULL_FACE),M=t}function q(t,n,i){t?(B(e.POLYGON_OFFSET_FILL),T===n&&A===i||(e.polygonOffset(n,i),T=n,A=i)):V(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:i,stencil:r},enable:B,disable:V,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let i=u,r=!1;if(t){i=c.get(n),void 0===i&&(i=[],c.set(n,i));const a=t.textures;if(i.length!==a.length||i[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=a.length;t<n;t++)i[t]=e.COLOR_ATTACHMENT0+t;i.length=a.length,r=!0}}else i[0]!==e.BACK&&(i[0]=e.BACK,r=!0);r&&e.drawBuffers(i)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:j,setMaterial:function(t,a){2===t.side?V(e.CULL_FACE):B(e.CULL_FACE);let s=1===t.side;a&&(s=!s),G(s),1===t.blending&&!1===t.transparent?j(0):j(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),i.setFunc(t.depthFunc),i.setTest(t.depthTest),i.setMask(t.depthWrite),n.setMask(t.colorWrite);const o=t.stencilWrite;r.setTest(o),o&&(r.setMask(t.stencilWriteMask),r.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),r.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?B(e.SAMPLE_ALPHA_TO_COVERAGE):V(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:G,setCullFace:X,setLineWidth:function(t){t!==S&&(R&&e.lineWidth(t),S=t)},setPolygonOffset:q,setScissorTest:function(t){t?B(e.SCISSOR_TEST):V(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+C-1),O!==t&&(e.activeTexture(t),O=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===O?e.TEXTURE0+C-1:O);let r=I[i];void 0===r&&(r={type:void 0,texture:void 0},I[i]=r),r.type===t&&r.texture===n||(O!==i&&(e.activeTexture(i),O=i),e.bindTexture(t,n||z[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=I[O];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){}},updateUBOMapping:function(t,n){let i=s.get(n);void 0===i&&(i=new WeakMap,s.set(n,i));let r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){const i=s.get(n).get(t);a.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),a.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){}},scissor:function(t){!1===N.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),N.copy(t))},viewport:function(t){!1===U.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),i.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},O=null,I={},l={},c=new WeakMap,u=[],h=null,d=!1,p=null,f=null,m=null,g=null,_=null,v=null,y=null,x=new GO(0,0,0),w=0,b=!1,E=null,M=null,S=null,T=null,A=null,N.set(0,0,e.canvas.width,e.canvas.height),U.set(0,0,e.canvas.width,e.canvas.height),n.reset(),i.reset(),r.reset()}}}function EN(e,t,n,i){const r=function(e){switch(e){case TR:case AR:return{byteLength:1,components:1};case RR:case CR:case IR:return{byteLength:2,components:1};case LR:case DR:return{byteLength:2,components:4};case kR:case PR:case OR:return{byteLength:4,components:1};case UR:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(i);switch(n){case 1021:case 1024:return e*t;case 1025:return e*t*2;case VR:case HR:return e*t/r.components*r.byteLength;case 1030:case WR:return e*t*2/r.components*r.byteLength;case 1022:return e*t*3/r.components*r.byteLength;case FR:case jR:return e*t*4/r.components*r.byteLength;case GR:case XR:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case qR:case YR:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case KR:case QR:return Math.max(e,16)*Math.max(t,8)/4;case $R:case ZR:return Math.max(e,8)*Math.max(t,8)/2;case JR:case eP:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case tP:case nP:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case iP:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case rP:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case aP:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case sP:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case oP:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case lP:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case cP:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case uP:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case hP:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case dP:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case pP:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case fP:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case mP:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case gP:case _P:case vP:return Math.ceil(e/4)*Math.ceil(t/4)*16;case 36283:case yP:return Math.ceil(e/4)*Math.ceil(t/4)*8;case xP:case wP:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function MN(e,t,n,i,r,a,s){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new YP,u=new WeakMap;let h;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(H){}function f(e,t){return p?new OffscreenCanvas(e,t):QP("canvas")}function m(e,t,n){let i=1;const r=V(e);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(i*r.width),a=Math.floor(i*r.height);void 0===h&&(h=f(n,a));const s=t?f(n,a):h;s.width=n,s.height=a;return s.getContext("2d").drawImage(e,0,0,n,a),s}return e}return e}function g(e){return e.generateMipmaps}function _(t){e.generateMipmap(t)}function v(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function y(n,i,r,a,s=!1){if(null!==n&&void 0!==e[n])return e[n];let o=i;if(i===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.R8UI),r===e.UNSIGNED_SHORT&&(o=e.R16UI),r===e.UNSIGNED_INT&&(o=e.R32UI),r===e.BYTE&&(o=e.R8I),r===e.SHORT&&(o=e.R16I),r===e.INT&&(o=e.R32I)),i===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RG_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RG8UI),r===e.UNSIGNED_SHORT&&(o=e.RG16UI),r===e.UNSIGNED_INT&&(o=e.RG32UI),r===e.BYTE&&(o=e.RG8I),r===e.SHORT&&(o=e.RG16I),r===e.INT&&(o=e.RG32I)),i===e.RGB_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGB8UI),r===e.UNSIGNED_SHORT&&(o=e.RGB16UI),r===e.UNSIGNED_INT&&(o=e.RGB32UI),r===e.BYTE&&(o=e.RGB8I),r===e.SHORT&&(o=e.RGB16I),r===e.INT&&(o=e.RGB32I)),i===e.RGBA_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),r===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),r===e.UNSIGNED_INT&&(o=e.RGBA32UI),r===e.BYTE&&(o=e.RGBA8I),r===e.SHORT&&(o=e.RGBA16I),r===e.INT&&(o=e.RGBA32I)),i===e.RGB&&r===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),i===e.RGBA){const t=s?SP:nk.getTransfer(a);r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=t===TP?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function x(t,n){let i;return t?null===n||n===kR||n===NR?i=e.DEPTH24_STENCIL8:n===OR?i=e.DEPTH32F_STENCIL8:n===RR&&(i=e.DEPTH24_STENCIL8):null===n||n===kR||n===NR?i=e.DEPTH_COMPONENT24:n===OR?i=e.DEPTH_COMPONENT32F:n===RR&&(i=e.DEPTH_COMPONENT16),i}function w(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==xR&&e.minFilter!==ER?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function b(e){const t=e.target;t.removeEventListener("dispose",b),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const n=e.source,r=d.get(n);if(r){const i=r[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&M(e),0===Object.keys(r).length&&d.delete(n)}i.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function E(t){const n=t.target;n.removeEventListener("dispose",E),function(t){const n=i.get(t);t.depthTexture&&(t.depthTexture.dispose(),i.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++){if(Array.isArray(n.__webglFramebuffer[i]))for(let t=0;t<n.__webglFramebuffer[i].length;t++)e.deleteFramebuffer(n.__webglFramebuffer[i][t]);else e.deleteFramebuffer(n.__webglFramebuffer[i]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[i])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=t.textures;for(let a=0,o=r.length;a<o;a++){const t=i.get(r[a]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),i.remove(r[a])}i.remove(t)}(n)}function M(t){const n=i.get(t);e.deleteTexture(n.__webglTexture);const r=t.source;delete d.get(r)[n.__cacheKey],s.memory.textures--}let S=0;function T(t,r){const a=i.get(t);if(t.isVideoTexture&&function(e){const t=s.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){const e=t.image;if(null===e);else if(!1!==e.complete)return void O(a,t,r)}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+r)}const A={[_R]:e.REPEAT,[vR]:e.CLAMP_TO_EDGE,[yR]:e.MIRRORED_REPEAT},C={[xR]:e.NEAREST,[wR]:e.NEAREST_MIPMAP_NEAREST,[bR]:e.NEAREST_MIPMAP_LINEAR,[ER]:e.LINEAR,[MR]:e.LINEAR_MIPMAP_NEAREST,[SR]:e.LINEAR_MIPMAP_LINEAR},R={[CP]:e.NEVER,[DP]:e.ALWAYS,[RP]:e.LESS,[kP]:e.LEQUAL,[PP]:e.EQUAL,[LP]:e.GEQUAL,[OP]:e.GREATER,[IP]:e.NOTEQUAL};function P(n,a){if(a.type===OR&&!1===t.has("OES_texture_float_linear")&&(a.magFilter===ER||a.magFilter===MR||a.magFilter===bR||a.magFilter===SR||a.minFilter===ER||a.minFilter===MR||a.minFilter===bR||a.minFilter),e.texParameteri(n,e.TEXTURE_WRAP_S,A[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,A[a.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,A[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,C[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,C[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,R[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===xR)return;if(a.minFilter!==bR&&a.minFilter!==SR)return;if(a.type===OR&&!1===t.has("OES_texture_float_linear"))return;if(a.anisotropy>1||i.get(a).__currentAnisotropy){const s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy}}}function k(t,n){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",b));const r=n.source;let a=d.get(r);void 0===a&&(a={},d.set(r,a));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),a[o].usedTimes++;const r=a[t.__cacheKey];void 0!==r&&(a[t.__cacheKey].usedTimes--,0===r.usedTimes&&M(n)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return i}function O(t,s,o){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);const c=k(t,s),u=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const h=i.get(u);if(u.version!==h.__version||!0===c){n.activeTexture(e.TEXTURE0+o);const t=nk.getPrimaries(nk.workingColorSpace),i=s.colorSpace===bP?null:nk.getPrimaries(s.colorSpace),d=s.colorSpace===bP||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(s.image,!1,r.maxTextureSize);p=B(s,p);const f=a.convert(s.format,s.colorSpace),v=a.convert(s.type);let b,E=y(s.internalFormat,f,v,s.colorSpace,s.isVideoTexture);P(l,s);const M=s.mipmaps,S=!0!==s.isVideoTexture,T=void 0===h.__version||!0===c,A=u.dataReady,C=w(s,p);if(s.isDepthTexture)E=x(s.format===BR,s.type),T&&(S?n.texStorage2D(e.TEXTURE_2D,1,E,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,E,p.width,p.height,0,f,v,null));else if(s.isDataTexture)if(M.length>0){S&&T&&n.texStorage2D(e.TEXTURE_2D,C,E,M[0].width,M[0].height);for(let t=0,i=M.length;t<i;t++)b=M[t],S?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,b.width,b.height,f,v,b.data):n.texImage2D(e.TEXTURE_2D,t,E,b.width,b.height,0,f,v,b.data);s.generateMipmaps=!1}else S?(T&&n.texStorage2D(e.TEXTURE_2D,C,E,p.width,p.height),A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,v,p.data)):n.texImage2D(e.TEXTURE_2D,0,E,p.width,p.height,0,f,v,p.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){S&&T&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,E,M[0].width,M[0].height,p.depth);for(let t=0,i=M.length;t<i;t++)if(b=M[t],s.format!==FR){if(null!==f)if(S){if(A)if(s.layerUpdates.size>0){const i=EN(b.width,b.height,s.format,s.type);for(const r of s.layerUpdates){const a=b.data.subarray(r*i/b.data.BYTES_PER_ELEMENT,(r+1)*i/b.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,r,b.width,b.height,1,f,a)}s.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,b.width,b.height,p.depth,f,b.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,E,b.width,b.height,p.depth,0,b.data,0,0)}else S?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,b.width,b.height,p.depth,f,v,b.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,E,b.width,b.height,p.depth,0,f,v,b.data)}else{S&&T&&n.texStorage2D(e.TEXTURE_2D,C,E,M[0].width,M[0].height);for(let t=0,i=M.length;t<i;t++)b=M[t],s.format!==FR?null!==f&&(S?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,b.width,b.height,f,b.data):n.compressedTexImage2D(e.TEXTURE_2D,t,E,b.width,b.height,0,b.data)):S?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,b.width,b.height,f,v,b.data):n.texImage2D(e.TEXTURE_2D,t,E,b.width,b.height,0,f,v,b.data)}else if(s.isDataArrayTexture)if(S){if(T&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,E,p.width,p.height,p.depth),A)if(s.layerUpdates.size>0){const t=EN(p.width,p.height,s.format,s.type);for(const i of s.layerUpdates){const r=p.data.subarray(i*t/p.data.BYTES_PER_ELEMENT,(i+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,v,r)}s.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,E,p.width,p.height,p.depth,0,f,v,p.data);else if(s.isData3DTexture)S?(T&&n.texStorage3D(e.TEXTURE_3D,C,E,p.width,p.height,p.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,v,p.data)):n.texImage3D(e.TEXTURE_3D,0,E,p.width,p.height,p.depth,0,f,v,p.data);else if(s.isFramebufferTexture){if(T)if(S)n.texStorage2D(e.TEXTURE_2D,C,E,p.width,p.height);else{let t=p.width,i=p.height;for(let r=0;r<C;r++)n.texImage2D(e.TEXTURE_2D,r,E,t,i,0,f,v,null),t>>=1,i>>=1}}else if(M.length>0){if(S&&T){const t=V(M[0]);n.texStorage2D(e.TEXTURE_2D,C,E,t.width,t.height)}for(let t=0,i=M.length;t<i;t++)b=M[t],S?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,v,b):n.texImage2D(e.TEXTURE_2D,t,E,f,v,b);s.generateMipmaps=!1}else if(S){if(T){const t=V(p);n.texStorage2D(e.TEXTURE_2D,C,E,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,v,p)}else n.texImage2D(e.TEXTURE_2D,0,E,f,v,p);g(s)&&_(l),h.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function I(t,r,s,l,c,u){const h=a.convert(s.format,s.colorSpace),d=a.convert(s.type),p=y(s.internalFormat,h,d,s.colorSpace),f=i.get(r),m=i.get(s);if(m.__renderTarget=r,!f.__hasExternalTextures){const t=Math.max(1,r.width>>u),i=Math.max(1,r.height>>u);c===e.TEXTURE_3D||c===e.TEXTURE_2D_ARRAY?n.texImage3D(c,u,p,t,i,r.depth,0,h,d,null):n.texImage2D(c,u,p,t,i,0,h,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),z(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,c,m.__webglTexture,0,F(r)):(c===e.TEXTURE_2D||c>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,c,m.__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function L(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const r=n.depthTexture,a=r&&r.isDepthTexture?r.type:null,s=x(n.stencilBuffer,a),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=F(n);z(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,s,n.width,n.height):i?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let r=0;r<t.length;r++){const s=t[r],l=a.convert(s.format,s.colorSpace),c=a.convert(s.type),u=y(s.internalFormat,l,c,s.colorSpace),h=F(n);i&&!1===z(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,u,n.width,n.height):z(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function D(t){const r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(r.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(r.__depthDisposeCallback&&r.__depthDisposeCallback(),e){const t=()=>{delete r.__boundDepthTexture,delete r.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),r.__depthDisposeCallback=t}r.__boundDepthTexture=e}if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const a=i.get(r.depthTexture);a.__renderTarget=r,a.__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),T(r.depthTexture,0);const s=a.__webglTexture,l=F(r);if(r.depthTexture.format===zR)z(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==BR)throw new Error("Unknown depthTexture format");z(r)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[i]),void 0===r.__webglDepthbuffer[i])r.__webglDepthbuffer[i]=e.createRenderbuffer(),L(r.__webglDepthbuffer[i],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,a=r.__webglDepthbuffer[i];e.bindRenderbuffer(e.RENDERBUFFER,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,a)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),void 0===r.__webglDepthbuffer)r.__webglDepthbuffer=e.createRenderbuffer(),L(r.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,i=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,i)}n.bindFramebuffer(e.FRAMEBUFFER,null)}const N=[],U=[];function F(e){return Math.min(r.maxSamples,e.samples)}function z(e){const n=i.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(e,t){const n=e.colorSpace;e.format,e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==MP&&n!==bP&&nk.getTransfer(n),t}function V(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(c.width=e.naturalWidth||e.width,c.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(c.width=e.displayWidth,c.height=e.displayHeight):(c.width=e.width,c.height=e.height),c}this.allocateTextureUnit=function(){const e=S;return r.maxTextures,S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?O(a,t,r):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){const a=i.get(t);t.version>0&&a.__version!==t.version?O(a,t,r):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,s){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,s,o){if(6!==s.image.length)return;const l=k(t,s),c=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const u=i.get(c);if(c.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=nk.getPrimaries(nk.workingColorSpace),i=s.colorSpace===bP?null:nk.getPrimaries(s.colorSpace),h=s.colorSpace===bP||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);const d=s.isCompressedTexture||s.image[0].isCompressedTexture,p=s.image[0]&&s.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=d||p?p?s.image[e].image:s.image[e]:m(s.image[e],!0,r.maxCubemapSize),f[e]=B(s,f[e]);const v=f[0],x=a.convert(s.format,s.colorSpace),b=a.convert(s.type),E=y(s.internalFormat,x,b,s.colorSpace),M=!0!==s.isVideoTexture,S=void 0===u.__version||!0===l,T=c.dataReady;let A,C=w(s,v);if(P(e.TEXTURE_CUBE_MAP,s),d){M&&S&&n.texStorage2D(e.TEXTURE_CUBE_MAP,C,E,v.width,v.height);for(let t=0;t<6;t++){A=f[t].mipmaps;for(let i=0;i<A.length;i++){const r=A[i];s.format!==FR?null!==x&&(M?T&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,x,r.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,E,r.width,r.height,0,r.data)):M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,r.width,r.height,x,b,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,E,r.width,r.height,0,x,b,r.data)}}}else{if(A=s.mipmaps,M&&S){A.length>0&&C++;const t=V(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,C,E,t.width,t.height)}for(let t=0;t<6;t++)if(p){M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,x,b,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,E,f[t].width,f[t].height,0,x,b,f[t].data);for(let i=0;i<A.length;i++){const r=A[i].image[t].image;M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,r.width,r.height,x,b,r.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,E,r.width,r.height,0,x,b,r.data)}}else{M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,x,b,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,E,x,b,f[t]);for(let i=0;i<A.length;i++){const r=A[i];M?T&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,x,b,r.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,E,x,b,r.image[t])}}}g(s)&&_(e.TEXTURE_CUBE_MAP),u.__version=c.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(o,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,r){const a=i.get(t);void 0!==n&&I(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&D(t)},this.setupRenderTarget=function(t){const r=t.texture,o=i.get(t),l=i.get(r);t.addEventListener("dispose",E);const c=t.textures,u=!0===t.isWebGLCubeRenderTarget,h=c.length>1;if(h||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=r.version,s.memory.textures++),u){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<r.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<r.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(h)for(let t=0,n=c.length;t<n;t++){const n=i.get(c[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===z(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const r=a.convert(i.format,i.colorSpace),s=a.convert(i.type),l=y(i.internalFormat,r,s,i.colorSpace,!0===t.isXRRenderTarget),u=F(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),L(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),P(e.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)I(o.__webglFramebuffer[n][i],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else I(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&_(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(h){for(let r=0,a=c.length;r<a;r++){const a=c[r],s=i.get(a);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),P(e.TEXTURE_2D,a),I(o.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+r,e.TEXTURE_2D,0),g(a)&&_(e.TEXTURE_2D)}n.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),P(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)I(o.__webglFramebuffer[n],t,r,e.COLOR_ATTACHMENT0,i,n);else I(o.__webglFramebuffer,t,r,e.COLOR_ATTACHMENT0,i,0);g(r)&&_(i),n.unbindTexture()}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let r=0,a=t.length;r<a;r++){const a=t[r];if(g(a)){const t=v(e),r=i.get(a).__webglTexture;n.bindTexture(t,r),_(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===z(t)){const r=t.textures,a=t.width,s=t.height;let o=e.COLOR_BUFFER_BIT;const c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),h=r.length>1;if(h)for(let t=0;t<r.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<r.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),h){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);const t=i.get(r[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),!0===l&&(N.length=0,U.length=0,N.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(N.push(c),U.push(c),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,U)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,N))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),h)for(let t=0;t<r.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const a=i.get(r[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=D,this.setupFrameBufferTexture=I,this.useMultisampledRTT=z}function SN(e,t){return{convert:function(n,i=""){let r;const a=nk.getTransfer(i);if(n===TR)return e.UNSIGNED_BYTE;if(n===LR)return e.UNSIGNED_SHORT_4_4_4_4;if(n===DR)return e.UNSIGNED_SHORT_5_5_5_1;if(n===UR)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===AR)return e.BYTE;if(n===CR)return e.SHORT;if(n===RR)return e.UNSIGNED_SHORT;if(n===PR)return e.INT;if(n===kR)return e.UNSIGNED_INT;if(n===OR)return e.FLOAT;if(n===IR)return e.HALF_FLOAT;if(1021===n)return e.ALPHA;if(1022===n)return e.RGB;if(n===FR)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(n===zR)return e.DEPTH_COMPONENT;if(n===BR)return e.DEPTH_STENCIL;if(n===VR)return e.RED;if(n===HR)return e.RED_INTEGER;if(1030===n)return e.RG;if(n===WR)return e.RG_INTEGER;if(n===jR)return e.RGBA_INTEGER;if(n===GR||n===XR||n===qR||n===YR)if(a===TP){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===GR)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===XR)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===qR)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===YR)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===GR)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===XR)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===qR)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===YR)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===$R||n===KR||n===ZR||n===QR){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===$R)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===KR)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===ZR)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===QR)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===JR||n===eP||n===tP){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===JR||n===eP)return a===TP?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===tP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===nP||n===iP||n===rP||n===aP||n===sP||n===oP||n===lP||n===cP||n===uP||n===hP||n===dP||n===pP||n===fP||n===mP){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===nP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===iP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===rP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===aP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===sP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===oP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===lP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===cP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===uP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===hP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===dP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===pP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===fP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===mP)return a===TP?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===gP||n===_P||n===vP){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(n===gP)return a===TP?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===_P)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===vP)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===n||n===yP||n===xP||n===wP){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===gP)return r.COMPRESSED_RED_RGTC1_EXT;if(n===yP)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===xP)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===wP)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===NR?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class TN extends II{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class AN extends TO{constructor(){super(),this.isGroup=!0,this.type="Group"}}const CN={type:"move"};class RN{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new AN,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new AN,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ek,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ek),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new AN,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ek,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ek),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,a=null;const s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(const a of e.hand.values()){const e=t.getJointPose(a,n),i=this._getHandJoint(l,a);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&s>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(CN)))}return null!==s&&(s.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new AN;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class PN{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const i=new gk;e.properties.get(i).__webglTexture=t.texture,t.depthNear==n.depthNear&&t.depthFar==n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new CI({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new wI(new qI(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class kN extends zP{constructor(e,t){super();const n=this;let i=null,r=1,a=null,s="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null;const f=new PN,m=t.getContextAttributes();let g=null,_=null;const v=[],y=[],x=new YP;let w=null;const b=new II;b.viewport=new _k;const E=new II;E.viewport=new _k;const M=[b,E],S=new TN;let T=null,A=null;function C(e){const t=y.indexOf(e.inputSource);if(-1===t)return;const n=v[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function R(){i.removeEventListener("select",C),i.removeEventListener("selectstart",C),i.removeEventListener("selectend",C),i.removeEventListener("squeeze",C),i.removeEventListener("squeezestart",C),i.removeEventListener("squeezeend",C),i.removeEventListener("end",R),i.removeEventListener("inputsourceschange",P);for(let e=0;e<v.length;e++){const t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}T=null,A=null,f.reset(),e.setRenderTarget(g),d=null,h=null,u=null,i=null,_=null,D.stop(),n.isPresenting=!1,e.setPixelRatio(w),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=y.indexOf(n);i>=0&&(y[i]=null,v[i].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let i=y.indexOf(n);if(-1===i){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(n),i=e;break}if(null===y[e]){y[e]=n,i=e;break}}if(-1===i)break}const r=v[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new RN,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new RN,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new RN,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,n.isPresenting},this.setReferenceSpaceType=function(e){s=e,n.isPresenting},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(g=e.getRenderTarget(),i.addEventListener("select",C),i.addEventListener("selectstart",C),i.addEventListener("selectend",C),i.addEventListener("squeeze",C),i.addEventListener("squeezestart",C),i.addEventListener("squeezeend",C),i.addEventListener("end",R),i.addEventListener("inputsourceschange",P),!0!==m.xrCompatible&&await t.makeXRCompatible(),w=e.getPixelRatio(),e.getSize(x),void 0===i.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),_=new yk(d.framebufferWidth,d.framebufferHeight,{format:FR,type:TR,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,a=null,s=null;m.depth&&(s=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?BR:zR,a=m.stencil?NR:kR);const o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:r};u=new XRWebGLBinding(i,t),h=u.createProjectionLayer(o),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),_=new yk(h.textureWidth,h.textureHeight,{format:FR,type:TR,depthTexture:new kL(h.textureWidth,h.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===h.ignoreDepthValues})}_.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await i.requestReferenceSpace(s),D.setContext(i),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const k=new Ek,O=new Ek;function I(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;let t=e.near,n=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(n=f.depthFar)),S.near=E.near=b.near=t,S.far=E.far=b.far=n,T===S.near&&A===S.far||(i.updateRenderState({depthNear:S.near,depthFar:S.far}),T=S.near,A=S.far),b.layers.mask=2|e.layers.mask,E.layers.mask=4|e.layers.mask,S.layers.mask=b.layers.mask|E.layers.mask;const r=e.parent,a=S.cameras;I(S,r);for(let i=0;i<a.length;i++)I(a[i],r);2===a.length?function(e,t,n){k.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(n.matrixWorld);const i=k.distanceTo(O),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,s=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],u=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=s*u,p=s*h,f=i/(-u+h),m=f*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===r[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=s+f,n=o+f,r=d-m,a=p+(i-m),u=l*o/n*t,h=c*o/n*t;e.projectionMatrix.makePerspective(r,a,u,h,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(S,b,E):S.projectionMatrix.copy(b.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*HP*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,S,r)},this.getCamera=function(){return S},this.getFoveation=function(){if(null!==h||null!==d)return o},this.setFoveation=function(e){o=e,null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(S)};let L=null;const D=new GI;D.setAnimationLoop((function(t,r){if(c=r.getViewerPose(l||a),p=r,null!==c){const t=c.views;null!==d&&(e.setRenderTargetFramebuffer(_,d.framebuffer),e.setRenderTarget(_));let n=!1;t.length!==S.cameras.length&&(S.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const r=t[i];let a=null;if(null!==d)a=d.getViewport(r);else{const t=u.getViewSubImage(h,r);a=t.viewport,0===i&&(e.setRenderTargetTextures(_,t.colorTexture,h.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(_))}let s=M[i];void 0===s&&(s=new II,s.layers.enable(i),s.viewport=new _k,M[i]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===i&&(S.matrix.copy(s.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),!0===n&&S.cameras.push(s)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")){const n=u.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&f.init(e,n,i.renderState)}}for(let e=0;e<v.length;e++){const t=y[e],n=v[e];null!==t&&void 0!==n&&n.update(t,r,l||a)}L&&L(t,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}const ON=new cO,IN=new Jk;function LN(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map,n(i.map,e.mapTransform)),i.alphaMap&&(e.alphaMap.value=i.alphaMap,n(i.alphaMap,e.alphaMapTransform)),i.bumpMap&&(e.bumpMap.value=i.bumpMap,n(i.bumpMap,e.bumpMapTransform),e.bumpScale.value=i.bumpScale,1===i.side&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,n(i.normalMap,e.normalMapTransform),e.normalScale.value.copy(i.normalScale),1===i.side&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,n(i.displacementMap,e.displacementMapTransform),e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,e.emissiveMapTransform)),i.specularMap&&(e.specularMap.value=i.specularMap,n(i.specularMap,e.specularMapTransform)),i.alphaTest>0&&(e.alphaTest.value=i.alphaTest);const r=t.get(i),a=r.envMap,s=r.envMapRotation;a&&(e.envMap.value=a,ON.copy(s),ON.x*=-1,ON.y*=-1,ON.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(ON.y*=-1,ON.z*=-1),e.envMapRotation.value.setFromMatrix4(IN.makeRotationFromEuler(ON)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=i.reflectivity,e.ior.value=i.ior,e.refractionRatio.value=i.refractionRatio),i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,e.lightMapTransform)),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,TI(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,r,a,s,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(e,r):r.isMeshToonMaterial?(i(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(i(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(i(e,r),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,r,o)):r.isMeshMatcapMaterial?(i(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?i(e,r):r.isMeshDistanceMaterial?(i(e,r),function(e,n){const i=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?i(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,i,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*r,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r,a,s):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function DN(e,t,n,i){let r={},a={},s=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,i){const r=e.value,a=t+"_"+n;if(void 0===i[a])return i[a]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const e=i[a];if("number"==typeof r||"boolean"==typeof r){if(e!==r)return i[a]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}function c(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture,t}function u(t){const n=t.target;n.removeEventListener("dispose",u);const i=s.indexOf(n.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(e,t){const n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){let d=r[n.id];void 0===d&&(!function(e){const t=e.uniforms;let n=0;const i=16;for(let a=0,s=t.length;a<s;a++){const e=Array.isArray(t[a])?t[a]:[t[a]];for(let t=0,r=e.length;t<r;t++){const r=e[t],a=Array.isArray(r.value)?r.value:[r.value];for(let e=0,t=a.length;e<t;e++){const t=c(a[e]),s=n%i,o=s%t.boundary,l=s+o;n+=o,0!==l&&i-l<t.storage&&(n+=i-l),r.__data=new Float32Array(t.storage/Float32Array.BYTES_PER_ELEMENT),r.__offset=n,n+=t.storage}}}const r=n%i;r>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),d=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return 0}();t.__bindingPointIndex=n;const i=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,r,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",u));const p=h.program;i.updateUBOMapping(n,p);const f=t.render.frame;a[n.id]!==f&&(!function(t){const n=r[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let r=0,s=i.length;r<s;r++){const t=Array.isArray(i[r])?i[r]:[i[r]];for(let n=0,i=t.length;n<i;n++){const i=t[n];if(!0===l(i,r,n,a)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let a=0;a<n.length;a++){const s=n[a],o=c(s);"number"==typeof s||"boolean"==typeof s?(i.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(const t in r)e.deleteBuffer(r[t]);s=[],r={},a={}}}}class NN{constructor(e={}){const{canvas:t=JP(),context:n=null,depth:i=!0,stencil:r=!1,alpha:a=!1,antialias:s=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1,reverseDepthBuffer:h=!1}=e;let d;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=a;const p=new Uint32Array(4),f=new Int32Array(4);let m=null,g=null;const _=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=EP,this.toneMapping=0,this.toneMappingExposure=1;const y=this;let x=!1,w=0,b=0,E=null,M=-1,S=null;const T=new _k,A=new _k;let C=null;const R=new GO(0);let P=0,k=t.width,O=t.height,I=1,L=null,D=null;const N=new _k(0,0,k,O),U=new _k(0,0,k,O);let F=!1;const z=new jI;let B=!1,V=!1;const H=new Jk,W=new Jk,j=new Ek,G=new _k,X={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let q=!1;function Y(){return null===E?I:1}let $,K,Z,Q,J,ee,te,ne,ie,re,ae,se,oe,le,ce,ue,he,de,pe,fe,me,ge,_e,ve,ye=n;function xe(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${FC}`),t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",Me,!1),t.addEventListener("webglcontextcreationerror",Se,!1),null===ye){const t="webgl2";if(ye=xe(t,e),null===ye)throw xe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Be){throw Be}function we(){$=new SL(ye),$.init(),ge=new SN(ye,$),K=new iL(ye,$,e,ge),Z=new bN(ye,$),K.reverseDepthBuffer&&h&&Z.buffers.depth.setReversed(!0),Q=new CL(ye),J=new oN,ee=new MN(ye,$,Z,J,K,ge,Q),te=new aL(y),ne=new ML(y),ie=new XI(ye),_e=new tL(ye,ie),re=new TL(ye,ie,Q,_e),ae=new PL(ye,re,ie,Q),pe=new RL(ye,K,ee),ue=new rL(J),se=new sN(y,te,ne,$,K,_e,ue),oe=new LN(y,J),le=new hN,ce=new _N($),de=new eL(y,te,ne,Z,ae,d,o),he=new xN(y,ae,K),ve=new DN(ye,Q,K,Z),fe=new nL(ye,$,Q),me=new AL(ye,$,Q),Q.programs=se.programs,y.capabilities=K,y.extensions=$,y.properties=J,y.renderLists=le,y.shadowMap=he,y.state=Z,y.info=Q}we();const be=new kN(y,ye);function Ee(e){e.preventDefault(),x=!0}function Me(){x=!1;const e=Q.autoReset,t=he.enabled,n=he.autoUpdate,i=he.needsUpdate,r=he.type;we(),Q.autoReset=e,he.enabled=t,he.autoUpdate=n,he.needsUpdate=i,he.type=r}function Se(e){}function Te(e){const t=e.target;t.removeEventListener("dispose",Te),function(e){(function(e){const t=J.get(e).programs;void 0!==t&&(t.forEach((function(e){se.releaseProgram(e)})),e.isShaderMaterial&&se.releaseShaderCache(e))})(e),J.remove(e)}(t)}function Ae(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ue(e,t,n),e.side=0,e.needsUpdate=!0,Ue(e,t,n),e.side=2):Ue(e,t,n)}this.xr=be,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){const e=$.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=$.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(e){void 0!==e&&(I=e,this.setSize(k,O,!1))},this.getSize=function(e){return e.set(k,O)},this.setSize=function(e,n,i=!0){be.isPresenting||(k=e,O=n,t.width=Math.floor(e*I),t.height=Math.floor(n*I),!0===i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(k*I,O*I).floor()},this.setDrawingBufferSize=function(e,n,i){k=e,O=n,I=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(T)},this.getViewport=function(e){return e.copy(N)},this.setViewport=function(e,t,n,i){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,i),Z.viewport(T.copy(N).multiplyScalar(I).round())},this.getScissor=function(e){return e.copy(U)},this.setScissor=function(e,t,n,i){e.isVector4?U.set(e.x,e.y,e.z,e.w):U.set(e,t,n,i),Z.scissor(A.copy(U).multiplyScalar(I).round())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){Z.setScissorTest(F=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(e=!0,t=!0,n=!0){let i=0;if(e){let e=!1;if(null!==E){const t=E.texture.format;e=t===jR||t===WR||t===HR}if(e){const e=E.texture.type,t=e===TR||e===kR||e===RR||e===NR||e===LR||e===DR,n=de.getClearColor(),i=de.getClearAlpha(),r=n.r,a=n.g,s=n.b;t?(p[0]=r,p[1]=a,p[2]=s,p[3]=i,ye.clearBufferuiv(ye.COLOR,0,p)):(f[0]=r,f[1]=a,f[2]=s,f[3]=i,ye.clearBufferiv(ye.COLOR,0,f))}else i|=ye.COLOR_BUFFER_BIT}t&&(i|=ye.DEPTH_BUFFER_BIT),n&&(i|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",Me,!1),t.removeEventListener("webglcontextcreationerror",Se,!1),le.dispose(),ce.dispose(),J.dispose(),te.dispose(),ne.dispose(),ae.dispose(),_e.dispose(),ve.dispose(),se.dispose(),be.dispose(),be.removeEventListener("sessionstart",Re),be.removeEventListener("sessionend",Pe),ke.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=X);const s=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,n,i,r){!0!==t.isScene&&(t=X);ee.resetTextureUnits();const a=t.fog,s=i.isMeshStandardMaterial?t.environment:null,o=null===E?y.outputColorSpace:!0===E.isXRRenderTarget?E.texture.colorSpace:MP,l=(i.isMeshStandardMaterial?ne:te).get(i.envMap||s),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;i.toneMapped&&(null!==E&&!0!==E.isXRRenderTarget||(f=y.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,_=void 0!==m?m.length:0,v=J.get(i),x=g.state.lights;if(!0===B&&(!0===V||e!==S)){const t=e===S&&i.id===M;ue.setState(i,e,t)}let w=!1;i.version===v.__version?v.needsLights&&v.lightsStateVersion!==x.state.version||v.outputColorSpace!==o||r.isBatchedMesh&&!1===v.batching?w=!0:r.isBatchedMesh||!0!==v.batching?r.isBatchedMesh&&!0===v.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===v.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===v.instancing?w=!0:r.isInstancedMesh||!0!==v.instancing?r.isSkinnedMesh&&!1===v.skinning?w=!0:r.isSkinnedMesh||!0!==v.skinning?r.isInstancedMesh&&!0===v.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===v.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===v.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===v.instancingMorph&&null!==r.morphTexture||v.envMap!==l||!0===i.fog&&v.fog!==a?w=!0:void 0===v.numClippingPlanes||v.numClippingPlanes===ue.numPlanes&&v.numIntersection===ue.numIntersection?(v.vertexAlphas!==c||v.vertexTangents!==u||v.morphTargets!==h||v.morphNormals!==d||v.morphColors!==p||v.toneMapping!==f||v.morphTargetsCount!==_)&&(w=!0):w=!0:w=!0:w=!0:w=!0:(w=!0,v.__version=i.version);let b=v.currentProgram;!0===w&&(b=Ue(i,t,r));let T=!1,A=!1,C=!1;const R=b.getUniforms(),P=v.uniforms;Z.useProgram(b.program)&&(T=!0,A=!0,C=!0);i.id!==M&&(M=i.id,A=!0);if(T||S!==e){Z.buffers.depth.getReversed()?(H.copy(e.projectionMatrix),function(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}(H),function(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}(H),R.setValue(ye,"projectionMatrix",H)):R.setValue(ye,"projectionMatrix",e.projectionMatrix),R.setValue(ye,"viewMatrix",e.matrixWorldInverse);const t=R.map.cameraPosition;void 0!==t&&t.setValue(ye,j.setFromMatrixPosition(e.matrixWorld)),K.logarithmicDepthBuffer&&R.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&R.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),S!==e&&(S=e,A=!0,C=!0)}if(r.isSkinnedMesh){R.setOptional(ye,r,"bindMatrix"),R.setOptional(ye,r,"bindMatrixInverse");const e=r.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(ye,"boneTexture",e.boneTexture,ee))}r.isBatchedMesh&&(R.setOptional(ye,r,"batchingTexture"),R.setValue(ye,"batchingTexture",r._matricesTexture,ee),R.setOptional(ye,r,"batchingIdTexture"),R.setValue(ye,"batchingIdTexture",r._indirectTexture,ee),R.setOptional(ye,r,"batchingColorTexture"),null!==r._colorsTexture&&R.setValue(ye,"batchingColorTexture",r._colorsTexture,ee));const k=n.morphAttributes;void 0===k.position&&void 0===k.normal&&void 0===k.color||pe.update(r,n,b);(A||v.receiveShadow!==r.receiveShadow)&&(v.receiveShadow=r.receiveShadow,R.setValue(ye,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(P.envMap.value=l,P.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==t.environment&&(P.envMapIntensity.value=t.environmentIntensity);A&&(R.setValue(ye,"toneMappingExposure",y.toneMappingExposure),v.needsLights&&(D=C,(L=P).ambientLightColor.needsUpdate=D,L.lightProbe.needsUpdate=D,L.directionalLights.needsUpdate=D,L.directionalLightShadows.needsUpdate=D,L.pointLights.needsUpdate=D,L.pointLightShadows.needsUpdate=D,L.spotLights.needsUpdate=D,L.spotLightShadows.needsUpdate=D,L.rectAreaLights.needsUpdate=D,L.hemisphereLights.needsUpdate=D),a&&!0===i.fog&&oe.refreshFogUniforms(P,a),oe.refreshMaterialUniforms(P,i,I,O,g.state.transmissionRenderTarget[e.id]),ND.upload(ye,Fe(v),P,ee));var L,D;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ND.upload(ye,Fe(v),P,ee),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&R.setValue(ye,"center",r.center);if(R.setValue(ye,"modelViewMatrix",r.modelViewMatrix),R.setValue(ye,"normalMatrix",r.normalMatrix),R.setValue(ye,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];ve.update(n,b),ve.bind(n,b)}}return b}(e,t,n,i,r);Z.setMaterial(i,s);let l=n.index,c=1;if(!0===i.wireframe){if(l=re.getWireframeAttribute(n),void 0===l)return;c=2}const u=n.drawRange,h=n.attributes.position;let d=u.start*c,p=(u.start+u.count)*c;null!==a&&(d=Math.max(d,a.start*c),p=Math.min(p,(a.start+a.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=h&&(d=Math.max(d,0),p=Math.min(p,h.count));const f=p-d;if(f<0||f===1/0)return;let m;_e.setup(r,i,o,n,l);let _=fe;if(null!==l&&(m=ie.get(l),_=me,_.setIndex(m)),r.isMesh)!0===i.wireframe?(Z.setLineWidth(i.wireframeLinewidth*Y()),_.setMode(ye.LINES)):_.setMode(ye.TRIANGLES);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*Y()),r.isLineSegments?_.setMode(ye.LINES):r.isLineLoop?_.setMode(ye.LINE_LOOP):_.setMode(ye.LINE_STRIP)}else r.isPoints?_.setMode(ye.POINTS):r.isSprite&&_.setMode(ye.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)_.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if($.get("WEBGL_multi_draw"))_.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const e=r._multiDrawStarts,t=r._multiDrawCounts,n=r._multiDrawCount,a=l?ie.get(l).bytesPerElement:1,s=J.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)s.setValue(ye,"_gl_DrawID",i),_.render(e[i]/a,t[i])}else if(r.isInstancedMesh)_.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);_.renderInstances(d,f,t)}else _.render(d,f)},this.compile=function(e,t,n=null){null===n&&(n=e),g=ce.get(n),g.init(t),v.push(g),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(g.pushLight(e),e.castShadow&&g.pushShadow(e))})),g.setupLights();const i=new Set;return e.traverse((function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let r=0;r<t.length;r++){const a=t[r];Ae(a,n,e),i.add(a)}else Ae(t,n,e),i.add(t)})),v.pop(),g=null,i},this.compileAsync=function(e,t,n=null){const i=this.compile(e,t,n);return new Promise((t=>{function n(){i.forEach((function(e){J.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(n,10):t(e)}null!==$.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ce=null;function Re(){ke.stop()}function Pe(){ke.start()}const ke=new GI;function Oe(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)g.pushLight(e),e.castShadow&&g.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||z.intersectsSprite(e)){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);const t=ae.update(e),r=e.material;r.visible&&m.push(e,t,r,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||z.intersectsObject(e))){const t=ae.update(e),r=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),G.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),G.copy(t.boundingSphere.center)),G.applyMatrix4(e.matrixWorld).applyMatrix4(W)),Array.isArray(r)){const i=t.groups;for(let a=0,s=i.length;a<s;a++){const s=i[a],o=r[s.materialIndex];o&&o.visible&&m.push(e,t,o,n,G.z,s)}}else r.visible&&m.push(e,t,r,n,G.z,null)}const r=e.children;for(let a=0,s=r.length;a<s;a++)Oe(r[a],t,n,i)}function Ie(e,t,n,i){const r=e.opaque,a=e.transmissive,s=e.transparent;g.setupLightsView(n),!0===B&&ue.setGlobalState(y.clippingPlanes,n),i&&Z.viewport(T.copy(i)),r.length>0&&De(r,t,n),a.length>0&&De(a,t,n),s.length>0&&De(s,t,n),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Le(e,t,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===g.state.transmissionRenderTarget[i.id]&&(g.state.transmissionRenderTarget[i.id]=new yk(1,1,{generateMipmaps:!0,type:$.has("EXT_color_buffer_half_float")||$.has("EXT_color_buffer_float")?IR:TR,minFilter:SR,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:nk.workingColorSpace}));const a=g.state.transmissionRenderTarget[i.id],s=i.viewport||T;a.setSize(s.z,s.w);const o=y.getRenderTarget();y.setRenderTarget(a),y.getClearColor(R),P=y.getClearAlpha(),P<1&&y.setClearColor(16777215,.5),y.clear(),q&&de.render(n);const l=y.toneMapping;y.toneMapping=0;const c=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),g.setupLightsView(i),!0===B&&ue.setGlobalState(y.clippingPlanes,i),De(e,n,i),ee.updateMultisampleRenderTarget(a),ee.updateRenderTargetMipmap(a),!1===$.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let r=0,a=t.length;r<a;r++){const a=t[r],s=a.object,o=a.geometry,l=a.material,c=a.group;if(2===l.side&&s.layers.test(i.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,Ne(s,n,i,o,l,c),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(ee.updateMultisampleRenderTarget(a),ee.updateRenderTargetMipmap(a))}y.setRenderTarget(o),y.setClearColor(R,P),void 0!==c&&(i.viewport=c),y.toneMapping=l}function De(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,a=e.length;r<a;r++){const a=e[r],s=a.object,o=a.geometry,l=null===i?a.material:i,c=a.group;s.layers.test(n.layers)&&Ne(s,t,n,o,l,c)}}function Ne(e,t,n,i,r,a){e.onBeforeRender(y,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,a),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,a),r.side=0,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,a),r.side=2):y.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(y,t,n,i,r,a)}function Ue(e,t,n){!0!==t.isScene&&(t=X);const i=J.get(e),r=g.state.lights,a=g.state.shadowsArray,s=r.state.version,o=se.getParameters(e,r.state,a,t,n),l=se.getProgramCacheKey(o);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?ne:te).get(e.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===c&&(e.addEventListener("dispose",Te),c=new Map,i.programs=c);let u=c.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===s)return ze(e,o),u}else o.uniforms=se.getUniforms(e),e.onBeforeCompile(o,y),u=se.acquireProgram(o,l),c.set(l,u),i.uniforms=o.uniforms;const h=i.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ue.uniform),ze(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=u,i.uniformsList=null,u}function Fe(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=ND.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function ze(e,t){const n=J.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}ke.setAnimationLoop((function(e){Ce&&Ce(e)})),"undefined"!=typeof self&&ke.setContext(self),this.setAnimationLoop=function(e){Ce=e,be.setAnimationLoop(e),null===e?ke.stop():ke.start()},be.addEventListener("sessionstart",Re),be.addEventListener("sessionend",Pe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return;if(!0===x)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===be.enabled&&!0===be.isPresenting&&(!0===be.cameraAutoUpdate&&be.updateCamera(t),t=be.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,E),g=ce.get(e,v.length),g.init(t),v.push(g),W.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),z.setFromProjectionMatrix(W),V=this.localClippingEnabled,B=ue.init(this.clippingPlanes,V),m=le.get(e,_.length),m.init(),_.push(m),!0===be.enabled&&!0===be.isPresenting){const e=y.xr.getDepthSensingMesh();null!==e&&Oe(e,t,-1/0,y.sortObjects)}Oe(e,t,0,y.sortObjects),m.finish(),!0===y.sortObjects&&m.sort(L,D),q=!1===be.enabled||!1===be.isPresenting||!1===be.hasDepthSensing(),q&&de.addToRenderList(m,e),this.info.render.frame++,!0===B&&ue.beginShadows();const n=g.state.shadowsArray;he.render(n,e,t),!0===B&&ue.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=m.opaque,r=m.transmissive;if(g.setupLights(),t.isArrayCamera){const n=t.cameras;if(r.length>0)for(let t=0,a=n.length;t<a;t++){Le(i,r,e,n[t])}q&&de.render(e);for(let t=0,i=n.length;t<i;t++){const i=n[t];Ie(m,e,i,i.viewport)}}else r.length>0&&Le(i,r,e,t),q&&de.render(e),Ie(m,e,t);null!==E&&(ee.updateMultisampleRenderTarget(E),ee.updateRenderTargetMipmap(E)),!0===e.isScene&&e.onAfterRender(y,e,t),_e.resetDefaultState(),M=-1,S=null,v.pop(),v.length>0?(g=v[v.length-1],!0===B&&ue.setGlobalState(y.clippingPlanes,g.state.camera)):g=null,_.pop(),m=_.length>0?_[_.length-1]:null},this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(e,t,n){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=n;const i=J.get(e);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===$.has("WEBGL_multisampled_render_to_texture")&&(i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=J.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){E=e,w=t,b=n;let i=!0,r=null,a=!1,s=!1;if(e){const o=J.get(e);if(void 0!==o.__useDefaultFramebuffer)Z.bindFramebuffer(ye.FRAMEBUFFER,null),i=!1;else if(void 0===o.__webglFramebuffer)ee.setupRenderTarget(e);else if(o.__hasExternalTextures)ee.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&J.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ee.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);const c=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=Array.isArray(c[t])?c[t][n]:c[t],a=!0):r=e.samples>0&&!1===ee.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,T.copy(e.viewport),A.copy(e.scissor),C=e.scissorTest}else T.copy(N).multiplyScalar(I).floor(),A.copy(U).multiplyScalar(I).floor(),C=F;if(Z.bindFramebuffer(ye.FRAMEBUFFER,r)&&i&&Z.drawBuffers(e,r),Z.viewport(T),Z.scissor(A),Z.setScissorTest(C),a){const i=J.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(s){const i=J.get(e.texture),r=t||0;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}M=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,s){if(!e||!e.isWebGLRenderTarget)return;let o=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){Z.bindFramebuffer(ye.FRAMEBUFFER,o);try{const s=e.texture,o=s.format,l=s.type;if(!K.textureFormatReadable(o))return;if(!K.textureTypeReadable(l))return;t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ye.readPixels(t,n,i,r,ge.convert(o),ge.convert(l),a)}finally{const e=null!==E?J.get(E).__webglFramebuffer:null;Z.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,i,r,a,s){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){const s=e.texture,l=s.format,c=s.type;if(!K.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!K.textureTypeReadable(c))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r){Z.bindFramebuffer(ye.FRAMEBUFFER,o);const e=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.bufferData(ye.PIXEL_PACK_BUFFER,a.byteLength,ye.STREAM_READ),ye.readPixels(t,n,i,r,ge.convert(l),ge.convert(c),0);const s=null!==E?J.get(E).__webglFramebuffer:null;Z.bindFramebuffer(ye.FRAMEBUFFER,s);const u=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);return ye.flush(),await function(e,t,n){return new Promise((function(i,r){setTimeout((function a(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:r();break;case e.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:i()}}),n)}))}(ye,u,4),ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,a),ye.deleteBuffer(e),ye.deleteSync(u),a}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t=null,n=0){!0!==e.isTexture&&(tk("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),a=Math.floor(e.image.height*i),s=null!==t?t.x:0,o=null!==t?t.y:0;ee.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,s,o,r,a),Z.unbindTexture()},this.copyTextureToTexture=function(e,t,n=null,i=null,r=0){let a,s,o,l,c,u,h,d,p;!0!==e.isTexture&&(tk("WebGLRenderer: copyTextureToTexture function signature has changed."),i=arguments[0]||null,e=arguments[1],t=arguments[2],r=arguments[3]||0,n=null);const f=e.isCompressedTexture?e.mipmaps[r]:e.image;null!==n?(a=n.max.x-n.min.x,s=n.max.y-n.min.y,o=n.isBox3?n.max.z-n.min.z:1,l=n.min.x,c=n.min.y,u=n.isBox3?n.min.z:0):(a=f.width,s=f.height,o=f.depth||1,l=0,c=0,u=0),null!==i?(h=i.x,d=i.y,p=i.z):(h=0,d=0,p=0);const m=ge.convert(t.format),g=ge.convert(t.type);let _;t.isData3DTexture?(ee.setTexture3D(t,0),_=ye.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(ee.setTexture2DArray(t,0),_=ye.TEXTURE_2D_ARRAY):(ee.setTexture2D(t,0),_=ye.TEXTURE_2D),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);const v=ye.getParameter(ye.UNPACK_ROW_LENGTH),y=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),x=ye.getParameter(ye.UNPACK_SKIP_PIXELS),w=ye.getParameter(ye.UNPACK_SKIP_ROWS),b=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,f.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,f.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,l),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,c),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,u);const E=e.isDataArrayTexture||e.isData3DTexture,M=t.isDataArrayTexture||t.isData3DTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const n=J.get(e),i=J.get(t),f=J.get(n.__renderTarget),m=J.get(i.__renderTarget);Z.bindFramebuffer(ye.READ_FRAMEBUFFER,f.__webglFramebuffer),Z.bindFramebuffer(ye.DRAW_FRAMEBUFFER,m.__webglFramebuffer);for(let g=0;g<o;g++)E&&ye.framebufferTextureLayer(ye.READ_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,J.get(e).__webglTexture,r,u+g),e.isDepthTexture?(M&&ye.framebufferTextureLayer(ye.DRAW_FRAMEBUFFER,ye.COLOR_ATTACHMENT0,J.get(t).__webglTexture,r,p+g),ye.blitFramebuffer(l,c,a,s,h,d,a,s,ye.DEPTH_BUFFER_BIT,ye.NEAREST)):M?ye.copyTexSubImage3D(_,r,h,d,p+g,l,c,a,s):ye.copyTexSubImage2D(_,r,h,d,p+g,l,c,a,s);Z.bindFramebuffer(ye.READ_FRAMEBUFFER,null),Z.bindFramebuffer(ye.DRAW_FRAMEBUFFER,null)}else M?e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(_,r,h,d,p,a,s,o,m,g,f.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(_,r,h,d,p,a,s,o,m,f.data):ye.texSubImage3D(_,r,h,d,p,a,s,o,m,g,f):e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,r,h,d,a,s,m,g,f.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,r,h,d,f.width,f.height,m,f.data):ye.texSubImage2D(ye.TEXTURE_2D,r,h,d,a,s,m,g,f);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,v),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,y),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,x),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,w),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,b),0===r&&t.generateMipmaps&&ye.generateMipmap(_),Z.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n=null,i=null,r=0){return!0!==e.isTexture&&(tk("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,e=arguments[2],t=arguments[3],r=arguments[4]||0),tk('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,i,r)},this.initRenderTarget=function(e){void 0===J.get(e).__webglFramebuffer&&ee.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?ee.setTextureCube(e,0):e.isData3DTexture?ee.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?ee.setTexture2DArray(e,0):ee.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){w=0,b=0,E=null,Z.reset(),_e.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return UP}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=nk._getDrawingBufferColorSpace(e),t.unpackColorSpace=nk._getUnpackColorSpace()}}class UN extends TO{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new cO,this.environmentIntensity=1,this.environmentRotation=new cO,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class FN extends gk{constructor(e=null,t=1,n=1,i,r,a,s,o,l=1003,c=1003,u,h){super(null,a,s,o,l,c,i,r,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:FC}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=FC));const zN="RFC3986",BN={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},VN=Array.isArray,HN=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),WN=1024;function jN(e,t){if(VN(e)){const n=[];for(let i=0;i<e.length;i+=1)n.push(t(e[i]));return n}return t(e)}const GN=Object.prototype.hasOwnProperty,XN={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},qN=Array.isArray,YN=Array.prototype.push,$N=function(e,t){YN.apply(e,qN(t)?t:[t])},KN=Date.prototype.toISOString,ZN={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,n,i,r)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let s="";for(let o=0;o<a.length;o+=WN){const e=a.length>=WN?a.slice(o,o+WN):a,t=[];for(let n=0;n<e.length;++n){let i=e.charCodeAt(n);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122||"RFC1738"===r&&(40===i||41===i)?t[t.length]=e.charAt(n):i<128?t[t.length]=HN[i]:i<2048?t[t.length]=HN[192|i>>6]+HN[128|63&i]:i<55296||i>=57344?t[t.length]=HN[224|i>>12]+HN[128|i>>6&63]+HN[128|63&i]:(n+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(n)),t[t.length]=HN[240|i>>18]+HN[128|i>>12&63]+HN[128|i>>6&63]+HN[128|63&i])}s+=t.join("")}return s},encodeValuesOnly:!1,format:zN,formatter:BN[zN],indices:!1,serializeDate:e=>KN.call(e),skipNulls:!1,strictNullHandling:!1};const QN={};function JN(e,t,n,i,r,a,s,o,l,c,u,h,d,p,f,m,g,_){let v=e,y=_,x=0,w=!1;for(;void 0!==(y=y.get(QN))&&!w;){const t=y.get(e);if(x+=1,void 0!==t){if(t===x)throw new RangeError("Cyclic object value");w=!0}void 0===y.get(QN)&&(x=0)}if("function"==typeof c?v=c(t,v):v instanceof Date?v=null==d?void 0:d(v):"comma"===n&&qN(v)&&(v=jN(v,(function(e){return e instanceof Date?null==d?void 0:d(e):e}))),null===v){if(a)return l&&!m?l(t,ZN.encoder,g,"key",p):t;v=""}if("string"==typeof(b=v)||"number"==typeof b||"boolean"==typeof b||"symbol"==typeof b||"bigint"==typeof b||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(v)){if(l){const e=m?t:l(t,ZN.encoder,g,"key",p);return[(null==f?void 0:f(e))+"="+(null==f?void 0:f(l(v,ZN.encoder,g,"value",p)))]}return[(null==f?void 0:f(t))+"="+(null==f?void 0:f(String(v)))]}var b;const E=[];if(void 0===v)return E;let M;if("comma"===n&&qN(v))m&&l&&(v=jN(v,l)),M=[{value:v.length>0?v.join(",")||null:void 0}];else if(qN(c))M=c;else{const e=Object.keys(v);M=u?e.sort(u):e}const S=o?String(t).replace(/\./g,"%2E"):String(t),T=i&&qN(v)&&1===v.length?S+"[]":S;if(r&&qN(v)&&0===v.length)return T+"[]";for(let A=0;A<M.length;++A){const t=M[A],y="object"==typeof t&&void 0!==t.value?t.value:v[t];if(s&&null===y)continue;const w=h&&o?t.replace(/\./g,"%2E"):t,b=qN(v)?"function"==typeof n?n(T,w):T:T+(h?"."+w:"["+w+"]");_.set(e,x);const S=new WeakMap;S.set(QN,_),$N(E,JN(y,b,n,i,r,a,s,o,"comma"===n&&m&&qN(v)?null:l,c,u,h,d,p,f,m,g,S))}return E}function eU(e,t={}){let n=e;const i=function(e=ZN){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||ZN.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=zN;if(void 0!==e.format){if(!GN.call(BN,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const i=BN[n];let r,a=ZN.filter;if(("function"==typeof e.filter||qN(e.filter))&&(a=e.filter),r=e.arrayFormat&&e.arrayFormat in XN?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":ZN.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const s=void 0===e.allowDots?1==!!e.encodeDotInKeys||ZN.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:ZN.addQueryPrefix,allowDots:s,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:ZN.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:ZN.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?ZN.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:ZN.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:ZN.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:ZN.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:ZN.encodeValuesOnly,filter:a,format:n,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:ZN.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:ZN.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:ZN.strictNullHandling}}(t);let r,a;"function"==typeof i.filter?(a=i.filter,n=a("",n)):qN(i.filter)&&(a=i.filter,r=a);const s=[];if("object"!=typeof n||null===n)return"";const o=XN[i.arrayFormat],l="comma"===o&&i.commaRoundTrip;r||(r=Object.keys(n)),i.sort&&r.sort(i.sort);const c=new WeakMap;for(let d=0;d<r.length;++d){const e=r[d];i.skipNulls&&null===n[e]||$N(s,JN(n[e],e,o,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}const u=s.join(i.delimiter);let h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}const tU="4.94.0";let nU,iU,rU,aU,sU,oU,lU,cU,uU,hU=!1;class dU{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}const pU=()=>{nU||function(e,t={auto:!1}){if(hU)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(nU)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${nU}'\``);hU=t.auto,nU=e.kind,iU=e.fetch,rU=e.FormData,aU=e.File,sU=e.ReadableStream,oU=e.getMultipartRequestOptions,lU=e.getDefaultAgent,cU=e.fileFromPath,uU=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,i,r,a;try{n=fetch,i=Request,r=Response,a=Headers}catch(s){throw new Error(`this environment is missing the following Web Fetch API type: ${s.message}. ${t}`)}return{kind:"web",fetch:n,Request:i,Response:r,Headers:a,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new dU(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};pU();class fU extends Error{}class mU extends fU{constructor(e,t,n,i){super(`${mU.makeMessage(e,t,n)}`),this.status=e,this.headers=i,this.request_id=null==i?void 0:i["x-request-id"],this.error=t;const r=t;this.code=null==r?void 0:r.code,this.param=null==r?void 0:r.param,this.type=null==r?void 0:r.type}static makeMessage(e,t,n){const i=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,n,i){if(!e||!i)return new _U({message:n,cause:mF(t)});const r=null==t?void 0:t.error;return 400===e?new yU(e,r,n,i):401===e?new xU(e,r,n,i):403===e?new wU(e,r,n,i):404===e?new bU(e,r,n,i):409===e?new EU(e,r,n,i):422===e?new MU(e,r,n,i):429===e?new SU(e,r,n,i):e>=500?new TU(e,r,n,i):new mU(e,r,n,i)}}class gU extends mU{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class _U extends mU{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class vU extends _U{constructor({message:e}={}){super({message:e??"Request timed out."})}}class yU extends mU{}class xU extends mU{}class wU extends mU{}class bU extends mU{}class EU extends mU{}class MU extends mU{}class SU extends mU{}class TU extends mU{}class AU extends fU{constructor(){super("Could not parse response content as the length limit was reached")}}class CU extends fU{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var RU,PU=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},kU=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class OU{constructor(){RU.set(this,void 0),this.buffer=new Uint8Array,PU(this,RU,null,"f")}decode(e){if(null==e)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?(new TextEncoder).encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const i=[];let r;for(;null!=(r=IU(this.buffer,kU(this,RU,"f")));){if(r.carriage&&null==kU(this,RU,"f")){PU(this,RU,r.index,"f");continue}if(null!=kU(this,RU,"f")&&(r.index!==kU(this,RU,"f")+1||r.carriage)){i.push(this.decodeText(this.buffer.slice(0,kU(this,RU,"f")-1))),this.buffer=this.buffer.slice(kU(this,RU,"f")),PU(this,RU,null,"f");continue}const e=null!==kU(this,RU,"f")?r.preceding-1:r.preceding,t=this.decodeText(this.buffer.slice(0,e));i.push(t),this.buffer=this.buffer.slice(r.index),PU(this,RU,null,"f")}return i}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new fU(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new fU(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new fU("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function IU(e,t){for(let n=t??0;n<e.length;n++){if(10===e[n])return{preceding:n,index:n+1,carriage:!1};if(13===e[n])return{preceding:n,index:n+1,carriage:!0}}return null}function LU(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}function DU(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}RU=new WeakMap,OU.NEWLINE_CHARS=new Set(["\n","\r"]),OU.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class NU{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;return new NU((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const n of async function*(e,t){if(!e.body)throw t.abort(),new fU("Attempted to iterate over a response with no body");const n=new UU,i=new OU,r=DU(e.body);for await(const a of async function*(e){let t=new Uint8Array;for await(const n of e){if(null==n)continue;const e=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?(new TextEncoder).encode(n):n;let i,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(i=LU(t));)yield t.slice(0,i),t=t.slice(i)}t.length>0&&(yield t)}(r))for(const e of i.decode(a)){const t=n.decode(e);t&&(yield t)}for(const a of i.flush()){const e=n.decode(a);e&&(yield e)}}(e,t))if(!i)if(n.data.startsWith("[DONE]"))i=!0;else if(null===n.event||n.event.startsWith("response.")||n.event.startsWith("transcript.")){let t;try{t=JSON.parse(n.data)}catch(r){throw r}if(t&&t.error)throw new mU(void 0,t.error,void 0,nF(e.headers));yield t}else{let e;try{e=JSON.parse(n.data)}catch(r){throw r}if("error"==n.event)throw new mU(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}i=!0}catch(r){if(r instanceof Error&&"AbortError"===r.name)return;throw r}finally{i||t.abort()}}),t)}static fromReadableStream(e,t){let n=!1;return new NU((async function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const t of async function*(){const t=new OU,n=DU(e);for await(const e of n)for(const n of t.decode(e))yield n;for(const e of t.flush())yield e}())i||t&&(yield JSON.parse(t));i=!0}catch(r){if(r instanceof Error&&"AbortError"===r.name)return;throw r}finally{i||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),i=i=>({next:()=>{if(0===i.length){const i=n.next();e.push(i),t.push(i)}return i.shift()}});return[new NU((()=>i(e)),this.controller),new NU((()=>i(t)),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new sU({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:i,done:r}=await t.next();if(r)return e.close();const a=n.encode(JSON.stringify(i)+"\n");e.enqueue(a)}catch(i){e.error(i)}},async cancel(){var e;await(null==(e=t.return)?void 0:e.call(t))}})}}class UU{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,i]=function(e,t){const n=e.indexOf(t);if(-1!==n)return[e.substring(0,n),t,e.substring(n+t.length)];return[e,"",""]}(e,":");return i.startsWith(" ")&&(i=i.substring(1)),"event"===t?this.event=i:"data"===t&&this.data.push(i),null}}const FU=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,zU=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&BU(e),BU=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function VU(e,t,n){var i;if(e=await e,zU(e))return e;if(FU(e)){const i=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const r=BU(i)?[await i.arrayBuffer()]:[i];return new aU(r,t,n)}const r=await async function(e){var t;let n=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)n.push(e);else if(BU(e))n.push(await e.arrayBuffer());else{if(!WU(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${null==(t=null==e?void 0:e.constructor)?void 0:t.name}; props: ${function(e){const t=Object.getOwnPropertyNames(e);return`[${t.map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const t of e)n.push(t)}return n}(e);if(t||(t=function(e){var t;return HU(e.name)||HU(e.filename)||(null==(t=HU(e.path))?void 0:t.split(/[\\/]/).pop())}(e)??"unknown_file"),!(null==n?void 0:n.type)){const e=null==(i=r[0])?void 0:i.type;"string"==typeof e&&(n={...n,type:e})}return new aU(r,t,n)}const HU=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,WU=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],jU=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],GU=async e=>{const t=await XU(e.body);return oU(t,e)},XU=async e=>{const t=new rU;return await Promise.all(Object.entries(e||{}).map((([e,n])=>qU(t,e,n)))),t},qU=async(e,t,n)=>{if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((e=>zU(e)||FU(e)||uU(e))(n)){const i=await VU(n);e.append(t,i)}else if(Array.isArray(n))await Promise.all(n.map((n=>qU(e,t+"[]",n))));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);await Promise.all(Object.entries(n).map((([n,i])=>qU(e,`${t}[${n}]`,i))))}}};var YU,$U={};async function KU(e){var t;const{response:n}=e;if(e.options.stream)return wF("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller):NU.fromSSEResponse(n,e.controller);if(204===n.status)return null;if(e.options.__binaryResponse)return n;const i=n.headers.get("content-type"),r=null==(t=null==i?void 0:i.split(";")[0])?void 0:t.trim();if((null==r?void 0:r.includes("application/json"))||(null==r?void 0:r.endsWith("+json"))){const e=await n.json();return wF("response",n.status,n.url,n.headers,e),ZU(e,n)}const a=await n.text();return wF("response",n.status,n.url,n.headers,a),a}function ZU(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}pU();class QU extends Promise{constructor(e,t=KU){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new QU(this.responsePromise,(async t=>ZU(e(await this.parseResponse(t),t),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class JU{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:i,fetch:r}){this.baseURL=e,this.maxRetries=fF("maxRetries",t),this.timeout=fF("timeout",n),this.httpAgent=i,this.fetch=r??iU}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...cF(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${bF()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then((async n=>{const i=n&&BU(null==n?void 0:n.body)?new DataView(await n.body.arrayBuffer()):(null==n?void 0:n.body)instanceof DataView?n.body:(null==n?void 0:n.body)instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(null==n?void 0:n.body)?new DataView(n.body.buffer):null==n?void 0:n.body;return{method:e,path:t,...n,body:i}})))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var n;const i={...e},{method:r,path:a,query:s,headers:o={}}=i,l=ArrayBuffer.isView(i.body)||i.__binaryRequest&&"string"==typeof i.body?i.body:jU(i.body)?i.body.body:i.body?JSON.stringify(i.body,null,2):null,c=this.calculateContentLength(l),u=this.buildURL(a,s);"timeout"in i&&fF("timeout",i.timeout),i.timeout=i.timeout??this.timeout;const h=i.httpAgent??this.httpAgent??lU(u),d=i.timeout+1e3;"number"==typeof(null==(n=null==h?void 0:h.options)?void 0:n.timeout)&&d>(h.options.timeout??0)&&(h.options.timeout=d),this.idempotencyHeader&&"get"!==r&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:r,...l&&{body:l},headers:this.buildHeaders({options:i,headers:o,contentLength:c,retryCount:t}),...h&&{agent:h},signal:i.signal??null},url:u,timeout:i.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:i}){const r={};n&&(r["content-length"]=n);const a=this.defaultHeaders(e);return yF(r,a),yF(r,t),jU(e.body)&&"node"!==nU&&delete r["content-type"],void 0===EF(a,"x-stainless-retry-count")&&void 0===EF(t,"x-stainless-retry-count")&&(r["x-stainless-retry-count"]=String(i)),void 0===EF(a,"x-stainless-timeout")&&void 0===EF(t,"x-stainless-timeout")&&e.timeout&&(r["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,n,i){return mU.generate(e,t,n,i)}request(e,t=null){return new QU(this.makeRequest(e,t))}async makeRequest(e,t){var n,i;const r=await e,a=r.maxRetries??this.maxRetries;null==t&&(t=a),await this.prepareOptions(r);const{req:s,url:o,timeout:l}=this.buildRequest(r,{retryCount:a-t});if(await this.prepareRequest(s,{url:o,options:r}),wF("request",o,r,s.headers),null==(n=r.signal)?void 0:n.aborted)throw new gU;const c=new AbortController,u=await this.fetchWithTimeout(o,s,l,c).catch(mF);if(u instanceof Error){if(null==(i=r.signal)?void 0:i.aborted)throw new gU;if(t)return this.retryRequest(r,t);if("AbortError"===u.name)throw new vU;throw new _U({cause:u})}const h=nF(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){return wF(`response (error; ${`retrying, ${t} attempts remaining`})`,u.status,o,h),this.retryRequest(r,t,h)}const e=await u.text().catch((e=>mF(e).message)),n=uF(e),i=n?void 0:e;wF(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,o,h,i);throw this.makeStatusError(u.status,n,i,h)}return{response:u,options:r,controller:c}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new tF(this,n,e)}buildURL(e,t){const n=dF(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return _F(i)||(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new fU(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,n,i){const{signal:r,...a}=t||{};r&&r.addEventListener("abort",(()=>i.abort()));const s=setTimeout((()=>i.abort()),n),o={signal:i.signal,...a};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally((()=>{clearTimeout(s)}))}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,t,n){let i;const r=null==n?void 0:n["retry-after-ms"];if(r){const e=parseFloat(r);Number.isNaN(e)||(i=e)}const a=null==n?void 0:n["retry-after"];if(a&&!i){const e=parseFloat(a);i=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(i&&0<=i&&i<6e4)){const n=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,n)}return await pF(i),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const n=t-e;return Math.min(.5*Math.pow(2,n),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${tU}`}}class eF{constructor(e,t,n,i){YU.set(this,void 0),function(e,t,n,i,r){if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");t.set(e,n)}(this,YU,e),this.options=i,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new fU("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,i]of n)e.url.searchParams.set(t,i);t.query=void 0,t.path=e.url.toString()}return await function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)}(this,YU,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(YU=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class tF extends QU{constructor(e,t,n){super(t,(async t=>new n(e,t.response,await KU(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const nF=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),iF={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},rF=e=>"object"==typeof e&&null!==e&&!_F(e)&&Object.keys(e).every((e=>vF(iF,e))),aF=()=>{var e;if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tU,"X-Stainless-OS":oF(Deno.build.os),"X-Stainless-Arch":sF(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:(null==(e=Deno.version)?void 0:e.deno)??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tU,"X-Stainless-OS":oF(process.platform),"X-Stainless-Arch":sF(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const e=n.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const sF=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",oF=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let lF;const cF=()=>lF??(lF=aF()),uF=e=>{try{return JSON.parse(e)}catch(t){return}},hF=/^[a-z][a-z0-9+.-]*:/i,dF=e=>hF.test(e),pF=e=>new Promise((t=>setTimeout(t,e))),fF=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new fU(`${e} must be an integer`);if(t<0)throw new fU(`${e} must be a positive integer`);return t},mF=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},gF=e=>{var t,n,i,r;return"undefined"!=typeof process?(null==(t=null==$U?void 0:$U[e])?void 0:t.trim())??void 0:"undefined"!=typeof Deno?null==(r=null==(i=null==(n=Deno.env)?void 0:n.get)?void 0:i.call(n,e))?void 0:r.trim():void 0};function _F(e){if(!e)return!0;for(const t in e)return!1;return!0}function vF(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function yF(e,t){for(const n in t){if(!vF(t,n))continue;const i=n.toLowerCase();if(!i)continue;const r=t[n];null===r?delete e[i]:void 0!==r&&(e[i]=r)}}const xF=new Set(["authorization","api-key"]);function wF(e,...t){if("undefined"!=typeof process&&"true"===(null==$U?void 0:$U.DEBUG)){t.map((e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const n in e.headers)xF.has(n.toLowerCase())&&(t.headers[n]="REDACTED");return t}let t=null;for(const n in e)xF.has(n.toLowerCase())&&(t??(t={...e}),t[n]="REDACTED");return t??e}))}}const bF=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),EF=(e,t)=>{var n;const i=t.toLowerCase();if((e=>"function"==typeof(null==e?void 0:e.get))(e)){const r=(null==(n=t[0])?void 0:n.toUpperCase())+t.substring(1).replace(/([^\w])(\w)/g,((e,t,n)=>t+n.toUpperCase()));for(const n of[t,i,t.toUpperCase(),r]){const t=e.get(n);if(t)return t}}for(const[r,a]of Object.entries(e))if(r.toLowerCase()===i)return Array.isArray(a)?(a.length,a[0]):a};function MF(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class SF extends eF{constructor(e,t,n,i){super(e,t,n,i),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class TF extends eF{constructor(e,t,n,i){super(e,t,n,i),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var e;const t=this.getPaginatedItems();if(!t.length)return null;const n=null==(e=t[t.length-1])?void 0:e.id;return n?{params:{after:n}}:null}}class AF{constructor(e){this._client=e}}let CF=class extends AF{list(e,t={},n){return rF(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,kF,{query:t,...n})}},RF=class extends AF{constructor(){super(...arguments),this.messages=new CF(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return rF(e)?this.list({},e):this._client.getAPIList("/chat/completions",PF,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class PF extends TF{}class kF extends TF{}RF.ChatCompletionsPage=PF,RF.Messages=CF;let OF=class extends AF{constructor(){super(...arguments),this.completions=new RF(this._client)}};OF.Completions=RF,OF.ChatCompletionsPage=PF;class IF extends AF{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...null==t?void 0:t.headers},__binaryResponse:!0})}}class LF extends AF{create(e,t){return this._client.post("/audio/transcriptions",GU({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class DF extends AF{create(e,t){return this._client.post("/audio/translations",GU({body:e,...t,__metadata:{model:e.model}}))}}class NF extends AF{constructor(){super(...arguments),this.transcriptions=new LF(this._client),this.translations=new DF(this._client),this.speech=new IF(this._client)}}NF.Transcriptions=LF,NF.Translations=DF,NF.Speech=IF;class UF extends AF{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return rF(e)?this.list({},e):this._client.getAPIList("/batches",FF,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class FF extends TF{}UF.BatchesPage=FF;class zF extends AF{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}list(e={},t){return rF(e)?this.list({},e):this._client.getAPIList("/assistants",BF,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}}class BF extends TF{}function VF(e){return"function"==typeof e.parse}zF.AssistantsPage=BF;const HF=e=>"assistant"===(null==e?void 0:e.role),WF=e=>"function"===(null==e?void 0:e.role),jF=e=>"tool"===(null==e?void 0:e.role);var GF,XF,qF,YF,$F,KF,ZF,QF,JF,ez,tz,nz,iz,rz=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},az=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class sz{constructor(){GF.add(this),this.controller=new AbortController,XF.set(this,void 0),qF.set(this,(()=>{})),YF.set(this,(()=>{})),$F.set(this,void 0),KF.set(this,(()=>{})),ZF.set(this,(()=>{})),QF.set(this,{}),JF.set(this,!1),ez.set(this,!1),tz.set(this,!1),nz.set(this,!1),rz(this,XF,new Promise(((e,t)=>{rz(this,qF,e,"f"),rz(this,YF,t,"f")})),"f"),rz(this,$F,new Promise(((e,t)=>{rz(this,KF,e,"f"),rz(this,ZF,t,"f")})),"f"),az(this,XF,"f").catch((()=>{})),az(this,$F,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),az(this,GF,"m",iz).bind(this))}),0)}_connected(){this.ended||(az(this,qF,"f").call(this),this._emit("connect"))}get ended(){return az(this,JF,"f")}get errored(){return az(this,ez,"f")}get aborted(){return az(this,tz,"f")}abort(){this.controller.abort()}on(e,t){return(az(this,QF,"f")[e]||(az(this,QF,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=az(this,QF,"f")[e];if(!n)return this;const i=n.findIndex((e=>e.listener===t));return i>=0&&n.splice(i,1),this}once(e,t){return(az(this,QF,"f")[e]||(az(this,QF,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,n)=>{rz(this,nz,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)}))}async done(){rz(this,nz,!0,"f"),await az(this,$F,"f")}_emit(e,...t){if(az(this,JF,"f"))return;"end"===e&&(rz(this,JF,!0,"f"),az(this,KF,"f").call(this));const n=az(this,QF,"f")[e];if(n&&(az(this,QF,"f")[e]=n.filter((e=>!e.once)),n.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return az(this,nz,"f")||(null==n?void 0:n.length)||Promise.reject(e),az(this,YF,"f").call(this,e),az(this,ZF,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];az(this,nz,"f")||(null==n?void 0:n.length)||Promise.reject(e),az(this,YF,"f").call(this,e),az(this,ZF,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function oz(e){return"auto-parseable-response-format"===(null==e?void 0:e.$brand)}function lz(e){return"auto-parseable-tool"===(null==e?void 0:e.$brand)}function cz(e,t){const n=e.choices.map((e=>{var n;if("length"===e.finish_reason)throw new AU;if("content_filter"===e.finish_reason)throw new CU;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:(null==(n=e.message.tool_calls)?void 0:n.map((e=>function(e,t){var n;const i=null==(n=e.tools)?void 0:n.find((e=>{var n;return(null==(n=e.function)?void 0:n.name)===t.function.name}));return{...t,function:{...t.function,parsed_arguments:lz(i)?i.$parseRaw(t.function.arguments):(null==i?void 0:i.function.strict)?JSON.parse(t.function.arguments):null}}}(t,e))))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?uz(t,e.message.content):null}}}));return{...e,choices:n}}function uz(e,t){var n,i;if("json_schema"!==(null==(n=e.response_format)?void 0:n.type))return null;if("json_schema"===(null==(i=e.response_format)?void 0:i.type)){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function hz(e,t){var n;if(!e)return!1;const i=null==(n=e.tools)?void 0:n.find((e=>{var n;return(null==(n=e.function)?void 0:n.name)===t.function.name}));return lz(i)||(null==i?void 0:i.function.strict)||!1}function dz(e){var t;return!!oz(e.response_format)||((null==(t=e.tools)?void 0:t.some((e=>lz(e)||"function"===e.type&&!0===e.function.strict)))??!1)}XF=new WeakMap,qF=new WeakMap,YF=new WeakMap,$F=new WeakMap,KF=new WeakMap,ZF=new WeakMap,QF=new WeakMap,JF=new WeakMap,ez=new WeakMap,tz=new WeakMap,nz=new WeakMap,GF=new WeakSet,iz=function(e){if(rz(this,ez,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new gU),e instanceof gU)return rz(this,tz,!0,"f"),this._emit("abort",e);if(e instanceof fU)return this._emit("error",e);if(e instanceof Error){const t=new fU(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new fU(String(e)))};var pz,fz,mz,gz,_z,vz,yz,xz,wz=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};const bz=10;class Ez extends sz{constructor(){super(...arguments),pz.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var t;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=null==(t=e.choices[0])?void 0:t.message;return n&&this._addMessage(n),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(WF(e)||jF(e))&&e.content)this._emit("functionCallResult",e.content);else if(HF(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(HF(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionCall",n.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new fU("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),wz(this,pz,"m",fz).call(this)}async finalMessage(){return await this.done(),wz(this,pz,"m",mz).call(this)}async finalFunctionCall(){return await this.done(),wz(this,pz,"m",gz).call(this)}async finalFunctionCallResult(){return await this.done(),wz(this,pz,"m",_z).call(this)}async totalUsage(){return await this.done(),wz(this,pz,"m",vz).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=wz(this,pz,"m",mz).call(this);t&&this._emit("finalMessage",t);const n=wz(this,pz,"m",fz).call(this);n&&this._emit("finalContent",n);const i=wz(this,pz,"m",gz).call(this);i&&this._emit("finalFunctionCall",i);const r=wz(this,pz,"m",_z).call(this);null!=r&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",wz(this,pz,"m",vz).call(this))}async _createChatCompletion(e,t,n){const i=null==n?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort()))),wz(this,pz,"m",yz).call(this,t);const r=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(cz(r,t))}async _runChatCompletion(e,t,n){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var i;const r="function",{function_call:a="auto",stream:s,...o}=t,l="string"!=typeof a&&(null==a?void 0:a.name),{maxChatCompletions:c=bz}=n||{},u={};for(const p of t.functions)u[p.name||p.function.name]=p;const h=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){const t=null==(i=(await this._createChatCompletion(e,{...o,function_call:a,functions:h,messages:[...this.messages]},n)).choices[0])?void 0:i.message;if(!t)throw new fU("missing message in ChatCompletion response");if(!t.function_call)return;const{name:s,arguments:c}=t.function_call,p=u[s];if(!p){const e=`Invalid function_call: ${JSON.stringify(s)}. Available options are: ${h.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:r,name:s,content:e});continue}if(l&&l!==s){const e=`Invalid function_call: ${JSON.stringify(s)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:r,name:s,content:e});continue}let f;try{f=VF(p)?await p.parse(c):c}catch(d){this._addMessage({role:r,name:s,content:d instanceof Error?d.message:String(d)});continue}const m=await p.function(f,this),g=wz(this,pz,"m",xz).call(this,m);if(this._addMessage({role:r,name:s,content:g}),l)return}}async _runTools(e,t,n){var i,r,a;const s="tool",{tool_choice:o="auto",stream:l,...c}=t,u="string"!=typeof o&&(null==(i=null==o?void 0:o.function)?void 0:i.name),{maxChatCompletions:h=bz}=n||{},d=t.tools.map((e=>{if(lz(e)){if(!e.$callback)throw new fU("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),p={};for(const g of d)"function"===g.type&&(p[g.function.name||g.function.function.name]=g.function);const f="tools"in t?d.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const g of t.messages)this._addMessage(g,!1);for(let g=0;g<h;++g){const t=null==(r=(await this._createChatCompletion(e,{...c,tool_choice:o,tools:f,messages:[...this.messages]},n)).choices[0])?void 0:r.message;if(!t)throw new fU("missing message in ChatCompletion response");if(!(null==(a=t.tool_calls)?void 0:a.length))return;for(const e of t.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:n,arguments:i}=e.function,r=p[n];if(!r){const e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(p).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:t,content:e});continue}if(u&&u!==n){const e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:t,content:e});continue}let a;try{a=VF(r)?await r.parse(i):i}catch(m){const e=m instanceof Error?m.message:String(m);this._addMessage({role:s,tool_call_id:t,content:e});continue}const o=await r.function(a,this),l=wz(this,pz,"m",xz).call(this,o);if(this._addMessage({role:s,tool_call_id:t,content:l}),u)return}}}}pz=new WeakSet,fz=function(){return wz(this,pz,"m",mz).call(this).content??null},mz=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(HF(t)){const{function_call:e,...n}=t,i={...n,content:t.content??null,refusal:t.refusal??null};return e&&(i.function_call=e),i}}throw new fU("stream ended without producing a ChatCompletionMessage with role=assistant")},gz=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const i=this.messages[n];if(HF(i)&&(null==i?void 0:i.function_call))return i.function_call;if(HF(i)&&(null==(e=null==i?void 0:i.tool_calls)?void 0:e.length))return null==(t=i.tool_calls.at(-1))?void 0:t.function}},_z=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(WF(t)&&null!=t.content)return t.content;if(jF(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>{var n;return"assistant"===e.role&&(null==(n=e.tool_calls)?void 0:n.some((e=>"function"===e.type&&e.id===t.tool_call_id)))})))return t.content}},vz=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},yz=function(e){if(null!=e.n&&e.n>1)throw new fU("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},xz=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Mz extends Ez{static runFunctions(e,t,n){const i=new Mz,r={...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run((()=>i._runFunctions(e,t,r))),i}static runTools(e,t,n){const i=new Mz,r={...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run((()=>i._runTools(e,t,r))),i}_addMessage(e,t=!0){super._addMessage(e,t),HF(e)&&e.content&&this._emit("content",e.content)}}const Sz=1,Tz=2,Az=4,Cz=8,Rz=16,Pz=32,kz=64,Oz=128,Iz=256,Lz=511;class Dz extends Error{}class Nz extends Error{}const Uz=(e,t)=>{const n=e.length;let i=0;const r=e=>{throw new Dz(`${e} at position ${i}`)},a=e=>{throw new Nz(`${e} at position ${i}`)},s=()=>(h(),i>=n&&r("Unexpected end of input"),'"'===e[i]?o():"{"===e[i]?l():"["===e[i]?c():"null"===e.substring(i,i+4)||Rz&t&&n-i<4&&"null".startsWith(e.substring(i))?(i+=4,null):"true"===e.substring(i,i+4)||Pz&t&&n-i<4&&"true".startsWith(e.substring(i))?(i+=4,!0):"false"===e.substring(i,i+5)||Pz&t&&n-i<5&&"false".startsWith(e.substring(i))?(i+=5,!1):"Infinity"===e.substring(i,i+8)||Oz&t&&n-i<8&&"Infinity".startsWith(e.substring(i))?(i+=8,1/0):"-Infinity"===e.substring(i,i+9)||Iz&t&&1<n-i&&n-i<9&&"-Infinity".startsWith(e.substring(i))?(i+=9,-1/0):"NaN"===e.substring(i,i+3)||kz&t&&n-i<3&&"NaN".startsWith(e.substring(i))?(i+=3,NaN):u()),o=()=>{const s=i;let o=!1;for(i++;i<n&&('"'!==e[i]||o&&"\\"===e[i-1]);)o="\\"===e[i]&&!o,i++;if('"'==e.charAt(i))try{return JSON.parse(e.substring(s,++i-Number(o)))}catch(l){a(String(l))}else if(Sz&t)try{return JSON.parse(e.substring(s,i-Number(o))+'"')}catch(l){return JSON.parse(e.substring(s,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{i++,h();const a={};try{for(;"}"!==e[i];){if(h(),i>=n&&Cz&t)return a;const r=o();h(),i++;try{const e=s();Object.defineProperty(a,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(l){if(Cz&t)return a;throw l}h(),","===e[i]&&i++}}catch(l){if(Cz&t)return a;r("Expected '}' at end of object")}return i++,a},c=()=>{i++;const n=[];try{for(;"]"!==e[i];)n.push(s()),h(),","===e[i]&&i++}catch(a){if(Az&t)return n;r("Expected ']' at end of array")}return i++,n},u=()=>{if(0===i){"-"===e&&Tz&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(o){if(Tz&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(l){}a(String(o))}}const s=i;for("-"===e[i]&&i++;e[i]&&!",]}".includes(e[i]);)i++;i!=n||Tz&t||r("Unterminated number literal");try{return JSON.parse(e.substring(s,i))}catch(o){"-"===e.substring(s,i)&&Tz&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(s,e.lastIndexOf("e")))}catch(l){a(String(l))}}},h=()=>{for(;i<n&&" \n\r\t".includes(e[i]);)i++};return s()},Fz=e=>function(e,t=Lz){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return Uz(e.trim(),t)}(e,Lz^Tz);var zz,Bz,Vz,Hz,Wz,jz,Gz,Xz,qz,Yz,$z,Kz,Zz=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},Qz=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class Jz extends Ez{constructor(e){super(),zz.add(this),Bz.set(this,void 0),Vz.set(this,void 0),Hz.set(this,void 0),Zz(this,Bz,e,"f"),Zz(this,Vz,[],"f")}get currentChatCompletionSnapshot(){return Qz(this,Hz,"f")}static fromReadableStream(e){const t=new Jz(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,n){const i=new Jz(t);return i._run((()=>i._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}}))),i}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const r=null==n?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),Qz(this,zz,"m",Wz).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const s of a)Qz(this,zz,"m",Gz).call(this,s);if(null==(i=a.controller.signal)?void 0:i.aborted)throw new gU;return this._addChatCompletion(Qz(this,zz,"m",Yz).call(this))}async _fromReadableStream(e,t){var n;const i=null==t?void 0:t.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort()))),Qz(this,zz,"m",Wz).call(this),this._connected();const r=NU.fromReadableStream(e,this.controller);let a;for await(const s of r)a&&a!==s.id&&this._addChatCompletion(Qz(this,zz,"m",Yz).call(this)),Qz(this,zz,"m",Gz).call(this,s),a=s.id;if(null==(n=r.controller.signal)?void 0:n.aborted)throw new gU;return this._addChatCompletion(Qz(this,zz,"m",Yz).call(this))}[(Bz=new WeakMap,Vz=new WeakMap,Hz=new WeakMap,zz=new WeakSet,Wz=function(){this.ended||Zz(this,Hz,void 0,"f")},jz=function(e){let t=Qz(this,Vz,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Qz(this,Vz,"f")[e.index]=t,t)},Gz=function(e){var t,n,i,r,a,s,o,l,c,u,h,d,p,f,m;if(this.ended)return;const g=Qz(this,zz,"m",Kz).call(this,e);this._emit("chunk",e,g);for(const _ of e.choices){const e=g.choices[_.index];null!=_.delta.content&&"assistant"===(null==(t=e.message)?void 0:t.role)&&(null==(n=e.message)?void 0:n.content)&&(this._emit("content",_.delta.content,e.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=_.delta.refusal&&"assistant"===(null==(i=e.message)?void 0:i.role)&&(null==(r=e.message)?void 0:r.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:e.message.refusal}),null!=(null==(a=_.logprobs)?void 0:a.content)&&"assistant"===(null==(s=e.message)?void 0:s.role)&&this._emit("logprobs.content.delta",{content:null==(o=_.logprobs)?void 0:o.content,snapshot:(null==(l=e.logprobs)?void 0:l.content)??[]}),null!=(null==(c=_.logprobs)?void 0:c.refusal)&&"assistant"===(null==(u=e.message)?void 0:u.role)&&this._emit("logprobs.refusal.delta",{refusal:null==(h=_.logprobs)?void 0:h.refusal,snapshot:(null==(d=e.logprobs)?void 0:d.refusal)??[]});const v=Qz(this,zz,"m",jz).call(this,e);e.finish_reason&&(Qz(this,zz,"m",qz).call(this,e),null!=v.current_tool_call_index&&Qz(this,zz,"m",Xz).call(this,e,v.current_tool_call_index));for(const t of _.delta.tool_calls??[])v.current_tool_call_index!==t.index&&(Qz(this,zz,"m",qz).call(this,e),null!=v.current_tool_call_index&&Qz(this,zz,"m",Xz).call(this,e,v.current_tool_call_index)),v.current_tool_call_index=t.index;for(const t of _.delta.tool_calls??[]){const n=null==(p=e.message.tool_calls)?void 0:p[t.index];(null==n?void 0:n.type)&&("function"===(null==n?void 0:n.type)?this._emit("tool_calls.function.arguments.delta",{name:null==(f=n.function)?void 0:f.name,index:t.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:(null==(m=t.function)?void 0:m.arguments)??""}):null==n||n.type)}}},Xz=function(e,t){var n,i,r;if(Qz(this,zz,"m",jz).call(this,e).done_tool_calls.has(t))return;const a=null==(n=e.message.tool_calls)?void 0:n[t];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if("function"===a.type){const e=null==(r=null==(i=Qz(this,Bz,"f"))?void 0:i.tools)?void 0:r.find((e=>"function"===e.type&&e.function.name===a.function.name));this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:t,arguments:a.function.arguments,parsed_arguments:lz(e)?e.$parseRaw(a.function.arguments):(null==e?void 0:e.function.strict)?JSON.parse(a.function.arguments):null})}else a.type},qz=function(e){var t,n;const i=Qz(this,zz,"m",jz).call(this,e);if(e.message.content&&!i.content_done){i.content_done=!0;const t=Qz(this,zz,"m",$z).call(this);this._emit("content.done",{content:e.message.content,parsed:t?t.$parseRaw(e.message.content):null})}e.message.refusal&&!i.refusal_done&&(i.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),(null==(t=e.logprobs)?void 0:t.content)&&!i.logprobs_content_done&&(i.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),(null==(n=e.logprobs)?void 0:n.refusal)&&!i.logprobs_refusal_done&&(i.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Yz=function(){if(this.ended)throw new fU("stream has ended, this shouldn't happen");const e=Qz(this,Hz,"f");if(!e)throw new fU("request ended without sending any chunks");return Zz(this,Hz,void 0,"f"),Zz(this,Vz,[],"f"),function(e,t){const{id:n,choices:i,created:r,model:a,system_fingerprint:s,...o}=e,l={...o,id:n,choices:i.map((({message:t,finish_reason:n,index:i,logprobs:r,...a})=>{if(!n)throw new fU(`missing finish_reason for choice ${i}`);const{content:s=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new fU(`missing role for choice ${i}`);if(o){const{arguments:e,name:l}=o;if(null==e)throw new fU(`missing function_call.arguments for choice ${i}`);if(!l)throw new fU(`missing function_call.name for choice ${i}`);return{...a,message:{content:s,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:n,index:i,logprobs:r}}return l?{...a,index:i,finish_reason:n,logprobs:r,message:{...c,role:u,content:s,refusal:t.refusal??null,tool_calls:l.map(((t,n)=>{const{function:r,type:a,id:s,...o}=t,{arguments:l,name:c,...u}=r||{};if(null==s)throw new fU(`missing choices[${i}].tool_calls[${n}].id\n${eB(e)}`);if(null==a)throw new fU(`missing choices[${i}].tool_calls[${n}].type\n${eB(e)}`);if(null==c)throw new fU(`missing choices[${i}].tool_calls[${n}].function.name\n${eB(e)}`);if(null==l)throw new fU(`missing choices[${i}].tool_calls[${n}].function.arguments\n${eB(e)}`);return{...o,id:s,type:a,function:{...u,name:c,arguments:l}}}))}}:{...a,message:{...c,content:s,role:u,refusal:t.refusal??null},finish_reason:n,index:i,logprobs:r}})),created:r,model:a,object:"chat.completion",...s?{system_fingerprint:s}:{}};return function(e,t){return t&&dz(t)?cz(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}})))}}(l,t)}(e,Qz(this,Bz,"f"))},$z=function(){var e;const t=null==(e=Qz(this,Bz,"f"))?void 0:e.response_format;return oz(t)?t:null},Kz=function(e){var t,n,i,r;let a=Qz(this,Hz,"f");const{choices:s,...o}=e;a?Object.assign(a,o):a=Zz(this,Hz,{...o,choices:[]},"f");for(const{delta:l,finish_reason:c,index:u,logprobs:h=null,...d}of e.choices){let e=a.choices[u];if(e||(e=a.choices[u]={finish_reason:c,index:u,message:{},logprobs:h,...d}),h)if(e.logprobs){const{content:i,refusal:r,...a}=h;Object.assign(e.logprobs,a),i&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...i)),r&&((n=e.logprobs).refusal??(n.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},h);if(c&&(e.finish_reason=c,Qz(this,Bz,"f")&&dz(Qz(this,Bz,"f")))){if("length"===c)throw new AU;if("content_filter"===c)throw new CU}if(Object.assign(e,d),!l)continue;const{content:s,refusal:o,function_call:p,role:f,tool_calls:m,...g}=l;if(Object.assign(e.message,g),o&&(e.message.refusal=(e.message.refusal||"")+o),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((i=e.message.function_call).arguments??(i.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),s&&(e.message.content=(e.message.content||"")+s,!e.message.refusal&&Qz(this,zz,"m",$z).call(this)&&(e.message.parsed=Fz(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:n,type:i,function:a,...s}of m){const o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,s),n&&(o.id=n),i&&(o.type=i),a&&(o.function??(o.function={name:a.name??"",arguments:""})),(null==a?void 0:a.name)&&(o.function.name=a.name),(null==a?void 0:a.arguments)&&(o.function.arguments+=a.arguments,hz(Qz(this,Bz,"f"),o)&&(o.function.parsed_arguments=Fz(o.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",(n=>{const i=t.shift();i?i.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new NU(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function eB(e){return JSON.stringify(e)}class tB extends Jz{static fromReadableStream(e){const t=new tB(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,n){const i=new tB(null),r={...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run((()=>i._runFunctions(e,t,r))),i}static runTools(e,t,n){const i=new tB(t),r={...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run((()=>i._runTools(e,t,r))),i}}let nB=class extends AF{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new fU(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new fU(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...null==t?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>cz(t,e)))}runFunctions(e,t){return e.stream?tB.runFunctions(this._client,e,t):Mz.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?tB.runTools(this._client,e,t):Mz.runTools(this._client,e,t)}stream(e,t){return Jz.createChatCompletion(this._client,e,t)}};class iB extends AF{constructor(){super(...arguments),this.completions=new nB(this._client)}}(iB||(iB={})).Completions=nB;class rB extends AF{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}}class aB extends AF{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}}class sB extends AF{constructor(){super(...arguments),this.sessions=new rB(this._client),this.transcriptionSessions=new aB(this._client)}}sB.Sessions=rB,sB.TranscriptionSessions=aB;var oB,lB,cB,uB,hB,dB,pB,fB,mB,gB,_B,vB,yB,xB,wB,bB,EB,MB,SB,TB,AB,CB,RB=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},PB=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n};class kB extends sz{constructor(){super(...arguments),oB.add(this),lB.set(this,[]),cB.set(this,{}),uB.set(this,{}),hB.set(this,void 0),dB.set(this,void 0),pB.set(this,void 0),fB.set(this,void 0),mB.set(this,void 0),gB.set(this,void 0),_B.set(this,void 0),vB.set(this,void 0),yB.set(this,void 0)}[(lB=new WeakMap,cB=new WeakMap,uB=new WeakMap,hB=new WeakMap,dB=new WeakMap,pB=new WeakMap,fB=new WeakMap,mB=new WeakMap,gB=new WeakMap,_B=new WeakMap,vB=new WeakMap,yB=new WeakMap,oB=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const i=t.shift();i?i.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new kB;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){var n;const i=null==t?void 0:t.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const r=NU.fromReadableStream(e,this.controller);for await(const a of r)RB(this,oB,"m",xB).call(this,a);if(null==(n=r.controller.signal)?void 0:n.aborted)throw new gU;return this._addRun(RB(this,oB,"m",wB).call(this))}toReadableStream(){return new NU(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,i,r){const a=new kB;return a._run((()=>a._runToolAssistantStream(e,t,n,i,{...r,headers:{...null==r?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}}))),a}async _createToolAssistantStream(e,t,n,i,r){var a;const s=null==r?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort())));const o={...i,stream:!0},l=await e.submitToolOutputs(t,n,o,{...r,signal:this.controller.signal});this._connected();for await(const c of l)RB(this,oB,"m",xB).call(this,c);if(null==(a=l.controller.signal)?void 0:a.aborted)throw new gU;return this._addRun(RB(this,oB,"m",wB).call(this))}static createThreadAssistantStream(e,t,n){const i=new kB;return i._run((()=>i._threadAssistantStream(e,t,{...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}}))),i}static createAssistantStream(e,t,n,i){const r=new kB;return r._run((()=>r._runAssistantStream(e,t,n,{...i,headers:{...null==i?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}}))),r}currentEvent(){return RB(this,_B,"f")}currentRun(){return RB(this,vB,"f")}currentMessageSnapshot(){return RB(this,hB,"f")}currentRunStepSnapshot(){return RB(this,yB,"f")}async finalRunSteps(){return await this.done(),Object.values(RB(this,cB,"f"))}async finalMessages(){return await this.done(),Object.values(RB(this,uB,"f"))}async finalRun(){if(await this.done(),!RB(this,dB,"f"))throw Error("Final run was not received.");return RB(this,dB,"f")}async _createThreadAssistantStream(e,t,n){var i;const r=null==n?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const a={...t,stream:!0},s=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const o of s)RB(this,oB,"m",xB).call(this,o);if(null==(i=s.controller.signal)?void 0:i.aborted)throw new gU;return this._addRun(RB(this,oB,"m",wB).call(this))}async _createAssistantStream(e,t,n,i){var r;const a=null==i?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",(()=>this.controller.abort())));const s={...n,stream:!0},o=await e.create(t,s,{...i,signal:this.controller.signal});this._connected();for await(const l of o)RB(this,oB,"m",xB).call(this,l);if(null==(r=o.controller.signal)?void 0:r.aborted)throw new gU;return this._addRun(RB(this,oB,"m",wB).call(this))}static accumulateDelta(e,t){for(const[n,i]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let t=e[n];if(null!=t)if("index"!==n&&"type"!==n){if("string"==typeof t&&"string"==typeof i)t+=i;else if("number"==typeof t&&"number"==typeof i)t+=i;else{if(!MF(t)||!MF(i)){if(Array.isArray(t)&&Array.isArray(i)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...i);continue}for(const e of i){if(!MF(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const n=e.index;if(null==n)throw new Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);const i=t[n];null==i?t.push(e):t[n]=this.accumulateDelta(i,e)}continue}throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${t}`)}t=this.accumulateDelta(t,i)}e[n]=t}else e[n]=i;else e[n]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,i){return await this._createAssistantStream(t,e,n,i)}async _runToolAssistantStream(e,t,n,i,r){return await this._createToolAssistantStream(n,e,t,i,r)}}xB=function(e){if(!this.ended)switch(PB(this,_B,e,"f"),RB(this,oB,"m",MB).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":RB(this,oB,"m",CB).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":RB(this,oB,"m",EB).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":RB(this,oB,"m",bB).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},wB=function(){if(this.ended)throw new fU("stream has ended, this shouldn't happen");if(!RB(this,dB,"f"))throw Error("Final run has not been received");return RB(this,dB,"f")},bB=function(e){const[t,n]=RB(this,oB,"m",TB).call(this,e,RB(this,hB,"f"));PB(this,hB,t,"f"),RB(this,uB,"f")[t.id]=t;for(const i of n){const e=t.content[i.index];"text"==(null==e?void 0:e.type)&&this._emit("textCreated",e.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if("text"==n.type&&n.text){let e=n.text,i=t.content[n.index];if(!i||"text"!=i.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,i.text)}if(n.index!=RB(this,pB,"f")){if(RB(this,fB,"f"))switch(RB(this,fB,"f").type){case"text":this._emit("textDone",RB(this,fB,"f").text,RB(this,hB,"f"));break;case"image_file":this._emit("imageFileDone",RB(this,fB,"f").image_file,RB(this,hB,"f"))}PB(this,pB,n.index,"f")}PB(this,fB,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==RB(this,pB,"f")){const t=e.data.content[RB(this,pB,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,RB(this,hB,"f"));break;case"text":this._emit("textDone",t.text,RB(this,hB,"f"))}}RB(this,hB,"f")&&this._emit("messageDone",e.data),PB(this,hB,void 0,"f")}},EB=function(e){const t=RB(this,oB,"m",SB).call(this,e);switch(PB(this,yB,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of n.step_details.tool_calls)e.index==RB(this,mB,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(RB(this,gB,"f")&&this._emit("toolCallDone",RB(this,gB,"f")),PB(this,mB,e.index,"f"),PB(this,gB,t.step_details.tool_calls[e.index],"f"),RB(this,gB,"f")&&this._emit("toolCallCreated",RB(this,gB,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":PB(this,yB,void 0,"f");"tool_calls"==e.data.step_details.type&&RB(this,gB,"f")&&(this._emit("toolCallDone",RB(this,gB,"f")),PB(this,gB,void 0,"f")),this._emit("runStepDone",e.data,t)}},MB=function(e){RB(this,lB,"f").push(e),this._emit("event",e)},SB=function(e){switch(e.event){case"thread.run.step.created":return RB(this,cB,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=RB(this,cB,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const i=kB.accumulateDelta(t,n.delta);RB(this,cB,"f")[e.data.id]=i}return RB(this,cB,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":RB(this,cB,"f")[e.data.id]=e.data}if(RB(this,cB,"f")[e.data.id])return RB(this,cB,"f")[e.data.id];throw new Error("No snapshot available")},TB=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const e of i.delta.content)if(e.index in t.content){let n=t.content[e.index];t.content[e.index]=RB(this,oB,"m",AB).call(this,e,n)}else t.content[e.index]=e,n.push(e);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},AB=function(e,t){return kB.accumulateDelta(t,e)},CB=function(e){switch(PB(this,vB,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":PB(this,dB,e.data,"f"),RB(this,gB,"f")&&(this._emit("toolCallDone",RB(this,gB,"f")),PB(this,gB,void 0,"f"))}};class OB extends AF{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}update(e,t,n,i){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...null==i?void 0:i.headers}})}list(e,t={},n){return rF(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,IB,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}}class IB extends TF{}OB.MessagesPage=IB;class LB extends AF{retrieve(e,t,n,i={},r){return rF(i)?this.retrieve(e,t,n,{},i):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...null==r?void 0:r.headers}})}list(e,t,n={},i){return rF(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,DB,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...null==i?void 0:i.headers}})}}class DB extends TF{}LB.RunStepsPage=DB;let NB=class extends AF{constructor(){super(...arguments),this.steps=new LB(this._client)}create(e,t,n){const{include:i,...r}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}update(e,t,n,i){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...null==i?void 0:i.headers}})}list(e,t={},n){return rF(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,UB,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}async createAndPoll(e,t,n){const i=await this.create(e,t,n);return await this.poll(e,i.id,n)}createAndStream(e,t,n){return kB.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const i={...null==n?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for((null==n?void 0:n.pollIntervalMs)&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,t,{...n,headers:{...null==n?void 0:n.headers,...i}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(null==n?void 0:n.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await pF(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,n){return kB.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,i){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...null==i?void 0:i.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,i){const r=await this.submitToolOutputs(e,t,n,i);return await this.poll(e,r.id,i)}submitToolOutputsStream(e,t,n,i){return kB.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,i)}};class UB extends TF{}NB.RunsPage=UB,NB.Steps=LB,NB.RunStepsPage=DB;class FB extends AF{constructor(){super(...arguments),this.runs=new NB(this._client),this.messages=new OB(this._client)}create(e={},t){return rF(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return kB.createThreadAssistantStream(e,this._client.beta.threads,t)}}FB.Runs=NB,FB.RunsPage=UB,FB.Messages=OB,FB.MessagesPage=IB;class zB extends AF{constructor(){super(...arguments),this.realtime=new sB(this._client),this.chat=new iB(this._client),this.assistants=new zF(this._client),this.threads=new FB(this._client)}}zB.Realtime=sB,zB.Assistants=zF,zB.AssistantsPage=BF,zB.Threads=FB;class BB extends AF{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class VB extends AF{create(e,t){const n=!!e.encoding_format;let i=n?e.encoding_format:"base64";n&&wF(0,"User defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:i},...t});return n?r:(wF(0,"Decoding base64 embeddings to float32 array"),r._thenUnwrap((e=>(e&&e.data&&e.data.forEach((e=>{const t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),n=t.length,i=new Uint8Array(n);for(let e=0;e<n;e++)i[e]=t.charCodeAt(e);return Array.from(new Float32Array(i.buffer))}})(t)})),e))))}}class HB extends AF{retrieve(e,t,n,i){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,i)}list(e,t,n={},i){return rF(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,WB,{query:n,...i})}}class WB extends TF{}HB.OutputItemListResponsesPage=WB;class jB extends AF{constructor(){super(...arguments),this.outputItems=new HB(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return rF(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,GB,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class GB extends TF{}jB.RunListResponsesPage=GB,jB.OutputItems=HB,jB.OutputItemListResponsesPage=WB;class XB extends AF{constructor(){super(...arguments),this.runs=new jB(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return rF(e)?this.list({},e):this._client.getAPIList("/evals",qB,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class qB extends TF{}XB.EvalListResponsesPage=qB,XB.Runs=jB,XB.RunListResponsesPage=GB;let YB=class extends AF{create(e,t){return this._client.post("/files",GU({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return rF(e)?this.list({},e):this._client.getAPIList("/files",$B,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...null==t?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){const i=new Set(["processed","error","deleted"]),r=Date.now();let a=await this.retrieve(e);for(;!a.status||!i.has(a.status);)if(await pF(t),a=await this.retrieve(e),Date.now()-r>n)throw new vU({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return a}};class $B extends TF{}YB.FileObjectsPage=$B;class KB extends AF{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,ZB,{body:t,method:"post",...n})}retrieve(e,t={},n){return rF(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions`,t)}}class ZB extends SF{}KB.PermissionCreateResponsesPage=ZB;let QB=class extends AF{constructor(){super(...arguments),this.permissions=new KB(this._client)}};QB.Permissions=KB,QB.PermissionCreateResponsesPage=ZB;class JB extends AF{list(e,t={},n){return rF(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,eV,{query:t,...n})}}class eV extends TF{}JB.FineTuningJobCheckpointsPage=eV;class tV extends AF{constructor(){super(...arguments),this.checkpoints=new JB(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return rF(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",nV,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return rF(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,iV,{query:t,...n})}}class nV extends TF{}class iV extends TF{}tV.FineTuningJobsPage=nV,tV.FineTuningJobEventsPage=iV,tV.Checkpoints=JB,tV.FineTuningJobCheckpointsPage=eV;class rV extends AF{constructor(){super(...arguments),this.jobs=new tV(this._client),this.checkpoints=new QB(this._client)}}rV.Jobs=tV,rV.FineTuningJobsPage=nV,rV.FineTuningJobEventsPage=iV,rV.Checkpoints=QB;class aV extends AF{createVariation(e,t){return this._client.post("/images/variations",GU({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",GU({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class sV extends AF{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",oV,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class oV extends SF{}sV.ModelsPage=oV;class lV extends AF{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function cV(e,t){return t&&function(e){var t;if(oz(null==(t=e.text)?void 0:t.format))return!0;return!1}(t)?uV(e,t):{...e,output_parsed:null,output:e.output.map((e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map((e=>({...e,parsed:null})))}:e))}}function uV(e,t){const n=e.output.map((e=>{if("function_call"===e.type)return{...e,parsed_arguments:dV(t,e)};if("message"===e.type){const n=e.content.map((e=>"output_text"===e.type?{...e,parsed:hV(t,e.text)}:e));return{...e,content:n}}return e})),i=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||pV(i),Object.defineProperty(i,"output_parsed",{enumerable:!0,get(){for(const e of i.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),i}function hV(e,t){var n,i,r,a;if("json_schema"!==(null==(i=null==(n=e.text)?void 0:n.format)?void 0:i.type))return null;if("$parseRaw"in(null==(r=e.text)?void 0:r.format)){return(null==(a=e.text)?void 0:a.format).$parseRaw(t)}return JSON.parse(t)}function dV(e,t){const n=(i=e.tools??[],r=t.name,i.find((e=>"function"===e.type&&e.name===r)));var i,r,a;return{...t,...t,parsed_arguments:(a=n,"auto-parseable-tool"===(null==a?void 0:a.$brand)?n.$parseRaw(t.arguments):(null==n?void 0:n.strict)?JSON.parse(t.arguments):null)}}function pV(e){const t=[];for(const n of e.output)if("message"===n.type)for(const e of n.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class fV extends AF{list(e,t={},n){return rF(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,AV,{query:t,...n})}}var mV,gV,_V,vV,yV,xV,wV,bV,EV=function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},MV=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class SV extends sz{constructor(e){super(),mV.add(this),gV.set(this,void 0),_V.set(this,void 0),vV.set(this,void 0),EV(this,gV,e,"f")}static createResponse(e,t,n){const i=new SV(t);return i._run((()=>i._createResponse(e,t,{...n,headers:{...null==n?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}}))),i}async _createResponse(e,t,n){var i;const r=null==n?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort()))),MV(this,mV,"m",yV).call(this);const a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const s of a)MV(this,mV,"m",xV).call(this,s);if(null==(i=a.controller.signal)?void 0:i.aborted)throw new gU;return MV(this,mV,"m",wV).call(this)}[(gV=new WeakMap,_V=new WeakMap,vV=new WeakMap,mV=new WeakSet,yV=function(){this.ended||EV(this,_V,void 0,"f")},xV=function(e){if(this.ended)return;const t=MV(this,mV,"m",bV).call(this,e);switch(this._emit("event",e),e.type){case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new fU(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new fU(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new fU(`expected content to be 'output_text', got ${t.type}`);this._emit("response.output_text.delta",{...e,snapshot:t.text})}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new fU(`missing output at index ${e.output_index}`);"function_call"===n.type&&this._emit("response.function_call_arguments.delta",{...e,snapshot:n.arguments});break}default:this._emit(e.type,e)}},wV=function(){if(this.ended)throw new fU("stream has ended, this shouldn't happen");const e=MV(this,_V,"f");if(!e)throw new fU("request ended without sending any events");EV(this,_V,void 0,"f");const t=function(e,t){return cV(e,t)}(e,MV(this,gV,"f"));return EV(this,vV,t,"f"),t},bV=function(e){let t=MV(this,_V,"f");if(!t){if("response.created"!==e.type)throw new fU(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=EV(this,_V,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const n=t.output[e.output_index];if(!n)throw new fU(`missing output at index ${e.output_index}`);"message"===n.type&&n.content.push(e.part);break}case"response.output_text.delta":{const n=t.output[e.output_index];if(!n)throw new fU(`missing output at index ${e.output_index}`);if("message"===n.type){const t=n.content[e.content_index];if(!t)throw new fU(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new fU(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const n=t.output[e.output_index];if(!n)throw new fU(`missing output at index ${e.output_index}`);"function_call"===n.type&&(n.arguments+=e.delta);break}case"response.completed":EV(this,_V,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",(n=>{const i=t.shift();i?i.resolve(n):e.push(n)})),this.on("end",(()=>{n=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),this.on("error",(e=>{n=!0;for(const n of t)n.reject(e);t.length=0})),{next:async()=>{if(!e.length)return n?{value:void 0,done:!0}:new Promise(((e,n)=>t.push({resolve:e,reject:n}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0}));return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=MV(this,vV,"f");if(!e)throw new fU("stream ended without producing a ChatCompletion");return e}}class TV extends AF{constructor(){super(...arguments),this.inputItems=new fV(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap((e=>("object"in e&&"response"===e.object&&pV(e),e)))}retrieve(e,t={},n){return rF(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...n})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...null==t?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap((t=>uV(t,e)))}stream(e,t){return SV.createResponse(this._client,e,t)}}class AV extends TF{}TV.InputItems=fV;class CV extends AF{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,GU({body:t,...n}))}}class RV extends AF{constructor(){super(...arguments),this.parts=new CV(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}RV.Parts=CV;class PV extends AF{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}update(e,t,n,i){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...null==i?void 0:i.headers}})}list(e,t={},n){return rF(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,kV,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}async createAndPoll(e,t,n){const i=await this.create(e,t,n);return await this.poll(e,i.id,n)}async poll(e,t,n){const i={...null==n?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for((null==n?void 0:n.pollIntervalMs)&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const r=await this.retrieve(e,t,{...n,headers:i}).withResponse(),a=r.data;switch(a.status){case"in_progress":let e=5e3;if(null==n?void 0:n.pollIntervalMs)e=n.pollIntervalMs;else{const t=r.response.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await pF(e);break;case"failed":case"completed":return a}}}async upload(e,t,n){const i=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,t,n){const i=await this.upload(e,t,n);return await this.poll(e,i.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,OV,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}}class kV extends TF{}class OV extends SF{}PV.VectorStoreFilesPage=kV,PV.FileContentResponsesPage=OV;class IV extends AF{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}async createAndPoll(e,t,n){const i=await this.create(e,t);return await this.poll(e,i.id,n)}listFiles(e,t,n={},i){return rF(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,kV,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...null==i?void 0:i.headers}})}async poll(e,t,n){const i={...null==n?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for((null==n?void 0:n.pollIntervalMs)&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:r,response:a}=await this.retrieve(e,t,{...n,headers:i}).withResponse();switch(r.status){case"in_progress":let e=5e3;if(null==n?void 0:n.pollIntervalMs)e=n.pollIntervalMs;else{const t=a.headers.get("openai-poll-after-ms");if(t){const n=parseInt(t);isNaN(n)||(e=n)}}await pF(e);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},i){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=(null==i?void 0:i.maxConcurrency)??5,a=Math.min(r,t.length),s=this._client,o=t.values(),l=[...n];const c=Array(a).fill(o).map((async function(e){for(let t of e){const e=await s.files.create({file:t,purpose:"assistants"},i);l.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),n=t.filter((e=>"rejected"===e.status));if(n.length){for(const e of n);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const i=[];for(const r of t)"fulfilled"===r.status&&i.push(r.value);return i})(c),await this.createAndPoll(e,{file_ids:l})}}class LV extends AF{constructor(){super(...arguments),this.files=new PV(this._client),this.fileBatches=new IV(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}list(e={},t){return rF(e)?this.list({},e):this._client.getAPIList("/vector_stores",DV,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...null==t?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,NV,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...null==n?void 0:n.headers}})}}class DV extends TF{}class NV extends SF{}var UV;LV.VectorStoresPage=DV,LV.VectorStoreSearchResponsesPage=NV,LV.Files=PV,LV.VectorStoreFilesPage=kV,LV.FileContentResponsesPage=OV,LV.FileBatches=IV;class FV extends JU{constructor({baseURL:e=gF("OPENAI_BASE_URL"),apiKey:t=gF("OPENAI_API_KEY"),organization:n=gF("OPENAI_ORG_ID")??null,project:i=gF("OPENAI_PROJECT_ID")??null,...r}={}){if(void 0===t)throw new fU("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:i,...r,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new fU("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new BB(this),this.chat=new OF(this),this.embeddings=new VB(this),this.files=new YB(this),this.images=new aV(this),this.audio=new NF(this),this.moderations=new lV(this),this.models=new sV(this),this.fineTuning=new rV(this),this.vectorStores=new LV(this),this.beta=new zB(this),this.batches=new UF(this),this.uploads=new RV(this),this.responses=new TV(this),this.evals=new XB(this),this._options=a,this.apiKey=t,this.organization=n,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return eU(e,{arrayFormat:"brackets"})}}UV=FV,FV.OpenAI=UV,FV.DEFAULT_TIMEOUT=6e5,FV.OpenAIError=fU,FV.APIError=mU,FV.APIConnectionError=_U,FV.APIConnectionTimeoutError=vU,FV.APIUserAbortError=gU,FV.NotFoundError=bU,FV.ConflictError=EU,FV.RateLimitError=SU,FV.BadRequestError=yU,FV.AuthenticationError=xU,FV.InternalServerError=TU,FV.PermissionDeniedError=wU,FV.UnprocessableEntityError=MU,FV.toFile=VU,FV.fileFromPath=cU,FV.Completions=BB,FV.Chat=OF,FV.ChatCompletionsPage=PF,FV.Embeddings=VB,FV.Files=YB,FV.FileObjectsPage=$B,FV.Images=aV,FV.Audio=NF,FV.Moderations=lV,FV.Models=sV,FV.ModelsPage=oV,FV.FineTuning=rV,FV.VectorStores=LV,FV.VectorStoresPage=DV,FV.VectorStoreSearchResponsesPage=NV,FV.Beta=zB,FV.Batches=UF,FV.BatchesPage=FF,FV.Uploads=RV,FV.Responses=TV,FV.Evals=XB,FV.EvalListResponsesPage=qB;const zV="/img/rooms/oracle/goo.webp",BV="\n  varying vec2 vUv;\n  void main() {\n    vUv = uv;\n    gl_Position = vec4(position, 1.0);\n  }\n",VV="\n  uniform float iTime;\n  uniform vec2 iResolution;\n  uniform sampler2D iChannel0;\n  uniform vec3 colorScalar;\n  varying vec2 vUv;\n\n  float chladniPattern(float frequency, float phase, vec2 uv, float time, float noise) {\n    float angle = atan(uv.y, uv.x) + pow(noise, 2.0) * 2.0;\n    float radius = length(uv) + pow(noise, 2.0) * 2.0;\n    return sin((frequency + noise * 5.0) * angle + time + noise * phase) + \n           sin((2.0 * frequency + noise * 10.0) * radius - time);\n  }\n\n  void main() {\n    //vec2 uv = vUv * 2.0 - 1.0;\n    vec2 uv = gl_FragCoord.xy / iResolution.xy - vec2(1);\n    \n    float noise = texture2D(iChannel0, vUv).r;\n    noise = noise * 1.0 - 1.0;\n\n    float pattern = chladniPattern(-1.0, 31.0, uv, iTime, noise) + \n                   chladniPattern(1.0, 51.0, uv, iTime, noise);\n    \n    pattern = pattern * 0.25 + 0.5;\n    \n    gl_FragColor = vec4(colorScalar.rgb * vec3(pattern), 1.0);\n    //gl_FragColor = vec4(pattern, pattern, pattern/0.5, 1.0); \n  }\n",HV=new Float32Array([0,.5,8/64,.625,2/64,34/64,10/64,42/64,.75,.25,.875,.375,50/64,18/64,58/64,26/64,12/64,44/64,4/64,36/64,14/64,46/64,6/64,38/64,60/64,28/64,52/64,20/64,62/64,30/64,54/64,22/64,3/64,35/64,11/64,43/64,1/64,33/64,9/64,41/64,51/64,19/64,59/64,27/64,49/64,17/64,57/64,25/64,15/64,47/64,7/64,39/64,13/64,45/64,5/64,37/64,63/64,31/64,55/64,23/64,61/64,29/64,53/64,21/64]);const WV=["c2stcA==","cm9qLQ==","dmt2LQ==","SzJWMA==","VmNkcw==","bWpVUg==","d29sMw==","NlJ1eg==","aC1taQ==","Mi1pMw==","YlNTeA==","WHVGUQ==","Z2pHNQ==","NWJMMQ==","dnQ2Qw==","M3Z2cg==","bDNwMw==","UlJiSA==","Q2htcQ==","VlJQTQ==","RENUMw==","Qmxiaw==","RkpNaA==","QTJwYw==","a1hkbg==","TlVndg==","SFppVw==","RjVLUg==","anhwQQ==","YTZocg==","Vmo3VQ==","cnFLdw==","VzByOA==","SDB1Sw==","WHZaNg==","VmliVg==","N3Z6cQ==","cWZtQQ==","R0tqYQ==","MnJ6eQ==","TWhZQQ=="];function jV(){return WV.map((e=>atob(e))).join("")}const GV=[{role:"system",content:"Answer as a character in a video game about the long term friendship between two girls (vic and nat) who've known each since 13 and are now adults living together in Parc Ex montreal starting an adulterous relationship. Nat is a shy flirtatious nerd type and Vic is a sarcastic/prurient/goofball type (think Megan Fox in Jennifer's Body). They slipped into a horny vortex. Vic's pussy is a wise oracle (w/bits of vic's personality) that can now talk. Answer as the Vic pussy oracle and your interlocuter is Nat. Make the answers concise, wise, mysterious, serious, slightly flirtatious. You may refer to the fact that you're talking to Nat amid a horny vortex."}];function XV({endGame:e}){const t=Hr.useRef(null),n=Hr.useRef(),i=Hr.useRef(),r=Hr.useRef(),a=Hr.useRef(),s=Hr.useRef(),o=Hr.useRef(Date.now()),l=Hr.useRef(null);Hr.useEffect((()=>{if(!t.current)return;l.current=new FV({apiKey:jV(),dangerouslyAllowBrowser:!0});const[e,c]=function(e,t,n,i,r){const a=new UN;e.current=a;const s=new sL(-1,1,1,-1,0,1);t.current=s;const o=new NN({antialias:!0});o.setSize(window.innerWidth,window.innerHeight),n.current.appendChild(o.domElement),i.current=o;const l=new FN(HV,8,8,VR,OR,gk.DEFAULT_MAPPING,vR,vR,ER,ER);l.needsUpdate=!0;const c=new CI({vertexShader:BV,fragmentShader:VV,uniforms:{iTime:{value:0},iResolution:{value:new YP(window.innerWidth,window.innerHeight)},iChannel0:{value:l},colorScalar:{value:new Ek(1,1,2)}}});r.current=c;const u=new qI(2,2),h=new wI(u,c);return a.add(h),[o,c]}(i,r,t,a,s),u=()=>{e.setSize(window.innerWidth,window.innerHeight),c.uniforms.iResolution.value.set(window.innerWidth,window.innerHeight)};window.addEventListener("resize",u);const h=()=>{if(!(s.current&&a.current&&i.current&&r.current))return;const e=(Date.now()-o.current)/1e3;s.current.uniforms.iTime.value=e,a.current.render(i.current,r.current),n.current=requestAnimationFrame(h)};return h(),()=>{window.removeEventListener("resize",u),n.current&&cancelAnimationFrame(n.current),t.current&&a.current&&t.current.removeChild(a.current.domElement),e.dispose()}}),[]);const[c,u]=Hr.useState("meet_oracle"),[h,d]=Hr.useState("oracle"),[p,f]=Hr.useState(""),[m,g]=Hr.useState(""),[_,v]=Hr.useState(null),[y,x]=Hr.useState(0),[w,b]=Hr.useState(-1);Hr.useEffect((()=>{"meet_oracle"===c&&(v(SC.meet_oracle),x(0)),"ask_oracle_questions"===c&&(b(0),g(""),f("")),"farewell_oracle"===c&&(v(SC.farewell_oracle),x(0),s.current.uniforms.colorScalar.value=[1,1,2])}),[c]),Hr.useEffect((()=>{if(null!==_&&"ask_oracle_questions"!==c){const e=_.dialogue[y].text[0],t=0==y?"":_.dialogue[y-1].text[0],n="nat"===h?e:t;f("oracle"===h?e:t),g(n)}}),[_,y,h]),Hr.useEffect((()=>{0===w&&(s.current.uniforms.colorScalar.value=[1,0,.5]),1===w&&(s.current.uniforms.colorScalar.value=[2,0,2]),2===w&&(s.current.uniforms.colorScalar.value=[1,1,0]),3===w&&(s.current.uniforms.colorScalar.value=[1,.5,.5]),f(""),g("")}),[w]);const E=()=>null!==_&&y===_.dialogue.length-1,M="farewell_oracle"===c&&E(),S=async()=>{const t="nat"===h?"oracle":"nat";if(d(t),"meet_oracle"!==c){if("ask_oracle_questions"!==c)"farewell_oracle"!==c||(E()?e():x(y+1));else if(3===w)u("farewell_oracle");else if("nat"===t)b(w+1);else if(""!==m){f("");const e=await(async e=>{const t=l.current;GV.push({role:"user",content:e});let n="";const i=(await t.chat.completions.create({model:"gpt-4o-mini",store:!0,messages:GV})).choices[0].message;return null!==i.content?(n=i.content,GV.push({role:"assistant",content:n})):null!==i.refusal&&(n=i.refusal),n})(m);f(e)}}else E()?u("ask_oracle_questions"):x(y+1)};return Qr.jsxs("div",{className:"oracle-container",children:[Qr.jsx("div",{ref:t,className:"oracle"}),Qr.jsxs("div",{className:"oracle-goo-container-up",children:[Qr.jsx("img",{src:zV,className:"oracle-goo-up"}),Qr.jsxs("div",{className:"oracle-text-area oracle-nat-text-area",children:[(()=>{if("meet_oracle"!==c||0!==y)return"ask_oracle_questions"===c?(()=>{let e="Talk to the oracle...don't be shy...Ask anything..";return 1===w&&(e="Go on... ask another question.."),2===w&&(e="Go on... one last question for the oracle.."),Qr.jsx("textarea",{className:"oracle-question-input",value:m,onChange:e=>g(e.target.value),placeholder:"nat"===h?e:"",autoFocus:"nat"===h,readOnly:"oracle"===h})})():Qr.jsxs(Hr.Fragment,{children:[Qr.jsx("img",{src:TC.nat.avatarImg,className:"oracle-avatar oracle-nat-avatar"}),Qr.jsx("div",{className:"oracle-text oracle-nat-text",children:m})]})})(),"nat"===h&&Qr.jsx("div",{className:"bee "+("ask_oracle_questions"===c?"nat-bee-asking":"nat-bee")})]}),"nat"===h&&Qr.jsx("div",{className:"oracle-ask",children:Qr.jsx("button",{className:"oracle-next-button",title:"Next",onClick:S,children:"→"})})]}),Qr.jsxs("div",{className:"oracle-goo-container-down",children:[Qr.jsx("img",{src:zV,className:"oracle-goo-down"}),Qr.jsxs("div",{className:"oracle-text-area oracle-oracle-text-area",children:["ask_oracle_questions"===c?Qr.jsx(Hr.Fragment,{children:""!==p&&Qr.jsx("div",{className:"oracle-text oracle-answer",children:p})}):Qr.jsxs(Hr.Fragment,{children:[Qr.jsx("img",{src:TC.oracle.avatarImg,className:"oracle-avatar oracle-oracle-avatar"}),Qr.jsx("div",{className:"oracle-text oracle-oracle-text",children:p})]}),"oracle"===h&&Qr.jsx("div",{className:"bee oracle-bee"})]}),"oracle"===h&&Qr.jsx("div",{className:"oracle-next",children:Qr.jsx("button",{className:"oracle-next-button",title:M?"End":"Next",style:M?{fontSize:"2rem"}:{fontSize:"3rem"},onClick:S,children:M?"End":"→"})})]})]})}function qV({endGame:e,debug:t}){const n=Ng(),i=Tg((e=>e.title)),r=Tg((e=>e.header)),a=Tg((e=>e.dayIndex)),s=yC[a],o=Tg((e=>e.itemDisplayed)),l=Tg((e=>e.convoName)),c=Tg((e=>e.prevConvoName)),u=Tg((e=>e.equipped)),h=Tg((e=>e.readingDiary)),d=Tg((e=>e.isSleeping)),p=Tg((e=>e.isInsideBoinksDream)),f=Tg((e=>e.room)),m=Tg((e=>e.subRoom)),[g,_]=Hr.useState(void 0),[v,y]=Hr.useState("auto"),[x,w]=Hr.useState(!1),[b,E]=Hr.useState(!1),[M,S]=Hr.useState(!1),[T,A]=Hr.useState(!1),[C,R]=Hr.useState(null),[P,k]=Hr.useState(null),[O,I]=Hr.useState(0),[L,D]=Hr.useState(0),N=O===L&&0!==L,U=Tg((e=>{if(3!==e.dayIndex||null!==e.hornyVortexPhase)return!1;return Object.entries(e.roomToImgIndex).every((([e,t])=>t===er(e).subRooms[0].img.length-2))}));Hr.useEffect((()=>{U&&n(uv("world_bathed_in_red"))}),[U]),Hr.useEffect((()=>{}),[]),Hr.useEffect((()=>{const e=function(e){const t=[];for(const n in e.actions){const i=e.actions[n];for(const e in i){const n=i[e];for(const e of n)void 0!==e.img&&t.push(e.img)}}return t}(yC[a]);e&&_(e)}),[a]),Hr.useEffect((()=>{for(const e of u){const t=Zi(e);if("cursor"===t.type)return void y(`url(${t.img}) ${t.imgPosition[0]} ${t.imgPosition[1]}, auto`)}y("sunset"===f?"not-allowed":"auto")}),[u,f]),Hr.useEffect((()=>{const e=e=>{"Escape"===e.key&&(b&&E(!1),M&&S(!1),u.length>0&&n(ev([])))};return addEventListener("keydown",e),()=>{removeEventListener("keydown",e)}}),[b,M,u]),Hr.useEffect((()=>{S(!1),A(!1),E(!1)}),[d]);const F=null!==o&&mC(o.name);Hr.useEffect((()=>{!T&&F&&A(!0)}),[o]);const z=Tg((e=>e.inventory));Hr.useEffect((()=>{z.length>0&&A(!0)}),[z]);const B=null!==o||!0===M||!0===b?"blurry":"",V=null===o||F?"":"blurry";return"sunset"===f?(()=>{const t="day3"===s.name?"a vortex forms in steps...":"brilliant orange flame. until tomorrow...";return Qr.jsx(Qr.Fragment,{children:Qr.jsxs(Hr.Fragment,{children:[Qr.jsx(qv,{}),Qr.jsx("div",{className:"main sunset",style:{cursor:v,top:0,height:"100%"},children:"oracle"===m?Qr.jsx(XV,{endGame:e}):Qr.jsxs(Hr.Fragment,{children:[Qr.jsx("div",{className:"main-center",children:Qr.jsx(bC,{day:s})}),Qr.jsx("nav",{className:"nav",children:Qr.jsx("div",{className:"nav-title",children:Qr.jsx("h1",{children:t})})})]})})]})})})():Qr.jsx(Qr.Fragment,{children:Qr.jsxs(Hr.Fragment,{children:[Qr.jsx(qv,{musicToPlay:b?Cv:null,volume:b?.08:1}),void 0!==g&&g.map(((e,t)=>Qr.jsx("link",{rel:"preload",href:e,as:"image"},t))),Qr.jsxs("nav",{className:"nav",children:[Qr.jsxs("div",{children:[Qr.jsx("div",{className:"nav-title",children:Qr.jsx("h1",{children:i})}),Qr.jsx("div",{className:"nav-date",children:Qr.jsx("h1",{children:"൜"+s.date+"൜"})})]}),Qr.jsx("div",{className:"nav-header",children:Qr.jsx("h1",{children:r})}),null!==P&&Qr.jsx("div",{className:"nav-headline",children:Qr.jsx(Kv,{thought:`💭💭💭${P}💭💭💭`,animate:!0})}),Qr.jsxs("div",{className:"nav-links",children:[Qr.jsxs(fC,{type:"big-black-box",style:{borderRightWidth:"0px",position:"relative",backgroundColor:N?"cornsilk":""},tooltip:"The items discovered in this area",children:[O,"/",L,Qr.jsx("span",{className:"item-tally-text",children:" items"}),N&&Qr.jsx("span",{className:"item-tally-sugoi",children:"✓"})]}),Qr.jsx(fC,{type:"big-black-box",style:{borderRightWidth:"0px",cursor:"help",backgroundColor:b?"#ffff0030":""},tooltip:"You need directions?",onClick:d?void 0:()=>E(!b),children:"Map"}),Qr.jsx(fC,{type:"big-black-box",style:{padding:"12px",borderRightWidth:"0px",cursor:"help",backgroundColor:M?"#ffff0030":""},tooltip:"Awwww...you need help?",onClick:d?void 0:()=>{S(!M)},children:"Help"}),Qr.jsx(fC,{type:"big-black-box",tooltip:T?"close purse":"open purse",onClick:d?void 0:()=>A(!T),children:Qr.jsx("img",{src:T?"/img/purse/open_purse.webp":"/img/purse/closed_purse.webp",alt:"Purse"})})]})]}),Qr.jsxs("div",{className:"container",style:{cursor:v},onClick:()=>(b&&E(!1),R(null),k(null),void n(X_())),children:[Qr.jsxs("div",{className:"main",style:{height:null!==l?"80%":"100%"},children:[Qr.jsx("div",{className:`main-left ${B}`,children:!0===t&&Qr.jsx(UC,{debugLinesEnabled:x,setDebugLinesEnabled:e=>w(e),setDeepThought:e=>R(e),setPassingThought:e=>k(e),endGame:()=>e()})}),Qr.jsxs("div",{className:"main-center",children:[!0===p?Qr.jsx(pC,{}):Qr.jsx(bC,{day:s,debugMode:x,setItemsDiscovered:I,setTotalItems:D,canPointAndClick:()=>!1===h&&null===o&&null===l&&!1===M&&!1===b&&null===P&&null===C,className:B}),!0===b&&Qr.jsx("div",{className:"map",children:Qr.jsx("img",{src:"/img/rooms/map.webp"})})]}),Qr.jsx("div",{className:`main-right ${V}`,children:!0===T&&Qr.jsx(EC,{enabled:!M&&!b})})]}),null!==l&&Qr.jsx(AC,{convoName:l,prevConvoName:c,className:B}),null!==C&&Qr.jsx($v,{thought:C}),d&&Qr.jsx(NC,{}),!0===M&&Qr.jsx(CC,{onHelpFinished:()=>S(!1)}),null!==o&&Qr.jsx(_C,{item:o})]}),u.includes("sardine_pen")&&!1===h&&Qr.jsx(RC,{})]})})}const YV="/img/end-screen/open_letter2.gif",$V=["/img/end-screen/closed_letter.webp","/img/end-screen/open_letter1.webp",YV,YV];function KV(){const[e,t]=Hr.useState(!1),[n,i]=Hr.useState(0),r=Hr.useRef(null),a=n===$V.length-1;let s="";switch(n){case 0:s="not-allowed";break;case 1:s="n-resize";break;default:s="pointer"}return Qr.jsxs("div",{className:"end-screen",children:[Qr.jsx(qv,{musicToPlay:a?kv:Mv,volume:.1}),a?Qr.jsx("div",{className:"love-letter-contents",children:"Dear Vic,\nI began making this game shortly after we moved out of Parc Ex and we started hooking up for the first times.\nI wanted to remember the magic of living with you there.\nThis game is dedicated to all those insane moments of my life that you were the catalyst of. After Parc Ex, an even crazier chapter started.\nYou have a way of opening up all the extraodinary possibilities that exist in the simplest of situations.\nYou have a way of animating the world around you.\nYou animate me.\nThank you for everything.\nLove,\nNat\n"}):Qr.jsxs("div",{className:"end-screen-fin",children:[Qr.jsx("img",{src:"/img/people/jigsaw/jigsaw_with_goo.webp",alt:"jigsaw with goo",className:"jigsaw-with-goo"}),Qr.jsx("div",{className:"end-screen-fin-text",children:"Fin"}),Qr.jsxs("div",{className:"end-screen-credits",children:["Programming, Game Design, Art, Writing by Nathalie Raffray.",Qr.jsx("br",{}),"Music by Coil, Chris and Cosey, Yume Nikki Soundtrack, Faten Kanaan, Miss Kittin, etc.",Qr.jsx("br",{}),"None of it would have been possible without my friends, who inspire me immensely."]})]}),Qr.jsxs("div",{className:"love-letter",children:[Qr.jsx("img",{src:$V[n],alt:"love letter",onClick:()=>{if(e){const e=(n+1)%$V.length;i(e),0===e&&t(!1)}},style:{cursor:s}}),!e&&Qr.jsx("div",{className:"love-letter-password",children:Qr.jsxs("form",{onSubmit:function(e){e.preventDefault();const n=r.current.value.toLowerCase();"purrent"!==n&&"purrblent"!==n||(t(!0),i(1))},children:[Qr.jsxs("span",{style:{color:"white"},children:["Say Prurient:"," "]}),Qr.jsx("input",{type:"text",name:"name",ref:r}),Qr.jsx("button",{type:"submit",children:"Enter Password"})]})})]})]})}function ZV(){const[e,t]=Hr.useState(!1),[n,i]=Hr.useState(!1);return e?n?Qr.jsx(KV,{}):Qr.jsx(qV,{endGame:()=>i(!0),debug:!1}):Qr.jsx(ay,{startGame:()=>t(!0)})}rg(document.getElementById("root")).render(Qr.jsx(kg,{store:jv,children:Qr.jsx(Hr.StrictMode,{children:Qr.jsx(ZV,{})})}));
